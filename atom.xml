<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>SoulReader</title>
  <icon>https://www.gravatar.com/avatar/312dad3824ed31000bfdf9be178fd692</icon>
  <subtitle>勤劳刻苦</subtitle>
  <link href="https://lxx1997.github.io/atom.xml" rel="self"/>
  
  <link href="https://lxx1997.github.io/"/>
  <updated>2023-04-10T14:30:43.000Z</updated>
  <id>https://lxx1997.github.io/</id>
  
  <author>
    <name>SoulReader</name>
    <email>1987607597@qq.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>常用的设计模式</title>
    <link href="https://lxx1997.github.io/2023/04/10/web/javascript-design-parttern/"/>
    <id>https://lxx1997.github.io/2023/04/10/web/javascript-design-parttern/</id>
    <published>2023-04-10T14:30:43.000Z</published>
    <updated>2023-04-10T14:30:43.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><pre><code>通过工厂模式，可以让我们使用同一个类时，根据不同传参，创建不同类型的实例以满足我们的需求</code></pre><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">type, data</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;type1&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Type1</span>(data)</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;type2&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Type2</span>(data)</span><br><span class="line">            <span class="attr">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TypeDefault</span>(data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h2><pre><code>抽象模式主要在与对于类的一些结构进行抽象化处理，如果继承于该类的类直接调用，会抛出错误，需要继承类重新实现这个方法主要用于对方法的处理，针对我们传入的类添加其他类的抽象方法，并且实现对象方法</code></pre><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">VehicleFactory</span> =  <span class="keyword">function</span>(<span class="params">subType, superType</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="title class_">VehicleFactory</span>[superType] === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// 创建一个缓存类</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">        <span class="comment">// 继承父类的属性和方法</span></span><br><span class="line">        F.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">VehicleFactory</span>[superType]()</span><br><span class="line">        <span class="comment">// 将子类的constructor 指向子类</span></span><br><span class="line">        subType.<span class="property">constructor</span> = subType</span><br><span class="line">        <span class="comment">// 子类原型继承父类</span></span><br><span class="line">        subType.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">F</span>()</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;未创建&quot;</span> + superType + <span class="string">&quot;抽象类&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">VehicleFactory</span>.<span class="property">Car</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = <span class="string">&quot;car&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">VehicleFactory</span>.<span class="property">Car</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">    <span class="attr">getPrice</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;抽象方法不能调用&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Car</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">price</span> = <span class="number">12312</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">VehicleFactory</span>(<span class="title class_">Car</span>, <span class="string">&quot;Car&quot;</span>)</span><br><span class="line"><span class="title class_">Car</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getPrice</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    returrn <span class="variable language_">this</span>.<span class="property">price</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> car = <span class="keyword">new</span> <span class="title class_">Car</span>()</span><br><span class="line">car.<span class="title function_">getPrice</span>() <span class="comment">// 12312</span></span><br></pre></td></tr></table></figure><h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>单例模式主要保证我们每次 new 或者拿到的实例都是同一个实例，避免创建新的是类</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> instance = <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getInstance</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(instance) &#123;</span><br><span class="line">            <span class="keyword">return</span> instance</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">Factory</span>()</span><br><span class="line">            <span class="keyword">return</span> instance</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><h2 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h2><h2 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h2><h2 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h2><h2 id="原型链模式"><a href="#原型链模式" class="headerlink" title="原型链模式"></a>原型链模式</h2><h2 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h2><h2 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h2><h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><h2 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h2><h2 id="委托模式"><a href="#委托模式" class="headerlink" title="委托模式"></a>委托模式</h2><h2 id="数据访问对象模式"><a href="#数据访问对象模式" class="headerlink" title="数据访问对象模式"></a>数据访问对象模式</h2><h2 id="节流模式"><a href="#节流模式" class="headerlink" title="节流模式"></a>节流模式</h2><h2 id="参与者模式"><a href="#参与者模式" class="headerlink" title="参与者模式"></a>参与者模式</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;工厂模式&quot;&gt;&lt;a href=&quot;#工厂模式&quot; class=&quot;headerlink&quot; title=&quot;工厂模式&quot;&gt;&lt;/a&gt;工厂模式&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;通过工厂模式，可以让我们使用同一个类时，根据不同传参，创建不同类型的实例以满足我们的需求
&lt;/code&gt;&lt;/</summary>
      
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/categories/JavaScript/"/>
    
    <category term="web" scheme="https://lxx1997.github.io/categories/web/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>数组部分方法原理重写</title>
    <link href="https://lxx1997.github.io/2023/04/08/web/array-methods-rewrite/"/>
    <id>https://lxx1997.github.io/2023/04/08/web/array-methods-rewrite/</id>
    <published>2023-04-08T09:11:23.000Z</published>
    <updated>2023-04-08T09:11:23.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property">prototye</span>.<span class="property">map</span> = <span class="keyword">function</span> (<span class="params">cb</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> cb !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;callback is not function&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> arr = []</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    arr.<span class="title function_">push</span>(<span class="title function_">cb</span>(<span class="variable language_">this</span>[i]))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property">prototye</span>.<span class="property">filter</span> = <span class="keyword">function</span> (<span class="params">cb</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> cb !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;callback is not function&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> arr = []</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> flag = <span class="title function_">cb</span>(<span class="variable language_">this</span>[i])</span><br><span class="line">    <span class="keyword">if</span>(flag) &#123;</span><br><span class="line">      arr.<span class="title function_">push</span>(<span class="variable language_">this</span>[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property">prototye</span>.</span><br><span class="line"> = <span class="keyword">function</span> (<span class="params">cb, total</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> cb !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;callback is not function&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    total = <span class="title function_">cb</span>(total, <span class="variable language_">this</span>[i])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="some"><a href="#some" class="headerlink" title="some"></a>some</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property">prototye</span>.<span class="property">some</span> = <span class="keyword">function</span> (<span class="params">cb</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> cb !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;callback is not function&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> flag = <span class="title function_">cb</span>(<span class="variable language_">this</span>[i])</span><br><span class="line">    <span class="keyword">if</span>(flag) &#123;</span><br><span class="line">      <span class="keyword">return</span> flag</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="every"><a href="#every" class="headerlink" title="every"></a>every</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property">prototye</span>.<span class="property">every</span> = <span class="keyword">function</span> (<span class="params">cb</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> cb !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;callback is not function&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> flag = <span class="title function_">cb</span>(<span class="variable language_">this</span>[i])</span><br><span class="line">    <span class="keyword">if</span>(!flag) &#123;</span><br><span class="line">      <span class="keyword">return</span> flag</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;map&quot;&gt;&lt;a href=&quot;#map&quot; class=&quot;headerlink&quot; title=&quot;map&quot;&gt;&lt;/a&gt;map&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span</summary>
      
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/categories/JavaScript/"/>
    
    <category term="web" scheme="https://lxx1997.github.io/categories/web/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>个人整理的比较全的知识 - 方便自己回顾</title>
    <link href="https://lxx1997.github.io/2023/04/04/interview/%E9%9D%A2%E8%AF%95%E9%A2%98-01/"/>
    <id>https://lxx1997.github.io/2023/04/04/interview/%E9%9D%A2%E8%AF%95%E9%A2%98-01/</id>
    <published>2023-04-04T09:15:19.000Z</published>
    <updated>2023-04-10T15:15:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="更全的面试题"><a href="#更全的面试题" class="headerlink" title="更全的面试题"></a>更全的面试题</h2><p><a href="https://github.com/febobo/web-interview">vue 生态面试题</a></p><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><h4 id="新增的-h5-属性"><a href="#新增的-h5-属性" class="headerlink" title="新增的 h5 属性"></a>新增的 h5 属性</h4><ul><li>标签类 <code>header</code>,<code>footer</code>,<code>aside</code>,<code>nav</code>,<code>article</code></li><li>媒体播放标签 <code>audio</code>,<code>video</code></li><li>canvas svg 等</li><li>存储属性 localStorage,sessionStorage</li><li>input 标签新增type 属性 <code>email</code>,<code>password</code>,<code>file</code>,<code>tel</code>,<code>date</code>,<code>url</code> 等</li></ul><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><h4 id="BFC-块级格式化上下文"><a href="#BFC-块级格式化上下文" class="headerlink" title="BFC 块级格式化上下文"></a>BFC 块级格式化上下文</h4><p>是块级盒子的布局过程发生的区域，也是浮动元素与其他元素交互的区域。</p><p>特性：</p><ul><li>块级元素会在垂直方向一个接一个排列</li><li>避免子元素的margin 属性影响父元素</li><li>保证子元素的属性只在BFC盒内起作用，不会影响盒外的其他元素</li><li>如果子元素有 float 或者 </li></ul><p>触发方式：</p><ul><li>float: left/right</li><li>position: absolute/fixed</li><li>overflow: hidden/hidden-x/hidden-y</li><li>display: inline-block/flex/gid</li></ul><h4 id="如何解决高度塌陷"><a href="#如何解决高度塌陷" class="headerlink" title="如何解决高度塌陷"></a>如何解决高度塌陷</h4><ul><li>:after { clear: both;} 或者在父元素内部最后新增一个元素设置 style  clear: both;</li><li>设置 position: absolute</li><li>overflow: hidden</li></ul><h4 id="元素水平垂直居中的方法"><a href="#元素水平垂直居中的方法" class="headerlink" title="元素水平垂直居中的方法"></a>元素水平垂直居中的方法</h4><ul><li><code>display: flex; align-items: center;justify-content: space-around;</code></li><li><code>position:absolute; top:50%;left:50%;transform: translate(-50%, -50%)</code></li><li><code>display: grid; align-items: center;justify-content: space-around;</code></li><li><code>margin-top:50%;margin-left:50%;transform: translate(-50%, -50%)</code></li><li>定高的话可以使用 margin-left偏移自身一般宽度和高度</li></ul><h4 id="flex-布局"><a href="#flex-布局" class="headerlink" title="flex 布局"></a>flex 布局</h4><p>有哪些属性</p><ul><li>flex-direction  布局方向 row/row-reverse/column/column-reverse</li><li>flex-wrap 是否换行</li><li>flex-flow flex-direction 和 flex-wrap 的简写模式</li><li>justify-content  主轴上的对齐方式 flex-start/flex-end/space-around/space-between/space-evenly/center</li><li>align-items: 交叉轴 flex-start/flex-end/center/base-line(以第一行文字基线对齐)/stretch</li><li>align-content 多根轴线对齐 flex-start/flex-end/space-around/space-between/space-evenly/center</li></ul><p>子元素属性</p><ul><li>order 定义项目排列顺序，数值越大越靠后</li><li>flex 设置 flex-grow/flex-shrik/flex-basic 的缩写</li><li>flex-grow 是否放大 默认为0</li><li>flex-shrink 是否缩小  默认为1</li><li>flex-basic 占据主轴空间</li><li>align-self 单独设置子元素的对齐方式,可以使部分子元素与其他子元素对齐方式不同 flex-start/flex-end/center/base-line(以第一行文字基线对齐)/stretch</li></ul><h4 id="css-选择器优先级"><a href="#css-选择器优先级" class="headerlink" title="css 选择器优先级"></a>css 选择器优先级</h4><p>css 选择器有以下几种</p><ul><li>ID 选择器 <code>id=&quot;abc&quot;</code></li><li>类（class）选择器 <code>class=&quot;abc&quot;</code></li><li>标签选择器  <code>div</code></li><li>标签属性选择器  <code>div[title=&quot;abc&quot;]</code></li><li>伪类和伪元素 <code>after,before,selection,focus,hover,active,</code></li><li>父子选择器 <code>div &gt; p</code>  </li></ul><p>其中 ID 选择器的权重最高，接着是类选择器，最后是标签选择器</p><h4 id="常用的-css-库"><a href="#常用的-css-库" class="headerlink" title="常用的 css 库"></a>常用的 css 库</h4><ul><li>reset.css       是一个css文件，用来重置css样式的。</li><li>normalize.css   为了增强跨浏览器渲染的一致性，一个CSS 重置样式库。<h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><h4 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h4></li></ul><p>基础数据类型有</p><ul><li>Number</li><li>String</li><li>Boolean</li><li>Null</li><li>Undefined</li><li>Symbol</li><li>Bigint (新增的，因为是为了兼容大数)</li></ul><p>引用数据</p><ul><li>Object</li></ul><p>如何判断数据类型</p><ul><li>typeof  需要注意的是 typeof null = object, typeof func() {} = function</li><li>instanceof 原理是根据原型链来查找的</li><li>Object.prototype.toString.call() 会返回对应元素类型 <code>[object Object/Array/RegExp/...]</code></li></ul><h4 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h4><ul><li>显示转换，比如使用 parseInt，Number，String，Boolean 方法强制进行转换</li><li>隐式转换，进行数据运算和 === 操作时，对象会调用 valueOf 方法进行转换，基础数据类型会根据内容进行隐式转换</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = &#123;</span><br><span class="line">  <span class="attr">valueOf</span>: <span class="function">() =&gt;</span> <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line">a + <span class="number">1</span> <span class="comment">//  5</span></span><br><span class="line"><span class="keyword">let</span> b = &#123;&#125;</span><br><span class="line">b + <span class="number">1</span> <span class="comment">// &quot;[object Object]1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c = []</span><br><span class="line">c + <span class="number">1</span> <span class="comment">// &quot;1&quot;</span></span><br><span class="line"><span class="literal">true</span> + <span class="number">1</span> <span class="comment">// 2</span></span><br><span class="line"><span class="literal">false</span> + <span class="number">1</span> <span class="comment">// 1</span></span><br><span class="line"><span class="string">&quot;&quot;</span> + <span class="number">1</span> <span class="comment">// &quot;1&quot;</span></span><br></pre></td></tr></table></figure><h4 id="你能写出多少种数组的方法"><a href="#你能写出多少种数组的方法" class="headerlink" title="你能写出多少种数组的方法"></a>你能写出多少种数组的方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">map       filter        reduce        reduceRight       some</span><br><span class="line">every     <span class="keyword">from</span>          <span class="keyword">of</span>            fill              join</span><br><span class="line">splice    slice         find          findIndex         findLast</span><br><span class="line">indexOf   lastIndexOf   forEach       concat            findLastIndex   </span><br><span class="line">includes  contains      values        keys              entries</span><br><span class="line">at        flat          isArray       sort              pop</span><br><span class="line">push      unshift       shift         toString          toLocaleString</span><br></pre></td></tr></table></figure><h4 id="你能写出多少种字符串方法"><a href="#你能写出多少种字符串方法" class="headerlink" title="你能写出多少种字符串方法"></a>你能写出多少种字符串方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">split     substr        substring     match             <span class="built_in">parseInt</span></span><br><span class="line">repeat    replace       replaceAll    concat            <span class="built_in">parseFloat</span></span><br><span class="line">endsidth  startsWidth   padStart      padEnd            toLowerCase</span><br><span class="line">toUpperCase toLocaleLowerCase toLocaleUpperCase codeAt  charCodeAt</span><br><span class="line">valueOf   includes      trim          trimStart</span><br></pre></td></tr></table></figure><h4 id="多维数组转成一维数组的方法"><a href="#多维数组转成一维数组的方法" class="headerlink" title="多维数组转成一维数组的方法"></a>多维数组转成一维数组的方法</h4><ul><li>flat  传参为 number，平铺层级</li><li>reduce + 递归  使用 reduce + 递归的方式</li><li>for + 递归   for 循环加递归</li></ul><h4 id="数组去重的方法"><a href="#数组去重的方法" class="headerlink" title="数组去重的方法"></a>数组去重的方法</h4><ul><li>es6 Set 方法会自动去重</li><li>使用 hash，对象的键是具有唯一性的</li><li>简单的遍历，使用新的数组来承载去重后的数组，可以用 indexOf,includes 等方法判断元素是否存在<br>… …</li></ul><p>中心思想是如何去重，使用说明方法并不固定</p><h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>闭包是一个函数及其捆绑的周边环境状态的引用的组合，闭包可以使开发者从内部函数访问外部函数的作用域。</p><ul><li>可以用来实现函数柯里化（将多个参数转变成单个参数传入<code>func(a,b,c) =&gt; func(a)(b)(c)</code>）</li><li>可以用来模拟私有方法，因为闭包内部的部分变量和方法，函数外部无法访问</li><li>闭包还可以用来解决变量提升的问题。</li></ul><p>使用闭包需要注意内存泄露问题，因为这些作用域不会随着函数的执行而清除掉</p><h4 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h4><p>javascript对象上有一个属性，可以通过这个属性查找到她的原型，而且原型上也有这个属性，可以一级一级的向上查找</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line">obj.<span class="property"><span class="keyword">prototype</span></span> === <span class="literal">undefined</span></span><br><span class="line">obj.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">func</span> () &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> f = <span class="keyword">new</span> <span class="title function_">func</span>()</span><br><span class="line">f.<span class="property">__proto__</span> === func.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line">func.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span> </span><br></pre></td></tr></table></figure><p>当我们在查找一个对象的属性的时候，如果当前对象不存在这个属性，则会沿着原型链一级一级的向上查找，直查找到最后一级，也就是 Object 对象上</p><p><strong>需要注意的是在原型链上查找比较耗时和消耗性能，如果层级比较深的话，可以选择暂存下来</strong></p><p><strong>原型链上的属性和方法最好不要随意修改，否则可能会影响其他继承于该原型的函数</strong></p><h4 id="this-指向"><a href="#this-指向" class="headerlink" title="this 指向"></a>this 指向</h4><ul><li><p>直接执行 this 指向 window</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">func</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">func</span>() <span class="comment">// window</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">func</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> f1 = obj.<span class="property">func</span></span><br><span class="line"><span class="title function_">f1</span>() <span class="comment">// window</span></span><br></pre></td></tr></table></figure></li><li><p>挂载到对象上执行  this指向当前对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">func</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="title function_">func</span>() <span class="comment">// obj</span></span><br></pre></td></tr></table></figure></li><li><p>new<br>使用new 的时候会执行以下几个操作</p><ol><li>创建一个新的空对象</li><li>将当前空对象的 prototype 指向当前函数的 prototype</li><li>将前端对象替换当前函数的执行上下文（this）</li><li>判断函数是否存在返回值，返回值如果是基础数据类型，则this 还是 创建的空对象，否则是return 的对象</li></ol></li><li><p>call，bind，apply<br>call 和 apply 会立即执行函数，同时将函数的this 指向传入的this<br>bind 不会立刻执行，而且参数可以不用一次性传入</p><ul><li>call(this, …args) </li><li>bind(this, …args) </li><li>apply(this, args)</li></ul></li></ul><h4 id="事件循环-Event-Loop"><a href="#事件循环-Event-Loop" class="headerlink" title="事件循环 (Event Loop)"></a>事件循环 (Event Loop)</h4><ul><li>宏任务（setTimeout，setInterval，script，ajax）</li><li>微任务（Promise.then, requestAnimationFrame， process.nextTic, Object.observer, MutationObserver(监察dom节点变化)）</li><li>同步任务 正常js解析，js代码执行等</li></ul><p>函数的执行顺序是</p><ul><li>如果存在同步任务，会先执行同步任务</li><li>同步任务执行完成后，先查找微任务队列中是否包含任务，如果包含需要执行的任务，会立即执行</li><li>微任务队列执行完成之后才会去判断宏任务中是否存在需要执行的任务，宏任务每次执行的时候都需要判断微任务队列中是否包含需要执行的任务</li></ul><h4 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h4><ul><li>Promise.resolve() 返回一个以给定值解析后的 Promise 对象</li><li>Promise.reject() 返回一个带有拒绝原因的 Promise 对象。</li><li>Promise.then() 返回一个 Promise 对象，有两个回调函数，一个成功的回调，一个失败情况的回调</li><li>Promise.catch() 返回一个 Promise 对象，只有一个失败情况的回调</li><li>Promise.finally() 无论成功和失败都会执行</li><li>Promise.all() 当所有的 Promise 成功后才回返回成功，结果按顺序返回，有一个失败就返回失败</li><li>Promise.race() 只要有一个 Promise 成功或者失败，就是返回一个成功或者失败的结果</li><li>Promise.allSettled() 当所有的 Promise 的结果都获取到才返回，不管成功还是失败</li><li>Promise.any() 只要有一个 Promise 成功就会返回成功的结果，全部失败才会返回失败的结果</li></ul><p><a href="https://lxx1997.github.io/2023/03/13/web/hand-write-promise/">手写一个 Promise 方法</a></p><h4 id="Proxy-Rflect"><a href="#Proxy-Rflect" class="headerlink" title="Proxy/Rflect"></a>Proxy/Rflect</h4><p>Proxy 对象用于创建一个对象的代理，实现对基本操作的拦截</p><p><em>类似于 Object.defineProperties,但是比她的功能更强大</em></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">obj, key, value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(obj, key, value)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">obj, key, value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(obj, key, value)</span><br><span class="line">    <span class="keyword">return</span> obj[key]</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line">obj.<span class="property">a</span> = <span class="number">20</span></span><br><span class="line">o.<span class="property">a</span></span><br><span class="line">o.<span class="property">a</span> = <span class="number">30</span></span><br></pre></td></tr></table></figure><p><strong>需要注意的是，只有通过代理后的对象修改和获取属性时，才会触发代理，原对象修改和删除并不会触发</strong></p><p><strong>handler 配置属性</strong></p><ul><li>get   属性读取操作</li><li>set   属性设置操作</li><li>has   in操作符 </li><li>deleteProperty  delete 操作符</li><li>ownKeys Object.getOwnPropertyNames 方法和 Object.getOwnPropertySymbols 方法的捕捉器。</li><li>apply   函数调用时触发</li><li>construct   使用 new 操作符触发</li><li>getPrototypeOf  获取原型对象扑捉器 Object.getPrototypeOf</li><li>setPrototypeOf  设置原型对象扑捉器 Object.setPrototypeOf</li><li>isExensible   Object.isExtensible 方法的捕捉器 是否是可扩展的</li><li>preventExtensible   Object.preventExtensions 方法的捕捉器。设置对象不可扩展</li><li>getOwnPropertyDescriptor  获取对象的属性描述（value,configurable,writable,get,set,enumerable）</li><li>defineProperty  Object.defineProperty 方法的捕捉器。</li></ul><p>Reflect 方法同理，主要用来对 Proxy 对应属性的映射</p><h4 id="能说一下-Set和-weakSet-Map和-weakMap-有什么区别吗？"><a href="#能说一下-Set和-weakSet-Map和-weakMap-有什么区别吗？" class="headerlink" title="能说一下 Set和 weakSet Map和 weakMap 有什么区别吗？"></a>能说一下 Set和 weakSet Map和 weakMap 有什么区别吗？</h4><p>主要区别在 weakMap 和 weakSet 存储的键值对是不会被垃圾清理进行标记和计数的，也就是说，在进行垃圾清理的时候，如果浏览器判断这个元素需要被清除掉，那么它就会从 weakMap 和 weakSet 中清除掉</p><p>而map 和 set 并没有这种操作</p><h4 id="ES6-新增了哪些内容"><a href="#ES6-新增了哪些内容" class="headerlink" title="ES6 新增了哪些内容"></a>ES6 新增了哪些内容</h4><p>ES6 现在统一作为 ECMA2015 以后的 javascript 版本的统称，主要新增了一下内容</p><ul><li>新增let，const 命名变量(解决变量提升问题)</li><li>箭头函数（没有this，this的执行为定义的时候上下文，无法使用new，call，bind，apply 等操作更改this）</li><li>解构赋值（包含有 symbol.iterator 方法的对象都支持）</li><li>class 语法糖（继承和封装）</li><li>promise，async/await（将异步函数转成同步方法）</li><li>map/set（将对象的键值对分别存储，允许使用对象作为键）</li><li>数组新增了 map，filter，reduce，some，every 等方法</li><li>for … of …</li></ul><h4 id="class-语法糖"><a href="#class-语法糖" class="headerlink" title="class 语法糖"></a>class 语法糖</h4><ul><li>constructor 构造方法，new 的时候会执行 constructor 里面的代码</li><li>get set 方法  对某个属性设置存值函数和取值函数，拦截该属性的存取行为</li><li>static 静态方法 静态方法只能在类上直接调用，无法再实例上调用<br>，并且可以被子类继承</li><li>私有属性和私有方法，只能在类内部访问的属性和方法，可以用 <code>#</code> 来标记，不可以在类的外面使用，可以通过this来访问</li><li><p>new.target 在类里面指向当前类</p><h4 id="面对对象编程"><a href="#面对对象编程" class="headerlink" title="面对对象编程"></a>面对对象编程</h4></li><li><p>面向过程编程：会将事情分为一个个函数和数据，按照一定的是顺序执行。</p></li><li>面向对象编程：将一个事情抽象成对象的概念，然后给对象赋予一些属性和方法，然后将每个对象执行自己的方法。因此易于维护，易复用，易扩展</li></ul><p>面对对象编程 三大基本特性：封装，继承，多态</p><h4 id="AMD-CommonJs，ES6-mdoule-之间的区别"><a href="#AMD-CommonJs，ES6-mdoule-之间的区别" class="headerlink" title="AMD CommonJs，ES6 mdoule 之间的区别"></a>AMD CommonJs，ES6 mdoule 之间的区别</h4><ul><li><p>AMD 异步模块加载，通过 define 定义模块，require 引用模块，模块加载完成后通过 回调函数执行代码</p></li><li><p>commonJs 通过 module.exports 导出模块，require 引入模块，模块内部变量只在内部起作用，不会污染全局，并且是同步加载的</p></li><li><p>ES6 module 通过 export 和 export default 导出模块，import 引入模块，加入了treeShaking，只会编译和打包被使用的模块。也支持动态加载</p></li></ul><h2 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h2><h4 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h4><ul><li><p>引用计数<br>引用计数的原理当创建和引用对象时，都会给该对象的引用次数加1，当给变量重新赋值或者执行的上下文清除时，引用次数 -1，当引用次数为0的时候，会被清除的。</p><p>缺点是当出现循环引用的时候，由于引用计数一直不为0，所以无法被清除</p></li><li><p>标记清除<br>当变量进入执行环境时，会标记状态为进入，当弹出执行环境时，会标记状态为清除，标记状态为清除的会自动被js引擎清除</p><p>缺点是容易造成内存碎片化</p></li><li><p>标记整理法<br>同标记清除，会在清除后重新整理内存地址</p></li><li><p>垃圾回收优化<br>将内存分为 新生代和老生代，新生代缓存的是存活时间比较短的地址，老生代缓存的是存活时间久的地址</p><p>同时新生代又分为使用区和空闲区（双缓存），在进行清除时，会将使用区的变量的标记进行判断，如果被标记，则放到空闲区内，并且进行内存整理，最后将使用区的内存清空，并将使用区变成空闲区，空闲区变成使用区，并重复上述操作</p></li><li><p>内存泄露</p><ul><li>循环引用</li><li>闭包</li><li>没有终止的 setInterval </li></ul></li></ul><h4 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h4><p><a href="https://lxx1997.github.io/2022/06/24/web/how-to-make-pagespeed-fast/">最全的页面性能优化</a></p><h4 id="输入一个链接地址到显示到页面上具体经过了那些步骤"><a href="#输入一个链接地址到显示到页面上具体经过了那些步骤" class="headerlink" title="输入一个链接地址到显示到页面上具体经过了那些步骤"></a>输入一个链接地址到显示到页面上具体经过了那些步骤</h4><ul><li><p>浏览器首先会根据输入的网址，进行 DNS 域名解析找到对应服务器的ip地址</p></li><li><p>建立连接 （TCP/IP 协议）三次握手 客户端向服务端发送SYN 服务器恢复 SYN-ACK,最后客户端发送 ACK 报文</p></li><li><p>发送请求（请求头，请求体）到服务器，服务器会根据传入的地址，找到对应的文件返回到客户端</p></li><li><p>客户端下载文件后，会解析文件，将标签和样式通过对应的parse 转化为 dom 树和 CSSOM 树</p></li><li><p>如果在解析的过程中遇到 script 标签，如果script 标签没有引用外部文件，则会停止文件解析，等待 script 内部代码执行完成后才会继续解析，如果引入了外部文件，则会根据 defer 属性和 async 属性，来判断是否延迟加载 js文件。</p></li><li><p>将生成的 DOM 树和 CSSOM 树合并形成渲染树，进行布局计算，将计算结果会渲染屏幕上</p></li><li><p>渲染时涉及到图层的概念（position，translae3d，will-change, transform）,启动GPU加速，将所有图层最后组合到页面上正成最终结果</p></li></ul><h4 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h4><ul><li><p><code>cache-control</code></p><ul><li><code>max-age</code> 最大缓存时间</li><li><code>no-store</code>  浏览器不会进行缓存，也不会进行协商缓存</li><li><code>no-cache</code>  浏览器进行协商缓存通过 <code>ETag/If-Match</code> 和 <code>last-modified</code></li><li><code>public</code> 可以被任何缓存例如共有缓存（CDN）和私有缓存（浏览器）</li><li><code>private</code> 仅可被私有缓存（浏览器）缓存</li></ul></li><li><p>强缓存：<br>强缓存主要是向浏览器缓存区获取文件，并且根据文件是否失效（<code>max-age</code>/<code>exproes</code>）来判断是否需要重新重服务器拿取文件</p></li><li><p>协商缓存：<br>当强缓存失效时，会走协商缓存，协商缓存不会直接从浏览器缓存中拿取数据，而是直接向服务器发送请求，服务器根据 ETag 和 last-Modified 参数和服务器文件进行对比，如果发生变更，则代表文件已修改，返回给客户端最新的文件，如果没有变更再去读取本地缓存的文件</p></li><li><p>缓存类型</p><ul><li>server-work （sw.js）走的是server-work 的缓存逻辑</li><li>memory cache  存在内存中，如果关闭tab页缓存会失效</li><li>disk cache  存在磁盘缓存中</li></ul></li></ul><h4 id="重绘和重排-回流"><a href="#重绘和重排-回流" class="headerlink" title="重绘和重排(回流)"></a>重绘和重排(回流)</h4><ul><li>重绘 是指元素自身属性发生变化时，并不会影响其他元素位置和属性变化，例如：color，opciaty，backgound等</li><li>重排是指元素本身的物理尺寸发生变化时，引起页面重新排列，列如修改宽，高，外边距，内边距，边框，添加和删除元素，display: none等</li></ul><p><strong>如何避免频繁触发重绘和重排</strong></p><ul><li>如果涉及到频繁修改样式，可以采用统一修改的方式，例如，添加 class 或者 cssText</li><li>设置 position: absolute 脱离文档流</li><li><p>这是 transform 和 will-change 属性，启动 gpu加速</p></li><li><p>修改元素时批量修改</p><ul><li>设置 display: none;修改完成后在显示出来</li><li>使用文档片段 （document.createDocumentFragment()）</li><li>创建一个熄灯节点，用来更新内容，更新换成后替换旧节点</li></ul></li><li><p>获取以下属性和方法时，页面会被强制更新，因为这些属性需要根据页面上元素的最新状态进行更新<br>offsetTop、offsetLeft、offsetWidth、offsetHeight<br>scrollTop、scrollLeft、scrollWidth、scrollHeight<br>clientTop、clientLeft、clientWidth、clientHeight<br>getComputedStyle()<br>getBoundingClientRect</p></li></ul><h4 id="HTTP1-HTTP2"><a href="#HTTP1-HTTP2" class="headerlink" title="HTTP1/HTTP2"></a>HTTP1/HTTP2</h4><ul><li><p>HTTP1.0  在 HTTP1.0 中，每发送一次请求，都要与服务器建立一次连接，请求完成后，连接会立即中断，再加上浏览器对于请求并发的限制，如果有一个请求一直处于padding 状态，则会影响后续接口的请求</p></li><li><p>HTTP1.1 则支持长连接，以及多个请求共用一次连接，然后返回结果根据请求顺序进行返回，虽然减少了连接次数，但是由于需要按照顺序返回，因此一旦有一个请求处于padding 状态，后面的接口即使结果已经拿到也不会返回给前端，而是等padding 结束后才返回给前端</p></li><li><p>HTTP2.0 支持多路复用以及二进制传输，首部压缩等操作，</p><ul><li>多路复用 同一个tcp连接，可以同时发送多个请求和回应</li><li>二进制分帧 每一个请求和回应都生成一个独特的id，客户端和服务端根据id拿取数据，这样不会发生 堵塞影响后续接口数据传输</li><li>头部压缩 客户端和服务端同时维护一套 头部信息键值对，可以减少数据传输量</li></ul></li></ul><h4 id="HTTP-HTTPS"><a href="#HTTP-HTTPS" class="headerlink" title="HTTP/HTTPS"></a>HTTP/HTTPS</h4><ul><li><p>HTTP 超文本运输协议，是实现网络通信的一种规范,可以将信息从一个设备发送到另一个设备</p></li><li><p>HTTPS 在 HTTP 的基础上添加了加密协议（SSL/TLS）传输的信息是1进行加密过的，但是由于需要进行加密验证，所以性能方法消耗比较大</p></li></ul><h4 id="跨域出现的原因及解决方法"><a href="#跨域出现的原因及解决方法" class="headerlink" title="跨域出现的原因及解决方法"></a>跨域出现的原因及解决方法</h4><p>出现原因：主要是同源策略，避免其他服务器的攻击，什么是同源策略呢？就是域名，端口号，还有协议必须要一样，如果有一个不一样，就不满足同源策略</p><p>解决方式：</p><ul><li>jsonp 主要利用script 标签不会被同源策略影响</li><li>postMessage</li><li>cor 后端通过设置 Access-Control-Allow-Origin 参数，允许白名单域名进行访问</li><li>document.domain</li></ul><h4 id="事件流"><a href="#事件流" class="headerlink" title="事件流"></a>事件流</h4><p>浏览器事件触发会经历三个阶段</p><ol><li>事件捕获阶段（由最外层元素，向目标元素查找）</li><li>目前事件阶段（触发事件元素）</li><li>事件冒泡阶段（由目标元素向直至最外层元素）</li></ol><p>事件类型又分为三种</p><ol><li>原始事件 (on + 事件名) 相同事件只能存在一个，后面的会覆盖前面的</li><li>标准事件 (addEventListener) 相同事件可以绑定多个函数，这些函数都会触发</li></ol><h4 id="web-常见的攻击方式"><a href="#web-常见的攻击方式" class="headerlink" title="web 常见的攻击方式"></a>web 常见的攻击方式</h4><ul><li>XSS (跨站脚本攻击)</li><li>CSRF 跨站请求伪造</li><li>SQL 注入</li></ul><p>解决方式：</p><ol><li>尽量不要使用 innerHTML,如需使用，需要对内容进行转码或者过滤等操作</li><li>对于发送给服务端数据，需要进行转码操作</li><li>针对 CSRF 进行同源检测，token验证等</li><li>针对SQL 注入，过滤和转义特殊字符串，检查输入内容，提前进行拦截</li></ol><h4 id="CDN-缓存"><a href="#CDN-缓存" class="headerlink" title="CDN 缓存"></a>CDN 缓存</h4><p>CDN (全称 Content Delivery Network)，即内容分发网络，构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN 的关键技术主要有内容存储和分发技术。</p><p>当开启 CDN 缓存时，用户访问文件时，会首先访问 CDN 距离用户地区最近站点查找，如果查找到文件，会根据文件缓存时间是否过期等信息判断是返回缓存的文件还是向服务器重新拿取文件，如果没有找到则会向服务拉取最新文件进行缓存，并且发送给客户端</p><p>可以通过修改文件名称，修改路径地址，清空对应文件 CDN 缓存。</p><h4 id="SEO-优化"><a href="#SEO-优化" class="headerlink" title="SEO 优化"></a>SEO 优化</h4><ul><li>title，meta标签（description，keywords,og:title…）</li><li>image alt 和 src 属性</li><li>link conial</li><li>a 标签的 href 属性</li><li>p 标签和 H1-6 标签</li><li>结构化数据（HowTo,Prodduct,Score…）</li></ul><h2 id="Vue2"><a href="#Vue2" class="headerlink" title="Vue2"></a>Vue2</h2><h4 id="常用指令"><a href="#常用指令" class="headerlink" title="常用指令"></a>常用指令</h4><ul><li>v-if</li><li>v-else</li><li>v-else-if</li><li>v-show</li><li>v-for</li><li>v-html</li><li>v-text</li><li>v-bind</li><li>v-on</li><li>v-model</li><li>v-once</li><li>v-slot 插件</li></ul><h4 id="常用修饰符"><a href="#常用修饰符" class="headerlink" title="常用修饰符"></a>常用修饰符</h4><ul><li>number</li><li>.lazy v-model 监听change 而非 input</li><li>keyup/keydown</li><li>trim</li><li>prevent/stop 阻止默认事件</li><li>once 只执行一次</li><li>right/left 鼠标左右键点击触发</li><li>camel 将属性转驼峰</li></ul><h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><p>beforeCreate<br>created<br>beforeMount<br>mounted<br>beforeUpdate<br>updated<br>beforeDestory<br>destoryed<br>errorCaptured 错误监听<br>activited  keep-alive<br>deactivited keep-alive</p><h4 id="组件通讯"><a href="#组件通讯" class="headerlink" title="组件通讯"></a>组件通讯</h4><ul><li>父子组件通讯<ul><li>props</li><li>provide/inject</li><li>$emit</li><li>$parent/$children</li><li>$ref</li><li>event bus</li></ul></li><li>兄弟组件<ul><li>通过父组件传值</li><li>$parent</li><li>event bus</li></ul></li><li>不相关组件<ul><li>event bus</li><li>Vuex</li></ul></li></ul><p><a href="https://lxx1997.github.io/2021/01/07/vue/vue-components-transfer-data/">Vue 组件之间通讯的各种情况</a></p><h4 id="computed-和-watch"><a href="#computed-和-watch" class="headerlink" title="computed 和 watch"></a>computed 和 watch</h4><ul><li>computed 计算属性，计算后的结果值会被缓存下来，如果相关联的属性没有发生变化时，会取缓存后的结果</li><li>watch 监听属性，当属性发生变化时，会重新执行监听函数，针对对象可以使用 immediate 和 deep 来启动立即监听和深度监听</li></ul><p>在日常使用中更推介使用computed 属性，因为会对得到的结果进行缓存，减少计算量</p><h4 id="diff-算法-（双指针遍历）"><a href="#diff-算法-（双指针遍历）" class="headerlink" title="diff 算法 （双指针遍历）"></a>diff 算法 （双指针遍历）</h4><p>当组件创建和更新时，vue会执行内部的update函数，该函数使用render函数生成的虚拟dom树，将新旧两树进行对比，找到差异点，最终更新到真实dom</p><p>对比差异的过程叫diff，vue在内部通过一个叫patch的函数完成该过程</p><p>在对比时，vue采用深度优先、同级比较的方式进行比对。同级比较就是说它不会跨越结构进行比较</p><p>在判断两个节点是否相同时，vue是通过虚拟节点的key和tag来进行判断的</p><p>具体来说，首先对根节点进行对比，如果相同则将旧节点关联的真实dom的引用挂到新节点上，然后根据需要更新属性到真实dom，然后再对比其子节点数组；如果不相同，则按照新节点的信息递归创建所有真实dom，同时挂到对应虚拟节点上，然后移除掉旧的dom。</p><p>在对比其子节点数组时，vue对每个子节点数组使用了两个指针，分别指向头尾，然后不断向中间靠拢来进行对比，这样做的目的是尽量复用真实dom，尽量少的销毁和创建真实dom。如果发现相同，则进入和根节点一样的对比流程，如果发现不同，则移动真实dom到合适的位置。</p><p>这样一直递归的遍历下去，直到整棵树完成对比。</p><p><a href="https://juejin.cn/post/6958292554047553549">请阐述vue的diff算法</a></p><p><strong>Vue diff 算法双指针逻辑总结</strong></p><p>新创建的 子节点数组 和 旧的子节点数组分别有一个 头节点指针和尾结点指针。</p><p>针对旧节点的两个指针，如果新节点的两个指针有匹配到的，则将该指针所对应的 Vnode 转移到对应的位置（头对头，尾队尾），对应头结点和尾结点的位置进行变化（头结点后移，尾结点前移）</p><p>知道头尾节点均不符合匹配时，这样就筛选出来两类节点，一种是旧子节点数组上需要删除的子节点，一种是新的子节点上需要新增的子节点。</p><p>这样做的目的是最大可能性的复用已有的真实dom节点，对于新增的，需要创建新的 dom节点。</p><h4 id="MVVM-框架"><a href="#MVVM-框架" class="headerlink" title="MVVM 框架"></a>MVVM 框架</h4><p>MVVM 是指双向数据流，即 View-Model 之间的双向通信，由 ViewModel 作桥接</p><p><a href="https://juejin.cn/post/6844903590448857096">Mvvm 前端数据流框架精讲</a></p><h4 id="v-for-和-v-if"><a href="#v-for-和-v-if" class="headerlink" title="v-for 和 v-if"></a>v-for 和 v-if</h4><p>v-for 的优先级比v-if 的优先级要高，页面会首先根据 v-for 渲染列表，然后在根据 v-if 来判断列表元素是否显示和隐藏，因此会造成性能浪费</p><p>因此推荐使用 computed 属性，提前过滤需要隐藏后的数据后，在使用 v-for 进行渲染</p><h4 id="v-show-和-v-if"><a href="#v-show-和-v-if" class="headerlink" title="v-show 和 v-if"></a>v-show 和 v-if</h4><p>v-show 会进行dom 树的构建，但是 display 属性为 none</p><p>v-if 不会进行组件渲染，自然也不会构建 dom 树，对性能有优化</p><h4 id="v-for-循环时-key的作用是什么"><a href="#v-for-循环时-key的作用是什么" class="headerlink" title="v-for 循环时 key的作用是什么"></a>v-for 循环时 key的作用是什么</h4><p>进行diff 算法时，方便进行对比组件是否更新，以及组件复用</p><p>会首先对比key 是否一样，如果一样在判断标签或者 类型是否一致（input）这样可以节省一部分对比操作，提升性能</p><h4 id="nextTick-原理"><a href="#nextTick-原理" class="headerlink" title="$nextTick 原理"></a>$nextTick 原理</h4><p>主要是利用了 javascript 引擎的时间循环机制，是的 $nextTick 传入的参数在同步事件之后触发，可以拿到 修改后的dom和 data 里面的值</p><p>使用 <code>Promise.then</code>,<code>setImediate</code>, <code>setTimeout</code>, <code>mutationObserve</code> 来实现</p><h4 id="Vue-是如何监听属性变化的"><a href="#Vue-是如何监听属性变化的" class="headerlink" title="Vue 是如何监听属性变化的"></a>Vue 是如何监听属性变化的</h4><p>使用 <code>Object.defineProperty</code> 来监听属性的变化，重写get，set 方法，并且新增 Watcher 方法，当修改属性值时，触犯到 set 方法，在set 方法中会收集到当前这个属性所关联的依赖，并通知这些依赖进行更新.</p><p>每个组件被创建的时候（$mount,mountComponent,$watch）都会创建一个新的 Watcher 实例，并且赋值给 当前组件内进行数据监听时创建的 Dep 对象的 target,当我们初始化实例的时候，会调用 depend 方法，会将当前 Dep 添加到 Watcher 里面，会通过 Watcher 的 addDep 方法，把当前Watcher 添加到 Dep 的依赖（dep） 中,修改属性值的时候会调用 notify 方法，去执行该属性关联的 Watcher 的 update 方法，更新数据。</p><p><strong>那几个方法会创建 new Watcher</strong></p><p>纵观源码，有以下几个地方会创建 Watcher</p><ul><li>computed，在非 SSR 的情况下会给每个 监听的变量创构建一个 watcher</li><li>$mount 方法 mountComponent 在挂载组件的时候也会创建一个 Watcher</li><li>$watch 方法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建 <span class="title class_">Watcher</span></span><br><span class="line">使用 <span class="title class_">Object</span>.<span class="property">defineProperty</span> 对数据获取和更新进行拦截，get操作时添加依赖（watcher），set 时，notify 依赖执行 update 操作，更新数据和对应页面</span><br></pre></td></tr></table></figure><h4 id="data-为什么要用一个函数的模式"><a href="#data-为什么要用一个函数的模式" class="headerlink" title="data 为什么要用一个函数的模式"></a>data 为什么要用一个函数的模式</h4><p>是因为组件是可以重复使用的，如果data 不用一个函数模式的话，可以会造成数据混乱，无法获取到想要的数据</p><h4 id="Vuex-有几个模块"><a href="#Vuex-有几个模块" class="headerlink" title="Vuex 有几个模块"></a>Vuex 有几个模块</h4><ul><li>module</li><li>state</li><li>mutations</li><li>actions</li><li>getters</li></ul><p>Vuex 提供了 mapGetters，mapState，mapActions 等方法，方便我们快速获取Vuex 的值</p><h4 id="Vue-router-有几个模式"><a href="#Vue-router-有几个模式" class="headerlink" title="Vue-router 有几个模式"></a>Vue-router 有几个模式</h4><p>设置 router 的 mode 属性，默认为 hash 模式，设置 history 后，为history模式</p><ul><li>hash模式<br>在网址后面以 # 模式</li><li>history 模式<br>直接跟在网址后面</li></ul><h4 id="Vue-项目如何优化"><a href="#Vue-项目如何优化" class="headerlink" title="Vue 项目如何优化"></a>Vue 项目如何优化</h4><ul><li>路由懒加载 () =&gt; import(“”)</li><li>组件懒加载 () =&gt; import(“”)</li><li>v-if 和 v-for 避免一起使用，可以用计算属性过滤部分数据</li><li>针对经常显示隐藏的页面结构，可以使用 v-show，否则应使用 v-if</li></ul><p>等等</p><h4 id="自定义指令-directive"><a href="#自定义指令-directive" class="headerlink" title="自定义指令 (directive)"></a>自定义指令 (directive)</h4><p>有以下几个周期，可以对dom 元素的各个状态进行监听</p><ul><li>beforeCreate</li><li>created</li><li>beforeMount</li><li>mounted</li><li>beforeUpdate</li><li>updated</li><li>beforeDestory</li><li>destoryed</li></ul><h2 id="Vue3"><a href="#Vue3" class="headerlink" title="Vue3"></a>Vue3</h2><h4 id="Vue3-相对比-Vue2-新增了哪些东西？"><a href="#Vue3-相对比-Vue2-新增了哪些东西？" class="headerlink" title="Vue3 相对比 Vue2 新增了哪些东西？"></a>Vue3 相对比 Vue2 新增了哪些东西？</h4><ul><li>composition API<br>ref，reactive，watch，watchEffect，computed 等</li><li>setup<br>  setup 执行顺序在 beforeCreate 生命周期之前，因此也不能获取到 DOM,因此提供了 生命周期钩子函数 (on + 生命周期) ，通过 return 把参数和方法暴露出来</li><li>beforeDestory -&gt; beforeUnmount, Destoryed -&gt; unmount</li><li>数据监听方式由 Object.defineProperty 变更为 Proxy，这样的话一个是针对多层 object 对象不需要进行递归监听，其次是针对数组的新增和修改操作也能更加方便的监听</li></ul><h4 id="vue3-相比于-vue2-针对性能做了哪些优化"><a href="#vue3-相比于-vue2-针对性能做了哪些优化" class="headerlink" title="vue3 相比于 vue2 针对性能做了哪些优化"></a>vue3 相比于 vue2 针对性能做了哪些优化</h4><ul><li>对组件类型进行区分，对静态节点进行了优化，会对静态节点保存下来，进行更新操作时，不需要重新创建节点</li><li>碰见连续静态节点的时候，会将这一段静态节点转成 html 字符串，直接使用 innerHTML 方法添加到元素内，减少了递归操作</li><li>缓存事件处理函数</li><li>对静态节点进行优化，虚拟dom对比时，直接跳过虚拟节点，减少对比和递归次数</li></ul><h2 id="React"><a href="#React" class="headerlink" title="React"></a>React</h2><h4 id="生命周期-1"><a href="#生命周期-1" class="headerlink" title="生命周期"></a>生命周期</h4><p>挂载阶段</p><ul><li>constructor</li><li>componentWillMount（新版 getDerivedtateFromProps）</li><li>render</li><li>componentDidMount</li></ul><p>更新阶段</p><ul><li>componentWillReceiveProps （getDerivedtateFromProps））</li><li>shouldComponentUpdate</li><li>componentWillUpdate （null）</li><li>render</li><li>（getSnapshotBeforeUpdate）</li><li>componentDidUpdate</li></ul><p>卸载阶段</p><ul><li>componentWillUnmount</li></ul><p><strong>为什么新版的react 的生命周期要加上 UNSAFE_ 前缀</strong></p><p>这个是因为这个函数不安全，原因是因为 react 16 以后 react 支持 fiber 切片后，组件会根据执行优先级来进行编译和渲染，因此可能会出现一个组件正在执行更新或者创建操作时，有一个优先级更高的任务插进来，这个时候，当前任务会被暂停掉，更换优先级更高的任务执行操作，操作完成后，才会回到之前的操作，继续执行，这个时候，部分生命周期有可能会执行两次，造成数据混乱</p><h4 id="虚拟dom（virtual-DOM）"><a href="#虚拟dom（virtual-DOM）" class="headerlink" title="虚拟dom（virtual DOM）"></a>虚拟dom（virtual DOM）</h4><p>virtual DOM 又称虚拟DOM， 是使用 JavaScript 对象来描述真实DOM节点，virtual DOM 内存储了真实DOM的各种信息，标签名，属性名包括子元素，virtual DOM 之间通过树形结构连接，与真实DOM一一对应，构成了最终的虚拟DOM树</p><p>virtual DOM 的修改不会触发页面的重绘和重排，可以有效避免真实DOM的频繁更新，通过对应的编译器可以实现一套代码，多端运行，但是由于 还需要渲染成真实DOM显示到页面上面，因此首次渲染时速度较慢</p><h4 id="diff-算法"><a href="#diff-算法" class="headerlink" title="diff 算法"></a>diff 算法</h4><p><a href="https://react.iamkasong.com/diff/multi.html#demo2">React技术揭秘-卡颂</a><br>React文档中提到，即使在最前沿的算法中，将前后两棵树完全比对的算法的复杂程度为 O(n 3 )，其中n是树中元素的数量</p><p>React diff 算法做了以下优化</p><ol><li>只进行同级比较，如果一个节点在更新前后层级不一样，则不会进行比较</li><li>不同类型的子元素是一个新的树，旧的树会被直接销毁，新的树会被创建</li><li>可以通过key 值来判断那些子元素保持稳定</li></ol><p>react 在进行 diff 算法时，会首先针对 节点的 类型，key进行对比，如果都一样，在对比传入的 props，state 等属性是否有变化，有变化执行更新操作，没有变化就直接复用，不过不一样，则会创建一个新的节点</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 之前</span></span><br><span class="line">abcd</span><br><span class="line"></span><br><span class="line"><span class="comment">// 之后</span></span><br><span class="line">dabc</span><br><span class="line"></span><br><span class="line">===第一轮遍历开始===</span><br><span class="line">d（之后）vs a（之前）  </span><br><span class="line">key改变，不能复用，跳出遍历</span><br><span class="line">===第一轮遍历结束===</span><br><span class="line"></span><br><span class="line">===第二轮遍历开始===</span><br><span class="line">newChildren === dabc，没用完，不需要执行删除旧节点</span><br><span class="line">oldFiber === abcd，没用完，不需要执行插入新节点</span><br><span class="line"></span><br><span class="line">将剩余oldFiber（abcd）保存为map</span><br><span class="line"></span><br><span class="line">继续遍历剩余newChildren</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前oldFiber：abcd</span></span><br><span class="line"><span class="comment">// 当前newChildren dabc</span></span><br><span class="line"></span><br><span class="line">key === d 在 oldFiber中存在</span><br><span class="line"><span class="keyword">const</span> oldIndex = d（之前）.<span class="property">index</span>;</span><br><span class="line">此时 oldIndex === <span class="number">3</span>; <span class="comment">// 之前节点为 abcd，所以d.index === 3</span></span><br><span class="line">比较 oldIndex 与 lastPlacedIndex;</span><br><span class="line">oldIndex <span class="number">3</span> &gt; lastPlacedIndex <span class="number">0</span></span><br><span class="line">则 lastPlacedIndex = <span class="number">3</span>;</span><br><span class="line">d节点位置不变</span><br><span class="line"></span><br><span class="line">继续遍历剩余newChildren</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前oldFiber：abc</span></span><br><span class="line"><span class="comment">// 当前newChildren abc</span></span><br><span class="line"></span><br><span class="line">key === a 在 oldFiber中存在</span><br><span class="line"><span class="keyword">const</span> oldIndex = a（之前）.<span class="property">index</span>; <span class="comment">// 之前节点为 abcd，所以a.index === 0</span></span><br><span class="line">此时 oldIndex === <span class="number">0</span>;</span><br><span class="line">比较 oldIndex 与 lastPlacedIndex;</span><br><span class="line">oldIndex <span class="number">0</span> &lt; lastPlacedIndex <span class="number">3</span></span><br><span class="line">则 a节点需要向右移动</span><br><span class="line"></span><br><span class="line">继续遍历剩余newChildren</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前oldFiber：bc</span></span><br><span class="line"><span class="comment">// 当前newChildren bc</span></span><br><span class="line"></span><br><span class="line">key === b 在 oldFiber中存在</span><br><span class="line"><span class="keyword">const</span> oldIndex = b（之前）.<span class="property">index</span>; <span class="comment">// 之前节点为 abcd，所以b.index === 1</span></span><br><span class="line">此时 oldIndex === <span class="number">1</span>;</span><br><span class="line">比较 oldIndex 与 lastPlacedIndex;</span><br><span class="line">oldIndex <span class="number">1</span> &lt; lastPlacedIndex <span class="number">3</span></span><br><span class="line">则 b节点需要向右移动</span><br><span class="line"></span><br><span class="line">继续遍历剩余newChildren</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前oldFiber：c</span></span><br><span class="line"><span class="comment">// 当前newChildren c</span></span><br><span class="line"></span><br><span class="line">key === c 在 oldFiber中存在</span><br><span class="line"><span class="keyword">const</span> oldIndex = c（之前）.<span class="property">index</span>; <span class="comment">// 之前节点为 abcd，所以c.index === 2</span></span><br><span class="line">此时 oldIndex === <span class="number">2</span>;</span><br><span class="line">比较 oldIndex 与 lastPlacedIndex;</span><br><span class="line">oldIndex <span class="number">2</span> &lt; lastPlacedIndex <span class="number">3</span></span><br><span class="line">则 c节点需要向右移动</span><br><span class="line"></span><br><span class="line">===第二轮遍历结束===</span><br></pre></td></tr></table></figure><p>总结来说就是尽量复用已有的节点，将已有的节点按照新的节点数组进行排序，没有的节点再新增</p><p>总共进行了两次遍历，第一次遍历是为了找到相同的前缀子节点数组，第二次遍历是为了找到剩余子节点数组中可以复用的子节点。</p><h4 id="fiber-分片"><a href="#fiber-分片" class="headerlink" title="fiber 分片"></a>fiber 分片</h4><p><a href="https://react.iamkasong.com/process/fiber-mental.html#%E4%BB%A3%E6%95%B0%E6%95%88%E5%BA%94%E4%B8%8Egenerator">React技术揭秘-卡颂</a></p><p>React Fiber可以理解为：React内部实现的一套状态更新机制。支持任务不同优先级，可中断与恢复，并且恢复后可以复用之前的中间状态。</p><p>总的来说，每一个 fiber 节点都对应着一个 react element，并且存储着当期节点的 属性，状态和值，fiber 与 fiber 之间通过 return，child，sibling 参数连接</p><p>在开始遍历的时候，会首先判断 child 是否有值，如果有值，会遍历child 的第一个值，然后逻辑同上。</p><p>如果child 没有值，会通过 sibling 查找当前节点的兄弟节点，兄弟节点查找完成后，会通过 return，回到父节点，然后继续执行操作（感觉像是深度优先遍历）</p><p>在进行 dom 挂载和更新的操作，fiber 采用的是双缓存。也就是说，react 在进行更新操作的时候，是存在两个fiber 树的，一个是当前页面渲染的旧的fiber 树（current Fiber），另一个是页面更新后需要渲染的 fiber 树（workInProcess Fiber），这两个 fiber 之间通过 alternate 参数连接</p><p>在更新过程中，会根据diff 算法判断是否需要复用原来的 fiber 节点（节省时间，提高效率）</p><p>页面更新完成后，workInProcess Fiber 将会变成 current Fiber，原来的 fiber 树将会被舍弃掉</p><h4 id="常用-hooks"><a href="#常用-hooks" class="headerlink" title="常用 hooks"></a>常用 hooks</h4><ul><li><p>useState</p></li><li><p>useEffect</p></li><li><p>useLayoutEffect</p></li><li><p>useRef</p></li><li><p>useMemo  缓存</p></li><li><p>useCallback 缓存</p></li><li><p>useContext</p></li><li><p>useReducer</p></li><li><p>useImperativeHandle/forwardRef</p><p>useImperativeHandle 可以将子组件中部分函数暴露给父组件的 ref使用 </p></li></ul><h4 id="useMemo-和-useCallback-的区别"><a href="#useMemo-和-useCallback-的区别" class="headerlink" title="useMemo 和 useCallback 的区别"></a>useMemo 和 useCallback 的区别</h4><p>useMemo 缓存的是值</p><p>useCallback 缓存的是具体函数</p><p>因为 React 函数式组件每次更新的时候，都会销毁上一次的上下文，然后重新创建新的上下文，也就是说在函数式组件内创建的函数，都会被重新创建</p><h4 id="组件通讯-1"><a href="#组件通讯-1" class="headerlink" title="组件通讯"></a>组件通讯</h4><ul><li>mobx/redux 等状态管理工具</li><li>props</li><li>ref/useImperativeHandle</li><li>发布订阅模式</li></ul><h4 id="React-如何监听数据变化"><a href="#React-如何监听数据变化" class="headerlink" title="React 如何监听数据变化"></a>React 如何监听数据变化</h4><p>主要是通过 setState，useState，forceUpdate，会生成一个 Update 对象，会和原属性的值进行对比，如果发生改变，则会触发更新操作，这个对比采用的是浅对比的方式。</p><h2 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h2><h4 id="多入口页面"><a href="#多入口页面" class="headerlink" title="多入口页面"></a>多入口页面</h4><p>通过 entry 和 output 参数可以设置多入入口文件及打包后的文件名称和位置</p><p>接下来通过 html-webpack-plugin 插件指定文件渲染模板，此外还可以设置生成文件的 title meta 标签以及link 标签等内容，以满足部分 SEO 需求</p><h4 id="loaders-的使用"><a href="#loaders-的使用" class="headerlink" title="loaders 的使用"></a>loaders 的使用</h4><ul><li>常用loader<br>具有那些loader 可以<a href="https://www.webpackjs.com/loaders/">查看这里</a><ul><li>style-loader</li><li>css-loader</li><li>sass-loader</li><li>less-loader</li><li>postcss-loader</li><li>ts-loader</li><li>babel-loader</li><li>vue-loader</li></ul></li></ul><h4 id="webpack-打包流程"><a href="#webpack-打包流程" class="headerlink" title="webpack 打包流程"></a>webpack 打包流程</h4><ul><li>首先通过 entry 找到入口文件</li><li>通过各种loader(ts-loader,js-loader,style-loader,sass-loader) 等将需要打包的文件转成浏览器识别的语言</li><li>接下来通过 output 将转化成的代码生成js文件，如果有分包操作，将会被拆解成多个文件</li><li>然后通过 plugin 将 文件写入到html文档中，如果有html-webpack-plugin 则会根据对应的chunk 和模板文件写入</li></ul><h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><h4 id="你在工作中觉得有没有什么比较难的事情"><a href="#你在工作中觉得有没有什么比较难的事情" class="headerlink" title="你在工作中觉得有没有什么比较难的事情"></a>你在工作中觉得有没有什么比较难的事情</h4><p>我觉得这个其实挺蛇皮的，这种问题看起来没有一点可以问的价值，正常来说只要能完成，我觉得都没什么难的，以下列一下我在工作中认为比较难的事情</p><ul><li>项目底层架构升级，需要对项目各个功能，参数，还有调用方式都有一个清晰的认知，否则在进行升级的过程中会出现各种各样的问题</li><li>多页面打包配置，基于 gitlab 实现多页面项目按需打包，避免发版影响页面过多</li><li>移动端样式适配，适配不同浏览器及移动端浏览器适配（样式，功能(下载)）</li></ul><p>这种东西其实在做的时候感觉挺难的，其实会想之后感觉也就那样</p><h4 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h4><p><strong>用最简便的方法描述</strong></p><ul><li><p>工厂模式</p></li><li><p>抽象模式</p></li><li>单例模式</li><li>观察者模式</li><li>状态模式</li><li>组合模式</li><li>享元模式</li><li>原型链模式</li><li>桥接模式</li><li>装饰器模式</li><li>代理模式</li><li>策略模式</li><li>访问者模式</li><li>委托模式</li><li>数据访问对象模式</li><li>节流模式</li><li>参与者模式</li></ul><h2 id="GIT"><a href="#GIT" class="headerlink" title="GIT"></a>GIT</h2><h4 id="正常提交流程"><a href="#正常提交流程" class="headerlink" title="正常提交流程"></a>正常提交流程</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;message&quot;</span></span><br><span class="line">git pull</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><h4 id="合并分支"><a href="#合并分支" class="headerlink" title="合并分支"></a>合并分支</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge branch-name</span><br></pre></td></tr></table></figure><h4 id="切换，创建，删除分支"><a href="#切换，创建，删除分支" class="headerlink" title="切换，创建，删除分支"></a>切换，创建，删除分支</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;branch-name&gt; <span class="comment">// 切换分支</span></span><br><span class="line">git checkout -b &lt;branch-name&gt; <span class="comment">// 创建本地新分支</span></span><br><span class="line">git checkout -d &lt;branch-name&gt; <span class="comment">// 删除分支</span></span><br></pre></td></tr></table></figure><h4 id="拉取代码"><a href="#拉取代码" class="headerlink" title="拉取代码"></a>拉取代码</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone github.<span class="property">com</span>/sample.<span class="property">git</span> <span class="comment">// 拉取代码</span></span><br><span class="line">git clone -b &lt;branch-name&gt; github.<span class="property">com</span>/sample.<span class="property">git</span> <span class="comment">// 拉取指定分支代码</span></span><br></pre></td></tr></table></figure><h4 id="git-回滚"><a href="#git-回滚" class="headerlink" title="git 回滚"></a>git 回滚</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git revert -n [hash] <span class="comment">// 在这个版本基础上重新生成一条记录</span></span><br><span class="line">git reset --hard [hash] <span class="comment">// 本地强制回滚至上一次提交，并覆盖记录</span></span><br></pre></td></tr></table></figure><h4 id="设置用户"><a href="#设置用户" class="headerlink" title="设置用户"></a>设置用户</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --<span class="variable language_">global</span> user.<span class="property">name</span> [name]</span><br><span class="line">git config --<span class="variable language_">global</span> user.<span class="property">email</span> [email]</span><br></pre></td></tr></table></figure><h4 id="其他用法"><a href="#其他用法" class="headerlink" title="其他用法"></a>其他用法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git log <span class="comment">// 查看提交记录 q 退出查看</span></span><br><span class="line">git diff branch1 branch2 <span class="comment">// 对比分支修改记录</span></span><br><span class="line">git cherry-pick [hash] <span class="comment">// 合并末次commit 内容到当前分支</span></span><br></pre></td></tr></table></figure><h2 id="手写算法题"><a href="#手写算法题" class="headerlink" title="手写算法题"></a>手写算法题</h2><h4 id="数组方法重写"><a href="#数组方法重写" class="headerlink" title="数组方法重写"></a>数组方法重写</h4><ul><li><a href="https://lxx1997.github.io/2023/04/08/web/array-methods-rewrite/#map">map</a></li><li><a href="https://lxx1997.github.io/2023/04/08/web/array-methods-rewrite/#reduce">reduce</a></li><li><a href="https://lxx1997.github.io/2023/04/08/web/array-methods-rewrite/#filter">filter</a></li><li><a href="https://lxx1997.github.io/2023/04/08/web/array-methods-rewrite/#some">some</a></li><li><a href="https://lxx1997.github.io/2023/04/08/web/array-methods-rewrite/#every">every</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;更全的面试题&quot;&gt;&lt;a href=&quot;#更全的面试题&quot; class=&quot;headerlink&quot; title=&quot;更全的面试题&quot;&gt;&lt;/a&gt;更全的面试题&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/febobo/web-interview&quot;&gt;vue </summary>
      
    
    
    
    
    <category term="interview" scheme="https://lxx1997.github.io/tags/interview/"/>
    
    <category term="promise" scheme="https://lxx1997.github.io/tags/promise/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript - 手写一个 Promise 方法</title>
    <link href="https://lxx1997.github.io/2023/03/13/web/hand-write-promise/"/>
    <id>https://lxx1997.github.io/2023/03/13/web/hand-write-promise/</id>
    <published>2023-03-13T08:22:04.000Z</published>
    <updated>2023-03-13T08:22:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>手动实现 promise, 下面hi全部的代码,写了差不多有两个小时，并且附上示例</p><p>之前也有一版，不过我觉得这一版更好理解一些<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this code for create a new promise</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROMISE_PADDING</span> = <span class="string">&quot;padding&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROMISE_FULLFILLED</span> = <span class="string">&quot;fullfilled&quot;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROMISE_REJECTED</span> = <span class="string">&quot;rejected&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">newPromise</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">func</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">PROMISE_PADDING</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">undefined</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">resolveCB</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rejectCB</span> = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> !== <span class="variable constant_">PROMISE_PADDING</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span> = val</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">PROMISE_FULLFILLED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">resolveCB</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">resolveCB</span>.<span class="title function_">map</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> !== <span class="variable constant_">PROMISE_PADDING</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span> = val</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">status</span> = <span class="variable constant_">PROMISE_REJECTED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rejectCB</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">rejectCB</span>.<span class="title function_">map</span>(<span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="title function_">func</span>(resolve, reject)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="title function_">reject</span>(error.<span class="property">message</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">then</span>(<span class="params">res, rej</span>) &#123;</span><br><span class="line">    res = <span class="keyword">typeof</span> res !== <span class="string">&quot;function&quot;</span> ? <span class="function">(<span class="params">val</span>) =&gt;</span> val : res</span><br><span class="line">    rej = <span class="keyword">typeof</span> rej !== <span class="string">&quot;function&quot;</span> ? <span class="function">(<span class="params">val</span>) =&gt;</span> val : rej</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">newPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PROMISE_PADDING</span>) &#123;</span><br><span class="line">        <span class="comment">// 这里之所以用 个函数包围住，主要是因为多次使用 .then 的时候，后面的 then 拿到的是前一个then 返回的实例，所以会出现，后面的then，无法执行</span></span><br><span class="line">        <span class="comment">// 使用函数包裹之后，然后调用 resolve 和reject 保证后续 then 方法能够拿到正确的值</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">rejectCB</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> val = <span class="title function_">rej</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">            <span class="title function_">reject</span>(val)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(error.<span class="property">message</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">resolveCB</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> val = <span class="title function_">res</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">            <span class="title function_">resolve</span>(val)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(error.<span class="property">message</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PROMISE_FULLFILLED</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">value</span> = <span class="title function_">res</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">          <span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="title function_">reject</span>(error.<span class="property">message</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">status</span> === <span class="variable constant_">PROMISE_REJECTED</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">value</span> = <span class="title function_">rej</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">          <span class="title function_">reject</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="title function_">reject</span>(error.<span class="property">message</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">catch</span>(rej) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">undefined</span>, rej)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">resolve</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    fn = <span class="keyword">typeof</span> fn !== <span class="string">&quot;function&quot;</span> ? <span class="function">(<span class="params">val</span>) =&gt;</span> val : fn</span><br><span class="line">    <span class="keyword">if</span>(fn <span class="keyword">instanceof</span> newPromise) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">newPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = <span class="title function_">fn</span>()</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="title function_">reject</span>(error.<span class="property">message</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">reject</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    fn = <span class="keyword">typeof</span> fn !== <span class="string">&quot;function&quot;</span> ? <span class="function">(<span class="params">val</span>) =&gt;</span> val : fn</span><br><span class="line">    <span class="keyword">if</span>(fn <span class="keyword">instanceof</span> newPromise) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">newPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = <span class="title function_">fn</span>()</span><br><span class="line">        <span class="title function_">reject</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="title function_">reject</span>(error.<span class="property">message</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">all</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">newPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> arr = []</span><br><span class="line">      <span class="keyword">if</span>(args.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>([])</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> item = args[i]</span><br><span class="line">        <span class="keyword">if</span>(!(item <span class="keyword">instanceof</span> newPromise)) &#123;</span><br><span class="line">          item = newPromise.<span class="title function_">resolve</span>(item)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(item <span class="keyword">instanceof</span> newPromise)</span><br><span class="line">        item.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          arr[i] = &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="variable constant_">PROMISE_FULLFILLED</span>,</span><br><span class="line">            <span class="attr">value</span>: res</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(arr.<span class="title function_">every</span>(<span class="function"><span class="params">item</span> =&gt;</span> item) &amp;&amp; arr.<span class="property">length</span> === args.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(arr)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function"><span class="params">rej</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(rej)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">allSettled</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">newPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> arr = []</span><br><span class="line">      <span class="keyword">if</span>(args.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>([])</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> item = args[i]</span><br><span class="line">        <span class="keyword">if</span>(!(item <span class="keyword">instanceof</span> newPromise)) &#123;</span><br><span class="line">          item = newPromise.<span class="title function_">resolve</span>(item)</span><br><span class="line">        &#125;</span><br><span class="line">        item.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          arr[i] = &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="variable constant_">PROMISE_FULLFILLED</span>,</span><br><span class="line">            <span class="attr">value</span>: res</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(arr.<span class="title function_">every</span>(<span class="function"><span class="params">item</span> =&gt;</span> item) &amp;&amp; arr.<span class="property">length</span> === args.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(arr)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function"><span class="params">rej</span> =&gt;</span> &#123;</span><br><span class="line">          arr[i] = &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="variable constant_">PROMISE_REJECTED</span>,</span><br><span class="line">            <span class="attr">value</span>: rej</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(arr.<span class="title function_">every</span>(<span class="function"><span class="params">item</span> =&gt;</span> item) &amp;&amp; arr.<span class="property">length</span> === args.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(arr)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">race</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">newPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> arr = []</span><br><span class="line">      <span class="keyword">if</span>(args.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>([])</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> item = args[i]</span><br><span class="line">        <span class="keyword">if</span>(!(item <span class="keyword">instanceof</span> newPromise)) &#123;</span><br><span class="line">          item = newPromise.<span class="title function_">resolve</span>(item)</span><br><span class="line">        &#125;</span><br><span class="line">        item.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(res)</span><br><span class="line">        &#125;, <span class="function"><span class="params">rej</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">rej</span>(arr)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">any</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">newPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> arr = []</span><br><span class="line">      <span class="keyword">if</span>(args.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>([])</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> item = args[i]</span><br><span class="line">        <span class="keyword">if</span>(!(item <span class="keyword">instanceof</span> newPromise)) &#123;</span><br><span class="line">          item = newPromise.<span class="title function_">resolve</span>(item)</span><br><span class="line">        &#125;</span><br><span class="line">        item.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(res)</span><br><span class="line">        &#125;, <span class="function"><span class="params">rej</span> =&gt;</span> &#123;</span><br><span class="line">          arr[i] = &#123;</span><br><span class="line">            <span class="attr">status</span>: <span class="variable constant_">PROMISE_FULLFILLED</span>,</span><br><span class="line">            <span class="attr">value</span>: rej</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span>(arr.<span class="title function_">every</span>(<span class="function"><span class="params">item</span> =&gt;</span> item) &amp;&amp; arr.<span class="property">length</span> === args.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(arr)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// new newPromise((resolve, reject) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     resolve(1000)</span></span><br><span class="line"><span class="comment">//   &#125;, 2000);</span></span><br><span class="line"><span class="comment">// &#125;).then((res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res, &quot;res1&quot;)</span></span><br><span class="line"><span class="comment">// &#125;)).then(res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res, &quot;res4&quot;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// new newPromise((resolve, reject) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   // resolve(1000)</span></span><br><span class="line"><span class="comment">//   throw new Error(12345)</span></span><br><span class="line"><span class="comment">// &#125;).then(res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res, &quot;res2&quot;)</span></span><br><span class="line"><span class="comment">//   return res</span></span><br><span class="line"><span class="comment">// &#125;).then(res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res, &quot;res3&quot;)</span></span><br><span class="line"><span class="comment">// &#125;).catch(err =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(err, &quot;err&quot;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// newPromise.resolve(() =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   return 10000</span></span><br><span class="line"><span class="comment">// &#125;).then(res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// newPromise.all(() =&gt; &#123;throw new Error(123)&#125;,() =&gt; 234, new newPromise((resolve) =&gt; setTimeout(() =&gt; resolve(1000), 1000))).then(res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res)</span></span><br><span class="line"><span class="comment">// &#125;, err =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(err)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// newPromise.allSettled(() =&gt; &#123;throw new Error(123)&#125;,() =&gt; 234, new newPromise((resolve) =&gt; setTimeout(() =&gt; resolve(1000), 1000))).then(res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res)</span></span><br><span class="line"><span class="comment">// &#125;, err =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(err)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">// newPromise.race(() =&gt; &#123;throw new Error(123)&#125;,() =&gt; 234, new newPromise((resolve) =&gt; setTimeout(() =&gt; resolve(1000), 1000))).then(res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res)</span></span><br><span class="line"><span class="comment">// &#125;, err =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(err)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">reject</span>(<span class="number">3234</span>), <span class="number">500</span>)</span><br><span class="line">&#125;), <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1000</span>), <span class="number">1000</span>)</span><br><span class="line">&#125;)]).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br><span class="line">newPromise.<span class="title function_">any</span>(<span class="function">() =&gt;</span> &#123;<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="number">123</span>)&#125;,<span class="function">() =&gt;</span> <span class="number">234</span>, <span class="keyword">new</span> <span class="title function_">newPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1000</span>), <span class="number">1000</span>))).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// promise.then((res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res)</span></span><br><span class="line"><span class="comment">// &#125;).then(res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res, &quot;res&quot;)</span></span><br><span class="line"><span class="comment">//   throw new Error(&quot;1234&quot;)</span></span><br><span class="line"><span class="comment">// &#125;).catch((err) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(err, &quot;1234&quot;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise.resolve(100).then((res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res, &quot;promise&quot;)</span></span><br><span class="line"><span class="comment">// &#125;).then(res =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(res, &quot;promise res&quot;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;手动实现 promise, 下面hi全部的代码,写了差不多有两个小时，并且附上示例&lt;/p&gt;
&lt;p&gt;之前也有一版，不过我觉得这一版更好理解一些&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre</summary>
      
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/categories/JavaScript/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>学习目标</title>
    <link href="https://lxx1997.github.io/2023/03/03/learning-target-list/"/>
    <id>https://lxx1997.github.io/2023/03/03/learning-target-list/</id>
    <published>2023-03-03T01:28:36.000Z</published>
    <updated>2023-03-03T01:28:36.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="2023-03"><a href="#2023-03" class="headerlink" title="2023-03"></a>2023-03</h4><table><thead><tr><th>项目</th><th>进度</th></tr></thead><tbody><tr><td><a href="https://jestjs.io/zh-Hans/docs/getting-started">单元测试</a></td><td>未开始</td></tr><tr><td>vue2</td><td>未开始</td></tr><tr><td>vue3</td><td>未开始</td></tr><tr><td>react</td><td>未开始</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;2023-03&quot;&gt;&lt;a href=&quot;#2023-03&quot; class=&quot;headerlink&quot; title=&quot;2023-03&quot;&gt;&lt;/a&gt;2023-03&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;项目&lt;/th&gt;
&lt;th&gt;进度&lt;/th&gt;
&lt;/tr&gt;
&lt;/</summary>
      
    
    
    
    <category term="learning" scheme="https://lxx1997.github.io/categories/learning/"/>
    
    
    <category term="learning" scheme="https://lxx1997.github.io/tags/learning/"/>
    
  </entry>
  
  <entry>
    <title>React 多页面应用 - 实现多页面应用每个页面可以单独打包 及 gitlab CI/CD 发版配置</title>
    <link href="https://lxx1997.github.io/2023/02/23/webpack/react-multiple-page-pack-separately/"/>
    <id>https://lxx1997.github.io/2023/02/23/webpack/react-multiple-page-pack-separately/</id>
    <published>2023-02-23T07:30:48.000Z</published>
    <updated>2023-02-23T07:30:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>书接上回 <a href="/2023/02/20/webpack/react-multiple-page-router/">React 多页面应用 - 路由配置</a></p><p>这次我们来实现一些不一样的需求，这是在日常工作中遇到的</p><p>首先我们来描述一下我们想要实现的需求</p><p>首先在这个项目中有多个项目（a,b,c,d…）,假如我只改了a项目的代码，按照我们之前的配置，发版的时候会把所有的项目都一起发上去，这样一个问题是会造成资源浪费（CDN 需要重新缓存），另一个问题是如果有修改到公共方法，会对未修改的项目造成影响，这个时候的需求是只发a项目相关的代码，其他项目的代码不会发上去。</p><p>接下来我们来看实现这个需求</p><h2 id="实现项目单独打包"><a href="#实现项目单独打包" class="headerlink" title="实现项目单独打包"></a>实现项目单独打包</h2><p>在上一个项目的基础上，我们可以发现多页面打包的基础是在 打包的时候配置的多入口，那么只需要把原来的多入口变成单入口，就可以实现按需打包了</p><p>所以在上一个项目的基础上，把 <code>config.entry</code> 和 <code>config.plugins</code> 的内容单独抽离出来，然后在 overrideConfig 方法内动态传入需要打包的组件入口名称，然后根据传入的组件名称动态获取 <code>entry</code> 和 <code>plugins</code> 的内容。具体实现代码如下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config-overrides.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; override &#125; =  <span class="built_in">require</span>(<span class="string">&quot;customize-cra&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> entry = &#123;</span><br><span class="line">  <span class="attr">main</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">page1</span>: <span class="string">&quot;./src/pages/page1/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">page2</span>: <span class="string">&quot;./src/pages/page2/index.js&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">computedPluginList</span> = (<span class="params">types</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> pluginList = []</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; types.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (types[i]) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;main&quot;</span>: </span><br><span class="line">        pluginList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title function_">htmlWebpackPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&quot;main&quot;</span>,</span><br><span class="line">          <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;main.html&quot;</span>,</span><br><span class="line">          <span class="attr">chunks</span>: [<span class="string">&quot;main&quot;</span>]</span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;page1&quot;</span>: </span><br><span class="line">        pluginList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title function_">htmlWebpackPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&quot;Page1&quot;</span>,</span><br><span class="line">          <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;page1.html&quot;</span>,</span><br><span class="line">          <span class="attr">chunks</span>: [<span class="string">&quot;page1&quot;</span>]</span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;page2&quot;</span>: </span><br><span class="line">        pluginList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title function_">htmlWebpackPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&quot;Page2&quot;</span>,</span><br><span class="line">          <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;page2.html&quot;</span>,</span><br><span class="line">          <span class="attr">chunks</span>: [<span class="string">&quot;page2&quot;</span>]</span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> pluginList</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">overrideConfig</span> = (<span class="params">paths</span>) =&gt; <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> innerEntry = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span>(paths) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; paths.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      innerEntry[paths[i]] = entry[paths[i]]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    innerEntry.<span class="property">entry</span> = entry</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  config.<span class="property">output</span> = &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].[fullhash].js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: __dirname + <span class="string">&#x27;/dist&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  config.<span class="property">plugins</span>.<span class="title function_">push</span>(...<span class="title function_">computedPluginList</span>(paths))</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">override</span>(<span class="title function_">overrideConfig</span>([<span class="string">&quot;page1&quot;</span>, <span class="string">&quot;main&quot;</span>]))</span><br></pre></td></tr></table></figure><p>通过上述操作，我们可以实现根据传入的项目包的名称进行按需运行及按需打包</p><p><strong>但是，这并不是最终的解决方案</strong>,我们不可能每次发版或者每次进行开发都要修改这个文件，这个操作太过繁琐，一旦忘了修改，就会发生比较严重的问题，这个时候需要对这个功能进行优化</p><h2 id="项目单独打包优化"><a href="#项目单独打包优化" class="headerlink" title="项目单独打包优化"></a>项目单独打包优化</h2><p>在经过诸多讨论后，最后敲定的优化方案是 本地开发时，运行所有的项目，在进行发版的时候根据 tag 名进行各个项目发版</p><h4 id="package-json-文件修改"><a href="#package-json-文件修改" class="headerlink" title="package.json 文件修改"></a>package.json 文件修改</h4><p>首先在 script 内新增一个命令 <code>set:env</code>，这个命令会在 发版的时候用到，和 tag 一起用来设置发版的项目</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;set:env&quot;</span><span class="punctuation">:</span> <span class="string">&quot;REACT_APP_PROJECT=&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>执行 <code>set:env</code> 时会向 process.env 新增变量 <code>REACT_APP_PROJECT</code> 可以用来判断当前发版项目，可以在项目全局进行访问，这里主要在config-overrides 文件里进行访问</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config-overrides.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; override &#125; =  <span class="built_in">require</span>(<span class="string">&quot;customize-cra&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> entry = &#123;</span><br><span class="line">  <span class="attr">main</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">page1</span>: <span class="string">&quot;./src/pages/page1/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">page2</span>: <span class="string">&quot;./src/pages/page2/index.js&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">computedPluginList</span> = (<span class="params">types</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> pluginList = []</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; types.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (types[i]) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;main&quot;</span>: </span><br><span class="line">        pluginList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title function_">htmlWebpackPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&quot;main&quot;</span>,</span><br><span class="line">          <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;main.html&quot;</span>,</span><br><span class="line">          <span class="attr">chunks</span>: [<span class="string">&quot;main&quot;</span>]</span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;page1&quot;</span>: </span><br><span class="line">        pluginList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title function_">htmlWebpackPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&quot;Page1&quot;</span>,</span><br><span class="line">          <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;page1.html&quot;</span>,</span><br><span class="line">          <span class="attr">chunks</span>: [<span class="string">&quot;page1&quot;</span>]</span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;page2&quot;</span>: </span><br><span class="line">        pluginList.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title function_">htmlWebpackPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&quot;Page2&quot;</span>,</span><br><span class="line">          <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;page2.html&quot;</span>,</span><br><span class="line">          <span class="attr">chunks</span>: [<span class="string">&quot;page2&quot;</span>]</span><br><span class="line">        &#125;))</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> pluginList</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">overrideConfig</span> = (<span class="params"></span>) =&gt; <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> innerEntry = &#123;&#125;</span><br><span class="line">  <span class="keyword">let</span> paths = [<span class="string">&quot;main&quot;</span>, <span class="string">&quot;page1&quot;</span>, <span class="string">&quot;page2&quot;</span>]</span><br><span class="line">  <span class="comment">// 这里根据设置的变量来判断打包项目，如果没传则全量打包，主要针对本地开发使用</span></span><br><span class="line">  <span class="keyword">if</span>(process.<span class="property">env</span>.<span class="property">REACT_APP_PROJECT</span>) &#123;</span><br><span class="line">    paths = [process.<span class="property">env</span>.<span class="property">REACT_APP_PROJECT</span>, <span class="string">&quot;main&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(paths) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; paths.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      innerEntry[paths[i]] = entry[paths[i]]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    innerEntry.<span class="property">entry</span> = entry</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  config.<span class="property">output</span> = &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].[fullhash].js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: __dirname + <span class="string">&#x27;/dist&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  config.<span class="property">plugins</span>.<span class="title function_">push</span>(...<span class="title function_">computedPluginList</span>(paths))</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">override</span>(<span class="title function_">overrideConfig</span>())</span><br></pre></td></tr></table></figure><h4 id="gitlab-ci-yml-文件修改"><a href="#gitlab-ci-yml-文件修改" class="headerlink" title="gitlab-ci.yml 文件修改"></a>gitlab-ci.yml 文件修改</h4><p>首先需要修改 gitlab-ci 文件内容，使其由原先的通过判断分支来发版，更改为判断 tag 名称发版，tag 需要定一个规则，用于区分正式，测试环境，我这边定义的规则 <code>V-[环境名称]-[version]-[project]</code></p><p>在 <code>gitlab CI/CD</code> 进行发版时，首先需要获取到 tag 名，gitlab-ci 提供了 <code>$CI_COMMIT_REF_NAME</code> 可以访问到 tag 名</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test:sync-to-s3:</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="comment"># tags</span></span><br><span class="line">    <span class="comment"># 测试环境</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/V-T-US-.*/</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="comment"># build</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">$&#123;CI_COMMIT_REF_NAME&#125;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">$&#123;CI_COMMIT_REF_NAME##*-&#125;</span> <span class="comment">#获取最后一个 - 后面的内容</span></span><br></pre></td></tr></table></figure><p>修改了上述代码后，当我们打好以 <code>V-T-US-</code> 开头的 tag 后，会自动触发gitlab 的发版流程，执行过程中，会输出 当前tag 名称以及 project 名称。</p><p>获取完成之后，就需要根据获取到的工程名称，编写 node 代码，修改 package.json 与发包相关的 代码</p><p>首先创建 <code>updatePackage.sh</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># updatePackage.sh</span></span><br><span class="line">PROJECT_NAME=default</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ];</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    PROJECT_NAME=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">    node ./update.js <span class="variable">$PROJECT_NAME</span> ./package.json</span><br></pre></td></tr></table></figure><p>在执行 <code>updatePackage.sh</code> 文件的时候，如果传入的有参数，则会 自动复制 PROJECT_NAME 变量，然后通过 node 执行 node 文件，并将传入的内容以及需要修改的文件路径传过去</p><p><strong>需要注意的是，这里的路径都是基于执行 <code>updatePackage.sh</code> 的位置来说的，而不是<code>updatePackage.sh</code> 文件的位置</strong></p><p>然后创建 <code>update.js</code> 文件，用来读取和修改 package.json</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// update.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>); <span class="comment">// 引入 fs 函数，用来读取文件</span></span><br><span class="line"><span class="keyword">const</span> arg = process.<span class="property">argv</span>.<span class="title function_">splice</span>(<span class="number">2</span>); <span class="comment">// 获取node 执行文件时传入的参数</span></span><br><span class="line"><span class="keyword">const</span> r = arg[arg.<span class="property">length</span> - <span class="number">1</span>] <span class="comment">// 获取 node 执行文件时传入的文件地址</span></span><br><span class="line"><span class="keyword">const</span> c = fs.<span class="title function_">readFileSync</span>(r);</span><br><span class="line"><span class="keyword">const</span> json = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(c);</span><br><span class="line"><span class="keyword">const</span> set_env = json.<span class="property">scripts</span>[<span class="string">&#x27;set:env&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> build_env = json.<span class="property">scripts</span>[<span class="string">&#x27;build:test&#x27;</span>]</span><br><span class="line">json.<span class="property">scripts</span>[<span class="string">&quot;build:test&quot;</span>] = set_env + arg[<span class="number">0</span>] + <span class="string">&quot; &quot;</span> + build_env <span class="comment">// 修改 package.json 的打包命令</span></span><br><span class="line">fs.<span class="title function_">writeFileSync</span>(r, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(json, <span class="literal">null</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure><p>修改 <code>gitlab-ci.yml</code> 文件 执行 <code>updatePackage.sh</code> 文件</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test:sync-to-s3:</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="comment"># tags</span></span><br><span class="line">    <span class="comment"># 测试环境</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/V-T-US-.*/</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="comment"># build</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">$&#123;CI_COMMIT_REF_NAME&#125;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">projectName=$&#123;CI_COMMIT_REF_NAME##*-&#125;</span> <span class="comment">#设置变量 projectName</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sh</span> <span class="string">./script/updatePackage.sh</span> <span class="string">$projectName</span></span><br></pre></td></tr></table></figure><p>执行完上述命令后，gitlab 发版服务上拉取到的tag 代码，就会自动修改package.json 的内容，然后执行 打包命令的时候就会按照我们想要的发版的内容进行发版</p><h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>  如果有预渲染页面的，也可以同 <code>updatePackage.sh</code> 文件来动态的修改需要预渲染的页面，修改 <code>gitlab-ci.yml</code> 文件来更新对应文件</p>  <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test:sync-to-s3:</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="comment"># tags</span></span><br><span class="line">    <span class="comment"># 测试环境</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/V-T-US-.*/</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="comment"># build</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">$&#123;CI_COMMIT_REF_NAME&#125;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">projectName=$&#123;CI_COMMIT_REF_NAME##*-&#125;</span> <span class="comment">#设置变量 projectName</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sh</span> <span class="string">./script/updatePackage.sh</span> <span class="string">$projectName</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">aws</span> <span class="string">s3</span> <span class="string">cp</span> <span class="string">build/$&#123;projectName&#125;.html</span> <span class="string">s3://bucket_path/$&#123;projectName&#125;.html</span> <span class="comment"># 上传对应文件到服务器</span></span><br></pre></td></tr></table></figure><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul><li><a href="https://stackoverflow.com/questions/43165840/get-value-of-package-json-in-gitlab-ci-yml">在gitLab-CI-YML中獲取package.json的值</a></li><li><a href="https://create-react-app.dev/docs/adding-custom-environment-variables/">添加自定義環境變量</a></li><li><a href="https://juejin.cn/post/6960983079867383844">脚本实现版本号自动更新，不传参加1</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;书接上回 &lt;a href=&quot;/2023/02/20/webpack/react-multiple-page-router/&quot;&gt;React 多页面应用 - 路由配置&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这次我们来实现一些不一样的需求，这是在日常工作中遇到的&lt;/p&gt;
&lt;p&gt;首先我们来描述一下</summary>
      
    
    
    
    <category term="webpack" scheme="https://lxx1997.github.io/categories/webpack/"/>
    
    <category term="react" scheme="https://lxx1997.github.io/categories/react/"/>
    
    <category term="gitlab" scheme="https://lxx1997.github.io/categories/gitlab/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
    <category term="webpack" scheme="https://lxx1997.github.io/tags/webpack/"/>
    
    <category term="gitlab" scheme="https://lxx1997.github.io/tags/gitlab/"/>
    
  </entry>
  
  <entry>
    <title>React 多页面应用 - 路由配置</title>
    <link href="https://lxx1997.github.io/2023/02/20/webpack/react-multiple-page-router/"/>
    <id>https://lxx1997.github.io/2023/02/20/webpack/react-multiple-page-router/</id>
    <published>2023-02-20T02:41:26.000Z</published>
    <updated>2023-02-21T02:41:26.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/lxx1997/react-multiple-page-router">项目地址</a></p><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create-react-app react-multiple-page-router</span><br></pre></td></tr></table></figure><h2 id="打包环境配置"><a href="#打包环境配置" class="headerlink" title="打包环境配置"></a>打包环境配置</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add customize-cra react-app-rewired -D</span><br></pre></td></tr></table></figure><p>修改 <code>package.json</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="string">&quot;react-scripts start&quot;</span>,</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;react-scripts build&quot;</span>,</span><br><span class="line">  <span class="string">&quot;test&quot;</span>: <span class="string">&quot;react-scripts test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;eject&quot;</span>: <span class="string">&quot;react-scripts eject&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更换为</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="string">&quot;react-app-rewired start&quot;</span>,</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;react-app-rewired build&quot;</span>,</span><br><span class="line">  <span class="string">&quot;test&quot;</span>: <span class="string">&quot;react-app-rewired test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;eject&quot;</span>: <span class="string">&quot;react-app-rewired eject&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>添加 config.overrides.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; override &#125; =  <span class="built_in">require</span>(<span class="string">&quot;customize-cra&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">overrideConfig</span> = (<span class="params"></span>) =&gt; <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">override</span>(<span class="title function_">overrideConfig</span>())</span><br></pre></td></tr></table></figure><h2 id="多页面配置"><a href="#多页面配置" class="headerlink" title="多页面配置"></a>多页面配置</h2><p>在 <code>src</code> 目录下新建 <code>pages</code> 文件夹用来存放多页面入口</p><p>在 <code>pages</code> 目录下新建 <code>pages1</code>, <code>pages2</code> 目录，并创建入口文件</p><p>引入 <code>HtmlWebpackPlugin</code> 组件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add html-webpack-plugin -D</span><br></pre></td></tr></table></figure><p>修改 <code>config.overrides.js</code> 配置多页面打包</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; override &#125; =  <span class="built_in">require</span>(<span class="string">&quot;customize-cra&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">overrideConfig</span> = (<span class="params"></span>) =&gt; <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  config.<span class="property">entry</span> = &#123;</span><br><span class="line">    <span class="attr">main</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">    <span class="attr">page1</span>: <span class="string">&quot;./src/pages/page1/index.js&quot;</span>,</span><br><span class="line">    <span class="attr">page2</span>: <span class="string">&quot;./src/pages/page2/index.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  config.<span class="property">output</span> = &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].[fullhash].js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: __dirname + <span class="string">&#x27;/dist&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  config.<span class="property">plugins</span>.<span class="title function_">push</span>(</span><br><span class="line">    <span class="keyword">new</span> <span class="title function_">htmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;main&quot;</span>,</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;main.html&quot;</span>,</span><br><span class="line">      <span class="attr">chunks</span>: [<span class="string">&quot;main&quot;</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title function_">htmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Page1&quot;</span>,</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;page1.html&quot;</span>,</span><br><span class="line">      <span class="attr">chunks</span>: [<span class="string">&quot;page1&quot;</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">new</span> <span class="title function_">htmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Page2&quot;</span>,</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;page2.html&quot;</span>,</span><br><span class="line">      <span class="attr">chunks</span>: [<span class="string">&quot;page2&quot;</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">override</span>(<span class="title function_">overrideConfig</span>())</span><br></pre></td></tr></table></figure><h2 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h2><p>引入 <code>react-router-dom</code></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-router-dom -D</span><br></pre></td></tr></table></figure><p>在 <code>pages1</code>,<code>pages2</code> 页面添加路由组件</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// page1/index.jsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> reportWebVitals <span class="keyword">from</span> <span class="string">&#x27;../../reportWebVitals&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// If you want to start measuring performance in your app, pass a function</span></span><br><span class="line"><span class="comment">// to log results (for example: reportWebVitals(console.log))</span></span><br><span class="line"><span class="comment">// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals</span></span><br><span class="line"><span class="title function_">reportWebVitals</span>();</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// page1/App.jsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Routes</span>, <span class="title class_">Route</span>, <span class="title class_">NavLink</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Test</span> <span class="keyword">from</span> <span class="string">&#x27;../../components/Test&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Page2<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&#123;</span>&quot;/<span class="attr">test</span>&quot;&#125;&gt;</span>Test<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/test&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Test</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// page2/index.jsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> reportWebVitals <span class="keyword">from</span> <span class="string">&#x27;../../reportWebVitals&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">BrowserRouter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// If you want to start measuring performance in your app, pass a function</span></span><br><span class="line"><span class="comment">// to log results (for example: reportWebVitals(console.log))</span></span><br><span class="line"><span class="comment">// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals</span></span><br><span class="line"><span class="title function_">reportWebVitals</span>();</span><br></pre></td></tr></table></figure><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// page2/App.jsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Routes</span>, <span class="title class_">Route</span>, <span class="title class_">NavLink</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">About</span> <span class="keyword">from</span> <span class="string">&#x27;../../components/About&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&#x27;../../components/Home&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Page2<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&#123;</span>&quot;/<span class="attr">home</span>&quot;&#125;&gt;</span>Home<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&#123;</span>&quot;/<span class="attr">about</span>&quot;&#125;&gt;</span>About<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Home</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">About</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure><p>这样就可以切换路由了</p><h2 id="存在问题"><a href="#存在问题" class="headerlink" title="存在问题"></a>存在问题</h2><ul><li><strong>路由跳转后，刷新页面后，可能会无法定位到对应的路由</strong></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://github.com/lxx1997/react-multiple-page-router&quot;&gt;项目地址&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;创建项目&quot;&gt;&lt;a href=&quot;#创建项目&quot; class=&quot;headerlink&quot; title=&quot;创建项目</summary>
      
    
    
    
    <category term="webpack" scheme="https://lxx1997.github.io/categories/webpack/"/>
    
    <category term="react" scheme="https://lxx1997.github.io/categories/react/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
    <category term="webpack" scheme="https://lxx1997.github.io/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>window.postMessage跨域的使用方式</title>
    <link href="https://lxx1997.github.io/2023/02/14/web/window-postMessage%E8%B7%A8%E5%9F%9F%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F/"/>
    <id>https://lxx1997.github.io/2023/02/14/web/window-postMessage%E8%B7%A8%E5%9F%9F%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F/</id>
    <published>2023-02-14T02:55:18.000Z</published>
    <updated>2023-02-14T02:55:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近忙着工作的事情，好久没有更新博客了，正好最近要做的一个功能，最后决定使用 postMessage 进行解决</p><p>具体的使用场景是我这边打开新的窗口的时候需要向新的窗口传递一些数据</p><p>首先从网上摘取一些针对 postMessage 介绍</p><blockquote><p>window.postMessage() 方法可以安全地实现跨源通信。通常，对于两个不同页面的脚本，只有当执行它们的页面位于具有相同的协议（通常为https），端口号（443为https的默认值），以及主机  (两个页面的模数 Document.domain设置为相同的值) 时，这两个脚本才能相互通信。window.postMessage() 方法提供了一种受控机制来规避此限制，只要正确的使用，这种方法就很安全。</p></blockquote><h4 id="父窗口如何传递参数"><a href="#父窗口如何传递参数" class="headerlink" title="父窗口如何传递参数"></a>父窗口如何传递参数</h4><p>打开窗口的方式有一下几种 <code>iframe</code>的<code>contentWindow</code>属性、执行<code>window.open</code>返回的窗口对象、或者是命名过或数值索引的<code>window.frames</code>,此处暂时先介绍 <code>window.open()</code></p><p>父窗口获取打开新窗口对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> open = <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;http://www.baidu.com&#x27;</span>, <span class="string">&quot;_blank&quot;</span>)</span><br></pre></td></tr></table></figure><p>postMessage 有三个参数<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open.<span class="title function_">postMessage</span>(message, targetOrigin, [transfer]);</span><br></pre></td></tr></table></figure></p><ul><li><code>message</code> 是传递的数据 一般来说是一个对象用来传递当前<code>postMessage</code>类型，以及要传递的数据，因为可以通过 <code>postMessage</code> 多次传递，但是调用的事件监听方法都是同一个，所以最好要加一个状态进行区分</li><li><code>targetOrigin</code> 代表接受域名， 可以是 <code>&quot;*&quot;</code> 代表所有域名都可以，也可以是一个url，代表特定域名可以接受</li><li><code>transfer</code> 是一串和message 同时传递的 Transferable 对象. 这些对象的所有权将被转移给消息的接收方，而发送一方将不再保有所有权。</li></ul><p>postMessage 在使用的时候需要在需要接收数据的窗口中定义一个事件监听函数 <code>message</code>, 注意这个方法需要挂载到 <code>·indow</code> 上面, 我最开始给挂载到 <code>document</code>, 结果怎么都触发不了，尴尬</p><p>postMessage 传递的 message 数据在 回调函数参数的 data上</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="子窗口获取父窗口"><a href="#子窗口获取父窗口" class="headerlink" title="子窗口获取父窗口"></a>子窗口获取父窗口</h4><ul><li>window.opener 方法</li><li>message 回到函数参数的 resource 属性，返回父窗口的引用</li></ul><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ul><li>使用window.open 打开新窗口会被拦截？</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> open = <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;about:blank&#x27;</span>)</span><br><span class="line">open.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;http://www.baidu.com&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近忙着工作的事情，好久没有更新博客了，正好最近要做的一个功能，最后决定使用 postMessage 进行解决&lt;/p&gt;
&lt;p&gt;具体的使用场景是我这边打开新的窗口的时候需要向新的窗口传递一些数据&lt;/p&gt;
&lt;p&gt;首先从网上摘取一些针对 postMessage 介绍&lt;/p&gt;
&lt;b</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>window.IntersectionObserver</title>
    <link href="https://lxx1997.github.io/2023/02/14/web/window-IntersectionObserver/"/>
    <id>https://lxx1997.github.io/2023/02/14/web/window-IntersectionObserver/</id>
    <published>2023-02-14T02:54:06.000Z</published>
    <updated>2023-02-14T02:55:18.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="window-IntersectionObserver"><a href="#window-IntersectionObserver" class="headerlink" title="window.IntersectionObserver"></a>window.IntersectionObserver</h2><p>IntersectionObserver 提供了一种异步观察观察目标元素与其祖先元素或者顶级文档交叉状态的方法，即目标元素元素出现或者隐藏的时候就会触发</p><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> observe = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(callback， options)</span><br></pre></td></tr></table></figure><ul><li><p>callback </p><p>  回调函数，当我们监听的元素触发到阈值的时候会触发回调函数，callback 会有两个参数 entries 和 observer， entries 是一个数组返回触发监听的目标元素</p></li><li><p>options</p><ul><li><p>root</p><p>  root 属性是目标元素的祖先元素，如果未传入值则默认使用顶级文档视窗</p></li><li><p>rootMarign</p><p>  计算交叉时添加到root边界和的矩形偏移量，所有偏移量均可用像素或者百分比</p><p>  主要作用是缩小或者扩大根元素的判定范围</p></li><li><p>thresholds</p><p>  一个包含阈值的列表，按照升序排列，列表中每个阈值都是监听对象的交叉区域与边界区域的比率，当监听对象的任何阈值被越过时，都会生成一个通知，如果未传入值，则默认为0</p><p>  例如 [0, 0.25, 0.5, 0.75, 1]表示当目标对应比例在目标元素可见时，触发回调函数</p></li></ul></li></ul><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ul><li><p>disconnect</p><p>  停止监听工作</p></li><li><p>observe</p><p>  添加监听目标元素并进行监听</p></li><li><p>takeRecords</p><p>  返回所有观察目标的 intersectionObserverEntry 对象数组</p></li><li><p>unobserve</p><p>  停止监听特定目标元素</p></li></ul><h4 id="IntersectionObserverEntry"><a href="#IntersectionObserverEntry" class="headerlink" title="IntersectionObserverEntry"></a>IntersectionObserverEntry</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">time</span>: <span class="number">3893.92</span>, <span class="comment">// 可见性发生变化的时间，是一个高精度时间戳，单位为毫秒</span></span><br><span class="line">    <span class="attr">target</span>: element <span class="comment">// 被观察的目标元素，是一个 DOM 节点对象</span></span><br><span class="line">    <span class="attr">rootBounds</span>: <span class="title class_">ClientRect</span> &#123; <span class="comment">// 根元素的矩形区域的信息，getBoundingClientRect()方法的返回值，如果没有根元素（即直接相对于视口滚动），则返回null</span></span><br><span class="line">        <span class="attr">bottom</span>: <span class="number">920</span>,</span><br><span class="line">        <span class="attr">height</span>: <span class="number">1024</span>,</span><br><span class="line">        <span class="attr">left</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">right</span>: <span class="number">1024</span>,</span><br><span class="line">        <span class="attr">top</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">width</span>: <span class="number">920</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">boundingClientRect</span>: <span class="title class_">ClientRect</span> &#123; <span class="comment">// 目标元素的矩形区域的信息</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">intersectionRect</span>: <span class="title class_">ClientRect</span> &#123; <span class="comment">// 目标元素与视口（或根元素）的交叉区域的信息</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">intersectionRatio</span>: <span class="number">0.54</span>, <span class="comment">// 目标元素的可见比例，即intersectionRect占boundingClientRect的比例，完全可见时为1，完全不可见时小于等于0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用-IntersectionObserver"><a href="#使用-IntersectionObserver" class="headerlink" title="使用 IntersectionObserver"></a>使用 IntersectionObserver</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 IntersectionObserver 实例</span></span><br><span class="line"><span class="keyword">var</span> observe = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function">(<span class="params">entries</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(entries)</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">root</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>),</span><br><span class="line">    <span class="attr">rootMargin</span>: <span class="string">&quot;0px 0px 0px 0px&quot;</span>,</span><br><span class="line">    <span class="attr">thresholds</span>: [<span class="number">0</span>, <span class="number">0.25</span>, <span class="number">0.5</span>, <span class="number">0.75</span>, <span class="number">1</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加目标对象</span></span><br><span class="line">observe.<span class="title function_">observe</span>(element)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 停止监听</span></span><br><span class="line">observe.<span class="title function_">unobserve</span>(element)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 断开链接</span></span><br><span class="line">observe.<span class="title function_">disconnect</span>()</span><br></pre></td></tr></table></figure><h4 id="我们可以解决什么问题"><a href="#我们可以解决什么问题" class="headerlink" title="我们可以解决什么问题"></a>我们可以解决什么问题</h4><ul><li><p>图片或者资源懒加载问题，使用 IntersectionObserver 可以监听到图片元素是否滚动到页面上，从而可以实现预加载和懒加载</p></li><li><p>元素曝光统计，我们在实际需求中可能需要统计或者计算元素是否曝光在页面上，然后向后台发送统计事件，这样可以方便产品对页面内容进行调整</p></li><li><p>其他计算，比如我们可能需要判断某个元素是否出现在页面上，然后再进行特殊的计算，如果这些计算数量较少，我们可以不做任何关注，但是如果页面上存在大量的这样的计算，我们需要实现按需计算，这个时候就可以使用 IntersectionObserver 监听元素是否出现在页面，来进行计算，从而减少浏览器内存消耗，提高用户体验</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;window-IntersectionObserver&quot;&gt;&lt;a href=&quot;#window-IntersectionObserver&quot; class=&quot;headerlink&quot; title=&quot;window.IntersectionObserver&quot;&gt;&lt;/a&gt;windo</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>一些精品的前端学习网站</title>
    <link href="https://lxx1997.github.io/2023/02/02/frontend-learning-website/"/>
    <id>https://lxx1997.github.io/2023/02/02/frontend-learning-website/</id>
    <published>2023-02-02T01:32:37.000Z</published>
    <updated>2023-02-02T01:32:37.000Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th style="text-align:center">网站名称</th><th style="text-align:center">跳转链接</th><th style="text-align:center">状态</th></tr></thead><tbody><tr><td style="text-align:center">web全栈体系</td><td style="text-align:center"><a href="https://senior-frontend.pages.dev/">点击跳转</a></td><td style="text-align:center">正在学习中</td></tr><tr><td style="text-align:center">前端技能图谱</td><td style="text-align:center"><a href="https://leohxj.gitbooks.io/front-end-database/content/interview/skill-path.html">点击跳转</a></td><td style="text-align:center">未学习</td></tr><tr><td style="text-align:center">JavaScript MDN doc</td><td style="text-align:center"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript">点击跳转</a></td><td style="text-align:center">正在学习中</td></tr><tr><td style="text-align:center">卡颂 React React技术揭秘</td><td style="text-align:center"><a href="https://react.iamkasong.com/preparation/idea.html">点击跳转</a></td><td style="text-align:center">正在学习中</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;网站名称&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;跳转链接&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;状态&lt;/th&gt;
&lt;</summary>
      
    
    
    
    <category term="web" scheme="https://lxx1997.github.io/categories/web/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
    <category term="nextJs" scheme="https://lxx1997.github.io/tags/nextJs/"/>
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>杂谈 - 短视频对现实生活的影响</title>
    <link href="https://lxx1997.github.io/2023/01/26/thinking/social/short-video-about-social/"/>
    <id>https://lxx1997.github.io/2023/01/26/thinking/social/short-video-about-social/</id>
    <published>2023-01-26T11:29:40.000Z</published>
    <updated>2023-01-26T11:29:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近这一年左右经常在 b站 刷短视频，也看过多种多样的视频类型，例如分享个人生活，做饭，讲解历史等，也有男女对立，带货，以及虚假新闻等会对人的判断造成影响的短视频。最近突发感想，记录下来</p><h4 id="短视频的崛起"><a href="#短视频的崛起" class="headerlink" title="短视频的崛起"></a>短视频的崛起</h4><p>感兴趣的可以看一下这篇文章<a href="https://posts.careerengine.us/p/60861e3d682f285b7c354a32">短视频行业是怎么火起来的？聊聊中美短视频行业的前世今生</a> 我这边就不过多介绍了</p><h4 id="短视频的优缺点"><a href="#短视频的优缺点" class="headerlink" title="短视频的优缺点"></a>短视频的优缺点</h4><p>这几年涌现出了许多家短视频平台，快手，抖音，西瓜，甚至于许多视频网站也开始向短视频平台进发，例如 b站，也开发出了短视频模式。</p><h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><ol><li><p>短视频一般可能是十几秒到三四分钟不等，视频内容精炼，我们可以完全可以在空闲时间刷两到三个短视频，极大加快了我们获取新知识的速度</p></li><li><p>短视频更容易吸引人的注意力</p></li></ol><h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><ol><li><p>容易沉迷，由于推送算法的影响，刷到的短视频经常都是自己喜欢看的，很容易长时间沉迷进去，从而占据人们大部分的娱乐时间</p></li><li><p>由于周围人都在刷短视频，人与人之间的交流逐渐减少，虽然之前也有类似的情况，但是短视频的更加显著一些</p></li><li><p>部分人群无法分辨高质量视频，容易被一些低质量视频或者三观不正的视频带偏，个人思想容易受到影响</p></li><li><p>为用户基数大，所以信息传递起来更快，这样就会被一部分不怀好意的人影响，传播虚假消息，挑拨社会问题，引发社会上的信任危机</p></li><li><p>视频比较短，部分内容可能无法完全展示，会造成断章取义的影响</p></li></ol><h4 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h4><ol><li><p>要学会分辨有用的知识和无用的知识</p></li><li><p>增强自控能力，避免沉迷</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近这一年左右经常在 b站 刷短视频，也看过多种多样的视频类型，例如分享个人生活，做饭，讲解历史等，也有男女对立，带货，以及虚假新闻等会对人的判断造成影响的短视频。最近突发感想，记录下来&lt;/p&gt;
&lt;h4 id=&quot;短视频的崛起&quot;&gt;&lt;a href=&quot;#短视频的崛起&quot; class</summary>
      
    
    
    
    <category term="thinking" scheme="https://lxx1997.github.io/categories/thinking/"/>
    
    
    <category term="thinking" scheme="https://lxx1997.github.io/tags/thinking/"/>
    
  </entry>
  
  <entry>
    <title>Swiper - 一些常用的属性及方法</title>
    <link href="https://lxx1997.github.io/2023/01/18/thirdPartPlugin/swiper-use-methods/"/>
    <id>https://lxx1997.github.io/2023/01/18/thirdPartPlugin/swiper-use-methods/</id>
    <published>2023-01-18T06:45:31.000Z</published>
    <updated>2023-02-01T09:45:31.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Swiper - is the free and most modern mobile touch slider with hardware accelerated transitions and amazing native behavior. It is intended to be used in mobile websites, mobile web apps, and mobile native/hybrid apps.</p><p>Swiper - 是免費且最現代的移動觸摸滑塊，具有硬件加速轉換和驚人的本機行為。它旨在用於移動網站、移動網絡應用程序和移動原生/混合應用程序。</p><p>Swiper is not compatible with all platforms, it is a modern touch slider which is focused only on modern apps/platforms to bring the best experience and simplicity.</p><p>Swiper 並非與所有平台兼容，它是一種現代觸摸滑塊，僅專注於現代應用程序/平台，以帶來最佳體驗和簡單性。</p><p>更多细节的使用可以查看官网，有 demo 且所有的api</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>Swiper 应该是最常用的滑块插件了，兼容了 Vue， react， Angular， solid， svelte 等三方框架，里面有很多属性和方法，里面有很多方法我们其实并不会遇到，有些方法很长用到，如果每次去查文档会浪费很多时间，在这里把一些常用的方法记录一下，方便下次查阅</p><h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><ul><li>slidesPerView: number 在屏幕内显示多少个组件，组件宽度会平分当前屏幕宽度</li><li>slidesPerGroup: number 每次滚动滚动滑块个数</li><li>spaceBetween: number 组件之间的距离</li><li>initialSlide: number 当前选中 (活跃) 的组件</li><li>loop: boolean 是否循环</li><li>centeredSlides: boolean 是否居中显示，如果设置为 true 的 在滑动时最开始和最后的组件可以滑动到页面中央</li><li>isBeginning: boolean 可以用来判断是否是开头</li><li>isEnd: boolean 可以判断是否结尾<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">onSlideChange</span> = (<span class="params">slider: any</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span>(slider) &#123;</span><br><span class="line">    <span class="title function_">setShowStart</span>(!slider.<span class="property">isBeginning</span>)</span><br><span class="line">    <span class="title function_">setShowEnd</span>(!slider.<span class="property">isEnd</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>breakpoints 不同屏幕尺寸下的适配，会替换掉原来的属性值</li></ul><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ul><li>slideTo 跳转到第几个滑块</li><li>onSwiper 可以获取 Swiper 实例（vue 和 react 中）</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h2&gt;&lt;p&gt;Swiper - is the free and most modern mobile touch slider with hardware</summary>
      
    
    
    
    <category term="web" scheme="https://lxx1997.github.io/categories/web/"/>
    
    <category term="thirdPartPlugin" scheme="https://lxx1997.github.io/categories/thirdPartPlugin/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
    <category term="thirdPartPlugin" scheme="https://lxx1997.github.io/tags/thirdPartPlugin/"/>
    
  </entry>
  
  <entry>
    <title>前端 - 文字换行</title>
    <link href="https://lxx1997.github.io/2023/01/18/web/font-wrap/"/>
    <id>https://lxx1997.github.io/2023/01/18/web/font-wrap/</id>
    <published>2023-01-18T01:38:33.000Z</published>
    <updated>2023-01-18T01:38:33.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="white-sapce"><a href="#white-sapce" class="headerlink" title="white-sapce"></a>white-sapce</h4><p><code>white-sapce</code> 可以通过 <code>nowrap</code> 或者 <code>wrap</code> 来控制一行文字在超出文本框长度时是否换行</p><ul><li><code>normal</code>: 默认。空白会被浏览器忽略。</li><li><code>pre</code>: 空白会被浏览器保留。其行为方式类似 <code>HTML</code> 中的 <code>pre</code> 标签。</li><li><code>nowrap</code>: 文本不会换行，文本会在在同一行上继续，直到遇到 <code>br</code> 标签为止。</li><li><code>pre-wrap</code>: 保留空白符序列，但是正常地进行换行。</li><li><code>pre-line</code>: 合并空白符序列，但是保留换行符。</li><li><code>inherit</code>: 规定应该从父元素继承 <code>white-space</code> 属性的值。</li></ul><p><code>word-break</code> 可以设置文字换行时是 自动换行还是 强制换行</p><ul><li><code>normal</code>: 只在允许的断字点换行(浏览器保持默认处理)</li><li><code>break-word</code>: 在长单词或URL地址内部进行换行</li><li><code>break-all</code>: 强制换行，会打断英文单词</li></ul><h4 id="文本超出隐藏"><a href="#文本超出隐藏" class="headerlink" title="文本超出隐藏"></a>文本超出隐藏</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">white-space</span>: nowrap;</span><br><span class="line"><span class="attribute">overflow</span>: hidden;</span><br><span class="line"><span class="attribute">text-overflow</span>: hidden;</span><br></pre></td></tr></table></figure><h4 id="文本超出显示省略号"><a href="#文本超出显示省略号" class="headerlink" title="文本超出显示省略号"></a>文本超出显示省略号</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">white-space</span>: nowrap;</span><br><span class="line"><span class="attribute">overflow</span>: hidden;</span><br><span class="line"><span class="attribute">text-overflow</span>: ellipsis;</span><br></pre></td></tr></table></figure><h4 id="多行文本超出显示省略号"><a href="#多行文本超出显示省略号" class="headerlink" title="多行文本超出显示省略号"></a>多行文本超出显示省略号</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">overflow</span> : hidden;</span><br><span class="line"><span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line"><span class="attribute">display</span>: -webkit-box;</span><br><span class="line">-webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">-webkit-box-orient: vertical;</span><br></pre></td></tr></table></figure><p>但是这种操作具有浏览器兼容性问题，在部分浏览器上并不适用，所以还有另一种解决方案，可以通过计算的方式来添加省略号<br><a href="/assets/demo/clamp.js">这是代码</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> clamp <span class="keyword">from</span> <span class="string">&quot;clamp&quot;</span> <span class="comment">// 首先引入js</span></span><br><span class="line"><span class="title function_">clamp</span>(domEle, &#123;</span><br><span class="line">  <span class="attr">clamp</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">splitOnChars</span>: [<span class="string">&quot;。&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;–&quot;</span>, <span class="string">&quot;—&quot;</span>, <span class="string">&quot; &quot;</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>通过以上操作，会将domEle 里面的文本超出两行时会显示省略号，如果遇到一行无法完整显示的词，会根据splitOnChars 里面的参数判断是否需要将单词拆开换行</p><p>也可以通过修改 clamp 参数来控制显示行数</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;white-sapce&quot;&gt;&lt;a href=&quot;#white-sapce&quot; class=&quot;headerlink&quot; title=&quot;white-sapce&quot;&gt;&lt;/a&gt;white-sapce&lt;/h4&gt;&lt;p&gt;&lt;code&gt;white-sapce&lt;/code&gt; 可以通过 &lt;cod</summary>
      
    
    
    
    <category term="web" scheme="https://lxx1997.github.io/categories/web/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="css" scheme="https://lxx1997.github.io/tags/css/"/>
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>杂谈 - 从一个前端的角度来看什么才是一个合格的产品</title>
    <link href="https://lxx1997.github.io/2023/01/13/thinking/code/working-process-problems/"/>
    <id>https://lxx1997.github.io/2023/01/13/thinking/code/working-process-problems/</id>
    <published>2023-01-13T15:17:09.000Z</published>
    <updated>2023-01-14T15:17:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>产品经理（PM）也称产品企划，是指在公司中针对某一项或是某一类的产品进行规划和管理的人员，主要负责产品的研发、制造、营销、渠道等工作。产品经理是很难定义的一个角色，如果非要一句话定义，那么产品经理是为终端用户服务，负责产品整个生命周期的人。</p><p>但是事实上，部分产品并不专业，主要体现在以下几个方面</p><h4 id="需求方面。"><a href="#需求方面。" class="headerlink" title="需求方面。"></a>需求方面。</h4><p>产品主要负责编写需求文档以及原型图，方便UI,测试，开发等了解需求详细内容，但是实际上大部分产品并不会编写需求文档，可能只会有原型图，而且原型图并不完善，很多细节都没有标注，还有就是没有考虑到对程序其他功能之间的影响以及不同端之间的影响，而作为一个开发人员或者测试人员，本身无法从全局方面来分析需求，即使向产品提出遗漏的部分，但是也会有遗漏的地方，这些遗漏的地方，运气好的话可能会在开发以及测试阶段被查找出来，但是更多的时候则是会被用户发现。</p><h4 id="任务排期。"><a href="#任务排期。" class="headerlink" title="任务排期。"></a>任务排期。</h4><p>如果是一个做自营产品的公司，产品经理除了自己需要进行迭代的任务外，还需要收集市场部分，老板的需求，以及现场用户遇到的问题。然后根据任务的紧急度进行排期，而不是任务提出来了就要立即更改，打乱了原本正常的迭代流程。</p><p>但是实际上部分产品经理根本不会过滤需求，也不会根据需求的紧急度进行排期，经常是来了一个任务后，如果优先级比较高的话，可能会暂停当前迭代，开发新的需求，但是优先级不高的需求则会被插入当前迭代任务内，而且基本上不会给你增加时间，这就导致了开发和测试需要经常加班才能按时完成任务。</p><p>而且我还遇到更加蛇皮的操作，有了新需求后，直接和我说要加个什么需求，然后我加完之后，需要进行测试了，发现测试人员根本就不知道有这个需求；有时候也会遇到我都已经将所有需求都提测了，在测试阶段又给我提出了新的需求。</p><h4 id="需求评审"><a href="#需求评审" class="headerlink" title="需求评审"></a>需求评审</h4><p>产品经理需要将当前迭代的内容以及详细的交互逻辑需要给UI，测试，前端，后端等相关人员讲解清楚，针对提出的疑问，要给出合理的解决办法，针对 UI 设计图，需要讲解一下页面的交互逻辑，以及交互动画，特效等，针对一些不合理的 UI 设计，需要进行修改。</p><p>但是在实际开发中，可能并不会有这一种流程，经常是产品提出需求，画出原型图后，开发就需要进行拆分任务和预估时间。然后基本上和 UI 同一时间进行开发。这也会造成开发在时间上的滞后。</p><p><strong>每个人也不是生来就会的，不会的可以去学，可以从每次的失败中总结教训，下一次争取做的更好，但是有些产品来来回回做了那么多次迭代，流程上还是老样子，这样就不免得让人觉得十分心烦了</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;产品经理（PM）也称产品企划，是指在公司中针对某一项或是某一类的产品进行规划和管理的人员，主要负责产品的研发、制造、营销、渠道等工作。产品经理是很难定义的一个角色，如果非要一句话定义，那么产品经理是为终端用户服务，负责产品整个生命周期的人。&lt;/p&gt;
&lt;p&gt;但是事实上，部分产</summary>
      
    
    
    
    <category term="thinking" scheme="https://lxx1997.github.io/categories/thinking/"/>
    
    
    <category term="thinking" scheme="https://lxx1997.github.io/tags/thinking/"/>
    
  </entry>
  
  <entry>
    <title>CANVAS 绘图小技巧 - 绘制一个带有圆角的矩形</title>
    <link href="https://lxx1997.github.io/2023/01/11/web/canvas-draw-border-radius-rect/"/>
    <id>https://lxx1997.github.io/2023/01/11/web/canvas-draw-border-radius-rect/</id>
    <published>2023-01-11T09:59:18.000Z</published>
    <updated>2023-01-11T09:59:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>在工作中遇到了这样的一个问题，需要在下载的图片添加一些文字描述，这些文字有一个带有圆角的矩形背景。</p><p>主要实现方式是使用 <code>Canvas</code> 的 <code>lineTo</code> 方法和 <code>arcTo</code> 方法通过线条绘制出一个圆角矩形</p><h4 id="moveTo-x-y"><a href="#moveTo-x-y" class="headerlink" title="moveTo(x, y)"></a>moveTo(x, y)</h4><p><code>moveTo</code> 主要是将一个新的子路径的起始点移动到 (x, y) 坐标的方法。</p><p>它代表我们绘制的线条的起点</p><h4 id="lineTo-x-y"><a href="#lineTo-x-y" class="headerlink" title="lineTo(x, y)"></a>lineTo(x, y)</h4><p><code>lineTo</code> 主要是从当前绘制线条终点，连接到 (x, y) 坐标，绘制的是一条直线</p><h4 id="arcTo-x1-y1-x2-y2-r"><a href="#arcTo-x1-y1-x2-y2-r" class="headerlink" title="arcTo(x1, y1, x2, y2, r)"></a>arcTo(x1, y1, x2, y2, r)</h4><p><code>arcTo</code> 则是用来绘制圆弧的，将会根据 (x1, y1), (x2, y2) 点的相对位置以点 (x1, y1) 偏移半径 R 的距离画一个圆弧，这个圆弧与 (x1, y1)，(x2, y2) 的连线相切，并从切点连线到(x2,y2),</p><p>接下来上代码，可以画出一个 左上角和右下角都是圆角的矩形</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">drawRoundRect</span> = (<span class="params">ctx, x, y, w, h, r, color</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> min_size = <span class="title class_">Math</span>.<span class="title function_">min</span>(w, h);</span><br><span class="line">  <span class="keyword">if</span> (r &gt; min_size / <span class="number">2</span>) r = min_size / <span class="number">2</span>;</span><br><span class="line">  <span class="comment">// 开始绘制</span></span><br><span class="line">  ctx.<span class="title function_">save</span>()</span><br><span class="line">  <span class="comment">// 开始绘制</span></span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">moveTo</span>(x + r, y);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x + w, y)</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x + w, y + h - r)</span><br><span class="line">  ctx.<span class="title function_">arcTo</span>(x + w, y + h, x + w - r, y + h, r)</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x + w - r, y + h)</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x, y + h)</span><br><span class="line">  ctx.<span class="title function_">arcTo</span>(x, y, x + w, y, r)</span><br><span class="line">  ctx.<span class="title function_">closePath</span>();</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = color</span><br><span class="line">  ctx.<span class="title function_">fill</span>()</span><br><span class="line">  ctx.<span class="title function_">restore</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>)</span><br><span class="line"><span class="title function_">drawRoundRect</span>(ctx, <span class="number">20</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">8</span>, <span class="string">&quot;rgba(0,0,0,0.3)&quot;</span>)</span><br></pre></td></tr></table></figure><p>我们只需要传入canvas 的 context 属性以及起始点坐标，以及矩形宽高和圆角半径</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在工作中遇到了这样的一个问题，需要在下载的图片添加一些文字描述，这些文字有一个带有圆角的矩形背景。&lt;/p&gt;
&lt;p&gt;主要实现方式是使用 &lt;code&gt;Canvas&lt;/code&gt; 的 &lt;code&gt;lineTo&lt;/code&gt; 方法和 &lt;code&gt;arcTo&lt;/code&gt; 方法通过线</summary>
      
    
    
    
    <category term="web" scheme="https://lxx1997.github.io/categories/web/"/>
    
    <category term="canvas" scheme="https://lxx1997.github.io/categories/canvas/"/>
    
    
    <category term="canvas" scheme="https://lxx1997.github.io/tags/canvas/"/>
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>移动端适配 - IOS 高版本无法下载之 navigator.share 使用</title>
    <link href="https://lxx1997.github.io/2023/01/01/web/navigator-share-ios-chrome-download/"/>
    <id>https://lxx1997.github.io/2023/01/01/web/navigator-share-ios-chrome-download/</id>
    <published>2023-01-01T02:30:26.000Z</published>
    <updated>2023-01-01T02:30:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>在生产环境中，leader 发现了这样一个问题，在生产环境中，部分 IOS 用户在使用 chrome 时，无法正常下载，点击下载按钮时，没有反应，图片无法正常存储到用户手机上，经过排查后发现基本存在与 ios 15 版本以上</p><h2 id="前因"><a href="#前因" class="headerlink" title="前因"></a>前因</h2><p>之前我们的网站一直主打的是pc端浏览器的使用，但是现在移动端访问网站的用户，也占有一定比例，为了使这一部分能够正常使用，所以针对移动端浏览器访问的时进行了一定的适配和功能调整，以保证用户正常使用，文件下载采用的 <code>file-saver</code> 的 <code>saveAs</code> 方法来下载文件。在线上环境也正常运行了一年的时间</p><h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><p>针对 <code>Android</code> 用户基本上都能正常下载，但是针对 <code>IOS 15</code> 版本以上的用户，在使用 <code>chrome</code> 时无法正常下载，在针对竞品进行调研后发现他们使用的是 <code>navigator.share</code> 方法，调用浏览器的分享功能来保证能正常下载</p><h2 id="使用-navigator-share"><a href="#使用-navigator-share" class="headerlink" title="使用 navigator.share"></a>使用 navigator.share</h2><p>在 <code>MDN</code> 上是这样介绍的 <em><code>Navigator.share()</code> 方法通过调用本机的共享机制作为 Web Share API 的一部分。</em>但是由于这是一个实验性的功能，所以浏览器兼容版本比较高，并不是所有浏览都支持，所以需要做一下兼容，不支持 <code>navigator.share</code>, 就使用之前的下载方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sharePromise = <span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="title function_">share</span>(data);</span><br></pre></td></tr></table></figure><p><code>data</code> 包含要共享的数据的对象。必须至少指定以下字段之一。可用选项包括：</p><ul><li><code>url:</code> 要共享的 URL</li><li><code>text:</code> 要共享的文本</li><li><code>title:</code> 要共享的标题（<strong>标题必传，否则无法正常使用</strong>）</li><li><code>files:</code> 要共享的文件(<strong>注意，这是一个数组</strong>)</li></ul><p>分享文件之前，先使用 navigator.canShare() 判断这个文件能否被分享</p><p>在使用中还需要注意 <code>IOS</code> 版本，我在使用中发现， 15 版本一下的 <code>navigator.canShare()</code> 可以通过，但是 <code>navigator.share</code> 会报错，所以在使用之前还需要做一下判断</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userAgent = navigator.<span class="property">userAgent</span>.<span class="title function_">toLocaleLowerCase</span>()</span><br><span class="line"><span class="keyword">let</span> ios = !!navigator.<span class="property">userAgent</span>.<span class="title function_">match</span>(<span class="regexp">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span>)</span><br><span class="line"><span class="keyword">let</span> android = navigator.<span class="property">userAgent</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;Android&quot;</span>) &gt; -<span class="number">1</span> || u.<span class="title function_">indexOf</span>(<span class="string">&quot;Linux&quot;</span>) &gt; -<span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> versionArray = userAgent.<span class="title function_">match</span>(<span class="regexp">/version\/([\d.]+).*mobile/</span>)</span><br><span class="line"><span class="comment">// 获取当前ios 版本</span></span><br><span class="line"><span class="keyword">let</span> version = <span class="title class_">Number</span>(versionArray &amp;&amp; versionArray[<span class="number">1</span>] &amp;&amp; versionArray[<span class="number">1</span>].<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">let</span> options = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;hello word&quot;</span>,</span><br><span class="line">  <span class="attr">files</span>: files</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(navigator.<span class="property">canShare</span> &amp;&amp; navigator.<span class="title function_">canShare</span>(options)  &amp;&amp; navigator.<span class="property">share</span> &amp;&amp; (ios &amp;&amp; version &gt;= <span class="number">15</span> || android)) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    navigator.<span class="title function_">share</span>(options).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 成功之后的其他操作</span></span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 旧版本的下载</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">    <span class="comment">// 旧版本的下载</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 旧版本的下载</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>补充一点：navigator.share在不刷新页面的时候只能调用一次，再次调用时 navigator.share 方法会拒绝此操作，所以需要做兼容</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在生产环境中，leader 发现了这样一个问题，在生产环境中，部分 IOS 用户在使用 chrome 时，无法正常下载，点击下载按钮时，没有反应，图片无法正常存储到用户手机上，经过排查后发现基本存在与 ios 15 版本以上&lt;/p&gt;
&lt;h2 id=&quot;前因&quot;&gt;&lt;a href=</summary>
      
    
    
    
    <category term="web" scheme="https://lxx1997.github.io/categories/web/"/>
    
    <category term="IOS" scheme="https://lxx1997.github.io/categories/IOS/"/>
    
    <category term="mobile" scheme="https://lxx1997.github.io/categories/mobile/"/>
    
    <category term="MobileAdaptation" scheme="https://lxx1997.github.io/categories/MobileAdaptation/"/>
    
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
    <category term="IOS" scheme="https://lxx1997.github.io/tags/IOS/"/>
    
    <category term="mobile" scheme="https://lxx1997.github.io/tags/mobile/"/>
    
    <category term="MobileAdaptation" scheme="https://lxx1997.github.io/tags/MobileAdaptation/"/>
    
  </entry>
  
  <entry>
    <title>基于 electron 实现一个记录用户粘贴历史记录应用程序 之 基础环境搭建</title>
    <link href="https://lxx1997.github.io/2022/12/15/frame/electron-vue3-vite-ts-copyright/"/>
    <id>https://lxx1997.github.io/2022/12/15/frame/electron-vue3-vite-ts-copyright/</id>
    <published>2022-12-15T01:59:59.000Z</published>
    <updated>2022-12-15T01:59:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>之前一直使用 utools 工具中的 剪贴板，感觉这个功能十分好用，不用在费劲的去寻找自己之前copy 的记录，十分的方便</p><p>但是由于几个月前收费了，本着能白嫖就付钱的心理，所以就没有继续使用了。</p><p>最近偶然想要做一下这个功能，也可以学习一个 electron 和 vue3 的新知识</p><p>环境搭建可以参考一下<a href="https://segmentfault.com/a/1190000041852520">这个文章</a>，这里有完整的搭建流程。</p><p>但是由于各个电脑的环境以及node， electron 等版本不一样的，所以还是会有一些不同，我只在这里简单的记录一下，并标注一下不同之处</p><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><table><thead><tr><th style="text-align:center">插件</th><th style="text-align:center">版本</th></tr></thead><tbody><tr><td style="text-align:center">node</td><td style="text-align:center">v16.14.0</td></tr><tr><td style="text-align:center">yarn</td><td style="text-align:center">v1.22.19</td></tr><tr><td style="text-align:center">vue</td><td style="text-align:center">v3.2.45</td></tr><tr><td style="text-align:center">@vitejs/plugin-vue</td><td style="text-align:center">4.0.0</td></tr><tr><td style="text-align:center">electron</td><td style="text-align:center">22.0.0</td></tr><tr><td style="text-align:center">electron-builder</td><td style="text-align:center">23.6.0</td></tr><tr><td style="text-align:center">electron-devtools-installer</td><td style="text-align:center">3.2.0</td></tr><tr><td style="text-align:center">rimraf</td><td style="text-align:center">3.0.2</td></tr><tr><td style="text-align:center">typescript</td><td style="text-align:center">4.9.3</td></tr><tr><td style="text-align:center">vite</td><td style="text-align:center">4.0.0</td></tr><tr><td style="text-align:center">vite-plugin-electron</td><td style="text-align:center">0.10.4</td></tr><tr><td style="text-align:center">vite-plugin-electron-renderer</td><td style="text-align:center">0.11.3</td></tr><tr><td style="text-align:center">vue-tsc</td><td style="text-align:center">1.0.11</td></tr></tbody></table><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h4 id="初始化-vue3-vite-ts-环境"><a href="#初始化-vue3-vite-ts-环境" class="headerlink" title="初始化 vue3 + vite + ts 环境"></a>初始化 vue3 + vite + ts 环境</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn create vite todolist --template vue-ts</span><br></pre></td></tr></table></figure><h4 id="初始化-electron-环境"><a href="#初始化-electron-环境" class="headerlink" title="初始化 electron 环境"></a>初始化 electron 环境</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D electron electron-builder rimraf vite-plugin-electron electron-devtools-installer</span><br></pre></td></tr></table></figure><p>插件说明</p><ul><li><p>electron-builder：打包工具</p></li><li><p>rimraf：快速删除文件或目录工具</p></li><li><p>vite-plugin-electron：vite 结合 electron 的库，关于这个插件可以参见 Vite 与 Electron 无缝衔接</p></li><li><p>electron-devtools-installer：electron 开发工具</p></li><li><p>vite-plugin-electron 插件是将 vite 和 electron 结合在一起的，可以让我们非常方便的结合 electron 和 vue，需要做一些指定的配置。</p></li></ul><h4 id="创建-electron-入口文件-electron-ts-和-预渲染-preload-ts"><a href="#创建-electron-入口文件-electron-ts-和-预渲染-preload-ts" class="headerlink" title="创建 electron 入口文件 electron.ts 和 预渲染 preload.ts"></a>创建 electron 入口文件 electron.ts 和 预渲染 preload.ts</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// electron.ts</span></span><br><span class="line"><span class="keyword">const</span> &#123; app, <span class="title class_">BrowserWindow</span>, <span class="title class_">Menu</span>, globalShortcut &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createWindow</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 隐藏顶部菜单</span></span><br><span class="line">  <span class="title class_">Menu</span>.<span class="title function_">setApplicationMenu</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> win = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">      <span class="attr">contextIsolation</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">nodeIntegration</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">preload</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./preload.ts&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (app.<span class="property">isPackaged</span>) &#123;</span><br><span class="line">    win.<span class="title function_">loadFile</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./index.html&#x27;</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Use [&#x27;ENV_NAME&#x27;] avoid vite:define plugin</span></span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">`http://127.0.0.1:5173/`</span>;</span><br><span class="line">    win.<span class="title function_">loadURL</span>(url);</span><br><span class="line">    <span class="comment">// 添加快捷键</span></span><br><span class="line">    globalShortcut.<span class="title function_">unregisterAll</span>()</span><br><span class="line">    globalShortcut.<span class="title function_">register</span>(<span class="string">&#x27;ctrl+q&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      app.<span class="title function_">quit</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    globalShortcut.<span class="title function_">register</span>(<span class="string">&#x27;ctrl+shift+i&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 添加 devtools</span></span><br><span class="line">      win.<span class="property">webContents</span>.<span class="title function_">openDevTools</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">whenReady</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">createWindow</span>();</span><br><span class="line"></span><br><span class="line">  app.<span class="title function_">on</span>(<span class="string">&#x27;activate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// On macOS it&#x27;s common to re-create a window in the app when the</span></span><br><span class="line">    <span class="comment">// dock icon is clicked and there are no other windows open.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">createWindow</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">platform</span> !== <span class="string">&#x27;darwin&#x27;</span>) &#123;</span><br><span class="line">    app.<span class="title function_">quit</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// electron-preload/index.ts</span></span><br><span class="line"><span class="keyword">const</span> os = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(os.<span class="title function_">platform</span>()); <span class="comment">// 测试打印一下系统平台</span></span><br></pre></td></tr></table></figure><h4 id="配置-electron"><a href="#配置-electron" class="headerlink" title="配置 electron"></a>配置 electron</h4><p>在 tsconfig.json 中监听 electron 相关文件和提示</p><p>这个没有发生变化<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;include&quot;</span>: [..., <span class="string">&quot;electron-main/**/*.ts&quot;</span>, <span class="string">&quot;electron-preload/**/*.ts&quot;</span>],</span><br></pre></td></tr></table></figure><br><code>vite.config.ts</code> 变化比较明显，首先 electronRenderer 引入插件变成了 <code>vite-plugin-electron-renderer</code>,其次是初始化的时候 electron 传入实例对象有变化<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> electron <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-electron&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> electronRenderer <span class="keyword">from</span> <span class="string">&#x27;vite-plugin-electron-renderer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">vue</span>(),</span><br><span class="line">    <span class="title function_">electron</span>(&#123;</span><br><span class="line">      <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="attr">main</span>: <span class="string">&#x27;./electron.ts&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">electronRenderer</span>(),</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">emptyOutDir</span>: <span class="literal">false</span>, <span class="comment">// 必须配置，否则electron相关文件将不会生成build后的文件</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h4 id="配置打包命令"><a href="#配置打包命令" class="headerlink" title="配置打包命令"></a>配置打包命令</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;build-electron&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rimraf dist &amp;&amp; vite build &amp;&amp; electron-builder&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>其实在执行完上述内容后，基本上就可以正常运行和打包了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;之前一直使用 utools 工具中的 剪贴板，感觉这个功能十分好用，不用在费劲的去寻找自己之前copy 的记录，十分的方便&lt;/p&gt;
&lt;p&gt;但是由于几个月前收费了，本着能白嫖就付钱的心理，所以就没有继续使用了。&lt;/p&gt;
&lt;p&gt;最近偶然想要做一下这个功能，也可以学习一个 ele</summary>
      
    
    
    
    <category term="vite" scheme="https://lxx1997.github.io/categories/vite/"/>
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/categories/TypeScript/"/>
    
    <category term="web" scheme="https://lxx1997.github.io/categories/web/"/>
    
    <category term="electron" scheme="https://lxx1997.github.io/categories/electron/"/>
    
    <category term="vue3" scheme="https://lxx1997.github.io/categories/vue3/"/>
    
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/tags/TypeScript/"/>
    
    <category term="electron" scheme="https://lxx1997.github.io/tags/electron/"/>
    
    <category term="Vue3" scheme="https://lxx1997.github.io/tags/Vue3/"/>
    
    <category term="vite" scheme="https://lxx1997.github.io/tags/vite/"/>
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript 高级类型</title>
    <link href="https://lxx1997.github.io/2022/12/06/web/typescript-advanced-type/"/>
    <id>https://lxx1997.github.io/2022/12/06/web/typescript-advanced-type/</id>
    <published>2022-12-06T06:39:19.000Z</published>
    <updated>2022-12-06T06:39:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>TypeScript 有许多高级类型，方便系统更好判断代码是否存在不合理的点，也更方便用户来排查错误和编写代码，下面介绍一些常用的高级类型，这些高级类型在日常开发中可能没有机会用到，但是了解一下对我们并没有任务坏处</p><h2 id="交叉类型"><a href="#交叉类型" class="headerlink" title="交叉类型"></a>交叉类型</h2><p>交叉类型是将多个类型合并为一个类型。 这让我们可以把现有的多种类型叠加到一起成为一种类型，它包含了所需的所有类型的特性</p><p>相当于混入（<code>mixin</code>）,在新的类型中，可以拥有合并的所有类型中的成员</p><p>使用 <code>&amp;</code> 来表示交叉</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> extend&lt;T, U&gt;(<span class="attr">first</span>: T, <span class="attr">second</span>: U): T &amp; U &#123;</span><br><span class="line">    <span class="keyword">let</span> result = &lt;T &amp; U&gt;&#123;&#125;;</span><br><span class="line">    for (let id in first) &#123;</span><br><span class="line">        (&lt;any&gt;result)[id] = (&lt;any&gt;first)[id];</span><br><span class="line">    &#125;</span><br><span class="line">    for (let id in second) &#123;</span><br><span class="line">        if (!result.hasOwnProperty(id)) &#123;</span><br><span class="line">            (&lt;any&gt;result)[id] = (&lt;any&gt;second)[id];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Person &#123;</span><br><span class="line">    constructor(public name: string) &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line">interface Loggable &#123;</span><br><span class="line">    log(): void;</span><br><span class="line">&#125;</span><br><span class="line">class ConsoleLogger implements Loggable &#123;</span><br><span class="line">    log() &#123;</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var jim = extend(new Person(&quot;Jim&quot;), new ConsoleLogger());</span><br><span class="line">var n = jim.name;</span><br><span class="line">jim.log();</span><br></pre></td></tr></table></figure><p>通过上述例子,我们利用泛型创建一个 <code>extend</code> 方法用来合并两个对象，通过交叉符号 <code>&amp;</code> 判断函数返回类型是传入类型的合并类型</p><p>这样我们在访问 <code>extend</code> 返回的对象时，如果获取到不存在的属性，就会贴心的为我们提示错误</p><h2 id="联合类型"><a href="#联合类型" class="headerlink" title="联合类型"></a>联合类型</h2><p>联合类型与交叉类型很有关联，但是使用上却完全不同.</p><p>交叉类型 是将多个类型合并成一个新的类型</p><p>联合类型 是满足多个类型中的一个，这些类型可以是基础类型(<code>string</code>, <code>number</code> …) 也可以是用户定义的类或者接口</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;TypeScript 有许多高级类型，方便系统更好判断代码是否存在不合理的点，也更方便用户来排查错误和编写代码，下面介绍一些常用的高级类型，这些高级类型在日常开发中可能没有机会用到，但是了解一下对我们并没有任务坏处&lt;/p&gt;
&lt;h2 id=&quot;交叉类型&quot;&gt;&lt;a href=&quot;#交</summary>
      
    
    
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/categories/TypeScript/"/>
    
    
    <category term="ES6" scheme="https://lxx1997.github.io/tags/ES6/"/>
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/tags/TypeScript/"/>
    
  </entry>
  
  <entry>
    <title>css 选择器</title>
    <link href="https://lxx1997.github.io/2022/12/02/web/css-selector/"/>
    <id>https://lxx1997.github.io/2022/12/02/web/css-selector/</id>
    <published>2022-12-02T07:23:57.000Z</published>
    <updated>2022-12-02T07:23:57.000Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th style="text-align:left">选择器</th><th style="text-align:left">例子</th><th style="text-align:left">例子描述</th></tr></thead><tbody><tr><td style="text-align:left">.class</td><td style="text-align:left">.intro</td><td style="text-align:left">选择 class=”intro” 的所有元素。</td></tr><tr><td style="text-align:left">.class1.class2</td><td style="text-align:left">.name1.name2</td><td style="text-align:left">选择 class 属性中同时有 name1 和 name2 的所有元素。</td></tr><tr><td style="text-align:left">.class1 .class2</td><td style="text-align:left">.name1 .name2</td><td style="text-align:left">选择作为类名 name1 元素后代的所有类名 name2 元素。</td></tr><tr><td style="text-align:left">#id</td><td style="text-align:left">#firstname</td><td style="text-align:left">选择 id=”firstname” 的元素。</td></tr><tr><td style="text-align:left">*</td><td style="text-align:left">*</td><td style="text-align:left">选择所有元素。</td></tr><tr><td style="text-align:left">element</td><td style="text-align:left">p</td><td style="text-align:left">选择所有 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">element.class</td><td style="text-align:left">p.intro</td><td style="text-align:left">选择 class=”intro” 的所有 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">element,element</td><td style="text-align:left">div, p</td><td style="text-align:left">选择所有 <code>&lt;div&gt;</code> 元素和所有 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">element element</td><td style="text-align:left">div p</td><td style="text-align:left">选择 <code>&lt;div&gt;</code> 元素内的所有 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">element&gt;element</td><td style="text-align:left">div &gt; p</td><td style="text-align:left">选择父元素是 <code>&lt;div&gt;</code> 的所有 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">element+element</td><td style="text-align:left">div + p</td><td style="text-align:left">选择紧跟 <code>&lt;div&gt;</code> 元素的首个 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">element1~element2</td><td style="text-align:left">p ~ ul</td><td style="text-align:left">选择前面有 <code>&lt;p&gt;</code> 元素的每个 <code>&lt;ul&gt;</code> 元素。</td></tr><tr><td style="text-align:left">[attribute]</td><td style="text-align:left">[target]</td><td style="text-align:left">选择带有 target 属性的所有元素。</td></tr><tr><td style="text-align:left">[attribute=value]</td><td style="text-align:left">[target=_blank]</td><td style="text-align:left">选择带有 <code>target=&quot;_blank&quot;</code> 属性的所有元素。</td></tr><tr><td style="text-align:left">[attribute~=value]</td><td style="text-align:left">[title~=flower]</td><td style="text-align:left">选择 title 属性包含单词 “flower” 的所有元素。</td></tr><tr><td style="text-align:left">[attribute</td><td style="text-align:left">=value]</td><td style="text-align:left">[lang</td><td>=en]</td><td>选择 lang 属性值以 “en” 开头的所有元素。</td></tr><tr><td style="text-align:left">[attribute^=value]</td><td style="text-align:left">a[href^=”https”]</td><td style="text-align:left">选择其 src 属性值以 “https” 开头的每个 <code>&lt;a&gt;</code> 元素。</td></tr><tr><td style="text-align:left">[attribute$=value]</td><td style="text-align:left">a[href$=”.pdf”]</td><td style="text-align:left">选择其 src 属性以 “.pdf” 结尾的所有 <code>&lt;a&gt;</code> 元素。</td></tr><tr><td style="text-align:left">[attribute=value]</td><td style="text-align:left">a[href=”w3schools”]</td><td style="text-align:left">选择其 href 属性值中包含 “abc” 子串的每个 <code>&lt;a&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:active</td><td style="text-align:left">a:active</td><td style="text-align:left">选择活动链接。</td></tr><tr><td style="text-align:left">::after</td><td style="text-align:left">p::after</td><td style="text-align:left">在每个 <code>&lt;p&gt;</code> 的内容之后插入内容。</td></tr><tr><td style="text-align:left">::before</td><td style="text-align:left">p::before</td><td style="text-align:left">在每个 <code>&lt;p&gt;</code> 的内容之前插入内容。</td></tr><tr><td style="text-align:left">:checked</td><td style="text-align:left">input:checked</td><td style="text-align:left">选择每个被选中的 <code>&lt;input&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:default</td><td style="text-align:left">input:default</td><td style="text-align:left">选择默认的 <code>&lt;input&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:disabled</td><td style="text-align:left">input:disabled</td><td style="text-align:left">选择每个被禁用的 <code>&lt;input&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:empty</td><td style="text-align:left">p:empty</td><td style="text-align:left">选择没有子元素的每个 <code>&lt;p&gt;</code> 元素（包括文本节点）。</td></tr><tr><td style="text-align:left">:enabled</td><td style="text-align:left">input:enabled</td><td style="text-align:left">选择每个启用的 <code>&lt;input&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:first-child</td><td style="text-align:left">p:first-child</td><td style="text-align:left">选择属于父元素的第一个子元素的每个 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">::first-letter</td><td style="text-align:left">p::first-letter</td><td style="text-align:left">选择每个 <code>&lt;p&gt;</code> 元素的首字母。</td></tr><tr><td style="text-align:left">::first-line</td><td style="text-align:left">p::first-line</td><td style="text-align:left">选择每个 <code>&lt;p&gt;</code> 元素的首行。</td></tr><tr><td style="text-align:left">:first-of-type</td><td style="text-align:left">p:first-of-type</td><td style="text-align:left">选择属于其父元素的首个 <code>&lt;p&gt;</code> 元素的每个 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:focus</td><td style="text-align:left">input:focus</td><td style="text-align:left">选择获得焦点的 input 元素。</td></tr><tr><td style="text-align:left">:fullscreen</td><td style="text-align:left">:fullscreen</td><td style="text-align:left">选择处于全屏模式的元素。</td></tr><tr><td style="text-align:left">:hover</td><td style="text-align:left">a:hover</td><td style="text-align:left">选择鼠标指针位于其上的链接。</td></tr><tr><td style="text-align:left">:in-range</td><td style="text-align:left">input:in-range</td><td style="text-align:left">选择其值在指定范围内的 input 元素。</td></tr><tr><td style="text-align:left">:indeterminate</td><td style="text-align:left">input:indeterminate</td><td style="text-align:left">选择处于不确定状态的 input 元素。</td></tr><tr><td style="text-align:left">:invalid</td><td style="text-align:left">input:invalid</td><td style="text-align:left">选择具有无效值的所有 input 元素。</td></tr><tr><td style="text-align:left">:lang(language)</td><td style="text-align:left">p:lang(it)</td><td style="text-align:left">选择 lang 属性等于 “it”（意大利）的每个 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:last-child</td><td style="text-align:left">p:last-child</td><td style="text-align:left">选择属于其父元素最后一个子元素每个 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:last-of-type</td><td style="text-align:left">p:last-of-type</td><td style="text-align:left">选择属于其父元素的最后 <code>&lt;p&gt;</code> 元素的每个 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:link</td><td style="text-align:left">a:link</td><td style="text-align:left">选择所有未访问过的链接。</td></tr><tr><td style="text-align:left">:not(selector)</td><td style="text-align:left">:not(p)</td><td style="text-align:left">选择非 <code>&lt;p&gt;</code> 元素的每个元素。</td></tr><tr><td style="text-align:left">:nth-child(n)</td><td style="text-align:left">p:nth-child(2)</td><td style="text-align:left">选择属于其父元素的第二个子元素的每个 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:nth-last-child(n)</td><td style="text-align:left">p:nth-last-child(2)</td><td style="text-align:left">同上，从最后一个子元素开始计数。</td></tr><tr><td style="text-align:left">:nth-of-type(n)</td><td style="text-align:left">p:nth-of-type(2)</td><td style="text-align:left">选择属于其父元素第二个 <code>&lt;p&gt;</code> 元素的每个 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:nth-last-of-type(n)</td><td style="text-align:left">p:nth-last-of-type(2)</td><td style="text-align:left">同上，但是从最后一个子元素开始计数。</td></tr><tr><td style="text-align:left">:only-of-type</td><td style="text-align:left">p:only-of-type</td><td style="text-align:left">选择属于其父元素唯一的 <code>&lt;p&gt;</code> 元素的每个 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:only-child</td><td style="text-align:left">p:only-child</td><td style="text-align:left">选择属于其父元素的唯一子元素的每个 <code>&lt;p&gt;</code> 元素。</td></tr><tr><td style="text-align:left">:optional</td><td style="text-align:left">input:optional</td><td style="text-align:left">选择不带 “required” 属性的 input 元素。</td></tr><tr><td style="text-align:left">:out-of-range</td><td style="text-align:left">input:out-of-range</td><td style="text-align:left">选择值超出指定范围的 input 元素。</td></tr><tr><td style="text-align:left">::placeholder</td><td style="text-align:left">input::placeholder</td><td style="text-align:left">选择已规定 “placeholder” 属性的 input 元素。</td></tr><tr><td style="text-align:left">:read-only</td><td style="text-align:left">input:read-only</td><td style="text-align:left">选择已规定 “readonly” 属性的 input 元素。</td></tr><tr><td style="text-align:left">:read-write</td><td style="text-align:left">input:read-write</td><td style="text-align:left">选择未规定 “readonly” 属性的 input 元素。</td></tr><tr><td style="text-align:left">:required</td><td style="text-align:left">input:required</td><td style="text-align:left">选择已规定 “required” 属性的 input 元素。</td></tr><tr><td style="text-align:left">:root</td><td style="text-align:left">:root</td><td style="text-align:left">选择文档的根元素。</td></tr><tr><td style="text-align:left">::selection</td><td style="text-align:left">::selection</td><td style="text-align:left">选择用户已选取的元素部分。</td></tr><tr><td style="text-align:left">:target</td><td style="text-align:left">#news:target</td><td style="text-align:left">选择当前活动的 #news 元素。</td></tr><tr><td style="text-align:left">:valid</td><td style="text-align:left">input:valid</td><td style="text-align:left">选择带有有效值的所有 input 元素。</td></tr><tr><td style="text-align:left">:visited</td><td style="text-align:left">a:visited</td><td style="text-align:left">选择所有已访问的链接。</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;选择器&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;例子&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;例子描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/</summary>
      
    
    
    
    <category term="web" scheme="https://lxx1997.github.io/categories/web/"/>
    
    
    <category term="css" scheme="https://lxx1997.github.io/tags/css/"/>
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>hexo 常用命令语句</title>
    <link href="https://lxx1997.github.io/2022/12/02/extend/hexo-common-commands/"/>
    <id>https://lxx1997.github.io/2022/12/02/extend/hexo-common-commands/</id>
    <published>2022-12-02T02:46:41.000Z</published>
    <updated>2022-12-02T02:46:41.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="创建一个博客到指定文件夹"><a href="#创建一个博客到指定文件夹" class="headerlink" title="创建一个博客到指定文件夹"></a>创建一个博客到指定文件夹</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page --<span class="built_in">path</span> [folder-<span class="built_in">path</span>]/[blog-name]</span><br></pre></td></tr></table></figure><h4 id="create-leetcode-练习（专用）"><a href="#create-leetcode-练习（专用）" class="headerlink" title="create leetcode 练习（专用）"></a>create leetcode 练习（专用）</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx hexo new page --<span class="built_in">path</span> handredday/leetcode/day-<span class="number">101</span>-<span class="number">2283</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;创建一个博客到指定文件夹&quot;&gt;&lt;a href=&quot;#创建一个博客到指定文件夹&quot; class=&quot;headerlink&quot; title=&quot;创建一个博客到指定文件夹&quot;&gt;&lt;/a&gt;创建一个博客到指定文件夹&lt;/h4&gt;&lt;figure class=&quot;highlight cmd&quot;&gt;&lt;ta</summary>
      
    
    
    
    <category term="extends" scheme="https://lxx1997.github.io/categories/extends/"/>
    
    
    <category term="hexo" scheme="https://lxx1997.github.io/tags/hexo/"/>
    
    <category term="extends" scheme="https://lxx1997.github.io/tags/extends/"/>
    
  </entry>
  
  <entry>
    <title>web - H5 移动端适配问题</title>
    <link href="https://lxx1997.github.io/2022/11/23/web/mobile-web-adaptation-problems/"/>
    <id>https://lxx1997.github.io/2022/11/23/web/mobile-web-adaptation-problems/</id>
    <published>2022-11-23T08:09:03.000Z</published>
    <updated>2022-11-23T08:09:03.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="IOS-移动端适配"><a href="#IOS-移动端适配" class="headerlink" title="IOS 移动端适配"></a>IOS 移动端适配</h2><h4 id="唤起键盘输入时，页面底部的输入框无法浮动到键盘上方"><a href="#唤起键盘输入时，页面底部的输入框无法浮动到键盘上方" class="headerlink" title="唤起键盘输入时，页面底部的输入框无法浮动到键盘上方"></a>唤起键盘输入时，页面底部的输入框无法浮动到键盘上方</h4><p><a href="https://juejin.cn/post/7105950857014804516">参考文章</a></p><p>这个出现的原因主要是 IOS 和 Andriod 的 适配不同</p><p>Andriod 的情况比较好理解。软键盘弹出后，实际webview被挤压了，变短了，相当于浏览器变小了，变成 原本高度 - 软键盘高</p><p>IOS 发布了 8.2 版本之后，与androids的不同，软键盘弹出，并不是挤压webview，webview的高度不会发生变化，而软键盘更像是一个悬浮在weview上的东西，并不会影响webview的实际高度，是“盖”上去的。这样就造成了我们目前所看到的情况，输入框被键盘遮挡，无法看到用户输入的内容</p><p>所以可以看到，我们在IOS上聚焦某个输入框，是会自动让页面发生滚动，以展示聚焦的输入框，此时页面的滚动，实际上是webview自身发生了移动。</p><p>这里可以采用的方法有两种</p><p>第一种是用户聚焦于输入框的时候，设置window 或者页面区域主动向上方滚动一定距离（例如软键盘高度），当用户失去焦点时，在滚动回原来的位置</p><p>第二种是改变 输入框所在元素的高度，使得输入框能够正常显示出来，当用户失去焦点时，在还原回原来的高度</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleBlur</span> = (<span class="params">e: any</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 获取浏览器类型</span></span><br><span class="line">  <span class="keyword">let</span> &#123; ios &#125; = utils.<span class="title function_">myBrowserOS</span>()</span><br><span class="line">  <span class="keyword">if</span>(ios) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      element.<span class="property">style</span>.<span class="property">height</span> = <span class="string">&quot;100%&quot;</span></span><br><span class="line">    &#125;, <span class="number">100</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleFocus</span> = (<span class="params">e: any</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; ios &#125; = utils.<span class="title function_">myBrowserOS</span>()</span><br><span class="line">  <span class="keyword">if</span>(ios) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="comment">//设置一个计时器，时间设置与软键盘弹出所需时间相近</span></span><br><span class="line">     element.<span class="property">style</span>.<span class="property">height</span> = (<span class="variable language_">window</span>.<span class="property">innerHeight</span> - <span class="number">330</span>) + <span class="string">&quot;px&quot;</span></span><br><span class="line">    &#125;, <span class="number">100</span>)</span><br><span class="line">  &#125;</span><br><span class="line">i</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="IOS-Safari-浏览器-canvas-写入图片过大，会造成页面重复刷新"><a href="#IOS-Safari-浏览器-canvas-写入图片过大，会造成页面重复刷新" class="headerlink" title="IOS Safari 浏览器 canvas 写入图片过大，会造成页面重复刷新"></a>IOS Safari 浏览器 canvas 写入图片过大，会造成页面重复刷新</h4><p>  <a href="https://discussions.apple.com/thread/4975106">参考文章</a></p><p>  您的網頁在桌面上表現良好並不能保證它在 iOS 上也能表現良好。請記住，iOS 使用 EDGE（低帶寬、高延遲）、3G（高帶寬、高延遲）和 Wi-Fi（高帶寬、低延遲）連接到互聯網。因此，您需要最小化網頁的大小。在您的網頁中包含未使用或不必要的圖像、CSS 和 JavaScript 會對您的網站在 iOS 上的性能產生不利影響。</p><p>  由於 iOS 上的可用內存，它可以處理的資源數量有限制：</p><p>  解碼後的 GIF、PNG 和 TIFF 圖像的最大尺寸對於內存小於 256 MB 的設備是 3 兆像素，對於內存大於或等於 256 MB 的設備是 5 兆像素。也就是說，確保  <code>width * height ≤ 3 * 1024 * 1024</code></p><p>  適用於 RAM 小於 256 MB 的設備。請注意，解碼後的尺寸遠大於圖像的編碼尺寸。</p><p>  使用子採樣時，JPEG 的最大解碼圖像大小為 32 兆像素。由於二次採樣，JPEG 圖像可以高達 32 兆像素，這允許 JPEG 圖像解碼為像素數的十六分之一的大小。大於 2 兆像素的 JPEG 圖像被二次採樣，即解碼為縮小的尺寸。JPEG 子採樣允許用戶查看來自最新數碼相機的圖像。</p><p>  對於內存小於 256 MB 的設備，畫布元素的最大尺寸為 3 兆像素，對於內存大於或等於 256 MB 的設備，畫布元素的最大尺寸為 5 兆像素。如果未指定，畫布對象的高度和寬度為 150 x 300 像素。</p><p>  每個頂級入口點的 JavaScript 執行時間限制為 10 秒。如果您的腳本執行時間超過 10 秒，iOS 上的 Safari 會在您代碼中的隨機位置停止執行腳本，因此可能會導致意外後果。施加此限制是因為 JavaScript 執行可能會導致主線程阻塞，因此當腳本運行時，用戶無法與網頁進行交互。閱讀“在 iOS 上調試 Web 內容”了解如何在 iOS 上調試 JavaScript。</p><p>  一次可以打開的最大文檔數在iPhone 上是八個，在iPad 上是九個。</p><h2 id="Andriod-移动端适配"><a href="#Andriod-移动端适配" class="headerlink" title="Andriod 移动端适配"></a>Andriod 移动端适配</h2><h2 id="共用的适配方式"><a href="#共用的适配方式" class="headerlink" title="共用的适配方式"></a>共用的适配方式</h2><h4 id="在滚动的元素内部-有-pisition-fixed-元素，点击到改元素，无法进行滑动"><a href="#在滚动的元素内部-有-pisition-fixed-元素，点击到改元素，无法进行滑动" class="headerlink" title="在滚动的元素内部 有 pisition: fixed; 元素，点击到改元素，无法进行滑动"></a>在滚动的元素内部 有 pisition: fixed; 元素，点击到改元素，无法进行滑动</h4><p>在 IOS 可以采用在 <code>pisition: fixed;</code> 元素外包一层 <code>pisition: sticky;</code> div，可以实现</p><p>其他的话要触发浏览器默认的滚动（window，document.body）而非 元素的 overflow 属性才可以滑动</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;IOS-移动端适配&quot;&gt;&lt;a href=&quot;#IOS-移动端适配&quot; class=&quot;headerlink&quot; title=&quot;IOS 移动端适配&quot;&gt;&lt;/a&gt;IOS 移动端适配&lt;/h2&gt;&lt;h4 id=&quot;唤起键盘输入时，页面底部的输入框无法浮动到键盘上方&quot;&gt;&lt;a href=&quot;#</summary>
      
    
    
    
    <category term="web" scheme="https://lxx1997.github.io/categories/web/"/>
    
    <category term="IOS" scheme="https://lxx1997.github.io/categories/IOS/"/>
    
    <category term="mobile" scheme="https://lxx1997.github.io/categories/mobile/"/>
    
    <category term="MobileAdaptation" scheme="https://lxx1997.github.io/categories/MobileAdaptation/"/>
    
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
    <category term="IOS" scheme="https://lxx1997.github.io/tags/IOS/"/>
    
    <category term="mobile" scheme="https://lxx1997.github.io/tags/mobile/"/>
    
    <category term="MobileAdaptation" scheme="https://lxx1997.github.io/tags/MobileAdaptation/"/>
    
  </entry>
  
  <entry>
    <title>一些不常用的事件监听方法</title>
    <link href="https://lxx1997.github.io/2022/10/27/web/document-eventListener-uncommon-use/"/>
    <id>https://lxx1997.github.io/2022/10/27/web/document-eventListener-uncommon-use/</id>
    <published>2022-10-27T03:22:40.000Z</published>
    <updated>2022-10-27T03:22:40.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="document"><a href="#document" class="headerlink" title="document"></a>document</h2><h4 id="selectionchange"><a href="#selectionchange" class="headerlink" title="selectionchange"></a>selectionchange</h4><p>可以获取到点击的文字所在元素对象及点击或者选中文字起始位置和结束位置</p><p><em>应该是只针对 文字，我点击图片没有触发时间，点击文字时间正常触发</em><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// addEventListener version</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;selectionchange&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">getSelection</span>());</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * anchorNode: text</span></span><br><span class="line"><span class="comment">   * anchorOffset: 4</span></span><br><span class="line"><span class="comment">   * baseNode: text</span></span><br><span class="line"><span class="comment">   * baseOffset: 4  选中起始位置</span></span><br><span class="line"><span class="comment">   * extentNode: text 选中起始元素</span></span><br><span class="line"><span class="comment">   * extentOffset: 4  选中结束位置</span></span><br><span class="line"><span class="comment">   * focusNode: text 选中结束元素</span></span><br><span class="line"><span class="comment">   * focusOffset: 4</span></span><br><span class="line"><span class="comment">   * isCollapsed: true</span></span><br><span class="line"><span class="comment">   * rangeCount: 1</span></span><br><span class="line"><span class="comment">   * type: &quot;Caret&quot;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// onselectionchange version</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">onselectionchange</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">getSelection</span>());</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>通过下方代码操作可以改变选中位置<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> selection = <span class="variable language_">document</span>.<span class="title function_">getSelection</span>()!</span><br><span class="line"><span class="keyword">const</span> range = <span class="variable language_">document</span>.<span class="title function_">createRange</span>();</span><br><span class="line">selection.<span class="title function_">removeAllRanges</span>();</span><br><span class="line">range.<span class="title function_">selectNodeContents</span>(node);</span><br><span class="line">range.<span class="title function_">setStart</span>(textNode,start)</span><br><span class="line">range.<span class="title function_">setEnd</span>(textNode,start)</span><br><span class="line">range.<span class="title function_">collapse</span>(<span class="literal">false</span>);</span><br><span class="line">selection.<span class="title function_">addRange</span>(range);</span><br></pre></td></tr></table></figure></p><h4 id="compositionStart"><a href="#compositionStart" class="headerlink" title="compositionStart"></a>compositionStart</h4><p>可以监控到用户使用中文输入法输入</p><h4 id="CompositionEnd"><a href="#CompositionEnd" class="headerlink" title="CompositionEnd"></a>CompositionEnd</h4><p>可以监控到用户结束中文输入法输入</p><h4 id="input"><a href="#input" class="headerlink" title="input"></a>input</h4><p>元素添加了 <code>contenteditable</code> 属性后，可以监控到用户输入<br><code>nativeEvent</code> 上的 inputType 可以判断用户当前输入状态</p><ul><li>deleteContentBackward 删除鼠标选中的字符或后方字符</li><li>deleteContentForward 删除鼠标选中的字符或前方字符</li><li>insertText 添加文字</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;document&quot;&gt;&lt;a href=&quot;#document&quot; class=&quot;headerlink&quot; title=&quot;document&quot;&gt;&lt;/a&gt;document&lt;/h2&gt;&lt;h4 id=&quot;selectionchange&quot;&gt;&lt;a href=&quot;#selectionchang</summary>
      
    
    
    
    <category term="web document" scheme="https://lxx1997.github.io/categories/web-document/"/>
    
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
    <category term="document" scheme="https://lxx1997.github.io/tags/document/"/>
    
    <category term="eventListener" scheme="https://lxx1997.github.io/tags/eventListener/"/>
    
  </entry>
  
  <entry>
    <title>vue3 状态管理工具 - pinia</title>
    <link href="https://lxx1997.github.io/2022/08/11/vue/vue-pinia-state-manager/"/>
    <id>https://lxx1997.github.io/2022/08/11/vue/vue-pinia-state-manager/</id>
    <published>2022-08-11T07:19:53.000Z</published>
    <updated>2022-08-11T07:19:53.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>Vue3</code> 出来都有一年多了，生态系统相对来说都慢慢变得完善起来了，像针对 <code>vue2</code> 的 <code>vue-router</code> 路由组件，<code>vuex</code> 状态管理工具都开始适应 <code>vue3</code> 了</p><p>这里就介绍 针对 <code>vue3</code> 的状态管理工具 <code>vuex5</code> 又叫 <code>pinia</code></p><h2 id="与-vuex4-和-vuex3-对比"><a href="#与-vuex4-和-vuex3-对比" class="headerlink" title="与 vuex4 和 vuex3 对比"></a>与 vuex4 和 vuex3 对比</h2><ul><li>mutations 不再存在。他们经常被认为是 非常 冗长。他们最初带来了 devtools 集成，但这不再是问题。</li><li>无需创建自定义复杂包装器来支持 TypeScript，所有内容都是类型化的，并且 API 的设计方式尽可能利用 TS 类型推断。</li><li>不再需要注入、导入函数、调用函数、享受自动完成功能！</li><li>无需动态添加 Store，默认情况下它们都是动态的，您甚至都不会注意到。请注意，您仍然可以随时手动使用 Store 进行注册，但因为它是自动的，您无需担心。</li><li>不再有 modules 的嵌套结构。您仍然可以通过在另一个 Store 中导入和 使用 来隐式嵌套 Store，但 Pinia 通过设计提供平面结构，同时仍然支持 Store 之间的交叉组合方式。 您甚至可以拥有 Store 的循环依赖关系。</li><li>没有 命名空间模块。鉴于 Store 的扁平架构，“命名空间” Store 是其定义方式所固有的，您可以说所有 Store 都是命名空间的。</li></ul><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h4 id="安装-pinia"><a href="#安装-pinia" class="headerlink" title="安装 pinia"></a>安装 <code>pinia</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br><span class="line"></span><br><span class="line">yarn add pinia</span><br></pre></td></tr></table></figure><h4 id="在-Vue-中注册"><a href="#在-Vue-中注册" class="headerlink" title="在 Vue 中注册"></a>在 Vue 中注册</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(<span class="title function_">createPinia</span>()).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="创建一个store"><a href="#创建一个store" class="headerlink" title="创建一个store"></a>创建一个store</h4><p><code>pinia</code> 提供了一个方法 <code>defineStore</code> 来定义一个 Store</p><p><code>defineStore</code> 需要我们传入两个参数，第一个参数是 <code>name</code>, 这个值是唯一的，第二个参数是 Store 的值，包含 <code>state</code>, <code>getters</code>, <code>actions</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useCountStore = <span class="title function_">defineStore</span>(<span class="string">&quot;name&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// state 值</span></span><br><span class="line">            <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="title function_">getCount</span>(<span class="params">state</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> state.<span class="property">count</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">actions</span>: &#123;</span><br><span class="line">        <span class="title function_">addCount</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="组件内使用"><a href="#组件内使用" class="headerlink" title="组件内使用"></a>组件内使用</h4><ul><li><code>setup components</code><br>在 setup component 内可以直接使用</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> countStore = <span class="title function_">useCountStore</span>()</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(countStore.<span class="property">count</span>) <span class="comment">// 1</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(countStore.<span class="property">getCount</span>) <span class="comment">// 1</span></span></span><br><span class="line"><span class="language-javascript">    countStore.<span class="title function_">addCount</span>()</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>需要注意的是，<strong>不能对 <code>store</code> 进行解构赋值，因为这会破坏 <code>store</code> 的响应式</strong></p><p>如果想要对 store 进行解构赋值，可以采用 <code>storeToRefs</code>,它将为任何响应式属性创建 refs。 当您仅使用 store 中的状态但不调用任何操作时，这很有用<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> countStore = <span class="title function_">useCountStore</span>()</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> &#123; count, getCount &#125; = <span class="title function_">storeToRefs</span>(countStore)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><h4 id="state"><a href="#state" class="headerlink" title="state"></a>state</h4><p>state 用来定义应用程序状态开始，在 <code>pinia</code> 中状态是一个返回初始状态函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useCountStore = <span class="title function_">defineStore</span>(<span class="string">&quot;name&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// state 值</span></span><br><span class="line">            <span class="attr">count</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>如果想要重置 <code>Store</code> 的状态，可以调用 <code>$reset</code> 方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useCountStore.$reset()</span><br></pre></td></tr></table></figure><p><strong>不在 <code>setup()</code> 中使用</strong></p><p>可以使用 <code>mapState</code> 将状态映射为只读属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        ...<span class="title function_">mapState</span>(useCountStore, options)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>options</code> 有两种类型</p><ul><li><p>数组类型 如果是数组类型的话，其内的元素是需要映射的属性名，例如我们想要映射 state 的 count 的值 <code>...mapState(useCountStore, [&quot;count&quot;])</code>,组件内可以直接使用 <code>this.count</code> 访问</p></li><li><p>对象类型 对象类型的话，key 是组件内访问时的属性名，key 所对应的值是 Store state 里面的值</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">        ...<span class="title function_">mapState</span>(useCountStore, &#123;</span><br><span class="line">            <span class="attr">aliasCount</span>: <span class="string">&quot;count&quot;</span>, <span class="comment">// 组件内访问时 this.aliasCount,相当于访问 store 的 count 属性</span></span><br><span class="line">            <span class="attr">doubleCount</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span> <span class="comment">// 类似于 Store 的 getters 属性</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果想要直接修改这些状态属性，类似 <code>this.count++</code>,可以使用 <code>mapWritableState</code> API</p><h4 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h4><p><code>getters</code> 的使用 类似于 <code>state</code>，但是创建方式略有不同</p><p>getters 是一个有具体返回值的函数，这个函数可以是有 state的值或者其他 getters 中的值计算出来的结果</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useCountStore = <span class="title function_">defineStore</span>(<span class="string">&quot;name&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">getters</span>: &#123;</span><br><span class="line">        <span class="attr">doubleCount</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> state.<span class="property">count</span> * <span class="number">2</span>,</span><br><span class="line">        <span class="title function_">othercount</span>(<span class="params">state</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">doubleCount</span> * state.<span class="property">count</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>在 setup 函数中使用时，可以直接通过 store 访问</p><p>非 setup 函数可以通过 mapState 方法注册到 computed 属性中</p><h4 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h4><p>actions 中的方法适合用来定义业务逻辑，而且是可以进行异步操作</p><p>在非 setup 函数中使用的时候可以通过 mapActions 映射出来</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        ...<span class="title function_">mapActions</span>(useCountStore, &#123;</span><br><span class="line">            <span class="attr">changeCount</span>: <span class="string">&quot;count&quot;</span>, </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二个参数传递的类型可以参考 mapState</p><p>在 setup 函数中，可以直接在 setup 中使用，也可以在组件中通过 store 对象调用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; todoItem &#125; = <span class="title function_">toRefs</span>(props)</span><br><span class="line">        <span class="keyword">const</span> todoList = <span class="title function_">useTodoListStore</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">handleEdit</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">            todoList.<span class="title function_">updatedTodoList</span>(todoItem.<span class="property">value</span>.<span class="property">id</span>, &#123;</span><br><span class="line">                <span class="attr">isEditing</span>: <span class="literal">true</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">handleDelete</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">            todoList.<span class="title function_">removeTodoList</span>(todoItem.<span class="property">value</span>.<span class="property">id</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">handleConfirm</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">            todoList.<span class="title function_">updatedTodoList</span>(todoItem.<span class="property">value</span>.<span class="property">id</span>, &#123;</span><br><span class="line">                <span class="attr">content</span>: value.<span class="property">value</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            value,</span><br><span class="line">            handleEdit,</span><br><span class="line">            handleDelete,</span><br><span class="line">            handleConfirm</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>另外，针对 actions vuex 提供了一个 <code>$onAction</code> 方法来订阅action 及结果</p><p>当我们订阅一个 store 后，每触发一次 store 内部的 action 执行，都会触发一次回调函数，传递给它的回调在 action 之前执行。 after 处理 Promise 并允许您在 action 完成后执行函数。 以类似的方式，onError 允许您在处理中抛出错误。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> unsubscribe = todoListStore.$onAction(</span><br><span class="line">    <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        name, // action 的名字</span></span></span><br><span class="line"><span class="params"><span class="function">        store, // store 实例</span></span></span><br><span class="line"><span class="params"><span class="function">        args, // 调用这个 action 的参数</span></span></span><br><span class="line"><span class="params"><span class="function">        after, // 在这个 action 执行完毕之后，执行这个函数</span></span></span><br><span class="line"><span class="params"><span class="function">        onError, // 在这个 action 抛出异常的时候，执行这个函数</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 记录开始的时间变量</span></span><br><span class="line">        <span class="keyword">const</span> startTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">        <span class="comment">// 这将在 `store` 上的操作执行之前触发</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Start &quot;<span class="subst">$&#123;name&#125;</span>&quot; with params [<span class="subst">$&#123;args.join(<span class="string">&#x27;, &#x27;</span>)&#125;</span>].`</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果 action 成功并且完全运行后，after 将触发。</span></span><br><span class="line">        <span class="comment">// 它将等待任何返回的 promise</span></span><br><span class="line">        <span class="title function_">after</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">            <span class="string">`Finished &quot;<span class="subst">$&#123;name&#125;</span>&quot; after <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="built_in">Date</span>.now() - startTime</span></span></span><br><span class="line"><span class="subst"><span class="string">            &#125;</span>ms.\nResult: <span class="subst">$&#123;result&#125;</span>.`</span></span><br><span class="line">        )</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果 action 抛出或返回 Promise.reject ，onError 将触发</span></span><br><span class="line">        <span class="title function_">onError</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(</span><br><span class="line">            <span class="string">`Failed &quot;<span class="subst">$&#123;name&#125;</span>&quot; after <span class="subst">$&#123;<span class="built_in">Date</span>.now() - startTime&#125;</span>ms.\nError: <span class="subst">$&#123;error&#125;</span>.`</span></span><br><span class="line">        )</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="title function_">unsubscribe</span>()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;code&gt;Vue3&lt;/code&gt; 出来都有一年多了，生态系统相对来说都慢慢变得完善起来了，像针对 &lt;code&gt;vue2&lt;/code&gt; 的 &lt;code&gt;vue-router&lt;/code&gt; 路由组件，&lt;code&gt;vuex&lt;/code&gt; 状态管理工具都开始适应 &lt;code&gt;vu</summary>
      
    
    
    
    <category term="Vue3" scheme="https://lxx1997.github.io/categories/Vue3/"/>
    
    
    <category term="Vue3" scheme="https://lxx1997.github.io/tags/Vue3/"/>
    
  </entry>
  
  <entry>
    <title>React Hooks - 自定义hooks</title>
    <link href="https://lxx1997.github.io/2022/08/09/react/react-custom-hooks/"/>
    <id>https://lxx1997.github.io/2022/08/09/react/react-custom-hooks/</id>
    <published>2022-08-09T01:55:31.000Z</published>
    <updated>2022-08-09T01:55:31.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Hook 是 React 16.8 的新增特性。它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性</strong></p><p>Hook 是一些可以让你在函数组件里“钩入” React state 及生命周期等特性的函数。Hook 不能在 class 组件中使用 —— 这使得你不使用 class 也能使用 React</p><h2 id="react-hooks"><a href="#react-hooks" class="headerlink" title="react hooks"></a>react hooks</h2><h4 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h4><p>useEffect 就是一个 Effect Hook，给函数组件增加了操作副作用的能力</p><p>它跟 class 组件中的 componentDidMount、componentDidUpdate 和 componentWillUnmount 具有相同的用途</p><p>在使用时我们传递一个数组，useEffect 会在数组内的数据发生变化时重新执行</p><p>useEffect 函数需返回一个清除函数，清除函数会在组件卸载前执行。另外，如果组件多次渲染（通常如此），则在执行下一个 effect 之前，上一个 effect 就已被清除</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 在此执行当前useEffect 的副作用清除，例如监听函数，定时器等操作</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, [obj1, obj2]) <span class="comment">// 仅在 obj1， obj2 改变的时候触发</span></span><br></pre></td></tr></table></figure><p>如果想执行只运行一次的 effect（仅在组件挂载和卸载时执行），可以传递一个空数组（[]）作为第二个参数。</p><h4 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h4><p>useState 会返回一对值：当前状态和一个让你更新它的函数，你可以在事件处理函数中或其他一些地方调用这个函数。</p><p>更新函数操作是完全替换，而非合并操作</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>) <span class="comment">// 初始化 count</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">setCount</span>(<span class="number">1</span>) <span class="comment">// 改变 count 值</span></span><br><span class="line"><span class="title function_">setCount</span>(<span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">1</span>) <span class="comment">// 改变 count 值 会基于原count 值的基础上 +1</span></span><br></pre></td></tr></table></figure><h4 id="useContext-上下文对象"><a href="#useContext-上下文对象" class="headerlink" title="useContext 上下文对象"></a>useContext 上下文对象</h4><p>用来接收由React.createContext() 创建的 context对象，并返回context对象的当前值，父组件需要有 <code>&lt;MyContext.Provider&gt;</code> 包裹着，值由 value 确定</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> themes = &#123;</span><br><span class="line">  <span class="attr">light</span>: &#123;</span><br><span class="line">    <span class="attr">foreground</span>: <span class="string">&quot;#000000&quot;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&quot;#eeeeee&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">dark</span>: &#123;</span><br><span class="line">    <span class="attr">foreground</span>: <span class="string">&quot;#ffffff&quot;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&quot;#222222&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ThemeContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(themes.<span class="property">light</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;themes.dark&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Toolbar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Toolbar</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ThemedButton</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ThemedButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> theme = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">background:</span> <span class="attr">theme.background</span>, <span class="attr">color:</span> <span class="attr">theme.foreground</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      I am styled by theme context!</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer"></a>useReducer</h4><p>useReducer 是 useState 的替代方案，它接收一个形如 (state, action) =&gt; newState 的 reducer，并返回当前的 state 以及与其配套的 dispatch 方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123;<span class="attr">count</span>: <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;increment&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;decrement&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      Count: &#123;state.count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123;type: &#x27;decrement&#x27;&#125;)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123;type: &#x27;increment&#x27;&#125;)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上述例子中，当修改 state 里面的值的时候，会通过dispatch 传递一个比较复杂的值作为 reducer 方法中的 action，在reducer 内部通过 action 的值来进行代码运算，返回出新的值</p><h4 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h4><p>React useCallbackHook 返回一個記憶化的回調函數。這使我們能夠隔離資源密集型功能，以便它們不會在每次渲染時自動運行。</p><p>使用useCallback鉤子來防止函數被重新創建，除非有必要。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> addTodo = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setTodos</span>(<span class="function">(<span class="params">t</span>) =&gt;</span> [...t, <span class="string">&quot;New Todo&quot;</span>]);</span><br><span class="line">&#125;, [todos]);</span><br></pre></td></tr></table></figure><p>当组件内容发生变化重新渲染的时候，如果 <code>todos</code> 没有发生变化的话，addTodo 函数不会重新创建</p><h4 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h4><p>React useCallbackHook 返回一個記憶化的值，它仅会在某个依赖项改变时才重新计算 memoized 值。这种优化有助于避免在每次渲染时都进行高开销的计算</p><p>传入 useMemo 的函数会在渲染期间执行。请不要在这个函数内部执行不应该在渲染期间内执行的操作</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Todo</span> = (<span class="params">&#123; todos &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;</span></span><br><span class="line"><span class="language-xml">    todos.map(item =&gt; <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;item.name&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>)</span></span><br><span class="line"><span class="language-xml">  &#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">useMemo</span>(<span class="title class_">Todo</span>)</span><br></pre></td></tr></table></figure><p>以上 Todo 组件仅会在 todos 参数发生变化时才会重新计算渲染，如果传入内容有函数，可以和 useCallback 接合，实现值的缓存</p><h4 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h4><p>useRef 返回一个可变的 ref 对象，其 .current 属性被初始化为传入的参数（initialValue）。返回的 ref 对象在组件的整个生命周期内持续存在。</p><p>useRef 既可以用来存储 dom 对象，也可以用来存储单个的值</p><p>当 ref 对象内容发生变化时，useRef 并不会通知你。变更 .current 属性不会引发组件重新渲染。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ref = <span class="title function_">useRef</span>(<span class="number">1</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ref.<span class="property">current</span>)</span><br><span class="line">ref.<span class="property">current</span> = <span class="number">2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ref.<span class="property">current</span>)</span><br></pre></td></tr></table></figure><h4 id="useImperativeHandle-和-forwardRef"><a href="#useImperativeHandle-和-forwardRef" class="headerlink" title="useImperativeHandle 和 forwardRef"></a>useImperativeHandle 和 forwardRef</h4><p>useImperativeHandle 可以让你在使用 ref 时自定义暴露给父组件的实例值。</p><p>父组件使用 forwardRef 来接收子组件暴露出的实例值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">FancyInput</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>();</span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">focus</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      inputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;));</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> <span class="attr">...</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">FancyInput</span> = <span class="title function_">forwardRef</span>(<span class="title class_">FancyInput</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">focus</span>(<span class="params"></span>) &#123;</span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">FancyInput</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="useLayoutEffect"><a href="#useLayoutEffect" class="headerlink" title="useLayoutEffect"></a>useLayoutEffect</h4><p>其函数签名与 useEffect 相同，但它会在所有的 DOM 变更之后同步调用 effect。可以使用它来读取 DOM 布局并同步触发重渲染。在浏览器执行绘制之前，useLayoutEffect 内部的更新计划将被同步刷新。</p><h4 id="useDebugValue"><a href="#useDebugValue" class="headerlink" title="useDebugValue"></a>useDebugValue</h4><p>useDebugValue 可用于在 React 开发者工具中显示自定义 hook 的标签。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useFriendStatus</span>(<span class="params">friendID</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [isOnline, setIsOnline] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在开发者工具中的这个 Hook 旁边显示标签</span></span><br><span class="line">  <span class="comment">// e.g. &quot;FriendStatus: Online&quot;</span></span><br><span class="line">  <span class="title function_">useDebugValue</span>(isOnline ? <span class="string">&#x27;Online&#x27;</span> : <span class="string">&#x27;Offline&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> isOnline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="useDeferredValue"><a href="#useDeferredValue" class="headerlink" title="useDeferredValue"></a>useDeferredValue</h4><p>useDeferredValue 接受一个值，并返回该值的新副本，该副本将推迟到更紧急地更新之后。如果当前渲染是一个紧急更新的结果，比如用户输入，React 将返回之前的值，然后在紧急渲染完成后渲染新的值。</p><p>该 hook 与使用防抖和节流去延迟更新的用户空间 hooks 类似。使用 useDeferredValue 的好处是，React 将在其他工作完成（而不是等待任意时间）后立即进行更新，并且像 startTransition 一样，延迟值可以暂停，而不会触发现有内容的意外降级。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Typeahead</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> query = <span class="title function_">useSearchQuery</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> deferredQuery = <span class="title function_">useDeferredValue</span>(query);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Memoizing 告诉 React 仅当 deferredQuery 改变，</span></span><br><span class="line">  <span class="comment">// 而不是 query 改变的时候才重新渲染</span></span><br><span class="line">  <span class="keyword">const</span> suggestions = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">SearchSuggestions</span> <span class="attr">query</span>=<span class="string">&#123;deferredQuery&#125;</span> /&gt;</span></span>,</span><br><span class="line">    [deferredQuery]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">SearchInput</span> <span class="attr">query</span>=<span class="string">&#123;query&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&quot;Loading results...&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;suggestions&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="useTransition"><a href="#useTransition" class="headerlink" title="useTransition"></a>useTransition</h4><p>返回一个状态值表示过渡任务的等待状态，以及一个启动该过渡任务的函数。</p><p>isPending 指示过渡任务何时活跃以显示一个等待状态：<br>startTransition 用来启动过渡任务</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [isPending, startTransition] = <span class="title function_">useTransition</span>();</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">startTransition</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setCount</span>(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isPending &amp;&amp; <span class="tag">&lt;<span class="name">Spinner</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="useId"><a href="#useId" class="headerlink" title="useId"></a>useId</h4><p>useId 是一个用于生成横跨服务端和客户端的稳定的唯一 ID 的同时避免 hydration 不匹配的 hook。</p><h2 id="自定义-Hooks"><a href="#自定义-Hooks" class="headerlink" title="自定义 Hooks"></a>自定义 Hooks</h2><p>在知道上述 hooks 之后，react 也支持我们自定义 hooks 操作。</p><p>自定义 hooks 主要是用来 提取共享逻辑，优化代码结构。</p><!-- 例如获取和修改用户信息 --><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">useUserInfo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [useInfo, setUseInfo] = <span class="title function_">useState</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 这里做处理用户的个人信息</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> useInfo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useInfo = <span class="title function_">useUserInfo</span>()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;Hook 是 React 16.8 的新增特性。它可以让你在不编写 class 的情况下使用 state 以及其他的 React 特性&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Hook 是一些可以让你在函数组件里“钩入” React state 及生命周期等特性的函</summary>
      
    
    
    
    <category term="react" scheme="https://lxx1997.github.io/categories/react/"/>
    
    <category term="hooks" scheme="https://lxx1997.github.io/categories/hooks/"/>
    
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
    <category term="hooks" scheme="https://lxx1997.github.io/tags/hooks/"/>
    
  </entry>
  
  <entry>
    <title>vue3 组合式Api setup</title>
    <link href="https://lxx1997.github.io/2022/08/02/vue/vue3-composition-api-setup/"/>
    <id>https://lxx1997.github.io/2022/08/02/vue/vue3-composition-api-setup/</id>
    <published>2022-08-02T07:03:31.000Z</published>
    <updated>2022-08-08T07:03:31.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="什么是组合式API"><a href="#什么是组合式API" class="headerlink" title="什么是组合式API"></a>什么是组合式API</h2><p><code>组合式API</code> 主要是为了把相同的逻辑关注点收集在一起，使得逻辑处理更加清晰和方便。</p><p>针对 <code>vue2</code> 的组件选项来说，（<code>data</code>, <code>computed</code>, <code>methods</code>, <code>watch</code>）等组件存在，导致我们在修改同一个逻辑关注点的之后需要不停地跳转相关的代码块，代码碎片化，使得我们理解和维护复杂组件变得困难。</p><p>在 <code>vue3</code>组件中，这个位置称为 <code>setup</code></p><p>这个是 <code>Vue3</code> 新增的一个选项 <code>setup</code> 选项会在组件被创建之前执行，一旦 <code>props</code> 解析完成，<code>setup</code> 就会被作为 <code>组合式Api</code> 的入口，也就是说 <code>setup</code> 执行的时机要比 <code>vue2</code> 的 <code>beforeCreate</code> 要早，此外 <code>setup</code> 中应避免使用 <code>this</code> 且因为调用发生在 <code>data</code>，<code>computed</code>，<code>methods</code> 之前，所以无法在 <code>setup</code> 中获取</p><p>既然 setup 中无法获取到 data，computed 中的内容，那么我们怎么创建和监控变量变化，且组件内能获取到呢？</p><p><code>setup</code> 接收 <code>props</code> 和 <code>context</code></p><ul><li>props 是父元素传递过来的 props</li><li>context 是当前组件实例上下文</li></ul><p><code>setup</code> 函数 return 出一个对象，这个对象可以被组件直接获取到，相当于 <code>data</code> 和 <code>methods</code> 的集团体</p><p>怎么保证 setup 返回的变量是响应式的呢？ <code>vue3</code> 提供了一些 hooks，可以让我们创建响应式的变量</p><h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><h4 id="props"><a href="#props" class="headerlink" title="props"></a>props</h4><p>setup 接受两个参数，第一个参数是props，且是响应式的，传入新的props 时，会被一起更新 <strong>因为是响应式的，所以无法直接使用解构赋值，会失去响应式</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 父组件向子组件传递一个 props title 属性，并且这个属性会在 3s 后发生变化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;hhhhhh&quot;</span>)</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      title.<span class="property">value</span> = <span class="string">&quot;this is new title&quot;</span></span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">    <span class="title function_">watch</span>(title, <span class="function">(<span class="params">n, o</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(n, o)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123; title &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子组件这里必须要在props 属性上添加需要接受的属性，否则setup 中的 props 无法接受到</span></span><br><span class="line"><span class="comment"> * 当props 属性发生变化时，使用 watch 监听可以再次被触发，但是页面上内容不会发生变化，这是因为我们直接取的 props 里面的属性值，不具备响应式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">title</span>)</span><br><span class="line">    <span class="title function_">watch</span>(props, <span class="function">(<span class="params">n, o</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">title</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> &#123; title &#125; = props</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">title</span>: props.<span class="property">title</span>,</span><br><span class="line">      <span class="attr">computedTitle</span>: title</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果我们想要对 props 进行解构操作，可以使用 <code>toRefs</code> 函数来完成此操作</p><p>下面代码我们会发现当 props 中的 title 属性发生变化后， 组件内 title 并不会跟随变化，而 computedTitle 则会跟随props 中的 title 属性发生变化</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">title</span>)</span><br><span class="line">    <span class="title function_">watch</span>(props, <span class="function">(<span class="params">n, o</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">title</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> &#123; title &#125; = <span class="title function_">toRefs</span>(props)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">title</span>: props.<span class="property">title</span>,</span><br><span class="line">      <span class="attr">computedTitle</span>: title</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果 title 是可选的 prop，则传入的 props 中可能没有 title 。在这种情况下，toRefs 将不会为 title 创建一个 ref 。你需要使用 toRef 替代它</p><p>toRef 的作用相当于把 对象中的属性转化为 ref 类的属性，且与对象相关联，当对象中对应属性发生变化时, toRef 中的内容会同步发生改变</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> name = <span class="title function_">toRef</span>(props, <span class="string">&quot;name&quot;</span>) <span class="comment">// name 会跟随 props 中的 name 属性变化而同步更新</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: name </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="context"><a href="#context" class="headerlink" title="context"></a>context</h4><p>context 是一个普通 JavaScript 对象，不是响应式的，因此可以使用 解构操作</p><p>暴露了其它可能在 setup 中有用的值：</p><ul><li>attrs 类似于 $attrs</li><li>slots 类似于 $slots</li><li>emit 类似于 $emit</li><li>expose 公共property</li></ul><p>slots 和 attrs 是有状态的对象，跟随组件本身的更新而更新，避免使用解构赋值，如果想要根据 attrs 和 solts 更改应用富足用，应该在 onBeforeUpdate 钩子中执行操作</p><h4 id="return"><a href="#return" class="headerlink" title="return"></a>return</h4><p>setup return 出来的值可以在模板和组件中直接使用</p><p>如果父组件想要访问子组件 setup 中的 property，可以使用 expose 方法暴露出去</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; expose &#125;</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">changeCount</span> = (<span class="params"></span>) =&gt; ++count.<span class="property">value</span></span><br><span class="line">    <span class="title function_">expose</span>(&#123;</span><br><span class="line">      changeCount</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="hooks"><a href="#hooks" class="headerlink" title="hooks"></a>hooks</h2><h4 id="setup-内部的钩子函数"><a href="#setup-内部的钩子函数" class="headerlink" title="setup 内部的钩子函数"></a>setup 内部的钩子函数</h4><ul><li>onBeforeMount // 页面挂载钩子函数</li><li>onMounted</li><li>onBeforeUpdate  // 页面更新钩子函数</li><li>onUpdated</li><li>onBeforeUnmount  // 页面销毁钩子函数</li><li>onUnmounted</li><li>onErrorCaptured  // 页面错误事件钩子函数</li><li>onRenderTracked</li><li>onRenderTriggered // 跟踪虚拟 DOM 重新渲染时调用</li><li>onActivated  //  keep-alive 缓存的组件激活时调用</li><li><p>onDeactivated  // keep-alive 缓存的组件失活时调用</p><p>这些钩子函数的触发时机和在组件内部触发时机一致</p><p>这些钩子函数接受一个回调函数，当钩子函数被调用时，将会被执行</p></li></ul><h4 id="带-ref-的响应式变量"><a href="#带-ref-的响应式变量" class="headerlink" title="带 ref 的响应式变量"></a>带 ref 的响应式变量</h4><p>在 Vue3 中，我们可以通过 ref hooks 创建一个响应式变量，ref 接收参数并将其包裹在一个带有 value property 的对象中返回，然后可以使用该 property 访问或更改响应式变量的值</p><p>之所以把值封装在对象中，主要是因为字符串和数字这些基本类型时通过值传递的，通过对象封装后，可以在整个对象安全的传递，不用担心失去响应式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;setup component&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> changeTitle = <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    title.<span class="property">value</span> = val</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    title.<span class="property">value</span> = <span class="string">&quot;setup component changed&quot;</span></span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    title,</span><br><span class="line">    changeTitle</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上述实例中，我们可以发现，在3s 过后，页面上显示的内容发生变化，而且setup return 出来的属性和方法在组件的其他选项中都可以通过 this 来访问到</p><h4 id="watch-响应式处理"><a href="#watch-响应式处理" class="headerlink" title="watch 响应式处理"></a>watch 响应式处理</h4><p>如果我们想要在 setup 选项中监听属性的变化，可以通过 watch hooks 方法监听属性变化</p><p>watch 接受三个参数，监听对象，回调函数，配置选项</p><p>配置选项同组件中的 watch 选项，同样包含 deep 和 immediate 属性，而且还额外接受一个 flush 选项</p><p>flush 选项有三个值</p><ul><li>pre 默认值，指定回调在渲染前被调用</li><li>post 将回调推迟到渲染之后，这时候可以获取页面 dom 元素</li><li>sync 回调同步调用，不过会比较消耗性能</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(obj, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;&#125;, &#123;deep?: <span class="literal">true</span>, immediate?: <span class="literal">true</span>, flush?: <span class="string">&quot;pre&quot;</span> | <span class="string">&quot;post&quot;</span> | <span class="string">&quot;sync&quot;</span>&#125;)</span><br></pre></td></tr></table></figure><p>下面这个例子，当 setTimeout 方法执行完成后，由于改变了 title 的值， 触发了 watch 函数，我们打开 console 就可以发现打印了title 改变之前的值和 修改之后的值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;setup component&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    title.<span class="property">value</span> = <span class="string">&quot;setup component changed&quot;</span></span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">watch</span>(title, <span class="function">(<span class="params">n, o</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(n, o)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    title</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果我们想要监控多个数据源的变化，可以在watch 的时候 watch 监听对象传入一个数组，同理，当数组内的任意一个元素发生变化时，都会触发watch 函数，而且 watch 回调函数中传入的值也是以数组的形式存在的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> firstName = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> lastName = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>([firstName, lastName], <span class="function">(<span class="params">newValues, prevValues</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(newValues, prevValues)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">firstName.<span class="property">value</span> = <span class="string">&#x27;John&#x27;</span> <span class="comment">// logs: [&quot;John&quot;, &quot;&quot;] [&quot;&quot;, &quot;&quot;]</span></span><br><span class="line">lastName.<span class="property">value</span> = <span class="string">&#x27;Smith&#x27;</span> <span class="comment">// logs: [&quot;John&quot;, &quot;Smith&quot;] [&quot;John&quot;, &quot;&quot;]</span></span><br></pre></td></tr></table></figure><p>如果在监控多个数据源变化时，针对多个数据源修改时是同步修改，并不涉及到 setTimeout 等异步操作时，watch 会把这些更改合并成一次操作，会将所有修改的值一起返回给回调函数</p><p>watch hooks 还可以通过回调函数的第三个参数来清除副作用，这个参数会在 watch hooks 被停止或者销毁时，或者副作用重新执行时触发</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;setup component&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    title.<span class="property">value</span> = <span class="string">&quot;setup component changed&quot;</span></span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">watch</span>(title, <span class="function">(<span class="params">n, o, onInvalidate</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(n, o)</span><br><span class="line">    <span class="title function_">onInvalidate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 处理副作用方法</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    title</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>类似的方式还有一个 <strong><code>watchEffect</code></strong> 方法</p><h4 id="watchEffect"><a href="#watchEffect" class="headerlink" title="watchEffect"></a>watchEffect</h4><p>在使用 watchEffect 的时候，会自动执行传入的函数，并且响应式的追踪依赖，并且在依赖发生变更操作时，重新运行传入的函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;setup component&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      title.<span class="property">value</span> = <span class="string">&quot;setup component changed&quot;</span></span><br><span class="line">    &#125;, <span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">watch</span>(title, <span class="function">(<span class="params">n, o</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(n, o)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(title.<span class="property">value</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      title</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述代码执行完成后，我们会发现在控制台会首先输出  <code>setup component</code>， 然后 3s 过程会同时输出 <code>setup component changed</code>，这个是因为 <code>watchEffect</code> 会立即执行，但是因为依赖没有变更，所以就是初始值，3s 后，依赖发生了变更，这时 <code>watch</code> 和 <code>watchEffect</code> 同时触发</p><p>watchEffect 在执行完成后，会有一个返回值，我们可以通过这个返回值来停止监听,但是需要注意的是，watchEffect 还是会立即执行，只是当依赖方式变化时，不会再次触发</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;setup component&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      title.<span class="property">value</span> = <span class="string">&quot;setup component changed&quot;</span></span><br><span class="line">    &#125;, <span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> stop = <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(title.<span class="property">value</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">stop</span>()</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      title</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="computed-计算属性"><a href="#computed-计算属性" class="headerlink" title="computed 计算属性"></a>computed 计算属性</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> title = <span class="title function_">ref</span>(<span class="string">&quot;setup component&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    title.<span class="property">value</span> = <span class="string">&quot;setup component changed&quot;</span></span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> computedTitle = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> title.<span class="property">value</span> + <span class="string">&quot;abcd&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    title,</span><br><span class="line">    computedTitle</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>访问 computed 值的时候和 访问响应式变量的值一样，都是通过 <code>.value</code> 来获取到</p><h4 id="provide-amp-amp-inject"><a href="#provide-amp-amp-inject" class="headerlink" title="provide &amp;&amp; inject"></a>provide &amp;&amp; inject</h4><p>vue3 暴露出了两个方法 <code>provide</code> 和 <code>inject</code> 两个方法，这两个方法和 组件内的 provide和inject 方法等同</p><p>provide 传入两个参数，第一个参数是属性名，第二个参数是属性值<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">  <span class="title function_">provide</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;lxx&quot;</span>)</span><br><span class="line">  <span class="title function_">provide</span>(<span class="string">&quot;age&quot;</span>, <span class="number">26</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>inject 传入两个参数，第一个参数是属性名，第二个参数是默认值<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">  <span class="title function_">inject</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;lxx&quot;</span>)</span><br><span class="line">  <span class="title function_">inject</span>(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>但是通过上述创建的 provide 和 inject 之间不是响应式的，也就是说如果provide 的值改变并不会触发 inject 的值变化，<br>provide 可以使用 ref 和 reactive 方法创建响应式的 provide</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line">  <span class="title function_">provide</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;lxx&quot;</span>)</span><br><span class="line">  <span class="title function_">provide</span>(<span class="string">&quot;age&quot;</span>, count)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="模板引用-ref-””"><a href="#模板引用-ref-””" class="headerlink" title="模板引用(ref=””)"></a>模板引用(ref=””)</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:ref</span>=<span class="string">&quot;root&quot;</span>&gt;</span>This is a root element<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; ref, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> root = <span class="title function_">ref</span>(<span class="literal">null</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// DOM 元素将在初始渲染后分配给 ref</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(root.<span class="property">value</span>) <span class="comment">// &lt;div&gt;This is a root element&lt;/div&gt;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        root</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当页面加载完成后，会自动将 div 绑定给 root</p><p>如果需要使用 v-for 绑定多个标签，可以创建响应式数组或者响应式对象来实现</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;什么是组合式API&quot;&gt;&lt;a href=&quot;#什么是组合式API&quot; class=&quot;headerlink&quot; title=&quot;什么是组合式API&quot;&gt;&lt;/a&gt;什么是组合式API&lt;/h2&gt;&lt;p&gt;&lt;code&gt;组合式API&lt;/code&gt; 主要是为了把相同的逻辑关注点收集在一起，使得</summary>
      
    
    
    
    <category term="Vue3" scheme="https://lxx1997.github.io/categories/Vue3/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="Vue3" scheme="https://lxx1997.github.io/tags/Vue3/"/>
    
  </entry>
  
  <entry>
    <title>创建默认的 hexo categories 首页</title>
    <link href="https://lxx1997.github.io/2022/07/20/extend/hexo-create-categories-pages/"/>
    <id>https://lxx1997.github.io/2022/07/20/extend/hexo-create-categories-pages/</id>
    <published>2022-07-20T01:16:55.000Z</published>
    <updated>2022-07-20T01:16:55.000Z</updated>
    
    <content type="html"><![CDATA[<p>正常我们创建一个新的 hexo 博客时 直接访问 categories 默认页面时是无法访问到的，如果我们想要访问到可以通过以下操作创建一个默认的 categories 默认页面，在生成页面时，categories 相关内容会自动写进去</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> page categories</span><br></pre></td></tr></table></figure><p>categories 默认 md 文档中添加 <code>type: &quot;categories&quot;</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: categories</span><br><span class="line">date: 2022-07-20 09:13:01</span><br><span class="line"><span class="section">type: &quot;categories&quot;</span></span><br><span class="line"><span class="section">---</span></span><br></pre></td></tr></table></figure><p>创建 tags 默认页面类似，只需要把 <code>type: &quot;categories&quot;</code> 改为 <code>type: &quot;tags&quot;</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;正常我们创建一个新的 hexo 博客时 直接访问 categories 默认页面时是无法访问到的，如果我们想要访问到可以通过以下操作创建一个默认的 categories 默认页面，在生成页面时，categories 相关内容会自动写进去&lt;/p&gt;
&lt;figure class=</summary>
      
    
    
    
    <category term="hexo" scheme="https://lxx1997.github.io/categories/hexo/"/>
    
    
    <category term="hexo" scheme="https://lxx1997.github.io/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>重新学习vue2 - 发现隐藏其中的细节 - part2</title>
    <link href="https://lxx1997.github.io/2022/07/19/vue/relearn-vue2-02/"/>
    <id>https://lxx1997.github.io/2022/07/19/vue/relearn-vue2-02/</id>
    <published>2022-07-19T07:04:48.000Z</published>
    <updated>2022-07-19T07:04:48.000Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p><strong>filter(过滤器)</strong></p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message | capitalize &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:id</span>=<span class="string">&quot;rawId | formatId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filter</span>: &#123;</span><br><span class="line">  <span class="attr">capitalize</span>: <span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <strong>过滤器可以串联，值从左向右传递</strong></p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;filter(过滤器)&lt;/strong&gt;&lt;/p&gt;
 &lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="relearn" scheme="https://lxx1997.github.io/tags/relearn/"/>
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>html-webpack-plugin 的使用与进阶</title>
    <link href="https://lxx1997.github.io/2022/07/13/webpack/html-webpack-plugin/"/>
    <id>https://lxx1997.github.io/2022/07/13/webpack/html-webpack-plugin/</id>
    <published>2022-07-13T03:19:44.000Z</published>
    <updated>2022-07-13T03:19:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>在日常工作中遇到了需要打包成多页面的需求，由于每个页面的标题，描述以及一些seo和推广上的不一样，采用了 <code>html-webpack-plugin</code> 这个插件，在这里记录一下踩过的坑，以便后续查看和翻阅</p><h2 id="简单的使用"><a href="#简单的使用" class="headerlink" title="简单的使用"></a>简单的使用</h2><h4 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add html-webpack-plugin -D</span><br></pre></td></tr></table></figure><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;/public/index.html&quot;</span>, <span class="comment">// 模板</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;template.html&quot;</span>, <span class="comment">// 输出文件名称</span></span><br><span class="line">      chunks[<span class="string">&quot;template&quot;</span>] <span class="comment">// 打包文件，与 entry 入口名相同</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="进阶操作"><a href="#进阶操作" class="headerlink" title="进阶操作"></a>进阶操作</h2><h4 id="自定义-meta-标签"><a href="#自定义-meta-标签" class="headerlink" title="自定义 meta 标签"></a>自定义 meta 标签</h4><p>在日常开发过程中，我们可能会遇到一些与seo 相关或者需要在页面头部添加 meta 标签，我们就可以采用 <code>html-webpack-plugin</code> 来动态的向同一个模板插入不同的meta标签</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;/public/index.html&quot;</span>, <span class="comment">// 模板</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;template.html&quot;</span>, <span class="comment">// 输出文件名称</span></span><br><span class="line">      chunks[<span class="string">&quot;template&quot;</span>], <span class="comment">// 打包文件，与 entry 入口名相同</span></span><br><span class="line">      <span class="attr">meta</span>: &#123;</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&quot;description&quot;</span>,</span><br><span class="line">        <span class="attr">keyword</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码会自动在打包之后的页面中添加 meta 标签</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;description&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;keyword&quot;</span> <span class="attr">content</span>=<span class="string">&quot;keyword&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="自定义-link-标签"><a href="#自定义-link-标签" class="headerlink" title="自定义 link 标签"></a>自定义 link 标签</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;/public/index.html&quot;</span>, <span class="comment">// 模板</span></span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;template.html&quot;</span>, <span class="comment">// 输出文件名称</span></span><br><span class="line">      chunks[<span class="string">&quot;template&quot;</span>], <span class="comment">// 打包文件，与 entry 入口名相同</span></span><br><span class="line">      <span class="attr">meta</span>: &#123;</span><br><span class="line">        <span class="attr">description</span>: <span class="string">&quot;description&quot;</span>,</span><br><span class="line">        <span class="attr">keyword</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">      &#125;，</span><br><span class="line">      <span class="attr">links</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">href</span>: <span class="string">&quot;http://template.com/assets/abc.css&quot;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;text/css&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">href</span>: <span class="string">&quot;http://template.com/assets/abc.css&quot;</span>,</span><br><span class="line">          <span class="attr">ref</span>: <span class="string">&quot;alternate&quot;</span>,</span><br><span class="line">          <span class="attr">hrefLang</span>: <span class="string">&quot;en&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在模板页面可以解析 links 的内容在打包时动态生成我们所需要的的 link 标签</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    &lt;% for (var key1 in htmlWebpackPlugin.options.links) &#123; %&gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">link</span> &lt;% <span class="attr">for</span> (<span class="attr">key</span> <span class="attr">in</span> <span class="attr">htmlWebpackPlugin.options.links</span>[<span class="attr">key1</span>]) &#123; %&gt;</span> &lt;%= key %&gt;=&quot;&lt;%= htmlWebpackPlugin.options.links[key1][key] %&gt;&quot;&lt;% &#125; %&gt; /&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在上述代码中，打包时首先会去拿取 <code>htmlWebpackPlugin.options.links</code> 中的内容进行遍历，然后根据 <code>links</code> 中元素的属性来动态生成link标签的 <code>href</code>,<code>type</code>,<code>ref</code> 等属性</p><p><strong>未完待续</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在日常工作中遇到了需要打包成多页面的需求，由于每个页面的标题，描述以及一些seo和推广上的不一样，采用了 &lt;code&gt;html-webpack-plugin&lt;/code&gt; 这个插件，在这里记录一下踩过的坑，以便后续查看和翻阅&lt;/p&gt;
&lt;h2 id=&quot;简单的使用&quot;&gt;&lt;a hr</summary>
      
    
    
    
    <category term="webpack" scheme="https://lxx1997.github.io/categories/webpack/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
    <category term="html" scheme="https://lxx1997.github.io/tags/html/"/>
    
    <category term="webpack" scheme="https://lxx1997.github.io/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>常用的前端动画库</title>
    <link href="https://lxx1997.github.io/2022/07/12/web/web-animation-package/"/>
    <id>https://lxx1997.github.io/2022/07/12/web/web-animation-package/</id>
    <published>2022-07-12T08:58:08.000Z</published>
    <updated>2022-07-12T08:58:08.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Lottie"><a href="#Lottie" class="headerlink" title="Lottie"></a><a href="https://github.com/airbnb/lottie-web">Lottie</a></h4><p>  文档<br>  <a href="https://juejin.cn/post/7101629986427109383">都2022年了，一个还不知道Lottie动画的前端已经OUT啦！</a></p><h4 id="svga"><a href="#svga" class="headerlink" title="svga"></a><a href="https://github.com/svga/SVGAPlayer-Web">svga</a></h4><p>  <a href="https://juejin.cn/post/6892996067315580941">SVGA在前端方面的使用</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;Lottie&quot;&gt;&lt;a href=&quot;#Lottie&quot; class=&quot;headerlink&quot; title=&quot;Lottie&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://github.com/airbnb/lottie-web&quot;&gt;Lottie&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;  文</summary>
      
    
    
    
    <category term="web" scheme="https://lxx1997.github.io/categories/web/"/>
    
    
    <category term="web" scheme="https://lxx1997.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>生成 github SSH key</title>
    <link href="https://lxx1997.github.io/2022/07/08/github-ssh-key-generate/"/>
    <id>https://lxx1997.github.io/2022/07/08/github-ssh-key-generate/</id>
    <published>2022-07-08T06:19:07.000Z</published>
    <updated>2022-07-08T06:19:07.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="生成-SSH-key"><a href="#生成-SSH-key" class="headerlink" title="生成 SSH key"></a>生成 SSH key</h4><p>打开 git bash 命令行工具 输入一下命令，自动生成 ssh key 地址</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;your_email@example.com&quot;</span></span><br></pre></td></tr></table></figure><p>可以通过命令行直接复制 ssh key 的内容</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clip &lt; ~<span class="regexp">/.ssh/i</span>d_ed25519.<span class="property">pub</span></span><br></pre></td></tr></table></figure><p>复制成功之后，可以将 ssh key 复制到 github 的ssh key 上</p><h4 id="和-github-链接"><a href="#和-github-链接" class="headerlink" title="和 github 链接"></a>和 github 链接</h4><p>执行以下命令</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-add ~<span class="regexp">/.ssh/i</span>d_ed25519</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">echo $SSH_AGENT_SOCK</span><br></pre></td></tr></table></figure><p>如果执行不成功，可能是 ssh-add 未开启，可以通过命令行查看是否开启ssh-add 服务<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep ssh</span><br></pre></td></tr></table></figure></p><h4 id="开启-ssh-add-服务"><a href="#开启-ssh-add-服务" class="headerlink" title="开启 ssh-add 服务"></a>开启 ssh-add 服务</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.<span class="property">ssh</span></span><br><span class="line"><span class="built_in">eval</span> $(ssh-agent)</span><br></pre></td></tr></table></figure><p>执行完上述命令后就可以进行ssh 链接</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;生成-SSH-key&quot;&gt;&lt;a href=&quot;#生成-SSH-key&quot; class=&quot;headerlink&quot; title=&quot;生成 SSH key&quot;&gt;&lt;/a&gt;生成 SSH key&lt;/h4&gt;&lt;p&gt;打开 git bash 命令行工具 输入一下命令，自动生成 ssh key </summary>
      
    
    
    
    <category term="git" scheme="https://lxx1997.github.io/categories/git/"/>
    
    
    <category term="git" scheme="https://lxx1997.github.io/tags/git/"/>
    
    <category term="linux" scheme="https://lxx1997.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>重新学习vue2 - 发现隐藏其中的细节 - part1</title>
    <link href="https://lxx1997.github.io/2022/07/07/vue/relearn-vue2-01/"/>
    <id>https://lxx1997.github.io/2022/07/07/vue/relearn-vue2-01/</id>
    <published>2022-07-07T07:56:07.000Z</published>
    <updated>2022-07-07T07:56:07.000Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>computed 属性默认是只有 getter 属性的，也就是说我们只能获取到computed 属性的值，但是无法修改它，但是我们可以手动的设置 setter 属性，这样就可以手动赋值了</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">computed</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="attr">fullName</span>: &#123;</span><br><span class="line">      <span class="attr">set</span>: <span class="keyword">function</span> (<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> name = val.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">firstName</span> = name[<span class="number">0</span>]</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">secondName</span> = name[<span class="number">1</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">get</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">firstName</span> + <span class="string">&quot; &quot;</span> + <span class="variable language_">this</span>.<span class="property">secondName</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>v-for 和 v-if 为什么不推介一起使用</p><p> 这个是因为 v-for 和 v-if 的优先级问题，vue 会先进行 v-for 循环渲染元素，最后在进行 v-if 控制是否显示元素，会造成无谓的资源浪费</p><p> 可以采用 v-show 代替 v-if 或者使用计算属性来代替 v-if， 只渲染我们想渲染的元素</p></li><li><p>key attribute 用来表示这个元素是完全独立的，和其他元素不同，在日常操作中可以用来强制刷新元素内容，只需要修改元素的key，就会重新去渲染元素</p><p> 我之前用过 v-if 和 $nextTick 来强制重新渲染元素内容，很明显使用上述方法是一种很方便的操作</p></li><li><p>v-for 可以使用 <code>in</code> 或者 <code>of</code> 来作为分隔符</p></li><li><p>v-for 遍历对象时 <code>v-for=&quot;(value, name, index) in obj&quot;</code> 三个值 分别为 值，键，和 索引</p></li><li><p>vue 中可以使用 template 标签，该标签类似 react 中的<code>&lt;&gt;&lt;/&gt;</code>和<code>React.Fragment</code>,在实际渲染中并不会被渲染出来</p></li><li><p>如果我们想要在点击事件中访问原始的 dom 时间，可以将特殊的变量 <code>$event</code> 传到方法中</p></li><li><p>事件修饰符</p><ul><li><code>.stop</code>  阻止事件冒泡</li><li><code>.prevent</code>  阻止默认事件</li><li><code>.capture</code>  事件捕获的时候触发，如果点击的是子元素，会先于子元素事件触发</li><li><code>.self</code>  只有当 <code>event.target</code> 是元素自身时触发，点击子元素时不会触发</li><li><code>.once</code>  只会触发一次</li><li><p><code>.passive</code>  和 <code>.prevent</code> 相反，不会阻止默认事件触发</p><p><strong>使用修饰符的时候，顺序很重要，代码会以同样的顺序产生，例如<code>v-on:click.prevent.self</code> 会阻止所有点击，而 <code>v-on:click.slef.prevent</code> 只会阻止元素对自身的点击</strong></p></li></ul></li><li><p>按键修饰符</p><ul><li>.enter</li><li>.tab</li><li>.delete (捕获“删除”和“退格”键)</li><li>.esc</li><li>.space</li><li>.up</li><li>.down</li><li>.left</li><li>.right</li><li>支持按键码</li><li>可以通过全局的 <code>config.keyCodes</code> 自定义按键修饰符别名<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">keyCodes</span>.<span class="property">f1</span> = <span class="number">112</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>系统修饰键 (<em>修饰键在和其他事件一起使用的时候，需要同时触发才行，否则并不会单独触发修饰键</em>)</p><ul><li>.ctrl</li><li>.alt</li><li>.shift</li><li>.meta</li></ul></li><li><p><code>.exact</code> 精确修饰符，允许我们控制精确的系统修饰符组合触发的事件</p></li><li><p><code>&lt;input v-model=&quot;toggle&quot; type=&quot;checkbox&quot; true-value=&quot;yes&quot; false-value=&quot;no&quot; /&gt;</code> 此时 <code>toggle</code> 会取 对应的 <code>true-value</code> 和 <code>false-value</code> 的值</p></li><li><p><code>v-model.lazy</code> 默认情况下，<code>v-model</code> 会在input 事件触发后将输入框的值与数据同步，添加<code>lazy</code> 修饰符后，从而转为在 <code>change</code> 事件之后触发</p></li><li><p><code>v-model.number</code> 会自动将用户输入的值转为数值类型</p></li><li><p><code>v-model.trim</code> 会自动去除用户输入内容两端的空格</p></li><li><p>自定义组件中的 <code>data</code> 必须是一个函数，是为了保证每次创建组件的时候都能拿到一个独立的数据，否则，重复创建组件时，组件内的数据由于有同一个引用地址，会互相干扰</p></li><li><p><code>v-model</code> 在自定义组件中使用相当于 <code>v-bind:value</code> 和 <code>v-on:change</code> 的组合</p></li><li><p>可以通过组件的 model 属性改变 v-model 的默认属性和事件绑定</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">model</span>: &#123;</span><br><span class="line">    <span class="attr">prop</span>: <span class="string">&#x27;checked&#x27;</span>,</span><br><span class="line">    <span class="attr">event</span>: <span class="string">&#x27;change&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">checked</span>)</span><br><span class="line">    <span class="variable language_">this</span>.$emit(<span class="string">&quot;change&quot;</span>, <span class="string">&quot;val&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>&lt;component v-bind:is=&quot;CustomComponent&quot;&gt;&lt;/component&gt;</code> 通过 <code>v-bind:is</code> 可以自定义组件，组件会跟随 <code>CustomComponent</code> 的值变化而变化</p></li><li><p>传入一个对象的所有 property, 组件内部可以直接通过 示例中 <code>post</code> 拿到对应的属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;component v-bind=<span class="string">&quot;post&quot;</span>&gt;&lt;/component&gt;</span><br></pre></td></tr></table></figure></li><li><p>props 验证</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">propA</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">require</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="title function_">validator</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>type</code> props 参数类型 <code>String</code>, <code>Number</code>, <code>Boolean</code>, <code>Array</code>, <code>Object</code>, <code>Date</code>, <code>Function</code>, <code>Symbol</code>, 或者自定义的构造函数</li><li><code>default</code> 默认值，引用类型数据 需要使用函数并且通过return 返回默认引用类型</li><li><code>require</code> 是否必须传 默认为 <code>false</code></li><li><code>validator</code> 自定义效验规则</li></ul></li><li><p>禁用 <code>Attribute</code> 继承，可以设置 <code>inheritAttrs</code> false 来之根元素继承 <code>Attribute</code></p><p>具体表现为 如果设置为 <code>false</code> 子组件不会渲染 <code>attribute</code>， <code>true</code> 会在子组件上渲染 <code>attribute</code></p></li><li><p><strong>父级模板里的所有内容都是在父级作用域中编译的；子模板里的所有内容都是在子作用域中编译的。</strong></p></li><li><p><code>slot</code> 缩写 <code>v-slot:</code> -&gt; <code>#</code></p><ul><li><strong>后备内容</strong> 如果我们没有向插槽内提供内容，此时将会显示后备内容 <code>&lt;slot&gt;默认内容&lt;/slot&gt;</code></li><li><strong>具名插槽</strong> <code>&lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;</code> <code>&lt;slot-component v-slot:header&gt;&lt;/slot-component&gt;</code></li><li><p><strong>作用域插槽</strong><br>  插槽内部</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;slot v-bind:user=&quot;user&quot;&gt;</span><br><span class="line">    &lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>  外部使用</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;slot v-slot:default=&quot;slotProps&quot;&gt;</span><br><span class="line">      &#123;&#123; slotProps.user.firstName &#125;&#125;</span><br><span class="line">    &lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>  如果有多个插槽</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;slot v-slot:default=&quot;slotProps&quot;&gt;</span><br><span class="line">      &#123;&#123; slotProps.user.firstName &#125;&#125;</span><br><span class="line">    &lt;/slot&gt;</span><br><span class="line">    &lt;slot v-slot:other=&quot;otherSlotProps&quot;&gt;</span><br><span class="line">      &#123;&#123; slotProps.user.firstName &#125;&#125;</span><br><span class="line">    &lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>子组件可以通过 <code>$root</code> 来访问和修改根组件的实例及方法</p></li><li><p><code>provide</code>, <code>inject</code></p><p><strong><code>provide</code></strong> 选项允许和指定提供给后代组件的数据和方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">provide</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>inject</code></strong> 允许子元素接受 <code>provide</code> 提供的 <code>provide</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]</span><br></pre></td></tr></table></figure><p>但是出于设计考虑， 这些数据不是响应式的，而且会对重构及代码复用有很大的影响</p></li><li><p><code>X-Template</code> <code>x-template</code> 需要定义在 Vue 所属的 DOM 元素外。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/x-template&quot;</span> <span class="attr">id</span>=<span class="string">&quot;hello-world-template&quot;</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello hello hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;hello-world&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;#hello-world-template&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>transition</code> 过渡动画</p><ul><li><code>v-enter</code> 定义进入过渡的开始状态。在元素被插入之前生效，在元素被插入之后的下一帧移除</li><li><code>v-enter-active</code> 定义进入过渡生效时的状态。在整个进入过渡的阶段中应用，在元素被插入之前生效，在过渡/动画完成之后移除。这个类可以被用来定义进入过渡的过程时间，延迟和曲线函数。</li><li><code>v-enter-to</code> 定义进入过渡的结束状态。在元素被插入之后下一帧生效 (与此同时 v-enter 被移除)，在过渡/动画完成之后移除。</li><li><code>v-leave</code> 定义离开过渡的开始状态。在离开过渡被触发时立刻生效，下一帧被移除。</li><li><code>v-leave-active</code> 定义离开过渡生效时的状态。在整个离开过渡的阶段中应用，在离开过渡被触发时立刻生效，在过渡/动画完成之后移除。这个类可以被用来定义离开过渡的过程时间，延迟和曲线函数。</li><li><code>v-leave-to</code> 定义离开过渡的结束状态。在离开过渡被触发之后下一帧生效 (与此同时 v-leave 被删除)，在过渡/动画完成之后移除。</li></ul><p><img src="/assets/blogImg/vue-transition.png" alt="vue-transition" title="vue-transition"></p><p><strong>自定义动画类名</strong></p><ul><li><code>enter-class</code></li><li><code>enter-active-class</code></li><li><code>enter-to-class</code></li><li><code>leave-class</code></li><li><code>leave-active-class</code></li><li><code>leave-to-class</code></li></ul><p><strong>显性的过渡持续时间</strong></p><p><code>&lt;transition :duration=&quot;1000&quot; /&gt;</code></p><p><code>&lt;transition :duration=&quot;&#123;enter: 500, leave: 800&#125;&quot; /&gt;</code></p><p><strong>JavaScript 钩子</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-on:before-enter</span>=<span class="string">&quot;beforeEnter&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-on:enter</span>=<span class="string">&quot;enter&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-on:after-enter</span>=<span class="string">&quot;afterEnter&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-on:enter-cancelled</span>=<span class="string">&quot;enterCancelled&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">  <span class="attr">v-on:before-leave</span>=<span class="string">&quot;beforeLeave&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-on:leave</span>=<span class="string">&quot;leave&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-on:after-leave</span>=<span class="string">&quot;afterLeave&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-on:leave-cancelled</span>=<span class="string">&quot;leaveCancelled&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="comment">// --------</span></span><br><span class="line">  <span class="comment">// 进入中</span></span><br><span class="line">  <span class="comment">// --------</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">beforeEnter</span>: <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 当与 CSS 结合使用时</span></span><br><span class="line">  <span class="comment">// 回调函数 done 是可选的</span></span><br><span class="line">  <span class="attr">enter</span>: <span class="keyword">function</span> (<span class="params">el, done</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="title function_">done</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">afterEnter</span>: <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">enterCancelled</span>: <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// --------</span></span><br><span class="line">  <span class="comment">// 离开时</span></span><br><span class="line">  <span class="comment">// --------</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">beforeLeave</span>: <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 当与 CSS 结合使用时</span></span><br><span class="line">  <span class="comment">// 回调函数 done 是可选的</span></span><br><span class="line">  <span class="attr">leave</span>: <span class="keyword">function</span> (<span class="params">el, done</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="title function_">done</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">afterLeave</span>: <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// leaveCancelled 只用于 v-show 中</span></span><br><span class="line">  <span class="attr">leaveCancelled</span>: <span class="keyword">function</span> (<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol start="28"><li><p><code>mixins</code> 混入选项合并</p><ul><li>数组对象会在内部进行合并，例如 <code>data</code>,属性名发生冲突时，以组件内属性优先</li><li>钩子函数合并成数组，都会被调用，混入对象的钩子函数优先于组件内钩子函数调用</li><li>值为对象时,将会被合并成为一个对象，且组件对象的键值对优先级更高</li></ul><p><strong>Vue.config.optionMergeStrategies</strong> 可以通过次宣讲自定义逻辑合并逻辑</p></li><li><p>自定义指令</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">directives</span>: &#123;</span><br><span class="line">  <span class="attr">focus</span>: &#123;</span><br><span class="line">    <span class="attr">inserted</span>: <span class="keyword">function</span>(<span class="params">el</span>) &#123;</span><br><span class="line">      el.<span class="title function_">focus</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-focus</span> /&gt;</span></span><br></pre></td></tr></table></figure><p><strong>钩子函数</strong></p><ul><li>bind 绑定时调用，只调用一次</li><li>inserted 被绑定元素插入父节点时调用</li><li>update  所在组件更新时调用，<strong>可能发生在子组件更新之前</strong></li><li>componentUpdated 所在组件和子组件全部更新后调用</li><li>unbind 指令与元素解绑时调用</li></ul><p><strong>钩子函数参数</strong></p><ul><li>el 绑定的元素，可以用来操作 DOM</li><li>binding<ul><li>name 指令名</li><li>value 指令绑定的值</li><li>oldValue  制定绑定的前一个值</li><li>expression 字符串形式的指令表达式 <code>=&quot;1 + 1&quot;</code></li><li>arg 传给指令的参数 <code>:foo</code></li><li>modifiers 指令修饰符 <code>.foo</code></li></ul></li><li>vnode 当前虚拟节点</li><li>oldVnode 上一个虚拟节点</li></ul></li><li><p><code>functional</code> 函数式组件<br>函数式组件没有响应式数据，也没有实例（没有 this 上下文）<br>相反会有一个 <code>context</code> 参数 包含如下字段</p><ul><li>props</li><li>children</li><li>slots</li><li>scopedSlots</li><li>data</li><li>parent</li><li>listeners</li><li>injections</li></ul></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;ol&gt;
&lt;li&gt;&lt;p&gt;computed 属性默认是只有 getter 属性的，也就是说我们只能获取到computed 属性的值，但是无法修改它，但是我们可以手动的设置 setter 属性，这样就可以手动赋值了&lt;/p&gt;
 &lt;figure class=&quot;highlight js&quot;&gt;</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="relearn" scheme="https://lxx1997.github.io/tags/relearn/"/>
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>好用的浏览器页面测试页面性能工具</title>
    <link href="https://lxx1997.github.io/2022/07/07/web/web-page-speed-testing-tools/"/>
    <id>https://lxx1997.github.io/2022/07/07/web/web-page-speed-testing-tools/</id>
    <published>2022-07-07T03:29:14.000Z</published>
    <updated>2022-07-07T03:29:14.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="pagespeed"><a href="#pagespeed" class="headerlink" title="pagespeed"></a>pagespeed</h4><p>地址： <a href="https://pagespeed.web.dev/">https://pagespeed.web.dev/</a></p><h4 id="gtmetrix"><a href="#gtmetrix" class="headerlink" title="gtmetrix"></a>gtmetrix</h4><p>地址： <a href="https://gtmetrix.com/">https://gtmetrix.com/</a></p><h4 id="web-dev"><a href="#web-dev" class="headerlink" title="web.dev"></a>web.dev</h4><p>地址： <a href="https://web.dev/measure/">https://web.dev/measure/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;pagespeed&quot;&gt;&lt;a href=&quot;#pagespeed&quot; class=&quot;headerlink&quot; title=&quot;pagespeed&quot;&gt;&lt;/a&gt;pagespeed&lt;/h4&gt;&lt;p&gt;地址： &lt;a href=&quot;https://pagespeed.web.dev/&quot;&gt;h</summary>
      
    
    
    
    <category term="performance" scheme="https://lxx1997.github.io/categories/performance/"/>
    
    
    <category term="performance" scheme="https://lxx1997.github.io/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>最全的页面性能优化</title>
    <link href="https://lxx1997.github.io/2022/06/24/web/how-to-make-pagespeed-fast/"/>
    <id>https://lxx1997.github.io/2022/06/24/web/how-to-make-pagespeed-fast/</id>
    <published>2022-06-24T14:20:06.000Z</published>
    <updated>2023-02-24T14:20:06.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="为什么要进行性能优化"><a href="#为什么要进行性能优化" class="headerlink" title="为什么要进行性能优化"></a>为什么要进行性能优化</h2><p>我们会在什么时候对页面性能进行优化呢，在我的观点里大致有以下几个方面</p><ul><li>页面加载时间较长，导致部分用户在页面还未加载完成之后便离开了页面，增加了用户的跳出率</li><li>因为 google 的搜索算法，对页面性能这一块有一定要求，如果页面性能较差，那么当用户搜索工具关键词时，页面的顺序就越靠下，这样针对用户自然搜索流量这一块会有很大影响</li><li>用户在使用工具时，可能会由于部分操作及代码实现的影响，导致用户使用时会比较卡顿，用户体验较差，降低用户留存</li></ul><p>如果想要提高用户的留存率这一块的数据，那么增加用户流量及降低用户跳出率就比较重要了</p><h2 id="怎么进行性能优化"><a href="#怎么进行性能优化" class="headerlink" title="怎么进行性能优化"></a>怎么进行性能优化</h2><p>我认为可以从以下几个方面来进行性能优化</p><ul><li><p>html 解析阶段</p></li><li><p>javascript 加载阶段</p></li><li><p>页面渲染阶段</p></li><li><p>用户操作过程中</p></li></ul><p>下面来分别介绍一下在各个阶段要具体要怎么做</p><h3 id="html-解析阶段"><a href="#html-解析阶段" class="headerlink" title="html 解析阶段"></a>html 解析阶段</h3><p>当浏览器请求到页面 html 的时候，会对html 进行解析，如果中间遇到 link 标签 或者 script 标签时，会去请求对应资源，并进行解析，在解析 css 文件的过程中，并不会阻止浏览器解析 html 文件，但是要注意，javascript 文件会阻止 css 和 html 文件的解析，所以尽量要把 javascript 文件访问 body 标签的最后，不要阻止html 和 css 的解析</p><p>在这个阶段我们可以通过以下几种方法提高页面速度</p><h4 id="prefetch-amp-amp-preload"><a href="#prefetch-amp-amp-preload" class="headerlink" title="prefetch &amp;&amp; preload"></a>prefetch &amp;&amp; preload</h4><p>使用 prefetch 和 preload 方式 预加载文件，但是要注意这两个方法加载文件的优先级程度不同， <strong>prefetch 的优先级最低，浏览器不会立即下载文件，而是会在空闲时间去下载文件</strong>， <strong>preload 的优先级最高，会立即去下载文件</strong>，但是这两个方式都不会去解析文件，只是下载文件后存放本地，如果我们需要使用时就不必再次下载</p><p><em>注意：由于浏览器对于同一个域名下请求的个数有限制，所以要谨慎使用prefetch 和preload 方法，如果一次性加载文件过多，反而会影响后续资源的获取，起到反优化的效果</em></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;prefetch&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://www.template.com/assets/js/tempalte.js&quot;</span> <span class="attr">as</span>=<span class="string">&quot;type/javascript&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;prefetch&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://www.template.com/assets/js/tempalte.css&quot;</span> <span class="attr">as</span>=<span class="string">&quot;type/style&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://www.template.com/assets/js/tempalte.js&quot;</span> <span class="attr">as</span>=<span class="string">&quot;type/javascript&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://www.template.com/assets/js/tempalte.css&quot;</span> <span class="attr">as</span>=<span class="string">&quot;type/style&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h4 id="DNS-Prefetch，即DNS预获取"><a href="#DNS-Prefetch，即DNS预获取" class="headerlink" title="DNS Prefetch，即DNS预获取"></a>DNS Prefetch，即DNS预获取</h4><p>当浏览器加载文件时，会对地址进行 DNS 解析,获取地址对用的IP地址，虽然浏览器内部对这一部分操作进行过优化，会在一定时间内缓存 DNS 解析结果，但是 DNS 解析的时间还是比较长的，大概需要 20ms - 120ms 左右的时间，我们可以针对会使用的域名开启 dns 预解析操作，在浏览器空闲的时候，去解析 DNS,当我们使用的时候，就可以减少 dns 解析的时间操作，提高接口请求时间</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启 DNS 解析 content: off 关闭 on 打开 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;x-dns-prefetch-control&quot;</span> <span class="attr">content</span>=<span class="string">&quot;on&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;dns-prefetch&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://www.template.com&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>但是要注意不要滥用预解析，如果短时间不需要的域名，可以不需要 dns 预解析</p><h4 id="script-标签位置"><a href="#script-标签位置" class="headerlink" title="script 标签位置"></a>script 标签位置</h4><p>浏览器在遇到script 标签时，会暂停解析 html 和 css 文件，转而去解析 js 内容，这样就阻止了页面的解析和渲染，所以尽量保证script 标签在 body 标签的末尾，减少 js 文件对html 文件解析的影响</p><h4 id="骨架屏"><a href="#骨架屏" class="headerlink" title="骨架屏"></a>骨架屏</h4><p>可以采用骨架屏的方式，防止用户因为看不到内容，从而离开页面</p><h3 id="JavaScript-解析阶段"><a href="#JavaScript-解析阶段" class="headerlink" title="JavaScript 解析阶段"></a>JavaScript 解析阶段</h3><p>在这个阶段，浏览器回去下载页面渲染所需要的 javascript 文件，解析，然后渲染到页面上，在这个阶段影响页面加载速度主要有以下几个方面：</p><ol><li>单个 js 文件过大，请求及解析文件耗时过大</li><li>同一时间请求了过多的资源，导致网络被占用，进一步影响了页面加载</li></ol><h4 id="采用不同域名加载静态资源"><a href="#采用不同域名加载静态资源" class="headerlink" title="采用不同域名加载静态资源"></a>采用不同域名加载静态资源</h4><p>我们都知道浏览器对同一个域名下的请求个数有一定的限制，例如google 浏览器限制最大并发个数是6个，当同时发起的请求的个数超过6个时，只会有有6个发起请求，其他的处于 padding 状态，只有当请求完成时，才会有下一个请求开发发起请求。</p><p>因此我们可以采用通过不同域名来请求静态资源，例如 所有的 js 资源可以单独采用一个域名来进行，图片等媒体资源可以采用一个域名来访问，这个就不会因为同一时间内请求的资源过多，影响页面加载速度</p><h4 id="CDN-缓存"><a href="#CDN-缓存" class="headerlink" title="CDN 缓存"></a>CDN 缓存</h4><p>当浏览器下载资源，会先通过 DNS 解析解析出资源所在主机的ip地址，然后去拉取资源，如果服务器刚好在用户所在城市附近，那么资源的加载速度并不会有多大影响，但如果距离过远，例如你人在北京，想要访问在美国的一台服务器上的资源，这个时候由于网络传输的印象，回导致资源获取延迟比较大。</p><p>这个时候就需要使用 CDN 缓存了， 这就是CDN的由来，分布式缓存服务器，主要功能是在转发、传输、链路抖动等情况下，最小化资源的时延，并保证信息的连续性和速度。</p><p>当我们访问资源，会首先向距离我们最近的 DNS 服务器发出资源请求，如果 这个DNS 服务器缓存有我们想要的资源，如果没有，则会向原服务器请求资源，然后返回给我们，这样一般就降低了资源在请求链路传输的延迟问题。</p><p>但是使用 DNS 缓存也会有一些弊端，因为资源都是已经缓存到 DNS 服务器上了，如果在资源缓存未失效的请求，资源进行了变更，这个时候用户访问到的又可能还是旧版资源，这个时候我们可以手动请求 DNS 缓存，但是这个方法不太方便，所以我们可以通过打包的方式，对静态资源添加 hash 后缀，这样每次发版或者更换资源，都会把地址专项新的地址，这样 CDN 就会重新对资源进行缓存<br>针对不能添加 hash 的文件，我们可以通过修改参数的方式来使 CDN 重新刷新缓存，例如<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.version 为 package.json 的版本号</span></span><br><span class="line"><span class="keyword">let</span> url = <span class="string">`http://www.example.com/useinfo?_v=<span class="subst">$&#123;package.version&#125;</span>`</span></span><br><span class="line">axios.<span class="property">get</span>*(url)</span><br></pre></td></tr></table></figure></p><p>这样当我们每次发版的时候，只需要修改一下版本号，就可以刷新 CDN 缓存了</p><h4 id="减少-javascript-包的体积"><a href="#减少-javascript-包的体积" class="headerlink" title="减少 javascript 包的体积"></a>减少 javascript 包的体积</h4><p>当 js 文件体积过大时，我们需要减少 javascript 包的大小，来减少js 加载时间和解析时间。</p><p>可以通过一下几种方式减少包的体积</p><ul><li><p>分包<br>  我们可以通过打包的方式，来将一些第三方资源包打包到一个文件，因为这部分资源我们通常并不会经常修改，这样当我们发版的时候，如果第三方资源并没有发生变化，那么这一块的资源并不会清空 CDN 缓存</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">            <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">            <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">                <span class="attr">vendors</span>: &#123; </span><br><span class="line">                    <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&quot;vendors&quot;</span>,</span><br><span class="line">                    <span class="attr">priority</span>: -<span class="number">10</span> </span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">utilCommon</span>: &#123; </span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&quot;common&quot;</span>,</span><br><span class="line">                    <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">minChunks</span>: <span class="number">2</span>, </span><br><span class="line">                    <span class="attr">priority</span>: -<span class="number">20</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  这样所有的 node_modules 下需要打包的资源都会打包到 vendors js 文件里面</p><p>  如果是多页面应用还可以吧多次使用的资源的资源打包到同一个包里面，这样多个页面就可以共用这一个包</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">            <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">            <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">                <span class="attr">utilCommon</span>: &#123; </span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&quot;common&quot;</span>,</span><br><span class="line">                    <span class="attr">minSize</span>: <span class="number">0</span>,</span><br><span class="line">                    <span class="attr">minChunks</span>: <span class="number">2</span>, </span><br><span class="line">                    <span class="attr">priority</span>: -<span class="number">20</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>资源懒加载</p><p>  <strong>这里主要以 vue 项目举例</strong></p><p>  假如我们的页面有多个路由，我们在访问其中一个路由的时候其实是不需要加载其他路由所需要的内容，这个时候可以使用懒加载的方式来减少首屏需要加载的资源</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&quot;./home.vue&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  这个时候只有我们访问 /home 这个路由的时候才会加载 home 所需要的资源，</p><p>  针对同一个路由中 也需要懒加载的组件的组件可以使用以下方式</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;tempalte&gt;</span><br><span class="line">    &lt;LazyLoad v-if=&quot;lazy&quot; /&gt;</span><br><span class="line">&lt;/tempalte&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const LazyLoad = () =&gt; import(&quot;./LazyLoad.vue&quot;)</span><br><span class="line">export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            lazy: false</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>  vue 在内部做过处理，只有当 lazy = true， 需要渲染 LazyLoad 组件时，才会加载对应资源</p><p>  <strong>React 路由懒加载</strong></p><p>  React.lazy 和 import 结合，使用的时候可以用 Suspense 组件包裹起来，可以在加载组件的时候提供占位效果</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Suspense</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">OtherComponent</span> = <span class="title class_">React</span>.<span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;./OtherComponent&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">OtherComponent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  通过以上操作，我们可以极大减少首屏加载所需要的资源大小，提高页面加载速度</p></li></ul><ul><li><p><a href="https://www.webpackjs.com/guides/tree-shaking/">Tree Shaking</a></p><p>  tree shaking 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码。它依赖于 ES2015 模块系统中的静态结构特性，例如 import 和 export。这个术语和概念实际上是兴起于 ES2015 模块打包工具 rollup。</p><p>  使用了 tree shaking后， 如果一段代码我们并没有通过 import 方式引入，这段代码在打包的时候就不会打包进去，但是这个时候也会出现其他问题，因为在迭代过程中，可能之前我们引入了一些资源，但这些资源在后期迭代的过程中不在使用了，但是并没有从代码中移除，这个时候，这些资源也会被打包到代码中，并且项目越大，这种问题出现的几率越大。</p><p>  因此webpack 扩展了这个检测能力，主要通过 package.json 的 sideEffect 属性来标记</p><p>  当我们把 sideEffect 设置为 false 时， 代表所有的代码都不包含副作用，告诉 webpack 可以安全的删除所有的未使用的 export 导出。</p><p>  如果部分代码存在副作用，我们通过一个数组来过滤掉这部分存在副作用的代码。</p>  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sideEffect&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sideEffect&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;./src/tool/effect.js&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>  我在对 vue 项目进行代码 treeshaking 的时候遇到过这样一个问题，打包没有问题，但是发到测试环境后看，页面样式发生了混乱，推测是 可能是由于 vue 文件进行 treeshaking 时，所以 就把 vue 文件标为 副作用文件，不进行treeshaking </p>  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sideEffect&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;./src/tool/effect.js&quot;</span>，</span><br><span class="line">        <span class="string">&quot;*.vue&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.less&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>gzip 压缩</p><p>  资源在经过网关的时候可以开启 gzip 压缩，使用了 gzip 后，静态文件可以被压缩 3 - 10 倍左右</p></li></ul><p>经过以上操作，可以极大减少用户请求页面加载资源大小，减少服务器带宽压力</p><h3 id="页面渲染阶段"><a href="#页面渲染阶段" class="headerlink" title="页面渲染阶段"></a>页面渲染阶段</h3><p>在页面渲染阶段 主要是用户让用户能够更快的看到页面，以及可操作，所以这个阶段就需要我们根据需求调整 资源加载 及 js 执行时间长度</p><ul><li>延迟加载资源</li></ul><p>对于部分第三方组件，例如支付，广告这些全局共用的js，可以等到使用的时候再去加载</p><ul><li>从产品设计方面</li></ul><p>针对部分阻塞页面加载及用户操作的资源可以通过用户的主动操作触发，而非页面一加载就执行</p><h3 id="用户操作过程"><a href="#用户操作过程" class="headerlink" title="用户操作过程"></a>用户操作过程</h3><p>再用户操作过程中，可能有些操作会需要大量计算，由于浏览器是单线程操作，长时间的计算将会阻止用户操作，造成页面出现卡顿的现状,我们可以通过采用分段计算和优化计算消毒，或者采用替代方法。</p><ul><li><p>使用全局加载动画，告诉用户当前属于什么状态。</p></li><li><p>canvas.toDataURL 可以采用 canvas.toBlob 方法替代（如果有使用的话）</p></li><li><p>setTimeout， setInterval， requestAnimationFrame 等方式实现异步操作</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;为什么要进行性能优化&quot;&gt;&lt;a href=&quot;#为什么要进行性能优化&quot; class=&quot;headerlink&quot; title=&quot;为什么要进行性能优化&quot;&gt;&lt;/a&gt;为什么要进行性能优化&lt;/h2&gt;&lt;p&gt;我们会在什么时候对页面性能进行优化呢，在我的观点里大致有以下几个方面&lt;/p&gt;</summary>
      
    
    
    
    <category term="performance" scheme="https://lxx1997.github.io/categories/performance/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="performance" scheme="https://lxx1997.github.io/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>SPA-prerender</title>
    <link href="https://lxx1997.github.io/2022/04/23/web/SPA-prerender/"/>
    <id>https://lxx1997.github.io/2022/04/23/web/SPA-prerender/</id>
    <published>2022-04-23T14:39:08.000Z</published>
    <updated>2022-04-23T14:39:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>由于单页面应用只生成了一个HTML 文件，如果想要做 SEO 的话， H 标签，img 标签的 alt 这些并不会被爬虫抓取到，所以需要我们做预渲染，使得生成的html文件中包含需要 爬虫抓取的内容， react-snap 插件可以帮助实现这个操作</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev react-snap</span><br></pre></td></tr></table></figure><h4 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;postbuild&quot;</span>: <span class="string">&quot;react-snap&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="入口-src-index-js"><a href="#入口-src-index-js" class="headerlink" title="入口 (src/index.js)"></a>入口 (src/index.js)</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; hydrate, render &#125; <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (rootElement.<span class="title function_">hasChildNodes</span>()) &#123;</span><br><span class="line"><span class="title function_">hydrate</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在使用 build 打包的时候，打包完成之后会执行我们添加的 postbuild 命令，然后将root下面的内容添加到 #root dom 里面，这样爬虫就可以从页面上抓取到关键词</p><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><!-- gitlab 发版 无法 postbuild --><p>Q: 在日常发版过程中通常会采用自动化发版，我们公司采用的是 gitlab 的 CI/CD 环境进行发版，最后进行postbuild 操作的时候 发现无法预渲染，要怎么解决</p><p>A: 虚拟环境的话，可以采用 puppeteer 来模拟浏览器环境<br>puppeteer 是 Node.js 的一个库可以用来模拟 chrome 环境<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">gitlab-ci.yml</span></span><br><span class="line"><span class="string">apt-get</span> <span class="string">install</span> <span class="string">-yq</span> <span class="string">gconf-service</span> <span class="string">libasound2</span> <span class="string">libatk1.0-0</span> <span class="string">libc6</span> <span class="string">libcairo2</span> <span class="string">libcups2</span> <span class="string">libdbus-1-3</span> <span class="string">libexpat1</span> <span class="string">libfontconfig1</span> <span class="string">libgcc1</span> <span class="string">libgconf-2-4</span> <span class="string">libgdk-pixbuf2.0-0</span> <span class="string">libglib2.0-0</span> <span class="string">libgtk-3-0</span> <span class="string">libnspr4</span> <span class="string">libpango-1.0-0</span> <span class="string">libpangocairo-1.0-0</span> <span class="string">libstdc++6</span> <span class="string">libx11-6</span> <span class="string">libx11-xcb1</span> <span class="string">libxcb1</span> <span class="string">libxcomposite1</span> <span class="string">libxcursor1</span> <span class="string">libxdamage1</span> <span class="string">libxext6</span> <span class="string">libxfixes3</span> <span class="string">libxi6</span> <span class="string">libxrandr2</span> <span class="string">libxrender1</span> <span class="string">libxss1</span> <span class="string">libxtst6</span> <span class="string">ca-certificates</span> <span class="string">fonts-liberation</span> <span class="string">libappindicator1</span> <span class="string">libnss3</span> <span class="string">lsb-release</span> <span class="string">xdg-utils</span> <span class="string">wget</span> <span class="comment">#install dependencies for puppeteer, which is a dependency for react-snap</span></span><br><span class="line"></span><br><span class="line"><span class="string">sh</span> <span class="string">./bash.sh</span> <span class="comment">#運行自定義腳本以更改 react-snap 上的選項以使其工作</span></span><br></pre></td></tr></table></figure><br>運行自定義腳本以更改 react-snap 上的選項以使其工作<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bash.sh</span></span><br><span class="line"><span class="comment"># modifies react-snap defaultOptions to add the --no-sandbox and --disable-setuid-sandbox flags so that puppeteer/chromium can run in the codebuild standard image</span></span><br><span class="line">sed -i <span class="string">&quot;s/puppeteerArgs: \[\],/puppeteerArgs: \[\&quot;--no-sandbox\&quot;, \&quot;--disable-setuid-sandbox\&quot;\],/&quot;</span> ./node_modules/react-snap/index.js</span><br><span class="line"><span class="built_in">echo</span> changed arguments <span class="keyword">in</span> react-snap</span><br></pre></td></tr></table></figure></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;reactSnap&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">// 需要进行预渲染的页面</span></span><br><span class="line">    <span class="string">&quot;/prerender.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;puppeteerArgs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;--no-sandbox&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;--disable-setuid-sandbox&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;--disable-web-security&quot;</span> <span class="comment">// 允许 接口跨域进行请求</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;viewport&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// 预渲染的页面宽高，可以控制移动端适配和web端适配</span></span><br><span class="line">    <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">1400</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">850</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;userAgent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ReactSnap&quot;</span><span class="punctuation">,</span> <span class="comment">// 环境，可以通过这个来区分是否是处于预渲染环境</span></span><br><span class="line">  <span class="attr">&quot;crawl&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;concurrency&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;inlineCss&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;removeStyleTags&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;skipThirdPartyRequests&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;puppeteerIgnoreHTTPSErrors&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><!-- spa 单页面涉及到多语言 --><p>Q: 页面存在国际化语言，页面再进行预渲染之后，在线上环境会出现文字先消失在出现的问题要怎么解决</p><p>A: 因为预渲染主要是把 页面渲染完成之后的内容重新写到html 里面，并不包含js文件，加载页面时，会去获取多语言文件，在多语言文件获取之前，通过key 去拿对应的文案时会获取不到，所以就变成了空白，文件加载完成之后，这个时候多语言文案就可以正常拿到了</p><p>可以采用先加载多语言文件再渲染页面的方式，或者再打包时就把对应多语言打包进去，放到window 对象上</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">loadLanguageJson</span>(language).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">rootElement</span>:<span class="title class_">HTMLElement</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>)!;</span><br><span class="line">    <span class="keyword">if</span> (rootElement.<span class="title function_">hasChildNodes</span>()) &#123;</span><br><span class="line">        <span class="title function_">hydrate</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span>, rootElement);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span>, rootElement);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;由于单页面应用只生成了一个HTML 文件，如果想要做 SEO 的话， H 标签，img 标签的 alt 这些并不会被爬虫抓取到，所以需要我们做预渲染，使得生成的html文件中包含需要 爬虫抓取的内容， react-snap 插件可以帮助实现这个操作&lt;/p&gt;
&lt;h2 id=&quot;</summary>
      
    
    
    
    <category term="SEO" scheme="https://lxx1997.github.io/categories/SEO/"/>
    
    <category term="gitlab" scheme="https://lxx1997.github.io/categories/gitlab/"/>
    
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
    <category term="Javascript" scheme="https://lxx1997.github.io/tags/Javascript/"/>
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SEO" scheme="https://lxx1997.github.io/tags/SEO/"/>
    
    <category term="gitlab" scheme="https://lxx1997.github.io/tags/gitlab/"/>
    
  </entry>
  
  <entry>
    <title>高性能JavaScript</title>
    <link href="https://lxx1997.github.io/2022/03/26/reading/%E9%AB%98%E6%80%A7%E8%83%BDJavaScript/"/>
    <id>https://lxx1997.github.io/2022/03/26/reading/%E9%AB%98%E6%80%A7%E8%83%BDJavaScript/</id>
    <published>2022-03-26T14:21:26.000Z</published>
    <updated>2022-03-26T14:21:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近读了一本关于如果写出性能更优的JavaScript的书，提取了一些相关的知识点</p><h4 id="JavaScript-文件加载及执行"><a href="#JavaScript-文件加载及执行" class="headerlink" title="JavaScript 文件加载及执行"></a>JavaScript 文件加载及执行</h4><p>我们都知道一个完整前端页面想要展示出来，需要包含 html， css，和JavaScript 文件，其中 html 是框架，css是样式，JavaScript负责交互。但是多数浏览器采用单一进程来处理用户界面ui和JavaScript脚本执行，同一时刻只能做一件事，所以JavaScript执行的时间越久浏览器等待的时间就会越久</p><p>浏览器页面在获取到页面时首先会先解析html元素，在解析的过程中，如果遇到css文件或者js文件的时候会去下载文件，下载完成之后然后再去解析文件，但是针对JavaScript文件来说，其实浏览器并不知道js有没有执行改变页面元素的操作，因此浏览器在下载和解析文件的时候，其实是一个暂停的操作，所以当 js 文件执行时间越久，页面空白的时间就越长</p><p>解决方式：</p><ul><li>将script 脚本尽量放在页面的最下方，保证页面解析完成之后才回去解析JavaScript脚本</li><li>针对script 脚本的数量做限制，每遇到一个script标签，浏览器都会停止其他操作去解析script脚本,而script脚本越大，下载时间越长，数量越多，http链接的额外请求的消耗越大。</li><li>script 标签的async 属性和 defer 属性，async 属性可以让资源在下载过程中不阻塞浏览器的解析，当下载完成之后在解析脚本文件，defer 属性则是延迟加载 script 文件，当页面解析完成之后才会去加载脚本文件</li><li>动态加载脚本文件。对于首屏加载不需要的脚本文件，我们可以在使用的时候再去加载文件。我们可以动态创建script标签，当js文件加载完成之后，再把script标签 append 到html文档中</li></ul><h4 id="数据存储方式"><a href="#数据存储方式" class="headerlink" title="数据存储方式"></a>数据存储方式</h4><p>JavaScript中有四种基本数据存储位置</p><ul><li>字面量<br>  字面量代表自身，不存储在特定位置，JavaScript中的字面量有字符串、数字、布尔值、对象、数组、函数、正则表达式、null、undefined</li><li>本地变量<br>  开发人员使用关键字 var，let const 定义的数据存储单元</li><li>数组元素<br>  存储在JavaScript数组对象内部，以数字作为索引</li><li>对象成员<br>  存储在JavaScript对象内部，以字符串作为索引</li></ul><p>大多数情况下，从字面量和本地变量存取数据性能是微不足道的，访问数组元素和对象成员的代价则高一些</p><h6 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h6><p>作用域决定了那些数据能够被访问，作用域内的每个对象都被成为一个可变对象，每个对象以键值对的形式存在，当函数创建后，作用域链就会被创建此函数的作用域中科访问的数据对象所填充，在函数内部表现为 <code>[[Scope]]</code> 属性</p><p>函数在被执行的时候，就会创建一个执行环境，函数每次执行时对应的执行环境都是独一无二的，同时调用一个函数会创建多个执行环境，函数调用完成后，执行环境就会被销毁</p><p>函数的作用域链是以栈的形式存在的，当一个函数被创建时，会创建一个局部作用域放到栈的顶端，当函数执行完成后，作用域会从栈顶删除，当在函数中想要寻找一个变量时，执行环境会沿着作用域链向下寻找，最后到全局作用域，如果找到了变量，就返回变量所存储的内容，否则返回 <code>undefined</code></p><p>因此如果我们查找的对象在作用域链中越深，查找就越耗费时间，因此我们可以在函数的局部作用域链中，创建一个新的变量来存储我们查找的对象</p><p><em>使用 <code>with</code> 和 <code>try...catch...</code> 方法可以修改函数的作用域链对象，但是实际并不推介这样做</em></p><p><strong>闭包</strong></p><p>闭包时 JavaScript 最强大的特性之一，它允许函数访问余部作用域链之外的数据，但是频繁的使用闭包有可能会造成问题。</p><p>平时我们使用函数时，会创建一个局部作用域，当函数执行完成后，这个局部作用域会被删除，但是由于引入了闭包，引用依然存在，导致这个局部作用域无法被销毁掉，造成了更多的内存开销，造成内存泄漏</p><p><strong>对象</strong></p><p>JavaScript的对象是基于原型，原型定义并实现了一个新创建的对象所必须包含的成员泪飙，原型对象为所有对象实例共享。</p><p>因此对象中有两种成员类型：实例成员和原型成员，可以用 <code>hasOwnProperty</code> 方法来判断对象是否包含特性的实例成员</p><p>当我们存取对象的属性或者方法时，会先查找对象的实例成员是否存在，如果不存在，则会沿着原型链进行查找，因此，对象在原型链存在的位置越深，查找起来越慢</p><p>因此我们要学会缓存对象成员的值，尽量避免在同一个函数中多次读取同一个实验对象</p><h4 id="DOM对象"><a href="#DOM对象" class="headerlink" title="DOM对象"></a>DOM对象</h4><p>DOM 是浏览器对象，是浏览器提供给JavaScript用于访问文档中的数据API,由于javascript和dom两个相互独立的功能只能通过接口彼此连接，因此会产生消耗。</p><p>我们每一次访问或者修改dom属性都会产生性能消耗，因此我们可以减少DOM的访问次数，把大部分的运算留在 ECMAScript 这一端</p><p><strong>innerHTML 和 DOM方法</strong></p><p>innerHTML相对来说要快一点，因为它在绝大部分浏览器中都运行的很快，但是对于大部分的日常操作而言，并没有太大区别，我们更应该根据可读性，稳定性，团队习惯和代码风格来综合决定使用哪种方式</p><p><strong>HTML集合</strong></p><ul><li>document.getELementsByName()</li><li>document.getELementsByClassName()</li><li>document.getELementsByTagName()</li><li>document.images</li><li>document.links</li><li>document.forms</li></ul><p>这些集合的长度会随着页面元素的变动而变动，所以我们不能简单的使用集合的长度来作为判断，我们可以把集合拷贝一个普通数组，在普通数组上进行操作</p><p>在方位内集合属性可以采用局部变量的方式存储集合元素的部分属性，避免多次重复读取，浪费性能</p><p><strong>重绘和重排</strong></p><p>引起重绘的方法：</p><ul><li>元素的颜色等非几何属性发生变化</li></ul><p>引起重排的方法：</p><ul><li>添加或者删除可见dom元素</li><li>元素的位置发生改变</li><li>元素的几何尺寸发生变化</li><li>内容发生改变</li><li>页面初始化</li><li>浏览器窗口改变<br>以上这些改变都会造成浏览器需要重新计算页面元素的位置，而重绘则不需要重新计算页面元素位置，重排一定会引起重绘，但是重绘不一定会引起重排</li></ul><p>我们在操作页面元素时，要尽量减少页面重绘及重排次数，每一次重排都需要大量的计算，消耗浏览器性能，可以将多次重绘重排整合成一次进行操作</p><ul><li>将页面元素变为不可见元素，在修改元素的属性，此时只需要发生两次重排</li><li>使用 文档碎片在DOM外创建子树再拷贝回文档</li><li>拷贝元素，修改副本，在替换原始元素</li></ul><p>浏览器尝试通过队列化修改和批量执行的方式最小化重排次数，当你查询布局信息时，比如偏移量，滚动位置，浏览器为了返回最新的值，会刷新队列并应用所有变更，因此我们可以设置局部变量用来存储布局信息，避免重复获取</p><p><strong>使用事件委托</strong></p><p>当页面存在大量需要一次或者多次绑定事件的元素，会占用更多的内存，我们可以事件委托，只需要在外层元素绑定一个处理器，就可以处理起子元素上的所有事件</p><h4 id="算法及流程控制"><a href="#算法及流程控制" class="headerlink" title="算法及流程控制"></a>算法及流程控制</h4><ul><li>减少迭代的工作量，对于常用且不便的数据进行缓存处理</li><li>减少迭代次数（达夫设备：循环展开技术，使得一次迭代中实际执行力多次迭代）</li><li>优化<code>if...else...</code>语句，最常用的判断放在最前面，这样可以减少对比次数</li><li>递归操作，根据情况缓存每一次递归操作的值</li><li>使用对象或者数组来缓存数据</li></ul><h4 id="快速响应的用户界面"><a href="#快速响应的用户界面" class="headerlink" title="快速响应的用户界面"></a>快速响应的用户界面</h4><ul><li>任何javascript任务都不应当执行超过 100 ms 过长的运行时间会导致UI更新出现明显的延迟，从而对用户的体验造成负面影响</li><li>使用定时器来安排代码的延迟执行，把长时间运行脚本分解成一系列的小任务</li><li>使用web worker 开启新的 javascript线程</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近读了一本关于如果写出性能更优的JavaScript的书，提取了一些相关的知识点&lt;/p&gt;
&lt;h4 id=&quot;JavaScript-文件加载及执行&quot;&gt;&lt;a href=&quot;#JavaScript-文件加载及执行&quot; class=&quot;headerlink&quot; title=&quot;JavaScr</summary>
      
    
    
    
    <category term="reading" scheme="https://lxx1997.github.io/categories/reading/"/>
    
    
    <category term="reading" scheme="https://lxx1997.github.io/tags/reading/"/>
    
  </entry>
  
  <entry>
    <title>服务端 渲染 - nextjs</title>
    <link href="https://lxx1997.github.io/2021/09/14/web/ssr-nextjs-01/"/>
    <id>https://lxx1997.github.io/2021/09/14/web/ssr-nextjs-01/</id>
    <published>2021-09-14T14:31:56.000Z</published>
    <updated>2021-09-14T14:31:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx create-next-app</span><br><span class="line"># or</span><br><span class="line">yarn create next-app</span><br></pre></td></tr></table></figure><p>如果想要添加特殊配置有以下选择</p><ul><li><code>--ts</code>，<code>--typescript</code> 使用TypeScript</li><li><code>-e</code>，<code>--example [name][github-url]</code>使用样例</li><li><code>--example-path</code></li><li><code>--use-npm</code></li></ul><h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><h4 id="页面路由-Router"><a href="#页面路由-Router" class="headerlink" title="页面路由 Router"></a>页面路由 Router</h4><p>nextjs 路由匹配规则</p><ul><li><p><code>/pages/example.js</code> | <code>/pages/example/index.js</code> 匹配路由 <code>/example</code></p></li><li><p><code>/pages/example/[id].js</code> 匹配路由 <code>/example/1</code></p></li><li><p><code>/pages/example/[...args].js</code> 匹配路由 <code>/example/1/2.../n</code></p></li><li><p><code>/pages/example/[[...args]].js</code> 匹配路由 <code>/example/.../n</code></p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /example/[id].js</span></span><br><span class="line"><span class="comment">// 路由为 /example/1</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&quot;next/dist/client/router&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Index</span> = (): <span class="variable constant_">JSX</span>.<span class="property">Element</span> =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> router = <span class="title function_">useRouter</span>()</span><br><span class="line">  <span class="keyword">const</span> query = router.<span class="property">query</span>  <span class="comment">// &#123;id: 1&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;初始化项目&quot;&gt;&lt;a href=&quot;#初始化项目&quot; class=&quot;headerlink&quot; title=&quot;初始化项目&quot;&gt;&lt;/a&gt;初始化项目&lt;/h2&gt;&lt;figure class=&quot;highlight cmd&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="SSR" scheme="https://lxx1997.github.io/tags/SSR/"/>
    
    <category term="nextJs" scheme="https://lxx1997.github.io/tags/nextJs/"/>
    
    <category term="React" scheme="https://lxx1997.github.io/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>threeJs 学习之路 - API 及 参数传递</title>
    <link href="https://lxx1997.github.io/2021/08/15/frame/threeJs-study-api/"/>
    <id>https://lxx1997.github.io/2021/08/15/frame/threeJs-study-api/</id>
    <published>2021-08-15T01:53:24.000Z</published>
    <updated>2023-03-15T03:48:08.305Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>THREE.Scene() 创建场景对象<br>方法</p><ul><li>add 添加物体，会被添加到坐标为 (0, 0, 0)的位置上</li></ul></li><li><p>THREE.PerspectiveCamera()</p><p>这个对象是 threeJs 中相机的其中一种 <em>透视摄像机</em><br>参数有四个</p><ul><li><strong>视野角度</strong> 表示在显示器上看到的场景的范围，值是一个角度（值会 mod 360）</li><li><strong>长宽比</strong> 长宽比的值会影响我们渲染物体的是否是正常的还是拉伸的，压扁的</li><li><strong>远剪切面</strong> </li><li><strong>近剪切面</strong> 物体所在的位置比摄像机的远剪切面远或者所在位置比近剪切面近的时候，该物体超出的部分将不会被渲染到场景中，根据我们渲染的物体的z轴的值和摄像机的z轴位置来决定的</li></ul></li></ul><ul><li><p>THREE.WebGLRenderer()</p><p>创建一个渲染器实例<br><strong>属性</strong></p><ul><li>domElement 渲染器生成的dom元素，通过 appendChild 方法插入到页面中</li><li>setSize(width, height, updateStyle) 第二个参数决定是否以较低的分辨率来渲染</li><li>render(scene, camera)  渲染场景和摄像机</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;p&gt;THREE.Scene() 创建场景对象&lt;br&gt;方法&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;add 添加物体，会被添加到坐标为 (0, 0, 0)的位置上&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;THREE.PerspectiveCamera()&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>threeJs 学习之路 - 创建画布及绘制图形</title>
    <link href="https://lxx1997.github.io/2021/08/15/frame/threeJs-study-01/"/>
    <id>https://lxx1997.github.io/2021/08/15/frame/threeJs-study-01/</id>
    <published>2021-08-15T01:38:18.000Z</published>
    <updated>2021-08-15T01:38:18.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>因为threeJs 版本在不断更新，所以本文可能部分 api 被替换，如果出现问题，请百度或者查找官方文档对应api</strong></p></blockquote><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><h4 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h4><p>引入的话可以采用 npm 引入 或者直接通过 CDN 方式引入</p><ul><li><p>npm 引入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install three</span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">THREE</span> = <span class="built_in">require</span>(<span class="string">&quot;three&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="variable constant_">THREE</span> <span class="keyword">from</span> <span class="string">&quot;three&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>CDN 方式引入</p><p><a href="https://www.bootcdn.cn/three.js/">CDN地址</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/three.js/r128/three.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="创建画布"><a href="#创建画布" class="headerlink" title="创建画布"></a>创建画布</h4>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建场景</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>()</span><br><span class="line"><span class="comment">// 创建一个摄像机</span></span><br><span class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">50</span>, <span class="variable language_">window</span>.<span class="property">innerWidth</span>/<span class="variable language_">window</span>.<span class="property">innerHeight</span>, <span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line"><span class="comment">// 实例化渲染器</span></span><br><span class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>()</span><br><span class="line"><span class="comment">// 设置渲染大小</span></span><br><span class="line">renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>)</span><br><span class="line">renderer.<span class="title function_">render</span>(scene, camera)</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>)</span><br></pre></td></tr></table></figure><p>  编写完上述代码后应该会出现一个黑色区域，这个就是threeJs创建的 canvas 画布</p><h4 id="绘制元素"><a href="#绘制元素" class="headerlink" title="绘制元素"></a>绘制元素</h4><h6 id="绘制一个正方体"><a href="#绘制一个正方体" class="headerlink" title="绘制一个正方体"></a>绘制一个正方体</h6><p>  创建一个立方体 需要一个 <code>BoxGeometry</code> 对象，这个对象包含了立方体所有的定点(vertices)和面(faces)</p><p>  然后对于这个立方体给一个材质，这里我们采用 <code>MeshBasicMaterial</code> 方法，并设置一个默认颜色</p><p>  接下来需要一个网格（Mesh），这个网格包含了 几何体及其材质的对象，然后通过 <code>Scene</code> 中的 <code>add</code> 方法添加到页面上，如果与摄像机重叠，还需要移动摄像机的位置</p><p>  最后通过 <code>WebGLRenderer</code> 的 render 方法渲染</p><p>  如果想要动起来，这个时候需要我们更改摄像机或者立方体的位置,并通过定时器函数，重新渲染</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>()</span><br><span class="line"><span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;<span class="attr">color</span>: <span class="number">0x00ff00</span>&#125;)</span><br><span class="line"><span class="keyword">let</span> cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material)</span><br><span class="line">camera.<span class="property">position</span>.<span class="property">z</span> = <span class="number">5</span></span><br><span class="line"><span class="comment">// scene 为之前创建的 THREE.Scene() 实例</span></span><br><span class="line">scene.<span class="title function_">add</span>(cube)</span><br><span class="line"><span class="comment">// renderer.render(scene, camera)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">requestAnimationFrame</span>(render)</span><br><span class="line">  <span class="comment">// 立方体旋转  旋转速度</span></span><br><span class="line">  cube.<span class="property">rotation</span>.<span class="property">x</span> += <span class="number">0.1</span></span><br><span class="line">  cube.<span class="property">rotation</span>.<span class="property">y</span> += <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修改摄像机的位置</span></span><br><span class="line">  <span class="comment">// camera.position.set(x, y, z) </span></span><br><span class="line">  renderer.<span class="title function_">render</span>(scene, camera)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">render</span>()</span><br></pre></td></tr></table></figure><h6 id="绘制线条"><a href="#绘制线条" class="headerlink" title="绘制线条"></a>绘制线条</h6><p>  对于绘制线条 我们可以选择的材质只有 <code>LineBasicMaterial</code> 和 <code>LineDashedMaterial</code></p><p>  定义好材质之后，我们需要一个带有定点的 <code>Geometry</code> 或者 <code>BufferGeometry</code></p><p>  然后通过 <code>THREE.Vector3(x, y, z)</code> 定义线条的顶点，线条是画在连续的顶点之间的<br>  最后 通过 <code>THREE.Line(geometry, material)</code> 将材质和顶点联系起来</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LineDashedMaterial 创建 虚线性的 线条</span></span><br><span class="line"><span class="comment">// LineBasicMaterial  创建 实线线条</span></span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineDashedMaterial</span>(&#123;<span class="attr">color</span>: <span class="number">0x0000ff</span>&#125;)</span><br><span class="line"><span class="keyword">const</span> points = []</span><br><span class="line"><span class="comment">// 创建 3d 线条的各个顶点</span></span><br><span class="line">points.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(-<span class="number">10</span>, <span class="number">0</span>, <span class="number">20</span>))</span><br><span class="line">points.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">20</span>))</span><br><span class="line">points.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">10</span>, <span class="number">0</span>, <span class="number">20</span>))</span><br><span class="line"><span class="comment">// 通过 setFromPoints 设置线条的顶点</span></span><br><span class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(points)</span><br><span class="line"><span class="comment">// 创建线条治理</span></span><br><span class="line"><span class="keyword">const</span> line = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geometry, material)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;因为threeJs 版本在不断更新，所以本文可能部分 api 被替换，如果出现问题，请百度或者查找官方文档对应api&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;初始化&quot;&gt;&lt;a href=&quot;#初始化&quot; cl</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="threeJs" scheme="https://lxx1997.github.io/tags/threeJs/"/>
    
    <category term="webgl" scheme="https://lxx1997.github.io/tags/webgl/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript 设计模式联系  -  创建型设计模式</title>
    <link href="https://lxx1997.github.io/2021/06/14/web/design-parttern-01/"/>
    <id>https://lxx1997.github.io/2021/06/14/web/design-parttern-01/</id>
    <published>2021-06-14T10:25:20.000Z</published>
    <updated>2021-06-14T10:25:20.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h4><blockquote><p>简单工厂模式(Simple Factory) 又叫静态工厂模式，由一个工厂对象决定创建摸一种产品对象类的实例</p></blockquote><blockquote><p>简单工厂模式的理念就是创建对象，提取多个类似需求中相同部分，针对不同的地方进行特殊处理</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">factory</span>(<span class="params">object</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Factory</span> = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line">  <span class="comment">// 相同的部分</span></span><br><span class="line">  <span class="title class_">Factory</span>.<span class="property">name</span> = object.<span class="property">name</span></span><br><span class="line">  <span class="title class_">Factory</span>.<span class="property">age</span> = object.<span class="property">name</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不同的部分</span></span><br><span class="line">  <span class="keyword">switch</span>(object.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;type1&#x27;</span>:</span><br><span class="line">      <span class="comment">// 特殊处理</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;type2&#x27;</span>:</span><br><span class="line">      <span class="comment">// 特殊处理</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Factory</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h4><blockquote><p>工厂方法模式(Factory Methods) 通过对产品类的抽象使其创建业务，主要负责用于创建多累产品的实例</p></blockquote><blockquote><p>工厂方法模式的本意是将时间创建对象工作推迟到了子类当中，这样核心类就成为了抽象类，在使用工厂方法模式时，需要使用安全策略来防止我们每次获取到的不是想要的对象</p></blockquote><h5 id="安全策略"><a href="#安全策略" class="headerlink" title="安全策略"></a>安全策略</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Factory</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Factory</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Factory</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过以上代码在实例化对象的时候判断一下是否是创建对象实例，如果不是则返回一个新的实例，以便能获取到预期的对象</p><h5 id="工厂方式模式代码"><a href="#工厂方式模式代码" class="headerlink" title="工厂方式模式代码"></a>工厂方式模式代码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Factory</span>(<span class="params">type, content</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Factory</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>[type](content)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Factory</span>(type, content)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Factory</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">Car</span> = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Factory</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">Pat</span> = &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Factory</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">Clothes</span> = &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h4><blockquote><p>抽象工厂模式(Abstract Factory) 通过对类的工厂抽象使其业务用于<strong>产品类簇</strong>的创建，而不是创建某一类产品的实例</p></blockquote><p>抽象类工厂其实是实现子类继承父类的方法，我们需要通过传递子类以及要继承父类的名称，并且在抽象工厂方法中增加一次对抽象类存在性的判断，如果存在，子类继承父类的方法。<br>子类继承了父类的所有的属性和方法，如果子类中没有方法或者属性覆盖父类方法，当调用的时候，会直接返回父类的属性和方法。</p><p>抽象类工厂的主要作用是，当子类调用了自己本身不存在且不需要的方法是，会给予提示</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Abstract</span>(<span class="params">child, parent</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="title class_">Abstract</span>[parent] === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 定义一个空的父类</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">    F.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Abstract</span>[parent]()</span><br><span class="line"></span><br><span class="line">    child.<span class="property">constructor</span> = child</span><br><span class="line">    child.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">F</span>()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;未找到改抽象类&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Abstract</span>.<span class="property">Car</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">type</span> = <span class="string">&#x27;car&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Abstract</span>.<span class="property">Car</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="attr">getName</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&#x27;抽象类方法无法调用&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">getPrice</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&#x27;抽象类方法无法调用&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Aodis</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&#x27;aodi&#x27;</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">price</span> = <span class="number">12312</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Abstract</span>(<span class="title class_">Aodis</span>, <span class="string">&#x27;Car&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Aodis</span>)</span><br><span class="line"><span class="title class_">Aodis</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> aodi = <span class="keyword">new</span> <span class="title class_">Aodis</span>()</span><br><span class="line"></span><br><span class="line">aodi.<span class="title function_">getName</span>()</span><br><span class="line">aodi.<span class="title function_">getPrice</span>()</span><br></pre></td></tr></table></figure><h5 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h5><blockquote><p>抽象类是一种声明了但是无法使用的类，当你调用抽象类的方法时就会报错，我们可以手动在类型的方法中进行错误提示</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Abstract</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="title class_">Abstract</span>.<span class="property"><span class="keyword">prototype</span></span> = &#123;</span><br><span class="line">  <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;抽象方法无法使用！！！&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">getPrice</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;抽象方法无法使用！！！&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当我们通过<strong>继承</strong>或者直接使用的方式来调用抽象类中方法时，会直接抛出错误</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;简单工厂模式&quot;&gt;&lt;a href=&quot;#简单工厂模式&quot; class=&quot;headerlink&quot; title=&quot;简单工厂模式&quot;&gt;&lt;/a&gt;简单工厂模式&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;简单工厂模式(Simple Factory) 又叫静态工厂模式，由一个工厂对象决定</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>记一次在面试过程中遇到的 promise 编程题</title>
    <link href="https://lxx1997.github.io/2021/04/01/interview/%E9%9D%A2%E8%AF%95-%E9%A2%98%E8%A7%A3/"/>
    <id>https://lxx1997.github.io/2021/04/01/interview/%E9%9D%A2%E8%AF%95-%E9%A2%98%E8%A7%A3/</id>
    <published>2021-04-01T08:25:13.000Z</published>
    <updated>2021-04-01T08:25:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>当时面试的时候遇到了这两个函数编程题，但是该死的是完全没有思路(悲伤)</p><ol><li><p>利用 Promise 完成一个队列，队列中的任务数满了的话，后续任务不执行，当队列中的任务有完成的状态，才会添加新的任务进入队列</p></li><li><p>利用 Promise 完成一个 retry 函数，传入一个执行函数和一个计数器，在一定次数范围内，如果函数执行失败的话会再次尝试执行该函数，直到执行成功</p></li></ol><p>面试结束之后，我上网上搜索了一下类似的问题，接下来是我总结之后的思路，以及最后成功的代码</p><h4 id="Promise-队列"><a href="#Promise-队列" class="headerlink" title="Promise 队列"></a>Promise 队列</h4><p>  这个问题有以下几个重点</p><ul><li>队列： 存放未执行的任务队列</li><li>计数器： 存放当前正在执行的任务数量</li><li>任务执行最大数量</li><li>添加任务函数</li><li><p>执行任务函数</p><p>接下根据我们上述描述的重点来创建一个任务队列执行类</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Scheduler</span> &#123;</span><br><span class="line">  <span class="comment">// 初始化任务队列，以及根据传入的数量来限制最大执行数量</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">maxCount</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">maxCount</span> = count</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">list</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span> = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下我们就要来编写添加函数了，在写添加函数之前我们首先思考一下这个添加函数里面应该注意那些东西</p><p>首先，如果我们想要在任务执行完成之后对执行结果操作的话，这个 add 函数必须返回一个 promise 函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">add</span>(<span class="params">task</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>添加一个任务的时候，我们需要把这个任务添加到未执行的任务队列的存放起来</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">add</span>(<span class="params">task</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(<span class="title function_">task</span>())</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个时候就出现了一个问题，我们应该怎样监控这个任务是否已经执行完成，这个时候 promise 的作用就来了，我们在 <code>then</code> 中就可以判断到函数是否执行成功</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">add</span>(<span class="params">task</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(<span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">task</span>()).<span class="title function_">then</span>())</span><br><span class="line">      <span class="comment">// 如果 task 执行之后的返回值是一个promise对象则可以修改成以下形式</span></span><br><span class="line">      <span class="comment">// this.list.push(task().then())</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>添加函数先写到这里，然后我们来写执行函数，在start函数中我们需要做的就是判断一下正在执行任务数是否小于最大执行数，然后从待执行队列中取出一个任务并执行，然后将正在执行的任务数加上1</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">count</span> &lt; <span class="variable language_">this</span>.<span class="property">maxCount</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">list</span>[<span class="number">0</span>] &amp;&amp; <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">shift</span>()()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来修改 add 函数 为当我们添加一个任务时，在最后执行一下执行函数，在执行任务完成之后，减少执行队列数，并触发执行函数，最后把任务的返回值 <code>return</code> 出来</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">add</span>(<span class="params">task</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">task</span>()).<span class="title function_">then</span>(<span class="function"><span class="params">s</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">count</span>--</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">start</span>()</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">start</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来实例化任务队列，并创建一个异步执行方法和一个添加任务函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> scheduler = <span class="keyword">new</span> <span class="title class_">Scheduler</span>(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">timeout</span> = (<span class="params">time</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, time)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> addTask = <span class="keyword">function</span> <span class="title function_">addTask</span>(<span class="params">time, order</span>) &#123;</span><br><span class="line">  scheduler.<span class="title function_">add</span>(<span class="function">() =&gt;</span> <span class="title function_">timeout</span>(time)).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(time, order)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Scheduler</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">count</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">list</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">maxCount</span> = count</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span> = <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">task</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">task</span>()).<span class="title function_">then</span>(<span class="function"><span class="params">s</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">count</span>--</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">start</span>()</span><br><span class="line">          <span class="keyword">return</span> s</span><br><span class="line">        &#125;))</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">start</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">count</span>)</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">count</span> &lt; <span class="variable language_">this</span>.<span class="property">maxCount</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>[<span class="number">0</span>] &amp;&amp; <span class="variable language_">this</span>.<span class="property">list</span>[<span class="number">0</span>]()</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">shift</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> scheduler = <span class="keyword">new</span> <span class="title class_">Scheduler</span>(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">timeout</span> = (<span class="params">time</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, time)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> addTask = <span class="keyword">function</span> <span class="title function_">addTask</span>(<span class="params">time, order</span>) &#123;</span><br><span class="line">  scheduler.<span class="title function_">add</span>(<span class="function">() =&gt;</span> <span class="title function_">timeout</span>(time)).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(time, order)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">addTask</span>(<span class="number">5000</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"><span class="title function_">addTask</span>(<span class="number">1100</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"><span class="title function_">addTask</span>(<span class="number">2200</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line"><span class="title function_">addTask</span>(<span class="number">3300</span>,<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line"><span class="title function_">addTask</span>(<span class="number">3300</span>,<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line"><span class="title function_">addTask</span>(<span class="number">3300</span>,<span class="string">&#x27;6&#x27;</span>)</span><br><span class="line"><span class="title function_">addTask</span>(<span class="number">3300</span>,<span class="string">&#x27;7&#x27;</span>)</span><br><span class="line"><span class="title function_">addTask</span>(<span class="number">2200</span>,<span class="string">&#x27;8&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="Promise-retry-函数"><a href="#Promise-retry-函数" class="headerlink" title="Promise retry 函数"></a>Promise retry 函数</h4></li></ul><p>function retry(fun, count) {<br>  if(count === 0) return<br>  let val = fun()<br>  if(val &gt; 3) {<br>    return val<br>  } else {<br>    return retry(fun, –count)<br>  }<br>}</p><p>function random() {<br>  return Math.random() * 5<br>}<br>console.log(retry(random, 5))</p><p>这个问题现在看起来挺简单的，但是当时估计相差了，思路都理解错了，难受</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;当时面试的时候遇到了这两个函数编程题，但是该死的是完全没有思路(悲伤)&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;利用 Promise 完成一个队列，队列中的任务数满了的话，后续任务不执行，当队列中的任务有完成的状态，才会添加新的任务进入队列&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;利用 </summary>
      
    
    
    
    
    <category term="interview" scheme="https://lxx1997.github.io/tags/interview/"/>
    
    <category term="promise" scheme="https://lxx1997.github.io/tags/promise/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript - 手写一个 Promise 方法</title>
    <link href="https://lxx1997.github.io/2021/03/18/web/js-promise/"/>
    <id>https://lxx1997.github.io/2021/03/18/web/js-promise/</id>
    <published>2021-03-18T05:15:52.000Z</published>
    <updated>2021-03-18T05:15:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>ES6新增了一个用于处理异步操作数据的一个原生API，能够解决回调地狱的产生</p><h4 id="常用的方法"><a href="#常用的方法" class="headerlink" title="常用的方法"></a>常用的方法</h4><ul><li>Promise.resolve()</li><li>Promise.reject()</li><li>Promise.then()</li><li>Promise.catch()</li><li>Promise.finally()</li><li>Promise.all()</li><li>Promise.race()</li><li>Promise.allSettled()</li><li>Promise.any()</li></ul><p>接下来我们来使用代码来实现这些操作</p><h4 id="实现Promise"><a href="#实现Promise" class="headerlink" title="实现Promise"></a>实现Promise</h4><p>  首先我们在创建 Promise 实例，会传入两个函数用来表示成功的回调以及失败的回调，然后我们可以设计 Promise 类中的内容大概是这个样子的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">PANDING</span> = <span class="string">&#x27;panding&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">FULFILLED</span> = <span class="string">&#x27;fulfilled&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;rejected&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Promise</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable constant_">PANDING</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">resolveVal</span> = <span class="literal">null</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rejectVal</span> = <span class="literal">null</span></span><br><span class="line">    <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">resolve</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>), <span class="variable language_">this</span>.<span class="property">reject</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> s = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="variable constant_">PANDING</span>) &#123;</span><br><span class="line">        s &amp;&amp; <span class="built_in">clearInterval</span>(s)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable constant_">FULFILLED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">resolveVal</span> = value || <span class="variable language_">this</span>.<span class="property">resolveVal</span></span><br><span class="line">    &#125;,<span class="number">4</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">reject</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> s = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="variable constant_">PANDING</span>) &#123;</span><br><span class="line">        s &amp;&amp; <span class="built_in">clearInterval</span>(s)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable constant_">REJECTED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rejectVal</span> = value || <span class="variable language_">this</span>.<span class="property">rejectVal</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就实现了一个简单的Promise方法，并且更改状态之后就不可以在修改状态了,并且用两个变量来接收<code>resolve</code>和<code>reject</code>两个方法传入的值</p><ul><li><code>Promise.then</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">then</span> = <span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="variable constant_">PANDING</span>) &#123;</span><br><span class="line">      s &amp;&amp; <span class="built_in">clearInterval</span>(s)</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> success = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">let</span> fail = <span class="literal">null</span></span><br><span class="line">        <span class="comment">// 判断 传入参数的类型并绑定this</span></span><br><span class="line">        <span class="keyword">typeof</span> resolve === <span class="string">&#x27;function&#x27;</span> &amp;&amp; (success = <span class="title function_">getReturn</span>(resolve.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">resolveVal</span>)))</span><br><span class="line">        <span class="keyword">typeof</span> reject === <span class="string">&#x27;function&#x27;</span> &amp;&amp; (fail = <span class="title function_">getReturn</span>(reject.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">rejectVal</span>)))</span><br><span class="line">        <span class="keyword">if</span>(success) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(success)</span><br><span class="line">        <span class="keyword">if</span>(fail) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(fail)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,<span class="number">4</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用 <code>then</code> 方法时判断一下传入的是否是函数，如果是函数就直接调用，并把成功的参数传入<br>最后的 <code>return this</code> 则是为了实现链式结构</p><ul><li><code>Promise.catch</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">catch</span> = <span class="keyword">function</span>(<span class="params">reject</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="variable constant_">PANDING</span>) &#123;</span><br><span class="line">      s &amp;&amp; <span class="built_in">clearInterval</span>(s)</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> fail = <span class="literal">null</span></span><br><span class="line">          <span class="keyword">typeof</span> reject === <span class="string">&#x27;function&#x27;</span> &amp;&amp; (fail = <span class="title function_">getReturn</span>(reject.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">rejectVal</span>)))</span><br><span class="line">          <span class="keyword">if</span>(fail) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(fail)</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,<span class="number">4</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>Promise.finally</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">finally</span> = <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="title function_">fn</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>Promise.resolve</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">resolve</span> = <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(value <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) <span class="keyword">return</span> value</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;<span class="title function_">resolve</span>(value)&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个稍微有些麻烦，我们需要判断传入的 <code>value</code> 是不是 <code>Promise</code> 类型的，如果是就可以直接返回，然后调用 <code>.then</code> 等方法，否则就需要我们创建一个 Promise 实例并返回</p><ul><li><code>Promise.reject</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">reject</span> = <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(value <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) <span class="keyword">return</span> value</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;<span class="title function_">reject</span>(value)&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是这里还有许多需要注意的地方，例如<code>Promise.then</code>中如果有 return 的话则需要以返回的状态和值为主，如果没有,就以上一次的状态和值为主<br>同时还需要对代码使用 <code>try...catch...</code> 进行容错处理，使得在 catch 中能够拿到错误信息</p><p>代码修改如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">then</span> = <span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> success = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> fail = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// 判断 传入参数的类型并绑定this</span></span><br><span class="line">    <span class="keyword">typeof</span> resolve === <span class="string">&#x27;function&#x27;</span> &amp;&amp; (success = <span class="title function_">getReturn</span>(resolve.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">resolveVal</span>)))</span><br><span class="line">    <span class="keyword">typeof</span> reject === <span class="string">&#x27;function&#x27;</span> &amp;&amp; (fail = <span class="title function_">getReturn</span>(reject.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">rejectVal</span>)))</span><br><span class="line">    <span class="keyword">if</span>(success) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(success)</span><br><span class="line">    <span class="keyword">if</span>(fail) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(fail)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getReturn</span>(<span class="params">val</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span>) <span class="keyword">return</span> <span class="title function_">val</span>()</span><br><span class="line">  <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="实现Promise高级语法"><a href="#实现Promise高级语法" class="headerlink" title="实现Promise高级语法"></a>实现Promise高级语法</h4><ul><li><code>Promise.all</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">all</span> = <span class="keyword">function</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(arr <span class="keyword">instanceof</span> <span class="title class_">Array</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> resolveVal = []</span><br><span class="line">        <span class="keyword">let</span> isReject = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">let</span> res = <span class="title function_">getReturn</span>(arr[i])</span><br><span class="line">          <span class="keyword">if</span>(res <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            res.<span class="title function_">then</span>(<span class="function"><span class="params">res1</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="comment">// 保证数组顺序返回正确</span></span><br><span class="line">              resolveVal[i] = res1</span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="title function_">reject</span>(err)</span><br><span class="line">              isReject = <span class="literal">true</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> resolveVal.<span class="title function_">push</span>(res)</span><br><span class="line">          <span class="keyword">if</span>(isReject) <span class="keyword">break</span></span><br><span class="line">        &#125; </span><br><span class="line">        <span class="title function_">resolve</span>(resolveVal)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Promise.all must receive Array&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">if</span>(error <span class="keyword">instanceof</span> <span class="title class_">Error</span>) <span class="keyword">throw</span> error</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>Promise.race</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">race</span> = <span class="keyword">function</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(arr <span class="keyword">instanceof</span> <span class="title class_">Array</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(arr.<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">resolve</span>()</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">let</span> res = <span class="title function_">getReturn</span>(arr[i])</span><br><span class="line">          <span class="keyword">if</span>(res <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            res.<span class="title function_">then</span>(<span class="function"><span class="params">res1</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span>(res1) &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(res)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span>(err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(res)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Promise.all must receive Array&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">if</span>(error <span class="keyword">instanceof</span> <span class="title class_">Error</span>) <span class="keyword">throw</span> error</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>promise.allSettled</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="property">allSettled</span> = <span class="keyword">function</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(arr <span class="keyword">instanceof</span> <span class="title class_">Array</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> resolveVal = []</span><br><span class="line">        <span class="keyword">let</span> length = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span>(arr.<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">resolve</span>([])</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">let</span> res = <span class="title function_">getReturn</span>(arr[i])</span><br><span class="line">          <span class="keyword">if</span>(res <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            res.<span class="title function_">then</span>(<span class="function"><span class="params">res1</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span>(res1) &#123;</span><br><span class="line">                resolveVal[i] = &#123;</span><br><span class="line">                  <span class="attr">status</span>: <span class="variable constant_">FULFILLED</span>,</span><br><span class="line">                  <span class="attr">value</span>: res1</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(++length === arr.<span class="property">length</span>) <span class="title function_">resolve</span>(resolveVal)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span>(err) &#123;</span><br><span class="line">                resolveVal[i] = &#123;</span><br><span class="line">                  <span class="attr">status</span>: <span class="variable constant_">REJECTED</span>,</span><br><span class="line">                  <span class="attr">value</span>: err</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(++length === arr.<span class="property">length</span>) <span class="title function_">resolve</span>(resolveVal)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resolveVal[i] = &#123;</span><br><span class="line">              <span class="attr">status</span>: <span class="variable constant_">FULFILLED</span>,</span><br><span class="line">              <span class="attr">value</span>: res</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(++length === arr.<span class="property">length</span>) <span class="title function_">resolve</span>(resolveVal)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Promise.all must receive Array&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">if</span>(error <span class="keyword">instanceof</span> <span class="title class_">Error</span>) <span class="keyword">throw</span> error</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这些代码中还是有很多的bug</p><h4 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">PANDING</span> = <span class="string">&#x27;panding&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">FULFILLED</span> = <span class="string">&#x27;fulfilled&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;rejected&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Promise</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable constant_">PANDING</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">resolveVal</span> = <span class="literal">null</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rejectVal</span> = <span class="literal">null</span></span><br><span class="line">    <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">resolve</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>), <span class="variable language_">this</span>.<span class="property">reject</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="variable constant_">PANDING</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable constant_">FULFILLED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">resolveVal</span> = value || <span class="variable language_">this</span>.<span class="property">resolveVal</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">reject</span>(<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="variable constant_">PANDING</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable constant_">REJECTED</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rejectVal</span> = value || <span class="variable language_">this</span>.<span class="property">rejectVal</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">resolve</span> = <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(value <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) <span class="keyword">return</span> value</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;<span class="title function_">resolve</span>(value)&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">reject</span> = <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(value <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) <span class="keyword">return</span> value</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;<span class="title function_">reject</span>(value)&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">all</span> = <span class="keyword">function</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(arr <span class="keyword">instanceof</span> <span class="title class_">Array</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> resolveVal = []</span><br><span class="line">        <span class="keyword">let</span> isReject = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">let</span> res = <span class="title function_">getReturn</span>(arr[i])</span><br><span class="line">          <span class="keyword">if</span>(res <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">              res.<span class="title function_">then</span>(<span class="function"><span class="params">res1</span> =&gt;</span> &#123;</span><br><span class="line">                resolveVal[i] = res1</span><br><span class="line">              &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">                isReject = <span class="literal">true</span></span><br><span class="line">              &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> resolveVal.<span class="title function_">push</span>(res)</span><br><span class="line">          <span class="keyword">if</span>(isReject) <span class="keyword">break</span></span><br><span class="line">        &#125; </span><br><span class="line">        <span class="title function_">resolve</span>(resolveVal)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Promise.all must receive Array&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">if</span>(error <span class="keyword">instanceof</span> <span class="title class_">Error</span>) <span class="keyword">throw</span> error</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">race</span> = <span class="keyword">function</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(arr <span class="keyword">instanceof</span> <span class="title class_">Array</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(arr.<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">resolve</span>()</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">let</span> res = <span class="title function_">getReturn</span>(arr[i])</span><br><span class="line">          <span class="keyword">if</span>(res <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            res.<span class="title function_">then</span>(<span class="function"><span class="params">res1</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span>(res1) &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(res)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span>(err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(res)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Promise.all must receive Array&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">if</span>(error <span class="keyword">instanceof</span> <span class="title class_">Error</span>) <span class="keyword">throw</span> error</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">allSettled</span> = <span class="keyword">function</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(arr <span class="keyword">instanceof</span> <span class="title class_">Array</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> resolveVal = []</span><br><span class="line">        <span class="keyword">let</span> length = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span>(arr.<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">resolve</span>([])</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          <span class="keyword">let</span> res = <span class="title function_">getReturn</span>(arr[i])</span><br><span class="line">          <span class="keyword">if</span>(res <span class="keyword">instanceof</span> <span class="title class_">Promise</span>) &#123;</span><br><span class="line">            res.<span class="title function_">then</span>(<span class="function"><span class="params">res1</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span>(res1) &#123;</span><br><span class="line">                resolveVal[i] = &#123;</span><br><span class="line">                  <span class="attr">status</span>: <span class="variable constant_">FULFILLED</span>,</span><br><span class="line">                  <span class="attr">value</span>: res1</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(++length === arr.<span class="property">length</span>) <span class="title function_">resolve</span>(resolveVal)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span>(err) &#123;</span><br><span class="line">                resolveVal[i] = &#123;</span><br><span class="line">                  <span class="attr">status</span>: <span class="variable constant_">REJECTED</span>,</span><br><span class="line">                  <span class="attr">value</span>: err</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(++length === arr.<span class="property">length</span>) <span class="title function_">resolve</span>(resolveVal)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resolveVal[i] = &#123;</span><br><span class="line">              <span class="attr">status</span>: <span class="variable constant_">FULFILLED</span>,</span><br><span class="line">              <span class="attr">value</span>: res</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(++length === arr.<span class="property">length</span>) <span class="title function_">resolve</span>(resolveVal)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Promise.all must receive Array&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">if</span>(error <span class="keyword">instanceof</span> <span class="title class_">Error</span>) <span class="keyword">throw</span> error</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">then</span> = <span class="keyword">function</span>(<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="variable constant_">PANDING</span>) &#123;</span><br><span class="line">      s &amp;&amp; <span class="built_in">clearInterval</span>(s)</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> success = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">let</span> fail = <span class="literal">null</span></span><br><span class="line">        <span class="comment">// 判断 传入参数的类型并绑定this</span></span><br><span class="line">        <span class="keyword">typeof</span> resolve === <span class="string">&#x27;function&#x27;</span> &amp;&amp; (success = <span class="title function_">getReturn</span>(resolve.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">resolveVal</span>)))</span><br><span class="line">        <span class="keyword">typeof</span> reject === <span class="string">&#x27;function&#x27;</span> &amp;&amp; (fail = <span class="title function_">getReturn</span>(reject.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">rejectVal</span>)))</span><br><span class="line">        <span class="keyword">if</span>(success) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(success)</span><br><span class="line">        <span class="keyword">if</span>(fail) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(fail)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,<span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">catch</span> = <span class="keyword">function</span>(<span class="params">reject</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> s = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">state</span> !== <span class="variable constant_">PANDING</span>) &#123;</span><br><span class="line">      s &amp;&amp; <span class="built_in">clearInterval</span>(s)</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">let</span> fail = <span class="literal">null</span></span><br><span class="line">          <span class="keyword">typeof</span> reject === <span class="string">&#x27;function&#x27;</span> &amp;&amp; (fail = <span class="title function_">getReturn</span>(reject.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">rejectVal</span>)))</span><br><span class="line">          <span class="keyword">if</span>(fail) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(fail)</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,<span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">finally</span> = <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="title function_">fn</span>()</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getReturn</span>(<span class="params">val</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> val === <span class="string">&#x27;function&#x27;</span>) <span class="keyword">return</span> <span class="title function_">val</span>()</span><br><span class="line">  <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ES6新增了一个用于处理异步操作数据的一个原生API，能够解决回调地狱的产生&lt;/p&gt;
&lt;h4 id=&quot;常用的方法&quot;&gt;&lt;a href=&quot;#常用的方法&quot; class=&quot;headerlink&quot; title=&quot;常用的方法&quot;&gt;&lt;/a&gt;常用的方法&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Promis</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>浅浅的剖析一下 Vue 的执行顺序</title>
    <link href="https://lxx1997.github.io/2021/02/08/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-implement/"/>
    <id>https://lxx1997.github.io/2021/02/08/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-implement/</id>
    <published>2021-02-08T03:02:00.000Z</published>
    <updated>2021-02-08T03:02:00.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="定义-Vue-构造函数"><a href="#定义-Vue-构造函数" class="headerlink" title="定义 Vue 构造函数"></a>定义 Vue 构造函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; initMixin &#125; <span class="keyword">from</span> <span class="string">&#x27;./init&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; stateMixin &#125; <span class="keyword">from</span> <span class="string">&#x27;./state&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; renderMixin &#125; <span class="keyword">from</span> <span class="string">&#x27;./render&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; eventsMixin &#125; <span class="keyword">from</span> <span class="string">&#x27;./events&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; lifecycleMixin &#125; <span class="keyword">from</span> <span class="string">&#x27;./lifecycle&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; warn &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Vue</span> (options) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class="line">    !(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Vue</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(<span class="string">&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_init</span>(options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">initMixin</span>(<span class="title class_">Vue</span>)</span><br><span class="line"><span class="title function_">stateMixin</span>(<span class="title class_">Vue</span>)</span><br><span class="line"><span class="title function_">eventsMixin</span>(<span class="title class_">Vue</span>) </span><br><span class="line"><span class="title function_">lifecycleMixin</span>(<span class="title class_">Vue</span>)</span><br><span class="line"><span class="title function_">renderMixin</span>(<span class="title class_">Vue</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vue</span></span><br></pre></td></tr></table></figure><p>定义了 一个 Vue 构造函数，这个构造函数传入的参数是 options，使用的时候通过 new 关键字来创建实例，然后调用了 <code>_init</code> 方法 根据传入的 <code>options</code> 配置来初始化 Vue 实例</p><h4 id="初始化-initMixin"><a href="#初始化-initMixin" class="headerlink" title="初始化 initMixin"></a>初始化 initMixin</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uid$<span class="number">3</span> = <span class="number">0</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_init</span> = <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>;</span><br><span class="line">  vm.<span class="property">_uid</span> = uid$<span class="number">3</span>++;</span><br><span class="line">  <span class="keyword">var</span> startTag, endTag;</span><br><span class="line">  <span class="comment">// 是否记录 性能</span></span><br><span class="line">  <span class="keyword">if</span> (config.<span class="property">performance</span> &amp;&amp; mark) &#123;</span><br><span class="line">    startTag = <span class="string">&quot;vue-perf-start:&quot;</span> + (vm.<span class="property">_uid</span>);</span><br><span class="line">    endTag = <span class="string">&quot;vue-perf-end:&quot;</span> + (vm.<span class="property">_uid</span>);</span><br><span class="line">    <span class="title function_">mark</span>(startTag);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  vm.<span class="property">_isVue</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (options &amp;&amp; options.<span class="property">_isComponent</span>) &#123;</span><br><span class="line">    <span class="title function_">initInternalComponent</span>(vm, options);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    vm.<span class="property">$options</span> = <span class="title function_">mergeOptions</span>(</span><br><span class="line">      <span class="title function_">resolveConstructorOptions</span>(vm.<span class="property">constructor</span>),</span><br><span class="line">      options || &#123;&#125;,</span><br><span class="line">      vm</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title function_">initProxy</span>(vm);</span><br><span class="line">  &#125;</span><br><span class="line">  vm.<span class="property">_self</span> = vm;</span><br><span class="line">  <span class="title function_">initLifecycle</span>(vm);</span><br><span class="line">  <span class="title function_">initEvents</span>(vm);</span><br><span class="line">  <span class="title function_">initRender</span>(vm);</span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeCreate&#x27;</span>);</span><br><span class="line">  <span class="title function_">initInjections</span>(vm); <span class="comment">// resolve injections before data/props</span></span><br><span class="line">  <span class="title function_">initState</span>(vm);</span><br><span class="line">  <span class="title function_">initProvide</span>(vm); <span class="comment">// resolve provide after data/props</span></span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;created&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (config.<span class="property">performance</span> &amp;&amp; mark) &#123;</span><br><span class="line">    vm.<span class="property">_name</span> = <span class="title function_">formatComponentName</span>(vm, <span class="literal">false</span>);</span><br><span class="line">    <span class="title function_">mark</span>(endTag);</span><br><span class="line">    <span class="title function_">measure</span>((<span class="string">&quot;vue &quot;</span> + (vm.<span class="property">_name</span>) + <span class="string">&quot; init&quot;</span>), startTag, endTag);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">$options</span>.<span class="property">el</span>) &#123;</span><br><span class="line">    vm.$mount(vm.<span class="property">$options</span>.<span class="property">el</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>通过上述代码，我们可以看到 Vue 在初始化的时候主要做了以下几件事</p><ul><li>创建 Vue 实例 唯一标识符 <code>_uid</code></li><li>根据 config 配置判断是否开启 性能监控 <code>performance</code></li><li>设置 Vue 标识符 <code>_isVue</code> 为 <code>true</code> 代表当前实例是 Vue 实例</li><li>通过 option 的 <code>_isComponents</code> 属性判断当前 Vue 实例是否是组件，如果是组件就调用 <code>initInternalComponent</code> 函数，不是组件就调用 <code>mergeOptions</code> 方法，并将返回的参数赋予 Vue 实例的 $options 属性</li><li>调用 <code>initProxy</code> 方法，判断 proxy 代理是否存在，如果存在，使用 proxy 对 Vue 实例进行响应式监控和代理</li><li>设置 Vue 的 _self 属性 为自身实例</li><li>调用 initLifecycle 函数 初始化生命周期</li><li>调用 initEvents 方法 初始化事件对象</li><li>调用 initRender 方法 初始化渲染使用的方法 <code>slot, scopedSlots, createElement, _c</code>方法，并对 <code>$attrs,$listeners</code> 方法进行进行数据响应式处理</li><li>调用 <code>beforeCreate</code> 生命周期，由于此时 还没有任何数据或者方法挂载到 Vue 实例上，所以 无法访问</li><li>调用 initInjections 方法 初始化 <code>inject</code> 属性</li><li>调用 initState 方法 初始化 <code>data,props,methods,computed,watch</code> 属性，设置数据响应式处理，及将属性挂载到 Vue 实例上</li><li>调用 initProvide 方法 初始化 <code>provide</code> 属性</li><li>调用 <code>created</code> 生命周期，此时可以访问到 <code>inject,data,props,methods,computed</code>上属性的值</li><li>调用 <code>$mount</code> 方法 获取 元素节点 <code>el</code></li><li>判断是否传入 <code>render</code> 函数，没有就初始化一个空 DOM 节点</li><li>调用 <code>beforeMount</code> 生命周期</li><li>设置 组件变化的监听方法，监听组件是否更新</li><li>设置 Vue 实例挂载状态为 true</li><li>调用 <code>mounted</code> 生命周期</li></ul><h4 id="stateMixin"><a href="#stateMixin" class="headerlink" title="stateMixin"></a>stateMixin</h4><p>该函数主要针对 实例 <code>$data</code>, <code>$props</code> 进行数据响应式处理，不允许更新<br>并且初始化实例 <code>$set</code>, <code>$delete</code>, <code>$watch</code>(并返回一个 撤销监听的方法)</p><h4 id="eventMixin"><a href="#eventMixin" class="headerlink" title="eventMixin"></a>eventMixin</h4><p>初始化事件方法  <code>$once</code>, <code>$on</code>, <code>$off</code>, <code>$emit</code></p><h4 id="lifecycleMixin"><a href="#lifecycleMixin" class="headerlink" title="lifecycleMixin"></a>lifecycleMixin</h4><p>初始化 <code>_update</code>, <code>forceUpdate</code>, <code>destory</code></p><p>当组件发生更新操作或者卸载的时候会触发这些生命周期<br><code>beforeUpdate</code>,  <code>updated</code>,  <code>beforeDestory</code>,  <code>destoryed</code></p><h4 id="renderMixin"><a href="#renderMixin" class="headerlink" title="renderMixin"></a>renderMixin</h4><p>在这个函数中 首先通过 installRenderHelpers 方法在 Vue 实例上注册了 协助渲染的函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">installRenderHelpers</span> (target) &#123;</span><br><span class="line">  target.<span class="property">_o</span> = markOnce;   <span class="comment">// 定义静态节点 只渲染一次, v-once 指令</span></span><br><span class="line">  target.<span class="property">_n</span> = toNumber;   <span class="comment">// 转化为整型</span></span><br><span class="line">  target.<span class="property">_s</span> = toString;   <span class="comment">// 字符串转化</span></span><br><span class="line">  target.<span class="property">_l</span> = renderList; <span class="comment">// 渲染 v-for 循环</span></span><br><span class="line">  target.<span class="property">_t</span> = renderSlot; <span class="comment">// 渲染 slot</span></span><br><span class="line">  target.<span class="property">_q</span> = looseEqual; <span class="comment">// 判断 对象是否相等</span></span><br><span class="line">  target.<span class="property">_i</span> = looseIndexOf;   <span class="comment">// 获取 元素 在 数组中的位置</span></span><br><span class="line">  target.<span class="property">_m</span> = renderStatic;   <span class="comment">// 定义静态节点 只渲染一次, v-once 指令</span></span><br><span class="line">  target.<span class="property">_f</span> = resolveFilter;  <span class="comment">// 调用 filter 方法</span></span><br><span class="line">  target.<span class="property">_k</span> = checkKeyCodes;  <span class="comment">// 检查键盘事件</span></span><br><span class="line">  target.<span class="property">_b</span> = bindObjectProps;  <span class="comment">// 读取 元素的 attr 属性绑定到 props 上面</span></span><br><span class="line">  target.<span class="property">_v</span> = createTextVNode;  <span class="comment">// 创建 文本node 节点</span></span><br><span class="line">  target.<span class="property">_e</span> = createEmptyVNode; <span class="comment">// 创建空节点</span></span><br><span class="line">  target.<span class="property">_u</span> = resolveScopedSlots;   <span class="comment">// 渲染 ScopedSlot</span></span><br><span class="line">  target.<span class="property">_g</span> = bindObjectListeners;  <span class="comment">// 绑定事件函数到 on 方法上去</span></span><br><span class="line">  target.<span class="property">_d</span> = bindDynamicKeys;  <span class="comment">// 渲染传入 变量 的 attrs 属性</span></span><br><span class="line">  target.<span class="property">_p</span> = prependModifier;  <span class="comment">// 设置前置修饰符</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后初始化 <code>$nextTick</code> <code>_render</code></p><h4 id="解析-dom-元素并渲染-patch"><a href="#解析-dom-元素并渲染-patch" class="headerlink" title="解析 dom 元素并渲染(patch)"></a>解析 dom 元素并渲染(patch)</h4><p>Vue 再渲染 DOM 的时候即 <code>mountComponent</code> 方法中 会调用 <code>_update</code> 方法，并将 Vue 的 <code>_render</code> 函数的返回值 (一个 VNode 对象) 作为参数传入,第二个参数 <code>hydrating</code> 为 undefined</p><p>然后在 _update 方法中 通过 <code>__patch__</code> 即 <code>patch/createPatchFunction</code> 方法渲染页面</p><p>我们来看一下 <code>patch</code> 方法做了哪些东西</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  vm.$el, vnode</span></span><br><span class="line"><span class="keyword">var</span> patch = <span class="title function_">createPatchFunction</span>(&#123; <span class="attr">nodeOps</span>: nodeOps, <span class="attr">modules</span>: modules &#125;)</span><br></pre></td></tr></table></figure><ul><li>首先创造了 几个生命周期<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hooks = [<span class="string">&#x27;create&#x27;</span>, <span class="string">&#x27;activate&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;remove&#x27;</span>, <span class="string">&#x27;destroy&#x27;</span>];</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;定义-Vue-构造函数&quot;&gt;&lt;a href=&quot;#定义-Vue-构造函数&quot; class=&quot;headerlink&quot; title=&quot;定义 Vue 构造函数&quot;&gt;&lt;/a&gt;定义 Vue 构造函数&lt;/h4&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/categories/SourceCode/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/tags/SourceCode/"/>
    
  </entry>
  
  <entry>
    <title>跟着 Vue源码学习 Vue api 系列 (八) - 指令</title>
    <link href="https://lxx1997.github.io/2021/02/01/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-08/"/>
    <id>https://lxx1997.github.io/2021/02/01/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-08/</id>
    <published>2021-02-01T09:29:54.000Z</published>
    <updated>2021-02-01T09:29:54.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="内置指令"><a href="#内置指令" class="headerlink" title="内置指令"></a>内置指令</h4><p>Vue 内置了以下几种指令</p><ul><li>v-text</li><li>v-html</li><li>v-show</li><li>v-if</li><li>v-else</li><li>v-else-if</li><li>v-for</li><li>v-on</li><li>v-bind</li><li>v-model</li><li>v-slot</li><li>v-pre</li><li>v-cloak</li><li>v-once</li></ul><p>在源码中分为以下几种</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// v-html v-text v-model</span></span><br><span class="line"><span class="keyword">var</span> directives$<span class="number">1</span> = &#123;</span><br><span class="line">  <span class="attr">model</span>: model,</span><br><span class="line">  <span class="attr">text</span>: text,</span><br><span class="line">  <span class="attr">html</span>: html</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// v-on v-bind v-clock</span></span><br><span class="line"><span class="keyword">var</span> baseDirectives = &#123;</span><br><span class="line">  <span class="attr">on</span>: on,</span><br><span class="line">  <span class="attr">bind</span>: bind$<span class="number">1</span>,</span><br><span class="line">  <span class="attr">cloak</span>: noop</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// v-if v-else v-else-if</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processIf</span> (el) &#123;</span><br><span class="line">  <span class="keyword">var</span> exp = <span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;v-if&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (exp) &#123;</span><br><span class="line">    el.<span class="property">if</span> = exp;</span><br><span class="line">    <span class="title function_">addIfCondition</span>(el, &#123;</span><br><span class="line">      <span class="attr">exp</span>: exp,</span><br><span class="line">      <span class="attr">block</span>: el</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;v-else&#x27;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">      el.<span class="property">else</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> elseif = <span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;v-else-if&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (elseif) &#123;</span><br><span class="line">      el.<span class="property">elseif</span> = elseif;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// v-pre</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processPre</span> (el) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;v-pre&#x27;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">    el.<span class="property">pre</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// v-for v-slot</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processFor</span> (el) &#123;</span><br><span class="line">  <span class="keyword">var</span> exp;</span><br><span class="line">  <span class="keyword">if</span> ((exp = <span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;v-for&#x27;</span>))) &#123;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="title function_">parseFor</span>(exp);</span><br><span class="line">    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">      <span class="title function_">extend</span>(el, res);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">warn$2</span>(</span><br><span class="line">        (<span class="string">&quot;Invalid v-for expression: &quot;</span> + exp),</span><br><span class="line">        el.<span class="property">rawAttrsMap</span>[<span class="string">&#x27;v-for&#x27;</span>]</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// v-slot</span></span><br><span class="line"><span class="keyword">var</span> slotBinding = <span class="title function_">getAndRemoveAttrByRegex</span>(el, slotRE);</span><br><span class="line"><span class="comment">// v-once</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processOnce</span> (el) &#123;</span><br><span class="line">  <span class="keyword">var</span> once$$1 = <span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;v-once&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (once$$1 != <span class="literal">null</span>) &#123;</span><br><span class="line">    el.<span class="property">once</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// v-show</span></span><br><span class="line"><span class="keyword">if</span> (child.<span class="property">data</span>.<span class="property">directives</span> &amp;&amp; child.<span class="property">data</span>.<span class="property">directives</span>.<span class="title function_">some</span>(isVShowDirective)) &#123;</span><br><span class="line">  child.<span class="property">data</span>.<span class="property">show</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="v-text-v-html"><a href="#v-text-v-html" class="headerlink" title="v-text / v-html"></a>v-text / v-html</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dir 为 directive 中的 binding 属性</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  arg: null</span></span><br><span class="line"><span class="comment">  end: 18</span></span><br><span class="line"><span class="comment">  isDynamicArg: false</span></span><br><span class="line"><span class="comment">  modifiers: undefined</span></span><br><span class="line"><span class="comment">  name: &quot;text&quot;</span></span><br><span class="line"><span class="comment">  rawName: &quot;v-text&quot;</span></span><br><span class="line"><span class="comment">  start: 5</span></span><br><span class="line"><span class="comment">  value: &quot;text&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">text</span> (el, dir) &#123;</span><br><span class="line">  <span class="keyword">if</span> (dir.<span class="property">value</span>) &#123;</span><br><span class="line">    <span class="title function_">addProp</span>(el, <span class="string">&#x27;textContent&#x27;</span>, (<span class="string">&quot;_s(&quot;</span> + (dir.<span class="property">value</span>) + <span class="string">&quot;)&quot;</span>), dir);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">html</span> (el, dir) &#123;</span><br><span class="line">  <span class="keyword">if</span> (dir.<span class="property">value</span>) &#123;</span><br><span class="line">    <span class="title function_">addProp</span>(el, <span class="string">&#x27;innerHTML&#x27;</span>, (<span class="string">&quot;_s(&quot;</span> + (dir.<span class="property">value</span>) + <span class="string">&quot;)&quot;</span>), dir);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// addProp (当前元素实例, &#x27;textContent&#x27;, &#x27;_s(dir.value)&#x27;, dir, null)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addProp</span> (el, name, value, range, dynamic) &#123;</span><br><span class="line">  (el.<span class="property">props</span> || (el.<span class="property">props</span> = [])).<span class="title function_">push</span>(<span class="title function_">rangeSetItem</span>(&#123; <span class="attr">name</span>: name, <span class="attr">value</span>: value, <span class="attr">dynamic</span>: dynamic &#125;, range));</span><br><span class="line">  el.<span class="property">plain</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// rangeSetItem</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">rangeSetItem</span> (item, range) &#123;</span><br><span class="line">  <span class="keyword">if</span> (range) &#123;</span><br><span class="line">    <span class="keyword">if</span> (range.<span class="property">start</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">      item.<span class="property">start</span> = range.<span class="property">start</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (range.<span class="property">end</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">      item.<span class="property">end</span> = range.<span class="property">end</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> item</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <code>v-text</code> 指令在 <code>processAttrs</code> 函数中 通过 <code>addDirective</code> 方法 添加一个 <code>directive</code> 属性，然后 通过 <code>updateDOMProps</code> 方法中的 <code>elm[key] = cur</code> 为 元素的 <code>textContent</code> 或者 <code>innerHTML</code> 属性赋值</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-text</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意：如果 v-text/v-html 指令所在的元素下的子元素，则不会被渲染</p><h4 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">model</span> (el, dir, _warn) &#123;</span><br><span class="line">  warn$<span class="number">1</span> = _warn;</span><br><span class="line">  <span class="keyword">var</span> value = dir.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">var</span> modifiers = dir.<span class="property">modifiers</span>;</span><br><span class="line">  <span class="keyword">var</span> tag = el.<span class="property">tag</span>;</span><br><span class="line">  <span class="keyword">var</span> type = el.<span class="property">attrsMap</span>.<span class="property">type</span>;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// inputs with type=&quot;file&quot; are read only and setting the input&#x27;s</span></span><br><span class="line">    <span class="comment">// value will throw an error.</span></span><br><span class="line">    <span class="keyword">if</span> (tag === <span class="string">&#x27;input&#x27;</span> &amp;&amp; type === <span class="string">&#x27;file&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">warn$1</span>(</span><br><span class="line">        <span class="string">&quot;&lt;&quot;</span> + (el.<span class="property">tag</span>) + <span class="string">&quot; v-model=\&quot;&quot;</span> + value + <span class="string">&quot;\&quot; type=\&quot;file\&quot;&gt;:\n&quot;</span> +</span><br><span class="line">        <span class="string">&quot;File inputs are read only. Use a v-on:change listener instead.&quot;</span>,</span><br><span class="line">        el.<span class="property">rawAttrsMap</span>[<span class="string">&#x27;v-model&#x27;</span>]</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (el.<span class="property">component</span>) &#123;</span><br><span class="line">    <span class="title function_">genComponentModel</span>(el, value, modifiers);</span><br><span class="line">    <span class="comment">// component v-model doesn&#x27;t need extra runtime</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag === <span class="string">&#x27;select&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">genSelect</span>(el, value, modifiers);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag === <span class="string">&#x27;input&#x27;</span> &amp;&amp; type === <span class="string">&#x27;checkbox&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">genCheckboxModel</span>(el, value, modifiers);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag === <span class="string">&#x27;input&#x27;</span> &amp;&amp; type === <span class="string">&#x27;radio&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">genRadioModel</span>(el, value, modifiers);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag === <span class="string">&#x27;input&#x27;</span> || tag === <span class="string">&#x27;textarea&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">genDefaultModel</span>(el, value, modifiers);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!config.<span class="title function_">isReservedTag</span>(tag)) &#123;</span><br><span class="line">    <span class="title function_">genComponentModel</span>(el, value, modifiers);</span><br><span class="line">    <span class="comment">// component v-model doesn&#x27;t need extra runtime</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">warn$1</span>(</span><br><span class="line">      <span class="string">&quot;&lt;&quot;</span> + (el.<span class="property">tag</span>) + <span class="string">&quot; v-model=\&quot;&quot;</span> + value + <span class="string">&quot;\&quot;&gt;: &quot;</span> +</span><br><span class="line">      <span class="string">&quot;v-model is not supported on this element type. &quot;</span> +</span><br><span class="line">      <span class="string">&#x27;If you are working with contenteditable, it\&#x27;s recommended to &#x27;</span> +</span><br><span class="line">      <span class="string">&#x27;wrap a library dedicated for that purpose inside a custom component.&#x27;</span>,</span><br><span class="line">      el.<span class="property">rawAttrsMap</span>[<span class="string">&#x27;v-model&#x27;</span>]</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ensure runtime directive metadata</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  v-model 指令主要针对于 input 输入框 及textarea 等需要输入或者状态变更的元素，<code>v-model</code> 相当于 <code>v-bind:value + v-on:change</code> 的组合体，在其他组件上不能使用 v-model</p><h4 id="v-show"><a href="#v-show" class="headerlink" title="v-show"></a>v-show</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ref</span></span><br><span class="line"><span class="comment">// def: &#123;bind: ƒ, update: ƒ, unbind: ƒ&#125;</span></span><br><span class="line"><span class="comment">// expression: &quot;true&quot;</span></span><br><span class="line"><span class="comment">// modifiers: &#123;&#125;</span></span><br><span class="line"><span class="comment">// name: &quot;show&quot;</span></span><br><span class="line"><span class="comment">// rawName: &quot;v-show&quot;</span></span><br><span class="line"><span class="comment">// value: true</span></span><br><span class="line"><span class="attr">bind</span>: <span class="keyword">function</span> <span class="title function_">bind</span> (el, ref, vnode) &#123;</span><br><span class="line">  <span class="keyword">var</span> value = ref.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">  vnode = <span class="title function_">locateNode</span>(vnode);</span><br><span class="line">  <span class="keyword">var</span> transition$$1 = vnode.<span class="property">data</span> &amp;&amp; vnode.<span class="property">data</span>.<span class="property">transition</span>;</span><br><span class="line">  <span class="keyword">var</span> originalDisplay = el.<span class="property">__vOriginalDisplay</span> =</span><br><span class="line">    el.<span class="property">style</span>.<span class="property">display</span> === <span class="string">&#x27;none&#x27;</span> ? <span class="string">&#x27;&#x27;</span> : el.<span class="property">style</span>.<span class="property">display</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(ref,value, transition$$1)</span><br><span class="line">  <span class="keyword">if</span> (value &amp;&amp; transition$$1) &#123;</span><br><span class="line">    vnode.<span class="property">data</span>.<span class="property">show</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title function_">enter</span>(vnode, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      el.<span class="property">style</span>.<span class="property">display</span> = originalDisplay;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    el.<span class="property">style</span>.<span class="property">display</span> = value ? originalDisplay : <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>取 <code>ref.value</code> 如果 <code>v-show=&quot;false&quot;</code> 则 <code>ref.value</code> 为 false 将 元素的display 属性设置为 null</p><h4 id="v-if-v-else-v-else-if"><a href="#v-if-v-else-v-else-if" class="headerlink" title="v-if/v-else/v-else-if"></a>v-if/v-else/v-else-if</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断当前元素是否有 v-if，v-else， v-else-if 指令</span></span><br><span class="line"><span class="comment">// 并将元素上的if,else,elseif 属性置为对应状态</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processIf</span> (el) &#123;</span><br><span class="line">  <span class="keyword">var</span> exp = <span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;v-if&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (exp) &#123;</span><br><span class="line">    el.<span class="property">if</span> = exp;</span><br><span class="line">    <span class="title function_">addIfCondition</span>(el, &#123;</span><br><span class="line">      <span class="attr">exp</span>: exp,</span><br><span class="line">      <span class="attr">block</span>: el</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;v-else&#x27;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">      el.<span class="property">else</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> elseif = <span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;v-else-if&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (elseif) &#123;</span><br><span class="line">      el.<span class="property">elseif</span> = elseif;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 addIfCondition 方法将 v-if 所在的元素放入 ifConditions 数组中</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addIfCondition</span> (el, condition) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!el.<span class="property">ifConditions</span>) &#123;</span><br><span class="line">    el.<span class="property">ifConditions</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  el.<span class="property">ifConditions</span>.<span class="title function_">push</span>(condition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// markStatic$1</span></span><br><span class="line"><span class="keyword">if</span> (node.<span class="property">ifConditions</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i$<span class="number">1</span> = <span class="number">1</span>, l$<span class="number">1</span> = node.<span class="property">ifConditions</span>.<span class="property">length</span>; i$<span class="number">1</span> &lt; l$<span class="number">1</span>; i$<span class="number">1</span>++) &#123;</span><br><span class="line">    <span class="keyword">var</span> block = node.<span class="property">ifConditions</span>[i$<span class="number">1</span>].<span class="property">block</span>;</span><br><span class="line">    <span class="title function_">markStatic$1</span>(block);</span><br><span class="line">    <span class="keyword">if</span> (!block.<span class="property">static</span>) &#123;</span><br><span class="line">      node.<span class="property">static</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// genIfConditions  转换 IfConditions 中的元素</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genIfConditions</span> (</span><br><span class="line">  conditions,</span><br><span class="line">  state,</span><br><span class="line">  altGen,</span><br><span class="line">  altEmpty</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!conditions.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> altEmpty || <span class="string">&#x27;_e()&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> condition = conditions.<span class="title function_">shift</span>();</span><br><span class="line">  <span class="keyword">if</span> (condition.<span class="property">exp</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">&quot;(&quot;</span> + (condition.<span class="property">exp</span>) + <span class="string">&quot;)?&quot;</span> + (<span class="title function_">genTernaryExp</span>(condition.<span class="property">block</span>)) + <span class="string">&quot;:&quot;</span> + (<span class="title function_">genIfConditions</span>(conditions, state, altGen, altEmpty)))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">&quot;&quot;</span> + (<span class="title function_">genTernaryExp</span>(condition.<span class="property">block</span>)))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// v-if with v-once should generate code like (a)?_m(0):_m(1)</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">genTernaryExp</span> (el) &#123;</span><br><span class="line">    <span class="keyword">return</span> altGen</span><br><span class="line">      ? <span class="title function_">altGen</span>(el, state)</span><br><span class="line">      : el.<span class="property">once</span></span><br><span class="line">        ? <span class="title function_">genOnce</span>(el, state)</span><br><span class="line">        : <span class="title function_">genElement</span>(el, state)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>v-for</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断是否含有 v-for 指令 然后通过 extend 方法将 parseFor 转出的参数扩展到 元素上</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processFor</span> (el) &#123;</span><br><span class="line">  <span class="keyword">var</span> exp;</span><br><span class="line">  <span class="keyword">if</span> ((exp = <span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;v-for&#x27;</span>))) &#123;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="title function_">parseFor</span>(exp);</span><br><span class="line">    <span class="keyword">if</span> (res) &#123;</span><br><span class="line">      <span class="title function_">extend</span>(el, res);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">warn$2</span>(</span><br><span class="line">        (<span class="string">&quot;Invalid v-for expression: &quot;</span> + exp),</span><br><span class="line">        el.<span class="property">rawAttrsMap</span>[<span class="string">&#x27;v-for&#x27;</span>]</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断 for 循环</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseFor</span> (exp) &#123;</span><br><span class="line">  <span class="comment">// 正则表达式匹配，循环数组是否正确 [exp, item, 10]</span></span><br><span class="line">  <span class="keyword">var</span> inMatch = exp.<span class="title function_">match</span>(forAliasRE);</span><br><span class="line">  <span class="keyword">if</span> (!inMatch) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> res = &#123;&#125;;</span><br><span class="line">  res.<span class="property">for</span> = inMatch[<span class="number">2</span>].<span class="title function_">trim</span>();</span><br><span class="line">  <span class="comment">// 针对 v-for=&quot;(item,index) in array&quot; 进行处理 去除 item / item,index</span></span><br><span class="line">  <span class="keyword">var</span> alias = inMatch[<span class="number">1</span>].<span class="title function_">trim</span>().<span class="title function_">replace</span>(stripParensRE, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="comment">// 针对(item,index) in array 去除 , index</span></span><br><span class="line">  <span class="keyword">var</span> iteratorMatch = alias.<span class="title function_">match</span>(forIteratorRE);</span><br><span class="line">  <span class="keyword">if</span> (iteratorMatch) &#123;</span><br><span class="line">    res.<span class="property">alias</span> = alias.<span class="title function_">replace</span>(forIteratorRE, <span class="string">&#x27;&#x27;</span>).<span class="title function_">trim</span>();</span><br><span class="line">    res.<span class="property">iterator1</span> = iteratorMatch[<span class="number">1</span>].<span class="title function_">trim</span>();</span><br><span class="line">    <span class="keyword">if</span> (iteratorMatch[<span class="number">2</span>]) &#123;</span><br><span class="line">      res.<span class="property">iterator2</span> = iteratorMatch[<span class="number">2</span>].<span class="title function_">trim</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="property">alias</span> = alias;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// alias 对象别名 可以通过 alias 访问遍历数组的元素</span></span><br><span class="line">  <span class="comment">// iterator1 遍历时第二个参数</span></span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// genFor 获取与 v-for 指令相关参数，调用 renderList 方法渲染数组</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genFor</span> (</span><br><span class="line">  el,</span><br><span class="line">  state,</span><br><span class="line">  altGen,</span><br><span class="line">  altHelper</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">var</span> exp = el.<span class="property">for</span>;</span><br><span class="line">  <span class="keyword">var</span> alias = el.<span class="property">alias</span>;</span><br><span class="line">  <span class="keyword">var</span> iterator1 = el.<span class="property">iterator1</span> ? (<span class="string">&quot;,&quot;</span> + (el.<span class="property">iterator1</span>)) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> iterator2 = el.<span class="property">iterator2</span> ? (<span class="string">&quot;,&quot;</span> + (el.<span class="property">iterator2</span>)) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (state.<span class="title function_">maybeComponent</span>(el) &amp;&amp;</span><br><span class="line">    el.<span class="property">tag</span> !== <span class="string">&#x27;slot&#x27;</span> &amp;&amp;</span><br><span class="line">    el.<span class="property">tag</span> !== <span class="string">&#x27;template&#x27;</span> &amp;&amp;</span><br><span class="line">    !el.<span class="property">key</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    state.<span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">&quot;&lt;&quot;</span> + (el.<span class="property">tag</span>) + <span class="string">&quot; v-for=\&quot;&quot;</span> + alias + <span class="string">&quot; in &quot;</span> + exp + <span class="string">&quot;\&quot;&gt;: component lists rendered with &quot;</span> +</span><br><span class="line">      <span class="string">&quot;v-for should have explicit keys. &quot;</span> +</span><br><span class="line">      <span class="string">&quot;See https://vuejs.org/guide/list.html#key for more info.&quot;</span>,</span><br><span class="line">      el.<span class="property">rawAttrsMap</span>[<span class="string">&#x27;v-for&#x27;</span>],</span><br><span class="line">      <span class="literal">true</span> <span class="comment">/* tip */</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  el.<span class="property">forProcessed</span> = <span class="literal">true</span>; <span class="comment">// avoid recursion</span></span><br><span class="line">  <span class="comment">// 调用 renderList 方法 传入渲染函数</span></span><br><span class="line">  <span class="keyword">return</span> (altHelper || <span class="string">&#x27;_l&#x27;</span>) + <span class="string">&quot;((&quot;</span> + exp + <span class="string">&quot;),&quot;</span> +</span><br><span class="line">    <span class="string">&quot;function(&quot;</span> + alias + iterator1 + iterator2 + <span class="string">&quot;)&#123;&quot;</span> +</span><br><span class="line">      <span class="string">&quot;return &quot;</span> + ((altGen || genElement)(el, state)) +</span><br><span class="line">    <span class="string">&#x27;&#125;)&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// rederList</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderList</span> (</span><br><span class="line">  val,</span><br><span class="line">  render</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">var</span> ret, i, l, keys, key;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(val) || <span class="keyword">typeof</span> val === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    ret = <span class="keyword">new</span> <span class="title class_">Array</span>(val.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, l = val.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">      ret[i] = <span class="title function_">render</span>(val[i], i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> val === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    ret = <span class="keyword">new</span> <span class="title class_">Array</span>(val);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; val; i++) &#123;</span><br><span class="line">      ret[i] = <span class="title function_">render</span>(i + <span class="number">1</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isObject</span>(val)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (hasSymbol &amp;&amp; val[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]) &#123;</span><br><span class="line">      ret = [];</span><br><span class="line">      <span class="comment">// 利用 Symbol.iterator 方法 循环 对象val</span></span><br><span class="line">      <span class="keyword">var</span> iterator = val[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line">      <span class="keyword">var</span> result = iterator.<span class="title function_">next</span>();</span><br><span class="line">      <span class="keyword">while</span> (!result.<span class="property">done</span>) &#123;</span><br><span class="line">        ret.<span class="title function_">push</span>(<span class="title function_">render</span>(result.<span class="property">value</span>, ret.<span class="property">length</span>));</span><br><span class="line">        result = iterator.<span class="title function_">next</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(val);</span><br><span class="line">      ret = <span class="keyword">new</span> <span class="title class_">Array</span>(keys.<span class="property">length</span>);</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>, l = keys.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">        key = keys[i];</span><br><span class="line">        ret[i] = <span class="title function_">render</span>(val[key], key, i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isDef</span>(ret)) &#123;</span><br><span class="line">    ret = [];</span><br><span class="line">  &#125;</span><br><span class="line">  (ret).<span class="property">_isVList</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>v-on</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">name = name.<span class="title function_">replace</span>(onRE, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">isDynamic = dynamicArgRE.<span class="title function_">test</span>(name);</span><br><span class="line"><span class="keyword">if</span> (isDynamic) &#123;</span><br><span class="line">  name = name.<span class="title function_">slice</span>(<span class="number">1</span>, -<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">addHandler</span>(el, name, value, modifiers, <span class="literal">false</span>, warn$<span class="number">2</span>, list[i], isDynamic);</span><br><span class="line"></span><br><span class="line"><span class="comment">// addHandler</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addHandler</span> (el,name,value,modifiers,important,warn,range,dynamic) &#123;</span><br><span class="line">  modifiers = modifiers || emptyObject;</span><br><span class="line">  <span class="comment">// warn prevent and passive modifier</span></span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    warn &amp;&amp;</span><br><span class="line">    modifiers.<span class="property">prevent</span> &amp;&amp; modifiers.<span class="property">passive</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">&#x27;passive and prevent can\&#x27;t be used together. &#x27;</span> +</span><br><span class="line">      <span class="string">&#x27;Passive handler can\&#x27;t prevent default event.&#x27;</span>,</span><br><span class="line">      range</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// normalize click.right and click.middle since they don&#x27;t actually fire</span></span><br><span class="line">  <span class="comment">// this is technically browser-specific, but at least for now browsers are</span></span><br><span class="line">  <span class="comment">// the only target envs that have right/middle clicks.</span></span><br><span class="line">  <span class="keyword">if</span> (modifiers.<span class="property">right</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dynamic) &#123;</span><br><span class="line">      name = <span class="string">&quot;(&quot;</span> + name + <span class="string">&quot;)===&#x27;click&#x27;?&#x27;contextmenu&#x27;:(&quot;</span> + name + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name === <span class="string">&#x27;click&#x27;</span>) &#123;</span><br><span class="line">      name = <span class="string">&#x27;contextmenu&#x27;</span>;</span><br><span class="line">      <span class="keyword">delete</span> modifiers.<span class="property">right</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (modifiers.<span class="property">middle</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dynamic) &#123;</span><br><span class="line">      name = <span class="string">&quot;(&quot;</span> + name + <span class="string">&quot;)===&#x27;click&#x27;?&#x27;mouseup&#x27;:(&quot;</span> + name + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name === <span class="string">&#x27;click&#x27;</span>) &#123;</span><br><span class="line">      name = <span class="string">&#x27;mouseup&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// check capture modifier</span></span><br><span class="line">  <span class="keyword">if</span> (modifiers.<span class="property">capture</span>) &#123;</span><br><span class="line">    <span class="keyword">delete</span> modifiers.<span class="property">capture</span>;</span><br><span class="line">    name = <span class="title function_">prependModifierMarker</span>(<span class="string">&#x27;!&#x27;</span>, name, dynamic);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (modifiers.<span class="property">once</span>) &#123;</span><br><span class="line">    <span class="keyword">delete</span> modifiers.<span class="property">once</span>;</span><br><span class="line">    name = <span class="title function_">prependModifierMarker</span>(<span class="string">&#x27;~&#x27;</span>, name, dynamic);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (modifiers.<span class="property">passive</span>) &#123;</span><br><span class="line">    <span class="keyword">delete</span> modifiers.<span class="property">passive</span>;</span><br><span class="line">    name = <span class="title function_">prependModifierMarker</span>(<span class="string">&#x27;&amp;&#x27;</span>, name, dynamic);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> events;</span><br><span class="line">  <span class="keyword">if</span> (modifiers.<span class="property">native</span>) &#123;</span><br><span class="line">    <span class="keyword">delete</span> modifiers.<span class="property">native</span>;</span><br><span class="line">    events = el.<span class="property">nativeEvents</span> || (el.<span class="property">nativeEvents</span> = &#123;&#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    events = el.<span class="property">events</span> || (el.<span class="property">events</span> = &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> newHandler = <span class="title function_">rangeSetItem</span>(&#123; <span class="attr">value</span>: value.<span class="title function_">trim</span>(), <span class="attr">dynamic</span>: dynamic &#125;, range);</span><br><span class="line">  <span class="keyword">if</span> (modifiers !== emptyObject) &#123;</span><br><span class="line">    newHandler.<span class="property">modifiers</span> = modifiers;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> handlers = events[name];</span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(handlers)) &#123;</span><br><span class="line">    important ? handlers.<span class="title function_">unshift</span>(newHandler) : handlers.<span class="title function_">push</span>(newHandler);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (handlers) &#123;</span><br><span class="line">    events[name] = important ? [newHandler, handlers] : [handlers, newHandler];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    events[name] = newHandler;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  el.<span class="property">plain</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <strong>修饰器</strong></p><ul><li><code>.stop</code> 阻止默认事件 <code>event.stopPropagation()</code></li><li><code>.prevent</code> 阻止默认事件 <code>event.preventDefault()</code></li><li><code>.capture</code> 添加事件监听器使用 <code>capture</code> 模式</li><li><code>.self</code> 只当事件从侦听器绑定的元素本身触发时才触发回调</li><li><code>.&#123;keyCode | keyAlias&#125;</code> 只有特定键触发才会触发回调函数</li><li><code>.native</code> 监听根元素的原生时间</li><li><code>.once</code> 只触发一次回调</li><li><code>.left</code> 点击鼠标左键触发</li><li><code>.right</code> 点击鼠标右键触发</li><li><code>.middle</code> 点击鼠标中键触发</li><li><code>.passive</code> 以 <code>&#123;passive: true&#125;</code> 模式添加侦听器</li></ul><ul><li>v-bind</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">name = name.<span class="title function_">replace</span>(bindRE, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">value = <span class="title function_">parseFilters</span>(value);</span><br><span class="line">isDynamic = dynamicArgRE.<span class="title function_">test</span>(name);</span><br><span class="line"><span class="keyword">if</span> (isDynamic) &#123;</span><br><span class="line">  name = name.<span class="title function_">slice</span>(<span class="number">1</span>, -<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">  value.<span class="title function_">trim</span>().<span class="property">length</span> === <span class="number">0</span></span><br><span class="line">) &#123;</span><br><span class="line">  <span class="title function_">warn$2</span>(</span><br><span class="line">    (<span class="string">&quot;The value for a v-bind expression cannot be empty. Found in \&quot;v-bind:&quot;</span> + name + <span class="string">&quot;\&quot;&quot;</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (modifiers) &#123;</span><br><span class="line">  <span class="keyword">if</span> (modifiers.<span class="property">prop</span> &amp;&amp; !isDynamic) &#123;</span><br><span class="line">    name = <span class="title function_">camelize</span>(name);</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="string">&#x27;innerHtml&#x27;</span>) &#123; name = <span class="string">&#x27;innerHTML&#x27;</span>; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (modifiers.<span class="property">camel</span> &amp;&amp; !isDynamic) &#123;</span><br><span class="line">    name = <span class="title function_">camelize</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (modifiers.<span class="property">sync</span>) &#123;</span><br><span class="line">    syncGen = <span class="title function_">genAssignmentCode</span>(value, <span class="string">&quot;$event&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!isDynamic) &#123;</span><br><span class="line">      <span class="title function_">addHandler</span>(</span><br><span class="line">        el,</span><br><span class="line">        (<span class="string">&quot;update:&quot;</span> + (<span class="title function_">camelize</span>(name))),</span><br><span class="line">        syncGen,</span><br><span class="line">        <span class="literal">null</span>,</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        warn$<span class="number">2</span>,</span><br><span class="line">        list[i]</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">hyphenate</span>(name) !== <span class="title function_">camelize</span>(name)) &#123;</span><br><span class="line">        <span class="title function_">addHandler</span>(</span><br><span class="line">          el,</span><br><span class="line">          (<span class="string">&quot;update:&quot;</span> + (<span class="title function_">hyphenate</span>(name))),</span><br><span class="line">          syncGen,</span><br><span class="line">          <span class="literal">null</span>,</span><br><span class="line">          <span class="literal">false</span>,</span><br><span class="line">          warn$<span class="number">2</span>,</span><br><span class="line">          list[i]</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// handler w/ dynamic event name</span></span><br><span class="line">      <span class="title function_">addHandler</span>(</span><br><span class="line">        el,</span><br><span class="line">        (<span class="string">&quot;\&quot;update:\&quot;+(&quot;</span> + name + <span class="string">&quot;)&quot;</span>),</span><br><span class="line">        syncGen,</span><br><span class="line">        <span class="literal">null</span>,</span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line">        warn$<span class="number">2</span>,</span><br><span class="line">        list[i],</span><br><span class="line">        <span class="literal">true</span> <span class="comment">// dynamic</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ((modifiers &amp;&amp; modifiers.<span class="property">prop</span>) || (</span><br><span class="line">  !el.<span class="property">component</span> &amp;&amp; <span class="title function_">platformMustUseProp</span>(el.<span class="property">tag</span>, el.<span class="property">attrsMap</span>.<span class="property">type</span>, name)</span><br><span class="line">)) &#123;</span><br><span class="line">  <span class="title function_">addProp</span>(el, name, value, list[i], isDynamic);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="title function_">addAttr</span>(el, name, value, list[i], isDynamic);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <strong>修饰符</strong></p><ul><li><code>.prop</code> 作为 DOM 的property绑定，而不是作为 attribute 绑定</li><li><code>。camel</code> 将事件名转化为驼峰模式</li><li><code>.sync</code> 会扩展一个更新父组件绑定值的 <code>v-on</code> 监听器</li></ul><ul><li>v-slot</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">processSlotContent</span> (el) &#123;</span><br><span class="line">  <span class="keyword">var</span> slotScope;</span><br><span class="line">  <span class="keyword">if</span> (el.<span class="property">tag</span> === <span class="string">&#x27;template&#x27;</span>) &#123;</span><br><span class="line">    slotScope = <span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;scope&#x27;</span>);</span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (slotScope) &#123;</span><br><span class="line">      <span class="title function_">warn$2</span>(</span><br><span class="line">        <span class="string">&quot;the \&quot;scope\&quot; attribute for scoped slots have been deprecated and &quot;</span> +</span><br><span class="line">        <span class="string">&quot;replaced by \&quot;slot-scope\&quot; since 2.5. The new \&quot;slot-scope\&quot; attribute &quot;</span> +</span><br><span class="line">        <span class="string">&quot;can also be used on plain elements in addition to &lt;template&gt; to &quot;</span> +</span><br><span class="line">        <span class="string">&quot;denote scoped slots.&quot;</span>,</span><br><span class="line">        el.<span class="property">rawAttrsMap</span>[<span class="string">&#x27;scope&#x27;</span>],</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    el.<span class="property">slotScope</span> = slotScope || <span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;slot-scope&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((slotScope = <span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;slot-scope&#x27;</span>))) &#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (el.<span class="property">attrsMap</span>[<span class="string">&#x27;v-for&#x27;</span>]) &#123;</span><br><span class="line">      <span class="title function_">warn$2</span>(</span><br><span class="line">        <span class="string">&quot;Ambiguous combined usage of slot-scope and v-for on &lt;&quot;</span> + (el.<span class="property">tag</span>) + <span class="string">&quot;&gt; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;(v-for takes higher priority). Use a wrapper &lt;template&gt; for the &quot;</span> +</span><br><span class="line">        <span class="string">&quot;scoped slot to make it clearer.&quot;</span>,</span><br><span class="line">        el.<span class="property">rawAttrsMap</span>[<span class="string">&#x27;slot-scope&#x27;</span>],</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    el.<span class="property">slotScope</span> = slotScope;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// slot=&quot;xxx&quot;</span></span><br><span class="line">  <span class="keyword">var</span> slotTarget = <span class="title function_">getBindingAttr</span>(el, <span class="string">&#x27;slot&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (slotTarget) &#123;</span><br><span class="line">    el.<span class="property">slotTarget</span> = slotTarget === <span class="string">&#x27;&quot;&quot;&#x27;</span> ? <span class="string">&#x27;&quot;default&quot;&#x27;</span> : slotTarget;</span><br><span class="line">    el.<span class="property">slotTargetDynamic</span> = !!(el.<span class="property">attrsMap</span>[<span class="string">&#x27;:slot&#x27;</span>] || el.<span class="property">attrsMap</span>[<span class="string">&#x27;v-bind:slot&#x27;</span>]);</span><br><span class="line">    <span class="comment">// preserve slot as an attribute for native shadow DOM compat</span></span><br><span class="line">    <span class="comment">// only for non-scoped slots.</span></span><br><span class="line">    <span class="keyword">if</span> (el.<span class="property">tag</span> !== <span class="string">&#x27;template&#x27;</span> &amp;&amp; !el.<span class="property">slotScope</span>) &#123;</span><br><span class="line">      <span class="title function_">addAttr</span>(el, <span class="string">&#x27;slot&#x27;</span>, slotTarget, <span class="title function_">getRawBindingAttr</span>(el, <span class="string">&#x27;slot&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.6 v-slot syntax</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (el.<span class="property">tag</span> === <span class="string">&#x27;template&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// v-slot on &lt;template&gt;</span></span><br><span class="line">      <span class="keyword">var</span> slotBinding = <span class="title function_">getAndRemoveAttrByRegex</span>(el, slotRE);</span><br><span class="line">      <span class="keyword">if</span> (slotBinding) &#123;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (el.<span class="property">slotTarget</span> || el.<span class="property">slotScope</span>) &#123;</span><br><span class="line">            <span class="title function_">warn$2</span>(</span><br><span class="line">              <span class="string">&quot;Unexpected mixed usage of different slot syntaxes.&quot;</span>,</span><br><span class="line">              el</span><br><span class="line">            );</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (el.<span class="property">parent</span> &amp;&amp; !<span class="title function_">maybeComponent</span>(el.<span class="property">parent</span>)) &#123;</span><br><span class="line">            <span class="title function_">warn$2</span>(</span><br><span class="line">              <span class="string">&quot;&lt;template v-slot&gt; can only appear at the root level inside &quot;</span> +</span><br><span class="line">              <span class="string">&quot;the receiving component&quot;</span>,</span><br><span class="line">              el</span><br><span class="line">            );</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> ref = <span class="title function_">getSlotName</span>(slotBinding);</span><br><span class="line">        <span class="keyword">var</span> name = ref.<span class="property">name</span>;</span><br><span class="line">        <span class="keyword">var</span> dynamic = ref.<span class="property">dynamic</span>;</span><br><span class="line">        el.<span class="property">slotTarget</span> = name;</span><br><span class="line">        el.<span class="property">slotTargetDynamic</span> = dynamic;</span><br><span class="line">        el.<span class="property">slotScope</span> = slotBinding.<span class="property">value</span> || emptySlotScopeToken; <span class="comment">// force it into a scoped slot for perf</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// v-slot on component, denotes default slot</span></span><br><span class="line">      <span class="keyword">var</span> slotBinding$<span class="number">1</span> = <span class="title function_">getAndRemoveAttrByRegex</span>(el, slotRE);</span><br><span class="line">      <span class="keyword">if</span> (slotBinding$<span class="number">1</span>) &#123;</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (!<span class="title function_">maybeComponent</span>(el)) &#123;</span><br><span class="line">            <span class="title function_">warn$2</span>(</span><br><span class="line">              <span class="string">&quot;v-slot can only be used on components or &lt;template&gt;.&quot;</span>,</span><br><span class="line">              slotBinding$<span class="number">1</span></span><br><span class="line">            );</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (el.<span class="property">slotScope</span> || el.<span class="property">slotTarget</span>) &#123;</span><br><span class="line">            <span class="title function_">warn$2</span>(</span><br><span class="line">              <span class="string">&quot;Unexpected mixed usage of different slot syntaxes.&quot;</span>,</span><br><span class="line">              el</span><br><span class="line">            );</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (el.<span class="property">scopedSlots</span>) &#123;</span><br><span class="line">            <span class="title function_">warn$2</span>(</span><br><span class="line">              <span class="string">&quot;To avoid scope ambiguity, the default slot should also use &quot;</span> +</span><br><span class="line">              <span class="string">&quot;&lt;template&gt; syntax when there are other named slots.&quot;</span>,</span><br><span class="line">              slotBinding$<span class="number">1</span></span><br><span class="line">            );</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// add the component&#x27;s children to its default slot</span></span><br><span class="line">        <span class="keyword">var</span> slots = el.<span class="property">scopedSlots</span> || (el.<span class="property">scopedSlots</span> = &#123;&#125;);</span><br><span class="line">        <span class="keyword">var</span> ref$<span class="number">1</span> = <span class="title function_">getSlotName</span>(slotBinding$<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">var</span> name$<span class="number">1</span> = ref$<span class="number">1.</span>name;</span><br><span class="line">        <span class="keyword">var</span> dynamic$<span class="number">1</span> = ref$<span class="number">1.</span>dynamic;</span><br><span class="line">        <span class="keyword">var</span> slotContainer = slots[name$<span class="number">1</span>] = <span class="title function_">createASTElement</span>(<span class="string">&#x27;template&#x27;</span>, [], el);</span><br><span class="line">        slotContainer.<span class="property">slotTarget</span> = name$<span class="number">1</span>;</span><br><span class="line">        slotContainer.<span class="property">slotTargetDynamic</span> = dynamic$<span class="number">1</span>;</span><br><span class="line">        slotContainer.<span class="property">children</span> = el.<span class="property">children</span>.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">c</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!c.<span class="property">slotScope</span>) &#123;</span><br><span class="line">            c.<span class="property">parent</span> = slotContainer;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        slotContainer.<span class="property">slotScope</span> = slotBinding$<span class="number">1.</span>value || emptySlotScopeToken;</span><br><span class="line">        <span class="comment">// remove children as they are returned from scopedSlots now</span></span><br><span class="line">        el.<span class="property">children</span> = [];</span><br><span class="line">        <span class="comment">// mark el non-plain so data gets generated</span></span><br><span class="line">        el.<span class="property">plain</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>v-pre</p><p>跳过这个元素和子元素的编译过程，显示原始的标签</p></li><li><p>v-cloak</p><p>无表达式，绑定一个空函数，隐藏未编译的 标签直到实例准备完成</p></li><li><p>v-once</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  判断是否含有 v-once 指令</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">processOnce</span> (el) &#123;</span><br><span class="line">  <span class="keyword">var</span> once$$1 = <span class="title function_">getAndRemoveAttr</span>(el, <span class="string">&#x27;v-once&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (once$$1 != <span class="literal">null</span>) &#123;</span><br><span class="line">    el.<span class="property">once</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// v-once</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genOnce</span> (el, state) &#123;</span><br><span class="line">  el.<span class="property">onceProcessed</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (el.<span class="property">if</span> &amp;&amp; !el.<span class="property">ifProcessed</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genIf</span>(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">staticInFor</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> parent = el.<span class="property">parent</span>;</span><br><span class="line">    <span class="keyword">while</span> (parent) &#123;</span><br><span class="line">      <span class="keyword">if</span> (parent.<span class="property">for</span>) &#123;</span><br><span class="line">        key = parent.<span class="property">key</span>;</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      parent = parent.<span class="property">parent</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!key) &#123;</span><br><span class="line">      state.<span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&quot;v-once can only be used inside v-for that is keyed. &quot;</span>,</span><br><span class="line">        el.<span class="property">rawAttrsMap</span>[<span class="string">&#x27;v-once&#x27;</span>]</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">genElement</span>(el, state)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">&quot;_o(&quot;</span> + (<span class="title function_">genElement</span>(el, state)) + <span class="string">&quot;,&quot;</span> + (state.<span class="property">onceId</span>++) + <span class="string">&quot;,&quot;</span> + key + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">genStatic</span>(el, state)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;内置指令&quot;&gt;&lt;a href=&quot;#内置指令&quot; class=&quot;headerlink&quot; title=&quot;内置指令&quot;&gt;&lt;/a&gt;内置指令&lt;/h4&gt;&lt;p&gt;Vue 内置了以下几种指令&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;v-text&lt;/li&gt;
&lt;li&gt;v-html&lt;/li&gt;
&lt;li&gt;v-s</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/categories/SourceCode/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/tags/SourceCode/"/>
    
  </entry>
  
  <entry>
    <title>跟着 Vue源码学习 Vue api 系列 (七) - 实例 property</title>
    <link href="https://lxx1997.github.io/2021/02/01/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-07/"/>
    <id>https://lxx1997.github.io/2021/02/01/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-07/</id>
    <published>2021-02-01T07:25:46.000Z</published>
    <updated>2021-02-01T07:25:46.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="on-emit"><a href="#on-emit" class="headerlink" title="$on $emit"></a>$on $emit</h4><p>监听 <code>Vue.$emit</code> 发送的事件，回调函数会接收所有传入参数的参数</p><h5 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $on 监听事件</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$on</span> = <span class="keyword">function</span> (<span class="params">event, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(event)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = event.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">      vm.$on(event[i], fn);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    (vm.<span class="property">_events</span>[event] || (vm.<span class="property">_events</span>[event] = [])).<span class="title function_">push</span>(fn);</span><br><span class="line">    <span class="comment">// optimize hook:event cost by using a boolean flag marked at registration</span></span><br><span class="line">    <span class="comment">// instead of a hash lookup</span></span><br><span class="line">    <span class="keyword">if</span> (hookRE.<span class="title function_">test</span>(event)) &#123;</span><br><span class="line">      vm.<span class="property">_hasHookEvent</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// $emit 发送事件及参数</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$emit</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> lowerCaseEvent = event.<span class="title function_">toLowerCase</span>();</span><br><span class="line">    <span class="keyword">if</span> (lowerCaseEvent !== event &amp;&amp; vm.<span class="property">_events</span>[lowerCaseEvent]) &#123;</span><br><span class="line">      <span class="title function_">tip</span>(</span><br><span class="line">        <span class="string">&quot;Event \&quot;&quot;</span> + lowerCaseEvent + <span class="string">&quot;\&quot; is emitted in component &quot;</span> +</span><br><span class="line">        (<span class="title function_">formatComponentName</span>(vm)) + <span class="string">&quot; but the handler is registered for \&quot;&quot;</span> + event + <span class="string">&quot;\&quot;. &quot;</span> +</span><br><span class="line">        <span class="string">&quot;Note that HTML attributes are case-insensitive and you cannot use &quot;</span> +</span><br><span class="line">        <span class="string">&quot;v-on to listen to camelCase events when using in-DOM templates. &quot;</span> +</span><br><span class="line">        <span class="string">&quot;You should probably use \&quot;&quot;</span> + (<span class="title function_">hyphenate</span>(event)) + <span class="string">&quot;\&quot; instead of \&quot;&quot;</span> + event + <span class="string">&quot;\&quot;.&quot;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> cbs = vm.<span class="property">_events</span>[event];</span><br><span class="line">  <span class="keyword">if</span> (cbs) &#123;</span><br><span class="line">    cbs = cbs.<span class="property">length</span> &gt; <span class="number">1</span> ? <span class="title function_">toArray</span>(cbs) : cbs;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="title function_">toArray</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> info = <span class="string">&quot;event handler for \&quot;&quot;</span> + event + <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = cbs.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">      <span class="comment">// 调用 事件监听的回调函数</span></span><br><span class="line">      <span class="title function_">invokeWithErrorHandling</span>(cbs[i], vm, args, vm, info);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// invokeWithErrorHandling</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">invokeWithErrorHandling</span> (</span><br><span class="line">  handler,</span><br><span class="line">  context,</span><br><span class="line">  args,</span><br><span class="line">  vm,</span><br><span class="line">  info</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">var</span> res;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    res = args ? handler.<span class="title function_">apply</span>(context, args) : handler.<span class="title function_">call</span>(context);</span><br><span class="line">    <span class="keyword">if</span> (res &amp;&amp; !res.<span class="property">_isVue</span> &amp;&amp; <span class="title function_">isPromise</span>(res) &amp;&amp; !res.<span class="property">_handled</span>) &#123;</span><br><span class="line">      res.<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="keyword">return</span> <span class="title function_">handleError</span>(e, vm, info + <span class="string">&quot; (Promise/async)&quot;</span>); &#125;);</span><br><span class="line">      <span class="comment">// issue #9511</span></span><br><span class="line">      <span class="comment">// avoid catch triggering multiple times when nested calls</span></span><br><span class="line">      res.<span class="property">_handled</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">handleError</span>(e, vm, info);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>主要是用了 事件发布订阅模式</strong></p><p><code>(vm._events[event] || (vm._events[event] = [])).push(fn)</code> 通过这段代码 将 <code>$on</code> 监听的事件名称及方法 存储到 Vue 的私有属性 <code>_event</code> 中，当使用 <code>$emit</code> 发送事件的时候会在 <code>_event</code> 中找到对应的时间名，然后调用 <code>res = args ? handler.apply(context, args) : handler.call(context)</code> 调用 回调函数</p><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发送事件</span></span><br><span class="line"><span class="variable language_">this</span>.$emit(<span class="string">&#x27;sayHi&#x27;</span>, <span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收事件</span></span><br><span class="line"><span class="variable language_">this</span>.$on(<span class="string">&#x27;sayHi&#x27;</span>, <span class="keyword">function</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;say &#x27;</span> + msg) <span class="comment">// say hi</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="once"><a href="#once" class="headerlink" title="$once"></a>$once</h4><p>  监听一个自定义时间，只触发一次，触发之后移除监听器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$once</span> = <span class="keyword">function</span> (<span class="params">event, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">on</span> () &#123;</span><br><span class="line">    vm.$off(event, on);</span><br><span class="line">    fn.<span class="title function_">apply</span>(vm, <span class="variable language_">arguments</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  on.<span class="property">fn</span> = fn;</span><br><span class="line">  vm.$on(event, on);</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>在 $once 函数内部定义了一个回调函数，用于 触发事件之后调用 $off 方法销毁事件监听器<br>$emit 触发 $once 监听事件</p><h4 id="off"><a href="#off" class="headerlink" title="$off"></a>$off</h4><p>  移除事件监听器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$off</span> = <span class="keyword">function</span> (<span class="params">event, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="comment">// all</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">arguments</span>.<span class="property">length</span>) &#123;</span><br><span class="line">    vm.<span class="property">_events</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// array of events</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(event)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i$<span class="number">1</span> = <span class="number">0</span>, l = event.<span class="property">length</span>; i$<span class="number">1</span> &lt; l; i$<span class="number">1</span>++) &#123;</span><br><span class="line">      vm.$off(event[i$<span class="number">1</span>], fn);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// specific event</span></span><br><span class="line">  <span class="keyword">var</span> cbs = vm.<span class="property">_events</span>[event];</span><br><span class="line">  <span class="keyword">if</span> (!cbs) &#123;</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!fn) &#123;</span><br><span class="line">    vm.<span class="property">_events</span>[event] = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// specific handler</span></span><br><span class="line">  <span class="keyword">var</span> cb;</span><br><span class="line">  <span class="keyword">var</span> i = cbs.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    cb = cbs[i];</span><br><span class="line">    <span class="keyword">if</span> (cb === fn || cb.<span class="property">fn</span> === fn) &#123;</span><br><span class="line">      cbs.<span class="title function_">splice</span>(i, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>  使用 $off 方法移除监听器的时候可以选择性的传两个参数 <code>event, fn</code></p><ul><li>如果不传参数 默认移除所有的监听器事件</li><li>如果只传了 event 事件，移除对应事件下所有的监听器事件</li><li>如果同时提供了 event 事件和 回调，移除对应事件下的这个回调的监听器</li></ul><h5 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.$off() <span class="comment">// 移除所有</span></span><br><span class="line"><span class="variable language_">this</span>.$off(<span class="string">&#x27;test&#x27;</span>) <span class="comment">// 移除 test 下的所有监视器函数</span></span><br><span class="line"><span class="variable language_">this</span>.$off(<span class="string">&#x27;test&#x27;</span>, fn) <span class="comment">// 移除 test 下的 fn 回调函数 fn 是一个变量，指向回调函数地址</span></span><br></pre></td></tr></table></figure><h4 id="mount"><a href="#mount" class="headerlink" title="$mount"></a>$mount</h4><p>  传入 el 为 DOM 元素</p><h5 id="源码-1"><a href="#源码-1" class="headerlink" title="源码"></a>源码</h5><p><a href="/2021/01/27/vue-learn-api-with-源码-04/#el，template-render">参考地址</a></p><h5 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> <span class="title function_">h</span>()</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="forceUpdate"><a href="#forceUpdate" class="headerlink" title="$forceUpdate"></a>$forceUpdate</h4><p>强制更新页面，仅影响实例本身和插入插槽内容的子组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$forceUpdate</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">_watcher</span>) &#123;</span><br><span class="line">    vm.<span class="property">_watcher</span>.<span class="title function_">update</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>原理是调用 Watcher 的 update 方法更新 DOM 元素</p><h4 id="nextTick"><a href="#nextTick" class="headerlink" title="$nextTick"></a>$nextTick</h4><p>  <a href="/2021/01/20/vue-learn-api-with-源码-02/#Vue-nextTick-callback-Function-context-Object">Vue.nextTick</a></p><h4 id="destroy"><a href="#destroy" class="headerlink" title="$destroy"></a>$destroy</h4><h5 id="源码-2"><a href="#源码-2" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$destroy</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">_isBeingDestroyed</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeDestroy&#x27;</span>);</span><br><span class="line">  vm.<span class="property">_isBeingDestroyed</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// remove self from parent</span></span><br><span class="line">  <span class="keyword">var</span> parent = vm.<span class="property">$parent</span>;</span><br><span class="line">  <span class="keyword">if</span> (parent &amp;&amp; !parent.<span class="property">_isBeingDestroyed</span> &amp;&amp; !vm.<span class="property">$options</span>.<span class="property">abstract</span>) &#123;</span><br><span class="line">    <span class="title function_">remove</span>(parent.<span class="property">$children</span>, vm);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// teardown watchers</span></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">_watcher</span>) &#123;</span><br><span class="line">    vm.<span class="property">_watcher</span>.<span class="title function_">teardown</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> i = vm.<span class="property">_watchers</span>.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    vm.<span class="property">_watchers</span>[i].<span class="title function_">teardown</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// remove reference from data ob</span></span><br><span class="line">  <span class="comment">// frozen object may not have observer.</span></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">_data</span>.<span class="property">__ob__</span>) &#123;</span><br><span class="line">    vm.<span class="property">_data</span>.<span class="property">__ob__</span>.<span class="property">vmCount</span>--;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// call the last hook...</span></span><br><span class="line">  vm.<span class="property">_isDestroyed</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// invoke destroy hooks on current rendered tree</span></span><br><span class="line">  vm.<span class="title function_">__patch__</span>(vm.<span class="property">_vnode</span>, <span class="literal">null</span>);</span><br><span class="line">  <span class="comment">// fire destroyed hook</span></span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;destroyed&#x27;</span>);</span><br><span class="line">  <span class="comment">// turn off all instance listeners.</span></span><br><span class="line">  vm.$off();</span><br><span class="line">  <span class="comment">// remove __vue__ reference</span></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">$el</span>) &#123;</span><br><span class="line">    vm.<span class="property">$el</span>.<span class="property">__vue__</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// release circular reference (#6759)</span></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">$vnode</span>) &#123;</span><br><span class="line">    vm.<span class="property">$vnode</span>.<span class="property">parent</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>在 $destroy 函数执行过程中，触发了 <code>beforeDestroy</code> 和 <code>destroyed</code> 生命周期函数</li><li>为防止多次调用，添加了是否正在销毁组件状态</li><li>同时移除所有的子组件，监听函数</li><li>销毁所有的事件监听函数，并置空 node 节点</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;on-emit&quot;&gt;&lt;a href=&quot;#on-emit&quot; class=&quot;headerlink&quot; title=&quot;$on $emit&quot;&gt;&lt;/a&gt;$on $emit&lt;/h4&gt;&lt;p&gt;监听 &lt;code&gt;Vue.$emit&lt;/code&gt; 发送的事件，回调函数会接收所有传入参数的</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/categories/SourceCode/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/tags/SourceCode/"/>
    
  </entry>
  
  <entry>
    <title>跟着 Vue源码学习 Vue api 系列 (六) - 实例 property</title>
    <link href="https://lxx1997.github.io/2021/01/29/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-06/"/>
    <id>https://lxx1997.github.io/2021/01/29/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-06/</id>
    <published>2021-01-29T06:34:56.000Z</published>
    <updated>2021-01-29T06:34:56.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="data"><a href="#data" class="headerlink" title="$data"></a>$data</h4><h5 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dataDef.<span class="property">get</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_data</span> &#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;$data&#x27;</span>, dataDef);</span><br></pre></td></tr></table></figure><p>通过 Object.defineProperty 方法对 Vue 原型上的 $data 设置监听方法，访问 $data 属性的时候 直接返回 Vue 的 _data 数据</p><p>不推介使用 $data 来访问 Vue 中 data 中的数据，因为 Vue 在内部已经做了映射，直接把 data 中的属性 映射到 Vue 实例上</p><h4 id="props"><a href="#props" class="headerlink" title="$props"></a>$props</h4><h5 id="源码-1"><a href="#源码-1" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">propsDef.<span class="property">get</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_props</span> &#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;$props&#x27;</span>, propsDef);</span><br></pre></td></tr></table></figure><p>通过 Object.defineProperty 方法对 Vue 原型上的 $props 设置监听方法，访问 $props 属性的时候 直接返回 Vue 的 _props 数据</p><p>不推介使用 $props 来访问 Vue 中 props 中的数据，因为 Vue 在内部已经做了映射，直接把 props 中的属性 映射到 Vue 实例上</p><h4 id="el"><a href="#el" class="headerlink" title="$el"></a>$el</h4><h5 id="源码-2"><a href="#源码-2" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $mount</span></span><br><span class="line">  el = el &amp;&amp; inBrowser ? <span class="title function_">query</span>(el) : <span class="literal">undefined</span>;</span><br><span class="line"><span class="comment">// mountComponent</span></span><br><span class="line">  vm.<span class="property">$el</span> = el;</span><br></pre></td></tr></table></figure><p>  存储了 Vue 实例的根元素</p><h4 id="options"><a href="#options" class="headerlink" title="$options"></a>$options</h4><h5 id="源码-3"><a href="#源码-3" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化实例的时候传入 options 参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Vue</span> (options) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Vue</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(<span class="string">&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">_init</span>(options);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _init 方法</span></span><br><span class="line"><span class="keyword">if</span> (options &amp;&amp; options.<span class="property">_isComponent</span>) &#123;</span><br><span class="line">    <span class="comment">// optimize internal component instantiation</span></span><br><span class="line">    <span class="comment">// since dynamic options merging is pretty slow, and none of the</span></span><br><span class="line">    <span class="comment">// internal component options needs special treatment.</span></span><br><span class="line">    <span class="title function_">initInternalComponent</span>(vm, options);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    vm.<span class="property">$options</span> = <span class="title function_">mergeOptions</span>(</span><br><span class="line">      <span class="title function_">resolveConstructorOptions</span>(vm.<span class="property">constructor</span>),</span><br><span class="line">      options || &#123;&#125;,</span><br><span class="line">      vm</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>Vue 也支持我们自定义 property 特性，可以通过 optionMergeStrategies 配置自定义特性的合并规则</p><p>访问的时候通过 this.$options.property 来访问</p><h4 id="parnet"><a href="#parnet" class="headerlink" title="$parnet"></a>$parnet</h4><p>  指向当前组件的 父实例，如果没有父组件实例，则为 null</p><h4 id="children"><a href="#children" class="headerlink" title="$children"></a>$children</h4><p>  指向组件的子组件 是一个数组</p><h4 id="root"><a href="#root" class="headerlink" title="$root"></a>$root</h4><p>  指向 Vue 实例的根组件，如果没有父组件，即指向自身<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.<span class="property">$parent</span> = parent;</span><br><span class="line">vm.<span class="property">$root</span> = parent ? parent.<span class="property">$root</span> : vm;</span><br><span class="line">vm.<span class="property">$children</span> = [];</span><br></pre></td></tr></table></figure></p><h4 id="slots"><a href="#slots" class="headerlink" title="$slots"></a>$slots</h4><p>  <code>[name]: Array&lt;VNode&gt;</code><br>  用来访问插槽</p><h5 id="源码-4"><a href="#源码-4" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// initRender</span></span><br><span class="line">vm.<span class="property">$slots</span> = <span class="title function_">resolveSlots</span>(options.<span class="property">_renderChildren</span>, renderContext);</span><br><span class="line"></span><br><span class="line"><span class="comment">// resolveSlots</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolveSlots</span> (</span><br><span class="line">  children,</span><br><span class="line">  context</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!children || !children.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> slots = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = children.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> child = children[i];</span><br><span class="line">    <span class="keyword">var</span> data = child.<span class="property">data</span>;</span><br><span class="line">    <span class="comment">// remove slot attribute if the node is resolved as a Vue slot node</span></span><br><span class="line">    <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">attrs</span> &amp;&amp; data.<span class="property">attrs</span>.<span class="property">slot</span>) &#123;</span><br><span class="line">      <span class="keyword">delete</span> data.<span class="property">attrs</span>.<span class="property">slot</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// named slots should only be respected if the vnode was rendered in the</span></span><br><span class="line">    <span class="comment">// same context.</span></span><br><span class="line">    <span class="keyword">if</span> ((child.<span class="property">context</span> === context || child.<span class="property">fnContext</span> === context) &amp;&amp;</span><br><span class="line">      data &amp;&amp; data.<span class="property">slot</span> != <span class="literal">null</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">var</span> name = data.<span class="property">slot</span>;</span><br><span class="line">      <span class="keyword">var</span> slot = (slots[name] || (slots[name] = []));</span><br><span class="line">      <span class="keyword">if</span> (child.<span class="property">tag</span> === <span class="string">&#x27;template&#x27;</span>) &#123;</span><br><span class="line">        slot.<span class="property">push</span>.<span class="title function_">apply</span>(slot, child.<span class="property">children</span> || []);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        slot.<span class="title function_">push</span>(child);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      (slots.<span class="property">default</span> || (slots.<span class="property">default</span> = [])).<span class="title function_">push</span>(child);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ignore slots that contains only whitespace</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> name$<span class="number">1</span> <span class="keyword">in</span> slots) &#123;</span><br><span class="line">    <span class="keyword">if</span> (slots[name$<span class="number">1</span>].<span class="title function_">every</span>(isWhitespace)) &#123;</span><br><span class="line">      <span class="keyword">delete</span> slots[name$<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> slots</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在初始化渲染的时候，解析 DOM 树，通过 resolveSlots 方法 提取出 slots 对象</p><p>resolveSlots 方法 判断 slot 属性是否为空，然后将同一个 slot 下的 node 节点 合并成一个 slot 数组,最后通过 delete 方法删除 slot 为空的数组</p><h5 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">blog-post</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>About Me<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Here&#x27;s some page content, which will be included in vm.$slots.default, because it&#x27;s not inside a named slot.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Copyright 2016 Evan You<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>If I have some content down here, it will also be included in vm.$slots.default.<span class="tag">&lt;/<span class="name">p</span>&gt;</span>.</span><br><span class="line"><span class="tag">&lt;/<span class="name">blog-post</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;blog-post&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> header = <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">header</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> body   = <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> footer = <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">footer</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, [</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">createElement</span>(<span class="string">&#x27;header&#x27;</span>, header),</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">createElement</span>(<span class="string">&#x27;main&#x27;</span>, body),</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">createElement</span>(<span class="string">&#x27;footer&#x27;</span>, footer)</span></span><br><span class="line"><span class="language-javascript">      ])</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="scopedSlots"><a href="#scopedSlots" class="headerlink" title="$scopedSlots"></a>$scopedSlots</h4><p>  <code>&#123; [name: string]: props =&gt; Array&lt;VNode&gt; | undefined &#125;</code></p><p>  用来访问作用域插槽。对于包括 默认 slot 在内的每一个插槽，该对象都包含一个返回相应 VNode 的函数。</p><h5 id="源码-5"><a href="#源码-5" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vue.prototype._render</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$scopedSlots</span> = <span class="title function_">normalizeScopedSlots</span>(data.<span class="property">scopedSlots</span>, <span class="variable language_">this</span>。$slots);</span><br><span class="line"><span class="comment">// 函数 normalizeScopedSlots</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeScopedSlots</span> (</span><br><span class="line">  slots,</span><br><span class="line">  normalSlots,</span><br><span class="line">  prevSlots</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">var</span> res;</span><br><span class="line">  <span class="keyword">var</span> hasNormalSlots = <span class="title class_">Object</span>.<span class="title function_">keys</span>(normalSlots).<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> isStable = slots ? !!slots.<span class="property">$stable</span> : !hasNormalSlots;</span><br><span class="line">  <span class="keyword">var</span> key = slots &amp;&amp; slots.<span class="property">$key</span>;</span><br><span class="line">  <span class="keyword">if</span> (!slots) &#123;</span><br><span class="line">    res = &#123;&#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (slots.<span class="property">_normalized</span>) &#123;</span><br><span class="line">    <span class="comment">// fast path 1: child component re-render only, parent did not change</span></span><br><span class="line">    <span class="keyword">return</span> slots.<span class="property">_normalized</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">    isStable &amp;&amp;</span><br><span class="line">    prevSlots &amp;&amp;</span><br><span class="line">    prevSlots !== emptyObject &amp;&amp;</span><br><span class="line">    key === prevSlots.<span class="property">$key</span> &amp;&amp;</span><br><span class="line">    !hasNormalSlots &amp;&amp;</span><br><span class="line">    !prevSlots.<span class="property">$hasNormal</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="comment">// fast path 2: stable scoped slots w/ no normal slots to proxy,</span></span><br><span class="line">    <span class="comment">// only need to normalize once</span></span><br><span class="line">    <span class="keyword">return</span> prevSlots</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key$<span class="number">1</span> <span class="keyword">in</span> slots) &#123;</span><br><span class="line">      <span class="keyword">if</span> (slots[key$<span class="number">1</span>] &amp;&amp; key$<span class="number">1</span>[<span class="number">0</span>] !== <span class="string">&#x27;$&#x27;</span>) &#123;</span><br><span class="line">        res[key$<span class="number">1</span>] = <span class="title function_">normalizeScopedSlot</span>(normalSlots, key$<span class="number">1</span>, slots[key$<span class="number">1</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// expose normal slots on scopedSlots</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key$<span class="number">2</span> <span class="keyword">in</span> normalSlots) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(key$<span class="number">2</span> <span class="keyword">in</span> res)) &#123;</span><br><span class="line">      res[key$<span class="number">2</span>] = <span class="title function_">proxyNormalSlot</span>(normalSlots, key$<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// avoriaz seems to mock a non-extensible $scopedSlots object</span></span><br><span class="line">  <span class="comment">// and when that is passed down this would cause an error</span></span><br><span class="line">  <span class="keyword">if</span> (slots &amp;&amp; <span class="title class_">Object</span>.<span class="title function_">isExtensible</span>(slots)) &#123;</span><br><span class="line">    (slots).<span class="property">_normalized</span> = res;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">def</span>(res, <span class="string">&#x27;$stable&#x27;</span>, isStable);</span><br><span class="line">  <span class="title function_">def</span>(res, <span class="string">&#x27;$key&#x27;</span>, key);</span><br><span class="line">  <span class="title function_">def</span>(res, <span class="string">&#x27;$hasNormal&#x27;</span>, hasNormalSlots);</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="refs"><a href="#refs" class="headerlink" title="$refs"></a>$refs</h4><h5 id="源码-6"><a href="#源码-6" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ref = &#123;</span><br><span class="line">  <span class="attr">create</span>: <span class="keyword">function</span> <span class="title function_">create</span> (_, vnode) &#123;</span><br><span class="line">    <span class="title function_">registerRef</span>(vnode);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">update</span>: <span class="keyword">function</span> <span class="title function_">update</span> (oldVnode, vnode) &#123;</span><br><span class="line">    <span class="keyword">if</span> (oldVnode.<span class="property">data</span>.<span class="property">ref</span> !== vnode.<span class="property">data</span>.<span class="property">ref</span>) &#123;</span><br><span class="line">      <span class="title function_">registerRef</span>(oldVnode, <span class="literal">true</span>);</span><br><span class="line">      <span class="title function_">registerRef</span>(vnode);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">destroy</span>: <span class="keyword">function</span> <span class="title function_">destroy</span> (vnode) &#123;</span><br><span class="line">    <span class="title function_">registerRef</span>(vnode, <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">registerRef</span> (vnode, isRemoval) &#123;</span><br><span class="line">  <span class="keyword">var</span> key = vnode.<span class="property">data</span>.<span class="property">ref</span>;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isDef</span>(key)) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> vm = vnode.<span class="property">context</span>;</span><br><span class="line">  <span class="keyword">var</span> ref = vnode.<span class="property">componentInstance</span> || vnode.<span class="property">elm</span>;</span><br><span class="line">  <span class="keyword">var</span> refs = vm.<span class="property">$refs</span>;</span><br><span class="line">  <span class="keyword">if</span> (isRemoval) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(refs[key])) &#123;</span><br><span class="line">      <span class="title function_">remove</span>(refs[key], ref);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (refs[key] === ref) &#123;</span><br><span class="line">      refs[key] = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (vnode.<span class="property">data</span>.<span class="property">refInFor</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(refs[key])) &#123;</span><br><span class="line">        refs[key] = [ref];</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (refs[key].<span class="title function_">indexOf</span>(ref) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// $flow-disable-line</span></span><br><span class="line">        refs[key].<span class="title function_">push</span>(ref);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      refs[key] = ref;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过 registerRef 方法 注册和移除旧的 VNode</p><h5 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">my-component</span> <span class="attr">ref</span>=<span class="string">&quot;myComponent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>[<span class="string">&#x27;myComponent&#x27;</span>])</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="isServer"><a href="#isServer" class="headerlink" title="$isServer"></a>$isServer</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isServerRendering = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (_isServer === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (!inBrowser &amp;&amp; !inWeex &amp;&amp; <span class="keyword">typeof</span> <span class="variable language_">global</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// detect presence of vue-server-renderer and avoid</span></span><br><span class="line">      <span class="comment">// Webpack shimming the process</span></span><br><span class="line">      _isServer = <span class="variable language_">global</span>[<span class="string">&#x27;process&#x27;</span>] &amp;&amp; <span class="variable language_">global</span>[<span class="string">&#x27;process&#x27;</span>].<span class="property">env</span>.<span class="property">VUE_ENV</span> === <span class="string">&#x27;server&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _isServer = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _isServer</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>判断 代码运行环境是否是服务端渲染,开启对应渲染和优化方法</p><h4 id="attrs"><a href="#attrs" class="headerlink" title="$attrs"></a>$attrs</h4><p>  包含了父作用域中不作为 prop 被识别且获取的 attribute 绑定(除开 class 和 style)，当一个组件没有声明任何props时，这里会包含所有父作用域的绑定，并且可以通过 <code>v-bind=&quot;$attrs&quot;</code> 传入内部组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function updateChildComponent</span></span><br><span class="line">vm.<span class="property">$attrs</span> = parentVnode.<span class="property">data</span>.<span class="property">attrs</span> || emptyObject;</span><br></pre></td></tr></table></figure><h4 id="listeners"><a href="#listeners" class="headerlink" title="$listeners"></a>$listeners</h4><p>  包含了父作用域中的 <code>v-on</code>(不包含 <code>.natvie</code> 修饰器) 事件监听器，可以通过 <code>v-on=&quot;$listeners&quot;</code> 传入内部组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vm.<span class="property">$listeners</span> = listeners || emptyObject;</span><br></pre></td></tr></table></figure><h4 id="watch"><a href="#watch" class="headerlink" title="$watch"></a>$watch</h4><h5 id="源码-7"><a href="#源码-7" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$watch</span> = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  expOrFn,</span></span><br><span class="line"><span class="params">  cb,</span></span><br><span class="line"><span class="params">  options</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(cb)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createWatcher</span>(vm, expOrFn, cb, options)</span><br><span class="line">  &#125;</span><br><span class="line">  options = options || &#123;&#125;;</span><br><span class="line">  options.<span class="property">user</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">var</span> watcher = <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, expOrFn, cb, options);</span><br><span class="line">  <span class="keyword">if</span> (options.<span class="property">immediate</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      cb.<span class="title function_">call</span>(vm, watcher.<span class="property">value</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="title function_">handleError</span>(error, vm, (<span class="string">&quot;callback for immediate watcher \&quot;&quot;</span> + (watcher.<span class="property">expression</span>) + <span class="string">&quot;\&quot;&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">unwatchFn</span> () &#123;</span><br><span class="line">    watcher.<span class="title function_">teardown</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>  主要是通过 Watcher 构造函数及 createWatcher 方法对 Vue 实例的属性进行监控，然后返回一个取消观察的函数，用来停止触发回调</p><h5 id="使用-3"><a href="#使用-3" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种使用</span></span><br><span class="line"><span class="variable language_">this</span>.$watch(<span class="string">&#x27;property&#x27;</span>, cb)</span><br><span class="line"><span class="comment">// 第二种使用</span></span><br><span class="line"><span class="variable language_">this</span>.$watch(<span class="string">&#x27;property&#x27;</span>, cb, &#123;</span><br><span class="line">  <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">immediate</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 第三种使用</span></span><br><span class="line"><span class="variable language_">this</span>.$watch(<span class="string">&#x27;property&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">handler</span>: cb,</span><br><span class="line">  <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">immediate</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>$watch 方法会返回一个取消侦听函数，但是如果包含 immediate 选项时，不能在第一次回调时取消侦听给定的 <code>property</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad example</span></span><br><span class="line"><span class="keyword">const</span> unwatch = <span class="variable language_">this</span>.$watch(<span class="string">&#x27;property&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">unwatch</span>()</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">immediate</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// good example</span></span><br><span class="line"><span class="keyword">const</span> unwatch = <span class="variable language_">this</span>.$watch(<span class="string">&#x27;property&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(unwatch) &#123;</span><br><span class="line">    <span class="title function_">unwatch</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">immediate</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="set"><a href="#set" class="headerlink" title="$set"></a>$set</h4><p>  参考<a href="/2021/01/20/vue-learn-api-with-源码-02/#Vue-set-target-Object-Array-index-Number-string-value-any">Vue.set</a></p><h4 id="delete"><a href="#delete" class="headerlink" title="$delete"></a>$delete</h4><p>  参考<a href="/2021/01/20/vue-learn-api-with-源码-02/#Vue-delete-target-Object-Array-index-Number-string">Vue.delete</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;data&quot;&gt;&lt;a href=&quot;#data&quot; class=&quot;headerlink&quot; title=&quot;$data&quot;&gt;&lt;/a&gt;$data&lt;/h4&gt;&lt;h5 id=&quot;源码&quot;&gt;&lt;a href=&quot;#源码&quot; class=&quot;headerlink&quot; title=&quot;源码&quot;&gt;&lt;/a&gt;源码&lt;</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/categories/SourceCode/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/tags/SourceCode/"/>
    
  </entry>
  
  <entry>
    <title>跟着 Vue源码学习 Vue api 系列 (五) - 选项 / 组合 &amp; 其他</title>
    <link href="https://lxx1997.github.io/2021/01/28/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-05/"/>
    <id>https://lxx1997.github.io/2021/01/28/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-05/</id>
    <published>2021-01-28T06:03:16.000Z</published>
    <updated>2021-01-28T06:03:16.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="parent"><a href="#parent" class="headerlink" title="parent"></a>parent</h4><p>主要用来存储 Vue 组件的父组件</p><h4 id="mixins"><a href="#mixins" class="headerlink" title="mixins"></a>mixins</h4><p>混入，主要用来开发 Vue组件中的可复用的功能</p><h5 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (child.<span class="property">mixins</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = child.<span class="property">mixins</span>.<span class="property">length</span>; i &lt; l; i++) &#123;</span><br><span class="line">    parent = <span class="title function_">mergeOptions</span>(parent, child.<span class="property">mixins</span>[i], vm);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Vue 在合并选项的时候 判断力 mixins 属性是否存在，如果存在，通过递归调用的方法合并到当前组件上</p><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mixin = &#123;</span><br><span class="line">  <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;create&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">getInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getInfo&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">mixins</span>: [mixin]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="extends"><a href="#extends" class="headerlink" title="extends"></a>extends</h4><h5 id="源码-1"><a href="#源码-1" class="headerlink" title="源码"></a>源码</h5><p>具体理解可以参考 <a href="/2021/01/20/vue-learn-api-with-源码-02/#Vue-extend">Vue.extend</a><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (child.<span class="property">extends</span>) &#123;</span><br><span class="line">  parent = <span class="title function_">mergeOptions</span>(parent, child.<span class="property">extends</span>, vm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> extend = &#123;</span><br><span class="line">  <span class="title function_">create</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;create&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">getInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getInfo&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">extends</span>: extend</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="provide-inject"><a href="#provide-inject" class="headerlink" title="provide/inject"></a>provide/inject</h4><ul><li><code>provide</code>   <code>Object | () =&gt; Object</code></li><li><code>inject</code>    <code>Array&lt;string&gt; | [key:string]: string | Symbol | Object</code></li></ul><p>父组件通过 provide 提供依赖，子孙组件通过 inject 将依赖注入到当前组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 mergeOptionStract 配置中， provide 通过mergeData方法从父组件中绑定到子组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initProvide</span> (vm) &#123;</span><br><span class="line">  <span class="keyword">var</span> provide = vm.<span class="property">$options</span>.<span class="property">provide</span>;</span><br><span class="line">  <span class="keyword">if</span> (provide) &#123;</span><br><span class="line">    vm.<span class="property">_provided</span> = <span class="keyword">typeof</span> provide === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">      ? provide.<span class="title function_">call</span>(vm)</span><br><span class="line">      : provide;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initInjections</span> (vm) &#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="title function_">resolveInject</span>(vm.<span class="property">$options</span>.<span class="property">inject</span>, vm);</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="title function_">toggleObserving</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(result).<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">      <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="title function_">defineReactive$$1</span>(vm, key, result[key], <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="title function_">warn</span>(</span><br><span class="line">            <span class="string">&quot;Avoid mutating an injected value directly since the changes will be &quot;</span> +</span><br><span class="line">            <span class="string">&quot;overwritten whenever the provided component re-renders. &quot;</span> +</span><br><span class="line">            <span class="string">&quot;injection being mutated: \&quot;&quot;</span> + key + <span class="string">&quot;\&quot;&quot;</span>,</span><br><span class="line">            vm</span><br><span class="line">          );</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">toggleObserving</span>(<span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 处理实例上的 inject 方法 返回处理之后的对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolveInject</span> (inject, vm) &#123;</span><br><span class="line">  <span class="keyword">if</span> (inject) &#123;</span><br><span class="line">    <span class="comment">// inject is :any because flow is not smart enough to figure out cached</span></span><br><span class="line">    <span class="keyword">var</span> result = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">var</span> keys = hasSymbol</span><br><span class="line">      ? <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(inject)</span><br><span class="line">      : <span class="title class_">Object</span>.<span class="title function_">keys</span>(inject);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; keys.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> key = keys[i];</span><br><span class="line">      <span class="comment">// #6574 in case the inject object is observed...</span></span><br><span class="line">      <span class="keyword">if</span> (key === <span class="string">&#x27;__ob__&#x27;</span>) &#123; <span class="keyword">continue</span> &#125;</span><br><span class="line">      <span class="keyword">var</span> provideKey = inject[key].<span class="property">from</span>;</span><br><span class="line">      <span class="keyword">var</span> source = vm;</span><br><span class="line">      <span class="keyword">while</span> (source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (source.<span class="property">_provided</span> &amp;&amp; <span class="title function_">hasOwn</span>(source.<span class="property">_provided</span>, provideKey)) &#123;</span><br><span class="line">          result[key] = source.<span class="property">_provided</span>[provideKey];</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        source = source.<span class="property">$parent</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&#x27;default&#x27;</span> <span class="keyword">in</span> inject[key]) &#123;</span><br><span class="line">          <span class="keyword">var</span> provideDefault = inject[key].<span class="property">default</span>;</span><br><span class="line">          result[key] = <span class="keyword">typeof</span> provideDefault === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">            ? provideDefault.<span class="title function_">call</span>(vm)</span><br><span class="line">            : provideDefault;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">warn</span>((<span class="string">&quot;Injection \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; not found&quot;</span>), vm);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  父组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">bar</span>: <span class="number">342</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="attr">provide</span>: &#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">    <span class="attr">bar</span>: <span class="variable language_">this</span>.<span class="property">bar</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">inject</span>:[<span class="string">&#x27;foo&#x27;</span>,<span class="string">&#x27;bar&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="高级使用技巧"><a href="#高级使用技巧" class="headerlink" title="高级使用技巧"></a>高级使用技巧</h5><p>利用 Symbol 传递</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="title class_">Symbol</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Provider</span> = &#123;</span><br><span class="line">  <span class="title function_">provide</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      [s]: <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Child</span> = &#123;</span><br><span class="line">  <span class="attr">inject</span>:&#123;</span><br><span class="line">    s</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>inject 的值作为 props 和 data 的初始值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> child = &#123;</span><br><span class="line">  <span class="attr">inject</span>: [<span class="string">&#x27;foo&#x27;</span>],</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">prop</span>: &#123;</span><br><span class="line">      <span class="attr">default</span>: <span class="variable language_">this</span>.<span class="property">foo</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="attr">bar</span>: <span class="variable language_">this</span>.<span class="property">foo</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="name"><a href="#name" class="headerlink" title="name"></a>name</h4><p>  name 属性允许组件模板递归调用自身</p><h4 id="delimiters"><a href="#delimiters" class="headerlink" title="delimiters"></a>delimiters</h4><p>  改变 纯文本插入分隔符 默认为[‘,‘]</p><h5 id="源码-2"><a href="#源码-2" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> defaultTagRE = <span class="regexp">/\&#123;\&#123;((?:.|\r?\n)+?)\&#125;\&#125;/g</span>;</span><br><span class="line"><span class="keyword">var</span> regexEscapeRE = <span class="regexp">/[-.*+?^$&#123;&#125;()|[\]\/\\]/g</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> buildRegex = <span class="title function_">cached</span>(<span class="keyword">function</span> (<span class="params">delimiters</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> open = delimiters[<span class="number">0</span>].<span class="title function_">replace</span>(regexEscapeRE, <span class="string">&#x27;\\$&amp;&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> close = delimiters[<span class="number">1</span>].<span class="title function_">replace</span>(regexEscapeRE, <span class="string">&#x27;\\$&amp;&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegExp</span>(open + <span class="string">&#x27;((?:.|\\n)+?)&#x27;</span> + close, <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="使用-3"><a href="#使用-3" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">delimiters</span>: [<span class="string">&#x27;$&#123;&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>]  <span class="comment">// Vue 进行字符串切割替换的时候将会仿照 es6 的模板字符串</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="functional"><a href="#functional" class="headerlink" title="functional"></a>functional</h4><p>函数元组件  无状态(data)，无上下文(this)，没有响应式数据，相当于只是一个渲染组件，渲染之后就不会发生变化</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createFunctionalComponent</span> (<span class="title class_">Ctor</span>,propsData,data,contextVm,children) &#123;</span><br><span class="line">  <span class="keyword">var</span> options = <span class="title class_">Ctor</span>.<span class="property">options</span>;</span><br><span class="line">  <span class="keyword">var</span> props = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> propOptions = options.<span class="property">props</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isDef</span>(propOptions)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> propOptions) &#123;</span><br><span class="line">      props[key] = <span class="title function_">validateProp</span>(key, propOptions, propsData || emptyObject);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(data.<span class="property">attrs</span>)) &#123; <span class="title function_">mergeProps</span>(props, data.<span class="property">attrs</span>); &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isDef</span>(data.<span class="property">props</span>)) &#123; <span class="title function_">mergeProps</span>(props, data.<span class="property">props</span>); &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> renderContext = <span class="keyword">new</span> <span class="title class_">FunctionalRenderContext</span>(</span><br><span class="line">    data,</span><br><span class="line">    props,</span><br><span class="line">    children,</span><br><span class="line">    contextVm,</span><br><span class="line">    <span class="title class_">Ctor</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> vnode = options.<span class="property">render</span>.<span class="title function_">call</span>(<span class="literal">null</span>, renderContext.<span class="property">_c</span>, renderContext);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (vnode <span class="keyword">instanceof</span> <span class="title class_">VNode</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">cloneAndMarkFunctionalResult</span>(vnode, data, renderContext.<span class="property">parent</span>, options, renderContext)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(vnode)) &#123;</span><br><span class="line">    <span class="keyword">var</span> vnodes = <span class="title function_">normalizeChildren</span>(vnode) || [];</span><br><span class="line">    <span class="keyword">var</span> res = <span class="keyword">new</span> <span class="title class_">Array</span>(vnodes.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i =</span><br><span class="line">     <span class="number">0</span>; i &lt; vnodes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      res[i] = <span class="title function_">cloneAndMarkFunctionalResult</span>(vnodes[i], data, renderContext.<span class="property">parent</span>, options, renderContext);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用-4"><a href="#使用-4" class="headerlink" title="使用"></a>使用</h5><p>  <code>context</code> 参数 字段详解</p><ul><li><code>props</code> 提供所有 props 对象</li><li><code>children</code> VNode 子节点的数组</li><li><code>slots</code> 一个函数，返回了包含所有插槽的对象</li><li><code>scopedSlots</code> 一个暴露传入的作用域插槽的对象，也已函数形式暴露普通插槽</li><li><code>data</code> 传给组件的整个数据对象，作为 createElement 函数的第二个参数传入组件</li><li><code>parent</code> 对父组件的引用</li><li><code>listeners</code> 一个包含了所有父组件为当前组件注册的时间监听器对象，这是data.on的一个别名</li><li><code>injection</code> 注入的 <code>property</code></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>this is test for directive<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">function-component</span> <span class="attr">:list</span>=<span class="string">&quot;list&quot;</span> <span class="attr">other</span>=<span class="string">&quot;other&quot;</span>&gt;</span></span><br><span class="line">      this is a slot &#123;&#123;list.name&#125;&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">        this is slot default</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">function-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;function-component&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">functional</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      <span class="attr">list</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Object</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement, context</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> header = context.<span class="property">scopedSlots</span>.<span class="title function_">default</span>()</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">createElement</span>(</span><br><span class="line">        <span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">          <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, [header[<span class="number">0</span>]]),</span><br><span class="line">          <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, [header[<span class="number">1</span>]])</span><br><span class="line">        ] </span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">test3</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">testChild</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">hidden</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">list</span>: &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;listName&#x27;</span>,</span><br><span class="line">          <span class="attr">value</span>: <span class="string">&#x27;listValue&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">computed</span>: &#123;</span><br><span class="line">      <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">test1</span>: <span class="number">4</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="model"><a href="#model" class="headerlink" title="model"></a>model</h4><ul><li>prop(可选) String</li><li><p>event(可选) String</p><p>允许一个自定义组件在使用 <code>v-model</code> 时定制定制 prop 和 event，默认情况下，一个组件上的 <code>v-model</code> 会把 value 用作 prop 且把 input 用作 event，一些复杂的输入框可以使用 model 选项回避这些情况产生的冲突</p></li></ul><h5 id="源码-3"><a href="#源码-3" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">transformModel</span> (options, data) &#123;</span><br><span class="line">  <span class="keyword">var</span> prop = (options.<span class="property">model</span> &amp;&amp; options.<span class="property">model</span>.<span class="property">prop</span>) || <span class="string">&#x27;value&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> event = (options.<span class="property">model</span> &amp;&amp; options.<span class="property">model</span>.<span class="property">event</span>) || <span class="string">&#x27;input&#x27;</span></span><br><span class="line">  ;(data.<span class="property">attrs</span> || (data.<span class="property">attrs</span> = &#123;&#125;))[prop] = data.<span class="property">model</span>.<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">var</span> on = data.<span class="property">on</span> || (data.<span class="property">on</span> = &#123;&#125;);</span><br><span class="line">  <span class="keyword">var</span> existing = on[event];</span><br><span class="line">  <span class="keyword">var</span> callback = data.<span class="property">model</span>.<span class="property">callback</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isDef</span>(existing)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      <span class="title class_">Array</span>.<span class="title function_">isArray</span>(existing)</span><br><span class="line">        ? existing.<span class="title function_">indexOf</span>(callback) === -<span class="number">1</span></span><br><span class="line">        : existing !== callback</span><br><span class="line">    ) &#123;</span><br><span class="line">      on[event] = [callback].<span class="title function_">concat</span>(existing);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    on[event] = callback;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在设置值的时候通过一个 <code>||</code>(或) 来判断 model 是否赋值，否则取默认设置的 value 及 input</p><h5 id="使用-5"><a href="#使用-5" class="headerlink" title="使用"></a>使用</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;inputValue&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- input 组件内部 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">model</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">prop</span>: <span class="string">&#x27;text&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">event</span>: <span class="string">&#x27;change&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">text</span>: <span class="title class_">String</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">handleChange</span>(<span class="params">value</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;change&#x27;</span>, value)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="inheritAttrs"><a href="#inheritAttrs" class="headerlink" title="inheritAttrs"></a>inheritAttrs</h4><p>  默认情况下父作用域的不被认作 props 的 attribute 绑定 (attribute bindings) 将会“回退”且作为普通的 HTML attribute 应用在子组件的根元素上。当撰写包裹一个目标元素或另一个组件的组件时，这可能不会总是符合预期行为。通过设置 inheritAttrs 到 false，这些默认行为将会被去掉。而通过 (同样是 2.4 新增的) 实例 property $attrs 可以让这些 attribute 生效，且可以通过 v-bind 显性的绑定到非根元素上</p><h5 id="源码-4"><a href="#源码-4" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateAttrs</span> (oldVnode, vnode) &#123;</span><br><span class="line">  <span class="keyword">var</span> opts = vnode.<span class="property">componentOptions</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isDef</span>(opts) &amp;&amp; opts.<span class="property">Ctor</span>.<span class="property">options</span>.<span class="property">inheritAttrs</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isUndef</span>(oldVnode.<span class="property">data</span>.<span class="property">attrs</span>) &amp;&amp; <span class="title function_">isUndef</span>(vnode.<span class="property">data</span>.<span class="property">attrs</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> key, cur, old;</span><br><span class="line">  <span class="keyword">var</span> elm = vnode.<span class="property">elm</span>;</span><br><span class="line">  <span class="keyword">var</span> oldAttrs = oldVnode.<span class="property">data</span>.<span class="property">attrs</span> || &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> attrs = vnode.<span class="property">data</span>.<span class="property">attrs</span> || &#123;&#125;;</span><br><span class="line">  <span class="comment">// clone observed objects, as the user probably wants to mutate it</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isDef</span>(attrs.<span class="property">__ob__</span>)) &#123;</span><br><span class="line">    attrs = vnode.<span class="property">data</span>.<span class="property">attrs</span> = <span class="title function_">extend</span>(&#123;&#125;, attrs);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (key <span class="keyword">in</span> attrs) &#123;</span><br><span class="line">    cur = attrs[key];</span><br><span class="line">    old = oldAttrs[key];</span><br><span class="line">    <span class="keyword">if</span> (old !== cur) &#123;</span><br><span class="line">      <span class="title function_">setAttr</span>(elm, key, cur);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// #4391: in IE9, setting type can reset value for input[type=radio]</span></span><br><span class="line">  <span class="comment">// #6666: IE/Edge forces progress value down to 1 before setting a max</span></span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> ((isIE || isEdge) &amp;&amp; attrs.<span class="property">value</span> !== oldAttrs.<span class="property">value</span>) &#123;</span><br><span class="line">    <span class="title function_">setAttr</span>(elm, <span class="string">&#x27;value&#x27;</span>, attrs.<span class="property">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (key <span class="keyword">in</span> oldAttrs) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isUndef</span>(attrs[key])) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isXlink</span>(key)) &#123;</span><br><span class="line">        elm.<span class="title function_">removeAttributeNS</span>(xlinkNS, <span class="title function_">getXlinkProp</span>(key));</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="title function_">isEnumeratedAttr</span>(key)) &#123;</span><br><span class="line">        elm.<span class="title function_">removeAttribute</span>(key);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在更新的时候 判断一下 inheritAttrs 的值，如果为 false 直接返回</p><h5 id="使用-6"><a href="#使用-6" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">inheritAttrs</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="comments"><a href="#comments" class="headerlink" title="comments"></a>comments</h4><p>  主要作用是 是否保留渲染模板中的 HTML 注释</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;parent&quot;&gt;&lt;a href=&quot;#parent&quot; class=&quot;headerlink&quot; title=&quot;parent&quot;&gt;&lt;/a&gt;parent&lt;/h4&gt;&lt;p&gt;主要用来存储 Vue 组件的父组件&lt;/p&gt;
&lt;h4 id=&quot;mixins&quot;&gt;&lt;a href=&quot;#mixins</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/categories/SourceCode/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/tags/SourceCode/"/>
    
  </entry>
  
  <entry>
    <title>跟着 Vue源码学习 Vue api 系列 (四) - 选项 / DOM 及 生命周期函数、filters,directives,components</title>
    <link href="https://lxx1997.github.io/2021/01/27/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-04/"/>
    <id>https://lxx1997.github.io/2021/01/27/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-04/</id>
    <published>2021-01-27T14:16:53.000Z</published>
    <updated>2021-01-27T14:16:53.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="el，template-render"><a href="#el，template-render" class="headerlink" title="el，template render"></a>el，template render</h4><h5 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h5><p>el 指定的元素作为 Vue 实例的挂载目标 主要是通过 Vue 实例的 $mount 方法</p><p>$mount 方法 主要 通过 el 获取到 DOM 元素 然后调用 mountComponents 方法 绑定到 Vue 实例上，最后返回 Vue 实例<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$mount</span> = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  el,</span></span><br><span class="line"><span class="params">  hydrating</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  el = el &amp;&amp; inBrowser ? <span class="title function_">query</span>(el) : <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">mountComponent</span>(<span class="variable language_">this</span>, el, hydrating)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>mountComponent 方法</p><ul><li>判断 是否有render函数，没有提示至少要有template或者render函数 (tempalte,el,render 不同同时使用)</li><li>调用 beforeMount 声明周期</li><li>判断是否开启性能优化检查</li><li>对 vm 的 updateComponet 函数进行 监听变化，如果发生变化，触发 beforeUpdate 生命周期函数</li><li>Vue 实例上挂载了 node 节点后更改 Vue 是否挂载状态</li><li>调用 mounted 生命周期</li><li>返回 挂载了 DOM 元素的 Vue 实例<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mountComponent</span> (vm, el, hydrating) &#123;</span><br><span class="line">  vm.<span class="property">$el</span> = el;</span><br><span class="line">  <span class="keyword">if</span> (!vm.<span class="property">$options</span>.<span class="property">render</span>) &#123;</span><br><span class="line">    vm.<span class="property">$options</span>.<span class="property">render</span> = createEmptyVNode;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">      <span class="keyword">if</span> ((vm.<span class="property">$options</span>.<span class="property">template</span> &amp;&amp; vm.<span class="property">$options</span>.<span class="property">template</span>.<span class="title function_">charAt</span>(<span class="number">0</span>) !== <span class="string">&#x27;#&#x27;</span>) ||</span><br><span class="line">        vm.<span class="property">$options</span>.<span class="property">el</span> || el) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(</span><br><span class="line">          <span class="string">&#x27;You are using the runtime-only build of Vue where the template &#x27;</span> +</span><br><span class="line">          <span class="string">&#x27;compiler is not available. Either pre-compile the templates into &#x27;</span> +</span><br><span class="line">          <span class="string">&#x27;render functions, or use the compiler-included build.&#x27;</span>,</span><br><span class="line">          vm</span><br><span class="line">        );</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">warn</span>(</span><br><span class="line">          <span class="string">&#x27;Failed to mount component: template or render function not defined.&#x27;</span>,</span><br><span class="line">          vm</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeMount&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> updateComponent;</span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (config.<span class="property">performance</span> &amp;&amp; mark) &#123;</span><br><span class="line">    updateComponent = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> name = vm.<span class="property">_name</span>;</span><br><span class="line">      <span class="keyword">var</span> id = vm.<span class="property">_uid</span>;</span><br><span class="line">      <span class="keyword">var</span> startTag = <span class="string">&quot;vue-perf-start:&quot;</span> + id;</span><br><span class="line">      <span class="keyword">var</span> endTag = <span class="string">&quot;vue-perf-end:&quot;</span> + id;</span><br><span class="line"></span><br><span class="line">      <span class="title function_">mark</span>(startTag);</span><br><span class="line">      <span class="keyword">var</span> vnode = vm.<span class="title function_">_render</span>();</span><br><span class="line">      <span class="title function_">mark</span>(endTag);</span><br><span class="line">      <span class="title function_">measure</span>((<span class="string">&quot;vue &quot;</span> + name + <span class="string">&quot; render&quot;</span>), startTag, endTag);</span><br><span class="line"></span><br><span class="line">      <span class="title function_">mark</span>(startTag);</span><br><span class="line">      vm.<span class="title function_">_update</span>(vnode, hydrating);</span><br><span class="line">      <span class="title function_">mark</span>(endTag);</span><br><span class="line">      <span class="title function_">measure</span>((<span class="string">&quot;vue &quot;</span> + name + <span class="string">&quot; patch&quot;</span>), startTag, endTag);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    updateComponent = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      vm.<span class="title function_">_update</span>(vm.<span class="title function_">_render</span>(), hydrating);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// we set this to vm._watcher inside the watcher&#x27;s constructor</span></span><br><span class="line">  <span class="comment">// since the watcher&#x27;s initial patch may call $forceUpdate (e.g. inside child</span></span><br><span class="line">  <span class="comment">// component&#x27;s mounted hook), which relies on vm._watcher being already defined</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, updateComponent, noop, &#123;</span><br><span class="line">    <span class="attr">before</span>: <span class="keyword">function</span> <span class="title function_">before</span> () &#123;</span><br><span class="line">      <span class="keyword">if</span> (vm.<span class="property">_isMounted</span> &amp;&amp; !vm.<span class="property">_isDestroyed</span>) &#123;</span><br><span class="line">        <span class="title function_">callHook</span>(vm, <span class="string">&#x27;beforeUpdate&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="literal">true</span> <span class="comment">/* isRenderWatcher */</span>);</span><br><span class="line">  hydrating = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// manually mounted instance, call mounted on self</span></span><br><span class="line">  <span class="comment">// mounted is called for render-created child components in its inserted hook</span></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">$vnode</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">    vm.<span class="property">_isMounted</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="title function_">callHook</span>(vm, <span class="string">&#x27;mounted&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`&lt;div&gt;test&lt;/div&gt;`</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`&lt;div&gt;test&lt;/div&gt;`</span></span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> <span class="title function_">h</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="生命周期函数"><a href="#生命周期函数" class="headerlink" title="生命周期函数"></a>生命周期函数</h4><h5 id="源码-1"><a href="#源码-1" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">callHook</span> (vm, hook) &#123;</span><br><span class="line">  <span class="comment">// #7573 disable dep collection when invoking lifecycle hooks</span></span><br><span class="line">  <span class="title function_">pushTarget</span>();</span><br><span class="line">  <span class="keyword">var</span> handlers = vm.<span class="property">$options</span>[hook]; <span class="comment">// 接收到的是一个数组</span></span><br><span class="line">  <span class="keyword">var</span> info = hook + <span class="string">&quot; hook&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (handlers) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, j = handlers.<span class="property">length</span>; i &lt; j; i++) &#123;</span><br><span class="line">      <span class="title function_">invokeWithErrorHandling</span>(handlers[i], vm, <span class="literal">null</span>, vm, info);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="property">_hasHookEvent</span>) &#123;</span><br><span class="line">    vm.$emit(<span class="string">&#x27;hook:&#x27;</span> + hook);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">popTarget</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">invokeWithErrorHandling</span> (handler,context,args,vm,info) &#123;</span><br><span class="line">  <span class="keyword">var</span> res;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    res = args ? handler.<span class="title function_">apply</span>(context, args) : handler.<span class="title function_">call</span>(context);</span><br><span class="line">    <span class="keyword">if</span> (res &amp;&amp; !res.<span class="property">_isVue</span> &amp;&amp; <span class="title function_">isPromise</span>(res) &amp;&amp; !res.<span class="property">_handled</span>) &#123;</span><br><span class="line">      res.<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="keyword">return</span> <span class="title function_">handleError</span>(e, vm, info + <span class="string">&quot; (Promise/async)&quot;</span>); &#125;);</span><br><span class="line">      <span class="comment">// issue #9511</span></span><br><span class="line">      <span class="comment">// avoid catch triggering multiple times when nested calls</span></span><br><span class="line">      res.<span class="property">_handled</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">handleError</span>(e, vm, info);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 callHook 方法中，主要是针对组件 生命周期进行处理，调用 invokeWithErrorHandling 方法 执行生命周期函数</p><p>在 invokeWithErrorHandling 方法中，通过 call 和 apply 执行生命周期函数及传参</p><h5 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h5><p><strong>生命周期函数</strong></p><ul><li><code>beforeCreate</code></li><li><code>created</code></li><li><code>beforeMount</code></li><li><code>mounted</code></li><li><code>beforeUpdate</code></li><li><code>updated</code></li><li><code>beforeDestroy</code></li><li><code>destroyed</code></li><li><code>activated</code></li><li><code>deactivated</code></li><li><code>errorCaptured</code></li><li><code>serverPrefetch</code></li></ul><p><strong>生命周期函数执行顺序</strong></p><ol><li>在 initMixin函数中，定义了 Vue 的 _init 函数，初始化 Vue 信息，合并 Vue 的 options 信息，初始化生命周期，初始化事件对象，初始化渲染方法</li><li>调用 <code>beforeCreate</code> 生命周期 <em>不能访问到数据和dom元素，但是能够访问生命周期函数</em></li><li>初始化注册函数，初始化 data，props，methods，watch,provide</li><li>调用 <code>created</code> 生命周期 <em>能获取到数据及方法，但是无法操作 dom</em></li><li>调用 $mount 方法挂载 DOM 元素 绑定 el 对应的 DOM 元素</li><li>调用 <code>beforeMount</code> 生命周期</li><li>调用 _update 挂载 DOM 元素,</li><li>使用 Watcher 构造函数 监听 updateComponent 方法，触发 <code>beforeUpdate</code> 生命周期</li><li>调用 <code>mounted</code> 生命周期</li><li>页面发生变化 时触发 <code>updated</code> 生命周期</li><li>页面销毁时时触发 <code>$destroy</code> 方法</li><li>调用 <code>beforeDestroy</code> 生命周期</li><li>清空 watcher，child，组件 及事件监听函数</li><li>调用 <code>destroyed</code> 生命周期</li></ol><p><strong>特殊的生命周期函数</strong></p><p>  <code>activated/deactivated</code> 只有被 keep-alive 组件包围的组件才有 这个生命周期函数</p><p>  <code>errorCaptured</code> 全局报错信息的生命周期函数，报错捕获</p><h4 id="directives"><a href="#directives" class="headerlink" title="directives"></a>directives</h4><h5 id="源码-2"><a href="#源码-2" class="headerlink" title="源码"></a>源码</h5><p>请参照 <a href="/2021/01/20/vue-learn-api-with-%E6%BA%90%E7%A0%81-02/#Vue-directive-id-string-definition-Function-Object">Vue.directive</a></p><h5 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">directives</span>: &#123;</span><br><span class="line">    <span class="attr">clip</span>: &#123;</span><br><span class="line">      <span class="attr">insert</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">      <span class="attr">bind</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">      <span class="attr">componentUpdate</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="filters"><a href="#filters" class="headerlink" title="filters"></a>filters</h4><h5 id="源码-3"><a href="#源码-3" class="headerlink" title="源码"></a>源码</h5><p>请参照 <a href="/2021/01/20/vue-learn-api-with-%E6%BA%90%E7%A0%81-02/#Vue-filter-id-string-definition-Function">Vue.filter</a></p><h5 id="使用-3"><a href="#使用-3" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">filters</span>: &#123;</span><br><span class="line">    <span class="attr">clip</span>: <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="components"><a href="#components" class="headerlink" title="components"></a>components</h4><h5 id="源码-4"><a href="#源码-4" class="headerlink" title="源码"></a>源码</h5><p>请参照 <a href="/2021/01/20/vue-learn-api-with-%E6%BA%90%E7%A0%81-02/#Vue-component-id-string-definition-Function-Object">Vue.component</a></p><h5 id="使用-4"><a href="#使用-4" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">FirstComponent</span>,</span><br><span class="line">    <span class="title class_">SecondComponent</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;el，template-render&quot;&gt;&lt;a href=&quot;#el，template-render&quot; class=&quot;headerlink&quot; title=&quot;el，template render&quot;&gt;&lt;/a&gt;el，template render&lt;/h4&gt;&lt;h5 id=&quot;源</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/categories/SourceCode/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/tags/SourceCode/"/>
    
  </entry>
  
  <entry>
    <title>跟着 Vue源码学习 Vue api 系列 (三) - Watcher 方法详解</title>
    <link href="https://lxx1997.github.io/2021/01/27/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-watcher/"/>
    <id>https://lxx1997.github.io/2021/01/27/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-watcher/</id>
    <published>2021-01-27T13:45:28.000Z</published>
    <updated>2021-01-27T13:45:28.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Watcher</span> = <span class="keyword">function</span> <span class="title function_">Watcher</span> (</span><br><span class="line">  vm, <span class="comment">// Vue 实例</span></span><br><span class="line">  expOrFn,  <span class="comment">// key值，watch 的属性</span></span><br><span class="line">  cb,   <span class="comment">// 回调函数</span></span><br><span class="line">  options,  <span class="comment">// 配置 &#123;lazy: true&#125;</span></span><br><span class="line">  isRenderWatcher <span class="comment">// 是否 在 Vue 实例上记载 Watcher </span></span><br><span class="line">) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">vm</span> = vm;</span><br><span class="line">  <span class="keyword">if</span> (isRenderWatcher) &#123;</span><br><span class="line">    vm.<span class="property">_watcher</span> = <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  vm.<span class="property">_watchers</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>);</span><br><span class="line">  <span class="comment">// options</span></span><br><span class="line">  <span class="keyword">if</span> (options) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deep</span> = !!options.<span class="property">deep</span>; <span class="comment">// 深度监听 针对 对象</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">user</span> = !!options.<span class="property">user</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lazy</span> = !!options.<span class="property">lazy</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sync</span> = !!options.<span class="property">sync</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">before</span> = options.<span class="property">before</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deep</span> = <span class="variable language_">this</span>.<span class="property">user</span> = <span class="variable language_">this</span>.<span class="property">lazy</span> = <span class="variable language_">this</span>.<span class="property">sync</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">cb</span> = cb;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">id</span> = ++uid$<span class="number">2</span>; <span class="comment">// uid for batching</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">active</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="variable language_">this</span>.<span class="property">lazy</span>; <span class="comment">// for lazy watchers</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">deps</span> = [];</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">newDeps</span> = [];</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">depIds</span> = <span class="keyword">new</span> <span class="title function_">_Set</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">newDepIds</span> = <span class="keyword">new</span> <span class="title function_">_Set</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">expression</span> = expOrFn.<span class="title function_">toString</span>();</span><br><span class="line">  <span class="comment">// parse expression for getter</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> expOrFn === <span class="string">&#x27;function&#x27;</span>) &#123; <span class="comment">// 判断 传入的 watch 函数 是否是函数，如果是函数，直接设置为 getter 函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">getter</span> = expOrFn;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;  <span class="comment">// 如果是对象，提取 函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">getter</span> = <span class="title function_">parsePath</span>(expOrFn);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">getter</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">getter</span> = noop;</span><br><span class="line">      <span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&quot;Failed watching path: \&quot;&quot;</span> + expOrFn + <span class="string">&quot;\&quot; &quot;</span> +</span><br><span class="line">        <span class="string">&#x27;Watcher only accepts simple dot-delimited paths. &#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;For full control, use a function instead.&#x27;</span>,</span><br><span class="line">        vm</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">lazy</span></span><br><span class="line">    ? <span class="literal">undefined</span></span><br><span class="line">    : <span class="variable language_">this</span>.<span class="title function_">get</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Evaluate the getter, and re-collect dependencies.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Watcher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">get</span> = <span class="keyword">function</span> <span class="title function_">get</span> () &#123;</span><br><span class="line">  <span class="title function_">pushTarget</span>(<span class="variable language_">this</span>); <span class="comment">// 设置 Dep 构造函数的 target 为当前 Watcher 实例</span></span><br><span class="line">  <span class="keyword">var</span> value;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="variable language_">this</span>.<span class="property">vm</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    value = <span class="variable language_">this</span>.<span class="property">getter</span>.<span class="title function_">call</span>(vm, vm); <span class="comment">// 调用 getter 函数，并将 vue 实例作为参数传进去</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span>) &#123;</span><br><span class="line">      <span class="title function_">handleError</span>(e, vm, (<span class="string">&quot;getter for watcher \&quot;&quot;</span> + (<span class="variable language_">this</span>.<span class="property">expression</span>) + <span class="string">&quot;\&quot;&quot;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> e</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// &quot;touch&quot; every property so they are all tracked as</span></span><br><span class="line">    <span class="comment">// dependencies for deep watching</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">deep</span>) &#123;</span><br><span class="line">      <span class="title function_">traverse</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">popTarget</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">cleanupDeps</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> value</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Add a dependency to this directive.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 此处 添加发布订阅模式，将 发布订阅模式 与 watcher 关联起来</span></span><br><span class="line"><span class="title class_">Watcher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">addDep</span> = <span class="keyword">function</span> <span class="title function_">addDep</span> (dep) &#123;</span><br><span class="line">  <span class="keyword">var</span> id = dep.<span class="property">id</span>;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">has</span>(id)) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">add</span>(id);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">newDeps</span>.<span class="title function_">push</span>(dep);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">depIds</span>.<span class="title function_">has</span>(id)) &#123;</span><br><span class="line">      dep.<span class="title function_">addSub</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Clean up for dependency collection.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Watcher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">cleanupDeps</span> = <span class="keyword">function</span> <span class="title function_">cleanupDeps</span> () &#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    <span class="keyword">var</span> dep = <span class="variable language_">this</span>.<span class="property">deps</span>[i];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">has</span>(dep.<span class="property">id</span>)) &#123;</span><br><span class="line">      dep.<span class="title function_">removeSub</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> tmp = <span class="variable language_">this</span>.<span class="property">depIds</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">depIds</span> = <span class="variable language_">this</span>.<span class="property">newDepIds</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">newDepIds</span> = tmp;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">newDepIds</span>.<span class="title function_">clear</span>();</span><br><span class="line">  tmp = <span class="variable language_">this</span>.<span class="property">deps</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">deps</span> = <span class="variable language_">this</span>.<span class="property">newDeps</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">newDeps</span> = tmp;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">newDeps</span>.<span class="property">length</span> = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Subscriber interface.</span></span><br><span class="line"><span class="comment"> * Will be called when a dependency changes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Watcher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">update</span> = <span class="keyword">function</span> <span class="title function_">update</span> () &#123;</span><br><span class="line">  <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">lazy</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">sync</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">run</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">queueWatcher</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Scheduler job interface.</span></span><br><span class="line"><span class="comment"> * Will be called by the scheduler.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Watcher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">run</span> = <span class="keyword">function</span> <span class="title function_">run</span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="variable language_">this</span>.<span class="title function_">get</span>();</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      value !== <span class="variable language_">this</span>.<span class="property">value</span> ||</span><br><span class="line">      <span class="comment">// Deep watchers and watchers on Object/Arrays should fire even</span></span><br><span class="line">      <span class="comment">// when the value is the same, because the value may</span></span><br><span class="line">      <span class="comment">// have mutated.</span></span><br><span class="line">      <span class="title function_">isObject</span>(value) ||</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deep</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="comment">// set new value</span></span><br><span class="line">      <span class="keyword">var</span> oldValue = <span class="variable language_">this</span>.<span class="property">value</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">user</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">cb</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, value, oldValue);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="title function_">handleError</span>(e, <span class="variable language_">this</span>.<span class="property">vm</span>, (<span class="string">&quot;callback for watcher \&quot;&quot;</span> + (<span class="variable language_">this</span>.<span class="property">expression</span>) + <span class="string">&quot;\&quot;&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cb</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, value, oldValue);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Evaluate the value of the watcher.</span></span><br><span class="line"><span class="comment"> * This only gets called for lazy watchers.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Watcher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">evaluate</span> = <span class="keyword">function</span> <span class="title function_">evaluate</span> () &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">value</span> = <span class="variable language_">this</span>.<span class="title function_">get</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dirty</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Depend on all deps collected by this watcher.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Watcher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">depend</span> = <span class="keyword">function</span> <span class="title function_">depend</span> () &#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deps</span>[i].<span class="title function_">depend</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Remove self from all dependencies&#x27; subscriber list.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Watcher</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">teardown</span> = <span class="keyword">function</span> <span class="title function_">teardown</span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">active</span>) &#123;</span><br><span class="line">    <span class="comment">// remove self from vm&#x27;s watcher list</span></span><br><span class="line">    <span class="comment">// this is a somewhat expensive operation so we skip it</span></span><br><span class="line">    <span class="comment">// if the vm is being destroyed.</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">_isBeingDestroyed</span>) &#123;</span><br><span class="line">      <span class="title function_">remove</span>(<span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">_watchers</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">deps</span>[i].<span class="title function_">removeSub</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">active</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;l</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/categories/SourceCode/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/tags/SourceCode/"/>
    
  </entry>
  
  <entry>
    <title>跟着 Vue源码学习 Vue api 系列 (三) - 选项 / 数据</title>
    <link href="https://lxx1997.github.io/2021/01/24/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-03/"/>
    <id>https://lxx1997.github.io/2021/01/24/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-03/</id>
    <published>2021-01-24T14:38:26.000Z</published>
    <updated>2021-01-24T14:38:26.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="data"><a href="#data" class="headerlink" title="data"></a>data</h4><p>在 data 中的数据 在 vue2 中会使用 Object.defineProperty 方法监听数据变化（vue3 采用 proxy）当数据发生变化的时候，会带动页面发生变化</p><p>在使用data的时候推介使用 返回一个初始对象的函数的方法，如果 data 是一个纯粹的对象，会造成 Vue 所有实例共享同一个引用数据对象</p><h5 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initData</span> (vm) &#123;</span><br><span class="line">  <span class="keyword">var</span> data = vm.<span class="property">$options</span>.<span class="property">data</span>;</span><br><span class="line">  data = vm.<span class="property">_data</span> = <span class="keyword">typeof</span> data === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">    ? <span class="title function_">getData</span>(data, vm)</span><br><span class="line">    : data || &#123;&#125;;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">isPlainObject</span>(data)) &#123;</span><br><span class="line">    data = &#123;&#125;;</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">&#x27;data functions should return an object:\n&#x27;</span> +</span><br><span class="line">      <span class="string">&#x27;https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function&#x27;</span>,</span><br><span class="line">      vm</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// proxy data on instance</span></span><br><span class="line">  <span class="keyword">var</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(data);</span><br><span class="line">  <span class="keyword">var</span> props = vm.<span class="property">$options</span>.<span class="property">props</span>;</span><br><span class="line">  <span class="keyword">var</span> methods = vm.<span class="property">$options</span>.<span class="property">methods</span>;</span><br><span class="line">  <span class="keyword">var</span> i = keys.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    <span class="keyword">var</span> key = keys[i];</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (methods &amp;&amp; <span class="title function_">hasOwn</span>(methods, key)) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(</span><br><span class="line">          (<span class="string">&quot;Method \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; has already been defined as a data property.&quot;</span>),</span><br><span class="line">          vm</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (props &amp;&amp; <span class="title function_">hasOwn</span>(props, key)) &#123;</span><br><span class="line">      <span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&quot;The data property \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; is already declared as a prop. &quot;</span> +</span><br><span class="line">        <span class="string">&quot;Use prop default value instead.&quot;</span>,</span><br><span class="line">        vm</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="title function_">isReserved</span>(key)) &#123;</span><br><span class="line">      <span class="title function_">proxy</span>(vm, <span class="string">&quot;_data&quot;</span>, key);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// observe data</span></span><br><span class="line">  <span class="title function_">observe</span>(data, <span class="literal">true</span> <span class="comment">/* asRootData */</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述源码 主要是判断一下 data 的 类型以及判断 data 定义的变量名是否在 props 及 methods 中是否也存在，之后调用 observe 方法给 data 对象添加数据监听</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getData</span> (data, vm) &#123;</span><br><span class="line">  <span class="comment">// #7573 disable dep collection when invoking data getters</span></span><br><span class="line">  <span class="title function_">pushTarget</span>();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> data.<span class="title function_">call</span>(vm, vm)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="title function_">handleError</span>(e, vm, <span class="string">&quot;data()&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="title function_">popTarget</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>数据映射，将 data 的数据映射到 Vue 实例上，这样我们通过 Vue.property 的方法也能访问到 data 上的数据</p><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">parameter</span>: <span class="string">&#x27;parameter&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="props"><a href="#props" class="headerlink" title="props"></a>props</h4><h5 id="源码-1"><a href="#源码-1" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">normalizeProps</span> (options, vm) &#123;</span><br><span class="line">  <span class="keyword">var</span> props = options.<span class="property">props</span>;</span><br><span class="line">  <span class="keyword">if</span> (!props) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> res = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> i, val, name;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(props)) &#123; <span class="comment">// 判断 props 类型 第一种是传递数组 [&#x27;props1&#x27;, &#x27;props2&#x27;]</span></span><br><span class="line">    i = props.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      val = props[i];</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> val === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        name = <span class="title function_">camelize</span>(val);</span><br><span class="line">        res[name] = &#123; <span class="attr">type</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">warn</span>(<span class="string">&#x27;props must be strings when using array syntax.&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(props)) &#123;  <span class="comment">// 判断 props 类型 第二种是传递带有类型检查的对象</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> props) &#123;</span><br><span class="line">      val = props[key];</span><br><span class="line">      name = <span class="title function_">camelize</span>(key);</span><br><span class="line">      res[name] = <span class="title function_">isPlainObject</span>(val)</span><br><span class="line">        ? val</span><br><span class="line">        : &#123; <span class="attr">type</span>: val &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">&quot;Invalid value for option \&quot;props\&quot;: expected an Array or an Object, &quot;</span> +</span><br><span class="line">      <span class="string">&quot;but got &quot;</span> + (<span class="title function_">toRawType</span>(props)) + <span class="string">&quot;.&quot;</span>,</span><br><span class="line">      vm</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  options.<span class="property">props</span> = res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h5><p>  props 有两种使用方式</p><ul><li><p>数组方式</p><p>子组件用一个数组接收父组件传递的props <code>props: [&#39;props1&#39;, &#39;props2&#39;]</code><br><strong>缺点</strong>就是无法做类型检查，无法控制接收到的 props 的数据类型及默认值</p></li><li><p>对象方式</p><p>子组件用一个对象接收父组件传入的props<br>对象属性上有以下参数  </p><ul><li><code>type</code> props 的数据类型，单个类型 直接判断 <code>type: String</code> ，多个类型 传递数组 <code>type: [String, Array]</code></li><li><code>default</code> 默认值，如果父组件没有传递此 props，将会自动取默认值</li><li><code>require</code>  是否必传</li><li><code>validator</code> 自定义验证函数<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// props: [&#x27;props1&#x27;, &#x27;props2&#x27;]</span></span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">props1</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">require</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">validator</span>: <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">props</span>: <span class="title class_">Number</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="propsData"><a href="#propsData" class="headerlink" title="propsData"></a>propsData</h4><p>  使用 new 创建 Vue 实例的时候使用</p><h5 id="源码-2"><a href="#源码-2" class="headerlink" title="源码"></a>源码</h5><p>  此源码也包含 props<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initProps</span> (vm, propsOptions) &#123;</span><br><span class="line">  <span class="keyword">var</span> propsData = vm.<span class="property">$options</span>.<span class="property">propsData</span> || &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> props = vm.<span class="property">_props</span> = &#123;&#125;;</span><br><span class="line">  <span class="comment">// cache prop keys so that future props updates can iterate using Array</span></span><br><span class="line">  <span class="comment">// instead of dynamic object key enumeration.</span></span><br><span class="line">  <span class="keyword">var</span> keys = vm.<span class="property">$options</span>.<span class="property">_propKeys</span> = [];</span><br><span class="line">  <span class="keyword">var</span> isRoot = !vm.<span class="property">$parent</span>;</span><br><span class="line">  <span class="comment">// root instance props should be converted</span></span><br><span class="line">  <span class="keyword">if</span> (!isRoot) &#123;</span><br><span class="line">    <span class="title function_">toggleObserving</span>(<span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> loop = <span class="keyword">function</span> (<span class="params"> key </span>) &#123;</span><br><span class="line">    keys.<span class="title function_">push</span>(key);</span><br><span class="line">    <span class="keyword">var</span> value = <span class="title function_">validateProp</span>(key, propsOptions, propsData, vm);</span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">var</span> hyphenatedKey = <span class="title function_">hyphenate</span>(key);</span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isReservedAttribute</span>(hyphenatedKey) ||</span><br><span class="line">          config.<span class="title function_">isReservedAttr</span>(hyphenatedKey)) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(</span><br><span class="line">          (<span class="string">&quot;\&quot;&quot;</span> + hyphenatedKey + <span class="string">&quot;\&quot; is a reserved attribute and cannot be used as component prop.&quot;</span>),</span><br><span class="line">          vm</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">defineReactive$$1</span>(props, key, value, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isRoot &amp;&amp; !isUpdatingChildComponent) &#123;</span><br><span class="line">          <span class="title function_">warn</span>(</span><br><span class="line">            <span class="string">&quot;Avoid mutating a prop directly since the value will be &quot;</span> +</span><br><span class="line">            <span class="string">&quot;overwritten whenever the parent component re-renders. &quot;</span> +</span><br><span class="line">            <span class="string">&quot;Instead, use a data or computed property based on the prop&#x27;s &quot;</span> +</span><br><span class="line">            <span class="string">&quot;value. Prop being mutated: \&quot;&quot;</span> + key + <span class="string">&quot;\&quot;&quot;</span>,</span><br><span class="line">            vm</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// static props are already proxied on the component&#x27;s prototype</span></span><br><span class="line">    <span class="comment">// during Vue.extend(). We only need to proxy props defined at</span></span><br><span class="line">    <span class="comment">// instantiation here.</span></span><br><span class="line">    <span class="keyword">if</span> (!(key <span class="keyword">in</span> vm)) &#123;</span><br><span class="line">      <span class="title function_">proxy</span>(vm, <span class="string">&quot;_props&quot;</span>, key);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> propsOptions) <span class="title function_">loop</span>( key );</span><br><span class="line">  <span class="title function_">toggleObserving</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>此方法主要是在初始化的时候 将propsData，props进行响应式处理</p><h5 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>（&#123;</span><br><span class="line">  <span class="attr">propsData</span>: &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;123</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h4><h5 id="源码-3"><a href="#源码-3" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initComputed</span> (vm, computed) &#123;</span><br><span class="line">  <span class="comment">// 创建一个 watcher 对象</span></span><br><span class="line">  <span class="keyword">var</span> watchers = vm.<span class="property">_computedWatchers</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">// 判断当前页面渲染类型 是否是服务端渲染</span></span><br><span class="line">  <span class="keyword">var</span> isSSR = <span class="title function_">isServerRendering</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> computed) &#123;  <span class="comment">// 遍历 computed 对象 获取属性的返回值</span></span><br><span class="line">    <span class="keyword">var</span> userDef = computed[key];</span><br><span class="line">    <span class="keyword">var</span> getter = <span class="keyword">typeof</span> userDef === <span class="string">&#x27;function&#x27;</span> ? userDef : userDef.<span class="property">get</span>;</span><br><span class="line">    <span class="keyword">if</span> (getter == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_">warn</span>(</span><br><span class="line">        (<span class="string">&quot;Getter is missing for computed property \&quot;&quot;</span> + key + <span class="string">&quot;\&quot;.&quot;</span>),</span><br><span class="line">        vm</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果 当前页面不是服务端渲染，调用 watcher 方法监听 computed 数值变化</span></span><br><span class="line">    <span class="keyword">if</span> (!isSSR) &#123; </span><br><span class="line">      watchers[key] = <span class="keyword">new</span> <span class="title class_">Watcher</span>(</span><br><span class="line">        vm,</span><br><span class="line">        getter || noop,</span><br><span class="line">        noop,</span><br><span class="line">        computedWatcherOptions</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(key <span class="keyword">in</span> vm)) &#123; <span class="comment">// 关键的一步，判断 computed 定义的变量在props及data中是否有值</span></span><br><span class="line">      <span class="title function_">defineComputed</span>(vm, key, userDef);  <span class="comment">// 给 computed 的属性添加 get 方法</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (key <span class="keyword">in</span> vm.<span class="property">$data</span>) &#123;</span><br><span class="line">        <span class="title function_">warn</span>((<span class="string">&quot;The computed property \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; is already defined in data.&quot;</span>), vm);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (vm.<span class="property">$options</span>.<span class="property">props</span> &amp;&amp; key <span class="keyword">in</span> vm.<span class="property">$options</span>.<span class="property">props</span>) &#123;</span><br><span class="line">        <span class="title function_">warn</span>((<span class="string">&quot;The computed property \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; is already defined as a prop.&quot;</span>), vm);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>defineComputed 函数  主要作用是设置 映射到 Vue 实例上的 computed 属性的 get 和 set 方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">defineComputed</span> (</span><br><span class="line">  target,</span><br><span class="line">  key,</span><br><span class="line">  userDef</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="comment">// 同样，首先判断一下是否是服务端渲染</span></span><br><span class="line">  <span class="keyword">var</span> shouldCache = !<span class="title function_">isServerRendering</span>();</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> userDef === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    sharedPropertyDefinition.<span class="property">get</span> = shouldCache</span><br><span class="line">      ? <span class="title function_">createComputedGetter</span>(key)</span><br><span class="line">      : <span class="title function_">createGetterInvoker</span>(userDef);</span><br><span class="line">    sharedPropertyDefinition.<span class="property">set</span> = noop;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    sharedPropertyDefinition.<span class="property">get</span> = userDef.<span class="property">get</span></span><br><span class="line">      ? shouldCache &amp;&amp; userDef.<span class="property">cache</span> !== <span class="literal">false</span></span><br><span class="line">        ? <span class="title function_">createComputedGetter</span>(key)</span><br><span class="line">        : <span class="title function_">createGetterInvoker</span>(userDef.<span class="property">get</span>)</span><br><span class="line">      : noop;</span><br><span class="line">    sharedPropertyDefinition.<span class="property">set</span> = userDef.<span class="property">set</span> || noop;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (sharedPropertyDefinition.<span class="property">set</span> === noop) &#123;</span><br><span class="line">    sharedPropertyDefinition.<span class="property">set</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">warn</span>(</span><br><span class="line">        (<span class="string">&quot;Computed property \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; was assigned to but it has no setter.&quot;</span>),</span><br><span class="line">        <span class="variable language_">this</span></span><br><span class="line">      );</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, sharedPropertyDefinition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createComputedGetter</span> (key) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">computedGetter</span> () &#123;</span><br><span class="line">    <span class="keyword">var</span> watcher = <span class="variable language_">this</span>.<span class="property">_computedWatchers</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">_computedWatchers</span>[key];</span><br><span class="line">    <span class="keyword">if</span> (watcher) &#123;</span><br><span class="line">      <span class="keyword">if</span> (watcher.<span class="property">dirty</span>) &#123;</span><br><span class="line">        watcher.evaluate();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Dep</span>.<span class="property">target</span>) &#123;</span><br><span class="line">        watcher.<span class="title function_">depend</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> watcher.<span class="property">value</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createGetterInvoker</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">computedGetter</span> () &#123;</span><br><span class="line">    <span class="keyword">return</span> fn.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用-3"><a href="#使用-3" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="title function_">parameter1</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">parameter2</span>: &#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">parameter1</span> = <span class="number">4</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="methods"><a href="#methods" class="headerlink" title="methods"></a>methods</h4><h5 id="源码-4"><a href="#源码-4" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initMethods</span> (vm, methods) &#123;</span><br><span class="line">  <span class="keyword">var</span> props = vm.<span class="property">$options</span>.<span class="property">props</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> methods) &#123;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> methods[key] !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(</span><br><span class="line">          <span class="string">&quot;Method \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; has type \&quot;&quot;</span> + (<span class="keyword">typeof</span> methods[key]) + <span class="string">&quot;\&quot; in the component definition. &quot;</span> +</span><br><span class="line">          <span class="string">&quot;Did you reference the function correctly?&quot;</span>,</span><br><span class="line">          vm</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (props &amp;&amp; <span class="title function_">hasOwn</span>(props, key)) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(</span><br><span class="line">          (<span class="string">&quot;Method \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; has already been defined as a prop.&quot;</span>),</span><br><span class="line">          vm</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ((key <span class="keyword">in</span> vm) &amp;&amp; <span class="title function_">isReserved</span>(key)) &#123;</span><br><span class="line">        <span class="title function_">warn</span>(</span><br><span class="line">          <span class="string">&quot;Method \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; conflicts with an existing Vue instance method. &quot;</span> +</span><br><span class="line">          <span class="string">&quot;Avoid defining component methods that start with _ or $.&quot;</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    vm[key] = <span class="keyword">typeof</span> methods[key] !== <span class="string">&#x27;function&#x27;</span> ? noop : <span class="title function_">bind</span>(methods[key], vm); <span class="comment">// 调用 函数的bind 方法，绑定 methods 方法的 this 到 Vue 实例上</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用-4"><a href="#使用-4" class="headerlink" title="使用"></a>使用</h5><p>  不推介使用箭头函数来命名 methods 函数 此时 函数的 this  指向了 父级作用域上下文<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">fn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// todo...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">fn2</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// todo...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h4><p>Vue 中 watch 主要用于监听 data，props，computed 对象中的属性发生变化，一旦发生变化就会触发对应的函数，更新对应数据及页面结构</p><h5 id="源码-5"><a href="#源码-5" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initWatch</span> (vm, watch) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> watch) &#123;</span><br><span class="line">    <span class="keyword">var</span> handler = watch[key];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(handler)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; handler.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="title function_">createWatcher</span>(vm, key, handler[i]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">createWatcher</span>(vm, key, handler);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createWatcher</span> (</span><br><span class="line">  vm,</span><br><span class="line">  expOrFn,</span><br><span class="line">  handler,</span><br><span class="line">  options</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(handler)) &#123;</span><br><span class="line">    options = handler;</span><br><span class="line">    handler = handler.<span class="property">handler</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> handler === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    handler = vm[handler];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vm.$watch(expOrFn, handler, options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 initWatch 的时候， 首先针对传入的 watch对象进行遍历<br>watch 的属性如果是数组，数组内的函数会异议调用，其他情况会直接创建 watch</p><ul><li>vm    Vue 实例</li><li>watch  vue 组件上的 watch 对象</li></ul><p>在 createWatcher 函数里面，因为传入的handler 可能是对象，所以做了兼容处理，之后要调用了 Vue 实例上的 $watch 方法来实现属性的监听, $watch 方法 我们会在接下进行讲解，现在先有个印象</p><ul><li>vm    Vue 实例</li><li>expOrFn  要进行数据监控的变量名</li><li>handler   回调函数，数据发生改变后执行此函数，吧改变后的值传递回来，也可以是对象，但是对象中必须要包含 handler 属性且是一个函数或者一个键，可以通过它在 vm 上找到对应函数</li><li>options   配置参数 针对对象进行特殊处理，防止无法监听到对象值的变化</li></ul><h5 id="使用-5"><a href="#使用-5" class="headerlink" title="使用"></a>使用</h5><p>在看了源码中的 initWatch 函数和 createWatcher 函数之后，根据对 watch 内部参数的处理我们可以猜到在使用 watch 的时候我们可以传递 数组、对象、函数、字符串</p><p>回调函数不推介使用 箭头函数，因为箭头函数的上下文已经绑定了，不会指向 Vue 实例</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="comment">// Vue 在监控到 a 发生变化之后 会执行 methods 方法 即 vm[&#x27;methods&#x27;]</span></span><br><span class="line">    <span class="attr">a</span>: <span class="string">&#x27;methods&#x27;</span>,</span><br><span class="line">    <span class="comment">// Vue 在监控到 b 发生变化之后 会执行此回调函数</span></span><br><span class="line">    <span class="attr">b</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">    <span class="comment">// 针对对象属性监听，在 createWatcher 函数中 会对对象进行处理，取出回调函数 及 options 配置</span></span><br><span class="line">    <span class="comment">// c 发生变化之后 会调用 对象中 handler 函数</span></span><br><span class="line">    <span class="attr">c</span>: &#123;</span><br><span class="line">      <span class="attr">handler</span>: <span class="string">&#x27;methods&#x27;</span>,</span><br><span class="line">      <span class="attr">deep</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// d 放生变化之后，数组中的每一个函数都会被执行，数组内部 watch 方法的执行和以上三种类似</span></span><br><span class="line">    <span class="attr">d</span>: [<span class="string">&#x27;methods&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;, &#123;</span><br><span class="line">      <span class="attr">handler</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="comment">// 此种方法针对对象的某一个值进行监听，在 Vue 中会对 `key:&#x27;e-f&#x27; 进行处理，精准查找到  e 对象下的 f 属性</span></span><br><span class="line">    <span class="string">&#x27;e.f&#x27;</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;data&quot;&gt;&lt;a href=&quot;#data&quot; class=&quot;headerlink&quot; title=&quot;data&quot;&gt;&lt;/a&gt;data&lt;/h4&gt;&lt;p&gt;在 data 中的数据 在 vue2 中会使用 Object.defineProperty 方法监听数据变化（vue3 采用</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/categories/SourceCode/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/tags/SourceCode/"/>
    
  </entry>
  
  <entry>
    <title>跟着 Vue源码学习 Vue api 系列 (二) - 全局 api</title>
    <link href="https://lxx1997.github.io/2021/01/20/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-02/"/>
    <id>https://lxx1997.github.io/2021/01/20/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-02/</id>
    <published>2021-01-20T09:18:54.000Z</published>
    <updated>2021-01-20T09:18:54.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Vue-extend"><a href="#Vue-extend" class="headerlink" title="Vue.extend({})"></a>Vue.extend({})</h4><h5 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initExtend</span> (<span class="title class_">Vue</span>) &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Each instance constructor, including Vue, has a unique</span></span><br><span class="line"><span class="comment">    * cid. This enables us to create wrapped &quot;child</span></span><br><span class="line"><span class="comment">    * constructors&quot; for prototypal inheritance and cache them.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="title class_">Vue</span>.<span class="property">cid</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> cid = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Class inheritance</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="title class_">Vue</span>.<span class="property">extend</span> = <span class="keyword">function</span> (<span class="params">extendOptions</span>) &#123;</span><br><span class="line">    extendOptions = extendOptions || &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Super</span> = <span class="variable language_">this</span>; <span class="comment">// 使用 super 继承Vue 实例</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">SuperId</span> = <span class="title class_">Super</span>.<span class="property">cid</span>;  <span class="comment">// 存储 Vue 实例的 cid</span></span><br><span class="line">    <span class="keyword">var</span> cachedCtors = extendOptions.<span class="property">_Ctor</span> || (extendOptions.<span class="property">_Ctor</span> = &#123;&#125;);</span><br><span class="line">    <span class="keyword">if</span> (cachedCtors[<span class="title class_">SuperId</span>]) &#123;</span><br><span class="line">      <span class="keyword">return</span> cachedCtors[<span class="title class_">SuperId</span>]  <span class="comment">// 优化，如果多次使用同一个 Vue.extend 返回的是同一个 Vue.extend ,使用缓存，减少不必要的内存消耗</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> name = extendOptions.<span class="property">name</span> || <span class="title class_">Super</span>.<span class="property">options</span>.<span class="property">name</span>;</span><br><span class="line">    <span class="keyword">if</span> (name) &#123;</span><br><span class="line">      <span class="title function_">validateComponentName</span>(name);  <span class="comment">// 检验 Vue extend 的name 属性是否合法</span></span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Sub</span> = <span class="keyword">function</span> <span class="title function_">VueComponent</span> (options) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">_init</span>(options);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">/** 原型继承，将 vue 的原型 集成到子类 Sub 构造函数上，同时添加唯一标识符 */</span></span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Super</span>.<span class="property"><span class="keyword">prototype</span></span>); </span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Sub</span>;</span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">cid</span> = cid++;</span><br><span class="line">    <span class="comment">/** 调用 mergeOptions 方法 将 extend的所有属性 合并到 Vue的 options 属性上 */</span></span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">options</span> = <span class="title function_">mergeOptions</span>(</span><br><span class="line">      <span class="title class_">Super</span>.<span class="property">options</span>,</span><br><span class="line">      extendOptions</span><br><span class="line">    );</span><br><span class="line">    <span class="title class_">Sub</span>[<span class="string">&#x27;super&#x27;</span>] = <span class="title class_">Super</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For props and computed properties, we define the proxy getters on</span></span><br><span class="line">    <span class="comment">// the Vue instances at extension time, on the extended prototype. This</span></span><br><span class="line">    <span class="comment">// avoids Object.defineProperty calls for each instance created.</span></span><br><span class="line">    <span class="comment">// 如果包含 props 属性，重新初始化 props</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Sub</span>.<span class="property">options</span>.<span class="property">props</span>) &#123;</span><br><span class="line">      <span class="title function_">initProps$1</span>(<span class="title class_">Sub</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果包含 computed 属性，重新初始化 computed</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Sub</span>.<span class="property">options</span>.<span class="property">computed</span>) &#123;</span><br><span class="line">      <span class="title function_">initComputed$1</span>(<span class="title class_">Sub</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// allow further extension/mixin/plugin usage</span></span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">extend</span> = <span class="title class_">Super</span>.<span class="property">extend</span>;</span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">mixin</span> = <span class="title class_">Super</span>.<span class="property">mixin</span>;</span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">use</span> = <span class="title class_">Super</span>.<span class="property">use</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create asset registers, so extended classes</span></span><br><span class="line">    <span class="comment">// can have their private assets too.</span></span><br><span class="line">    <span class="variable constant_">ASSET_TYPES</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">type</span>) &#123;</span><br><span class="line">      <span class="title class_">Sub</span>[type] = <span class="title class_">Super</span>[type];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// enable recursive self-lookup  启动递归查找</span></span><br><span class="line">    <span class="keyword">if</span> (name) &#123;</span><br><span class="line">      <span class="title class_">Sub</span>.<span class="property">options</span>.<span class="property">components</span>[name] = <span class="title class_">Sub</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// keep a reference to the super options at extension time.</span></span><br><span class="line">    <span class="comment">// later at instantiation we can check if Super&#x27;s options have</span></span><br><span class="line">    <span class="comment">// been updated.</span></span><br><span class="line">    <span class="comment">// 在分机处保留对超级选项的引用时间。稍后在实例化时，我们可以检查Super的选项是否已更新。</span></span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">superOptions</span> = <span class="title class_">Super</span>.<span class="property">options</span>;</span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">extendOptions</span> = extendOptions;</span><br><span class="line">    <span class="title class_">Sub</span>.<span class="property">sealedOptions</span> = <span class="title function_">extend</span>(&#123;&#125;, <span class="title class_">Sub</span>.<span class="property">options</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cache constructor</span></span><br><span class="line">    cachedCtors[<span class="title class_">SuperId</span>] = <span class="title class_">Sub</span>;  <span class="comment">// 在此处赋值，缓存 当前 Vue extend</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Sub</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  通过以上源码，我们可以看出 Vue 在 extend 的时候主要做了以下几个事情</p><ul><li>首先进行兼容处理，保证传入的对象不为空</li><li>创建一个变量 Super 用来存储 Vue 实例，并且存储 Vue 的 cid</li><li>判断当前 extend 是否已经被使用过，如果已经使用过，直接返回，以减少内存消耗</li><li>创建一个新的构造函数 Sub ，原型指向 Super 的原型，并创建一个唯一的 cid</li><li>接下来通过 mergeOptions 方法，将传入的 参数 与 Vue 实例的 options(data,lifeCycle,methods,props,methods 等) 合并，遵循 Vue 内部 config 中定义的optionMergeStrategies 配置</li><li>初始化 props 和 computed 属性</li><li>重新对 extend，mixin，use，filter，directive，component 属性进行赋值</li><li>最后 通过 _Ctor 缓存 当前创建的  Vue.extend 实例</li><li>返回 当前 Sub 构造函数，该构造函数 具有 Vue 所有属性及方法</li></ul><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Profile</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;lxx&#x27;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">24</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="title function_">time</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>.<span class="title function_">getTime</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getName</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">getName</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Profile</span>().$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p>  当我们 使用 Vue.extend 为 Vue 扩展一些信息的时候，会根据 Vue 的 optionMergeStrategies 配置的默认属性合并规则进行属性 合并，这样我们在任意组件都可以使用到这些属性和方法</p><h4 id="Vue-nextTick-callback-Function-context-Object"><a href="#Vue-nextTick-callback-Function-context-Object" class="headerlink" title="Vue.nextTick([callback: Function,context: Object])"></a>Vue.nextTick([callback: Function,context: Object])</h4><p>  Vue 更新页面并不是同步更新的，而是采用异步更新的。</p><p>  浏览器有一个更新循环 tick，这个 tick 时间间隔大概十几毫秒，Vue 在到浏览器执行下一个 tick 的时间段内搜集所有需要更新的 Dom 数据，在 下一个 tick 循环到来的时候同步更新到页面上。这时候就会造成一个问题，如果我们想在改变数据之后立刻获取页面的数据的话，这时候还没有触发浏览器的 tick 更新，页面没有变化，我们是获取不到更新后的 DOM 数据</p><p>  使用 Vue.nextTick 可以使我们在页面更新完成之后获取 DOM</p><h5 id="源码-1"><a href="#源码-1" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">nextTick</span> (cb, ctx) &#123;</span><br><span class="line">  <span class="keyword">var</span> _resolve;</span><br><span class="line">  callbacks.<span class="title function_">push</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        cb.<span class="title function_">call</span>(ctx);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="title function_">handleError</span>(e, ctx, <span class="string">&#x27;nextTick&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_resolve) &#123;</span><br><span class="line">      <span class="title function_">_resolve</span>(ctx);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (!pending) &#123;</span><br><span class="line">    pending = <span class="literal">true</span>;</span><br><span class="line">    <span class="title function_">timerFunc</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// $flow-disable-line</span></span><br><span class="line">  <span class="keyword">if</span> (!cb &amp;&amp; <span class="keyword">typeof</span> <span class="title class_">Promise</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">      _resolve = resolve;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  在 timerFunc() 函数 中 通过判断 Promise MutationObserver 及 setImmediate函数是否存在 如在就使用对应函数，不存在就使用setTimeout方法</p><h5 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取更新后的 Dom</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Vue-set-target-Object-Array-index-Number-string-value-any"><a href="#Vue-set-target-Object-Array-index-Number-string-value-any" class="headerlink" title="Vue.set(target: Object | Array, index: Number | string, value: any)"></a>Vue.set(target: Object | Array, index: Number | string, value: any)</h4><p>  用于修改一些 Vue 响应式无法监听到的对象属性变更，同时触发视图更新</p><h5 id="源码-2"><a href="#源码-2" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">set</span> (target, key, val) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isUndef</span>(target) || <span class="title function_">isPrimitive</span>(target)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="title function_">warn</span>((<span class="string">&quot;Cannot set reactive property on undefined, null, or primitive value: &quot;</span> + ((target))));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(target) &amp;&amp; <span class="title function_">isValidArrayIndex</span>(key)) &#123;</span><br><span class="line">    target.<span class="property">length</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(target.<span class="property">length</span>, key);</span><br><span class="line">    target.<span class="title function_">splice</span>(key, <span class="number">1</span>, val);</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (key <span class="keyword">in</span> target &amp;&amp; !(key <span class="keyword">in</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>)) &#123;</span><br><span class="line">    target[key] = val;</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> ob = (target).<span class="property">__ob__</span>;</span><br><span class="line">  <span class="keyword">if</span> (target.<span class="property">_isVue</span> || (ob &amp;&amp; ob.<span class="property">vmCount</span>)) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">&#x27;Avoid adding reactive properties to a Vue instance or its root $data &#x27;</span> +</span><br><span class="line">      <span class="string">&#x27;at runtime - declare it upfront in the data option.&#x27;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!ob) &#123;</span><br><span class="line">    target[key] = val;</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">defineReactive$$1</span>(ob.<span class="property">value</span>, key, val);</span><br><span class="line">  ob.<span class="property">dep</span>.<span class="title function_">notify</span>();</span><br><span class="line">  <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>首先判断传过来的 target 是否存在，及数据类型是否是基本数据类型</li><li>判断 target 是否是数组，以及 key 值 是否可用，然后调用 Array 的 slice 方法替换数组数据</li><li>判断 key 是否属于 target</li><li>判断 传入 target 对象 是否是 Vue 实例</li><li>调用 defineReactive$$1 监听数据变化</li><li>调用 发布订阅模式 的 发布方法</li></ul><h5 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">set</span>(target, key, value)</span><br></pre></td></tr></table></figure><h4 id="Vue-delete-target-Object-Array-index-Number-string"><a href="#Vue-delete-target-Object-Array-index-Number-string" class="headerlink" title="Vue.delete(target: Object | Array, index: Number | string)"></a>Vue.delete(target: Object | Array, index: Number | string)</h4><p>  删除对象的 property。如果对象是响应式的，确保删除能触发更新视图。这个方法主要用于避开 Vue 不能检测到 property 被删除的限制，但是你应该很少会使用它。</p><h5 id="源码-3"><a href="#源码-3" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">del</span> (target, key) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isUndef</span>(target) || <span class="title function_">isPrimitive</span>(target)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="title function_">warn</span>((<span class="string">&quot;Cannot delete reactive property on undefined, null, or primitive value: &quot;</span> + ((target))));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(target) &amp;&amp; <span class="title function_">isValidArrayIndex</span>(key)) &#123;</span><br><span class="line">      target.<span class="title function_">splice</span>(key, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> ob = (target).<span class="property">__ob__</span>;</span><br><span class="line">    <span class="keyword">if</span> (target.<span class="property">_isVue</span> || (ob &amp;&amp; ob.<span class="property">vmCount</span>)) &#123;</span><br><span class="line">      <span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;Avoid deleting properties on a Vue instance or its root $data &#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;- just set it to null.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">hasOwn</span>(target, key)) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> target[key];</span><br><span class="line">    <span class="keyword">if</span> (!ob) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    ob.<span class="property">dep</span>.<span class="title function_">notify</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li>首先判断传过来的 target 是否存在，及数据类型是否是基本数据类型</li><li>判断 target 是否是数组，以及 key 值 是否可用，然后调用 Array 的 slice 方法替换数组数据</li><li>判断 传入 target 对象 是否是 Vue 实例</li><li>删除 <code>target[key]</code></li><li>调用 发布订阅模式 的 发布方法</li></ul><h5 id="使用-3"><a href="#使用-3" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">delete</span>(target, key)</span><br></pre></td></tr></table></figure><h4 id="Vue-directive-id-string-definition-Function-Object"><a href="#Vue-directive-id-string-definition-Function-Object" class="headerlink" title="Vue.directive( id: string, [definition]: Function | Object )"></a>Vue.directive( id: string, [definition]: Function | Object )</h4><p>  此方法主要是为了给 Vue 设置自定义指令 及获取 Vue 指令</p><h5 id="源码-4"><a href="#源码-4" class="headerlink" title="源码"></a>源码</h5><p>首先 定义了一个 <code>platformDirectives</code> 存储 directive 指令的属性，然后通过 extend 方法，将 <code>platformDirectives</code> 上的属性 复制到 <code>Vue.options.directives</code> 上<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> platformDirectives = &#123;</span><br><span class="line">  <span class="attr">model</span>: directive,</span><br><span class="line">  <span class="attr">show</span>: show</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">extend</span>(<span class="title class_">Vue</span>.<span class="property">options</span>.<span class="property">directives</span>, platformDirectives)</span><br></pre></td></tr></table></figure></p><p>directive 对象的属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> directive = &#123;</span><br><span class="line">  <span class="attr">inserted</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  <span class="attr">componentUpdated</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>install<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inserted</span>: <span class="keyword">function</span> <span class="title function_">inserted</span> (el, binding, vnode, oldVnode) &#123;</span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">tag</span> === <span class="string">&#x27;select&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// #6903</span></span><br><span class="line">    <span class="keyword">if</span> (oldVnode.<span class="property">elm</span> &amp;&amp; !oldVnode.<span class="property">elm</span>.<span class="property">_vOptions</span>) &#123;</span><br><span class="line">      <span class="title function_">mergeVNodeHook</span>(vnode, <span class="string">&#x27;postpatch&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        directive.<span class="title function_">componentUpdated</span>(el, binding, vnode);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">setSelected</span>(el, binding, vnode.<span class="property">context</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    el.<span class="property">_vOptions</span> = [].<span class="property">map</span>.<span class="title function_">call</span>(el.<span class="property">options</span>, getValue);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (vnode.<span class="property">tag</span> === <span class="string">&#x27;textarea&#x27;</span> || <span class="title function_">isTextInputType</span>(el.<span class="property">type</span>)) &#123;</span><br><span class="line">    el.<span class="property">_vModifiers</span> = binding.<span class="property">modifiers</span>;</span><br><span class="line">    <span class="keyword">if</span> (!binding.<span class="property">modifiers</span>.<span class="property">lazy</span>) &#123;</span><br><span class="line">      el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;compositionstart&#x27;</span>, onCompositionStart);</span><br><span class="line">      el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;compositionend&#x27;</span>, onCompositionEnd);</span><br><span class="line">      <span class="comment">// Safari &lt; 10.2 &amp; UIWebView doesn&#x27;t fire compositionend when</span></span><br><span class="line">      <span class="comment">// switching focus before confirming composition choice</span></span><br><span class="line">      <span class="comment">// this also fixes the issue where some browsers e.g. iOS Chrome</span></span><br><span class="line">      <span class="comment">// fires &quot;change&quot; instead of &quot;input&quot; on autocomplete.</span></span><br><span class="line">      el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;change&#x27;</span>, onCompositionEnd);</span><br><span class="line">      <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">      <span class="keyword">if</span> (isIE9) &#123;</span><br><span class="line">        el.<span class="property">vmodel</span> = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>我们可以看到在 inserted 函数中对 指令绑定的元素做了一个判断， 针对 select，textarea标签及 input 标签且属性是 是文本输入类型的元素做了特殊处理</li></ul><p><strong>componentUpdated</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">componentUpdated</span>: <span class="keyword">function</span> <span class="title function_">componentUpdated</span> (el, binding, vnode) &#123;</span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">tag</span> === <span class="string">&#x27;select&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">setSelected</span>(el, binding, vnode.<span class="property">context</span>);</span><br><span class="line">    <span class="comment">// in case the options rendered by v-for have changed,</span></span><br><span class="line">    <span class="comment">// it&#x27;s possible that the value is out-of-sync with the rendered options.</span></span><br><span class="line">    <span class="comment">// detect such cases and filter out values that no longer has a matching</span></span><br><span class="line">    <span class="comment">// option in the DOM.</span></span><br><span class="line">    <span class="keyword">var</span> prevOptions = el.<span class="property">_vOptions</span>;</span><br><span class="line">    <span class="keyword">var</span> curOptions = el.<span class="property">_vOptions</span> = [].<span class="property">map</span>.<span class="title function_">call</span>(el.<span class="property">options</span>, getValue);</span><br><span class="line">    <span class="keyword">if</span> (curOptions.<span class="title function_">some</span>(<span class="keyword">function</span> (<span class="params">o, i</span>) &#123; <span class="keyword">return</span> !<span class="title function_">looseEqual</span>(o, prevOptions[i]); &#125;)) &#123;</span><br><span class="line">      <span class="comment">// trigger change event if</span></span><br><span class="line">      <span class="comment">// no matching option found for at least one value</span></span><br><span class="line">      <span class="keyword">var</span> needReset = el.<span class="property">multiple</span></span><br><span class="line">        ? binding.<span class="property">value</span>.<span class="title function_">some</span>(<span class="keyword">function</span> (<span class="params">v</span>) &#123; <span class="keyword">return</span> <span class="title function_">hasNoMatchingOption</span>(v, curOptions); &#125;)</span><br><span class="line">        : binding.<span class="property">value</span> !== binding.<span class="property">oldValue</span> &amp;&amp; <span class="title function_">hasNoMatchingOption</span>(binding.<span class="property">value</span>, curOptions);</span><br><span class="line">      <span class="keyword">if</span> (needReset) &#123;</span><br><span class="line">        <span class="title function_">trigger</span>(el, <span class="string">&#x27;change&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 componentUpdated 方法中 对select 标签的元素做了特殊处理，渲染其子元素 option </p><p><strong>bind,update,unbind</strong></p><p>针对元素的 display 进行处理</p><h5 id="使用-4"><a href="#使用-4" class="headerlink" title="使用"></a>使用</h5><p>insert 函数传入参数有四个 </p><ul><li>el 当前指令挂载的元素节点</li><li>binding   <code>v-[name]:[arg].[modifies].[modifies]=&quot;[expression]&quot;</code><br>  name: 指令名<br>  value: 指令的绑定值<br>  oldValue: 指令绑定的前一个值，value参数改变之前的值<br>  expression: 字符串形式的指令表达式<br>  arg: 传递指令的参数<br>  modifiers: 包含修饰符的对象<br>  <strong>首先 如果 express 没有话 不会获取到 value, 如果想要获取 value，就要包含有 expression, 则该 expression 必须在 data 或者 computed 上必须要在第一层上</strong><br>  <strong>就算是 expression 用 ex1.ex2 或者 ex1[ex2],value 的值为 <code>data[ex1]</code> 或者 <code>computed[ex1]</code></strong><br>  <strong>当 expression 为一个可以计算的表达式的时候 例如 <code>1+1</code>, <code>ex1 + 1</code> 等，value 的结果为 expression 计算之后的结果</strong></li><li>vnode 虚拟node节点</li><li>oldVnode 上一个虚拟 DOM 节点</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>this is test for directive<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-test:test2.test1</span>=<span class="string">&quot;test3&quot;</span>&gt;</span>&#123;&#123;test3&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;test&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">bind</span>: <span class="keyword">function</span>(<span class="params">el, binding, vnode, oldValue</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(el,binding,vnode,oldValue)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">          el: &lt;div&gt;4&lt;/div&gt;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">          binding:  arg: &quot;test2&quot;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    def: &#123;bind: ƒ, componentUpdated: ƒ&#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    expression: &quot;test3&quot;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    modifiers: &#123;test1: true&#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    name: &quot;test&quot;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    rawName: &quot;v-test:test2.test1&quot;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    value: 4</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">          vnode  VNode&#123;&#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">          oldValue  VNode&#123;&#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        */</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 使用 componentUpdated 可以监控元素节点数据变化 展示的 更新之后的数据</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">componentUpdated</span>:<span class="keyword">function</span>(<span class="params">el, binding, vnode, oldValue</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(el,binding,vnode,oldValue)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">          el: &lt;div&gt;9&lt;/div&gt;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">          binding:  arg: &quot;test2&quot;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    def: &#123;bind: ƒ, componentUpdated: ƒ&#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    expression: &quot;test3&quot;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    modifiers: &#123;test1: true&#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    name: &quot;test&quot;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    rawName: &quot;v-test:test2.test1&quot;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    value: 9</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">          vnode  VNode&#123;&#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">          oldValue  VNode&#123;&#125;  // 此处存放的是 value 未被更改为4的时候的节点</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        */</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 在元素bind的时候 可能updated方法就已经执行，</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 此时 bind时候 的el对象是更新之后的对象,即 testChild 为 8 test3 为 9</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 但是 Vnode 及 oldVNode 还是元素未发生更改之前的元素节点</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">updated</span>:<span class="keyword">function</span>(<span class="params">el, binding, vnode, oldValue</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(el,binding,vnode,oldValue, <span class="string">&#x27;updated&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 指令解绑的时候触发  可以使用 v-if 控制元素隐藏和显示来触发 unbid</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">unbind</span>: <span class="keyword">function</span>(<span class="params">el, binding, vnode, oldValue</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(el,binding,vnode,oldValue, <span class="string">&#x27;unbind&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 页面一渲染就会触发</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">insert</span>: <span class="keyword">function</span>(<span class="params">el, binding, vnode, oldValue</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(el,binding,vnode,oldValue, <span class="string">&#x27;insert&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">test3</span>: <span class="number">4</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">testChild</span>: <span class="number">4</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">test3</span> = <span class="number">9</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">testChild</span> = <span class="number">8</span></span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Vue-filter-id-string-definition-Function"><a href="#Vue-filter-id-string-definition-Function" class="headerlink" title="Vue.filter(id:string, definition: Function)"></a>Vue.filter(id:string, definition: Function)</h4><h5 id="源码-5"><a href="#源码-5" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">ASSET_TYPES</span> = [</span><br><span class="line">  <span class="string">&#x27;component&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;directive&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;filter&#x27;</span></span><br><span class="line">];</span><br><span class="line"><span class="variable constant_">ASSET_TYPES</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="title class_">Vue</span>[type] = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">      id,</span></span><br><span class="line"><span class="params">      definition</span></span><br><span class="line"><span class="params">    </span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!definition) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">options</span>[type + <span class="string">&#x27;s&#x27;</span>][id]</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&#x27;component&#x27;</span>) &#123;</span><br><span class="line">          <span class="title function_">validateComponentName</span>(id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&#x27;component&#x27;</span> &amp;&amp; <span class="title function_">isPlainObject</span>(definition)) &#123;</span><br><span class="line">          definition.<span class="property">name</span> = definition.<span class="property">name</span> || id;</span><br><span class="line">          definition = <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">_base</span>.<span class="title function_">extend</span>(definition);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">&#x27;directive&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> definition === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">          definition = &#123; <span class="attr">bind</span>: definition, <span class="attr">update</span>: definition &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">options</span>[type + <span class="string">&#x27;s&#x27;</span>][id] = definition;</span><br><span class="line">        <span class="keyword">return</span> definition</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码 是  ‘component’, ‘directive’, ‘filter’ 三个全局API 注册到 Vue 实例上的方法</p><p>如果是 component 则检查 组件名称是否是合格的组件名称 然后在判断 是否是 definition 参数是否是对象，如果是，则使用 Vue 实例的 extend 方法扩展全局的 extend 属性</p><p>如果是 directive 如果传入的 definition 是函数 则默认调用 bind 和 update 方法</p><h5 id="使用-5"><a href="#使用-5" class="headerlink" title="使用"></a>使用</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; test | uppcase&#125;&#125;<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="title class_">Vue</span>.<span class="title function_">filter</span>(<span class="string">&#x27;uppcase&#x27;</span>, <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> value &amp;&amp; value.<span class="title function_">toUpperCase</span>()</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Vue-component-id-string-definition-Function-Object"><a href="#Vue-component-id-string-definition-Function-Object" class="headerlink" title="Vue.component(id: string, definition: Function | Object)"></a>Vue.component(id: string, definition: Function | Object)</h4><h5 id="源码-6"><a href="#源码-6" class="headerlink" title="源码"></a>源码</h5><p>请查看 Vue.filter 的讲解</p><h5 id="使用-6"><a href="#使用-6" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">componet</span>(<span class="string">&#x27;my-component&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;<span class="keyword">return</span> &#123;&#125;&#125;</span><br><span class="line">  <span class="attr">methods</span>: &#123;&#125;</span><br><span class="line">  <span class="attr">computed</span>: &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>definition 可以传递 Vue.extend({}),也可以直接传一个对象，Vue会自动调用 Vue.extend 方法</p><h4 id="Vue-use-plugin"><a href="#Vue-use-plugin" class="headerlink" title="Vue.use(plugin)"></a>Vue.use(plugin)</h4><h5 id="源码-7"><a href="#源码-7" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initUse</span> (<span class="title class_">Vue</span>) &#123;</span><br><span class="line">  <span class="title class_">Vue</span>.<span class="property">use</span> = <span class="keyword">function</span> (<span class="params">plugin</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> installedPlugins = (<span class="variable language_">this</span>.<span class="property">_installedPlugins</span> || (<span class="variable language_">this</span>.<span class="property">_installedPlugins</span> = []));</span><br><span class="line">    <span class="keyword">if</span> (installedPlugins.<span class="title function_">indexOf</span>(plugin) &gt; -<span class="number">1</span>) &#123;  <span class="comment">// 判断是否 安装过此插件</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// additional parameters</span></span><br><span class="line">    <span class="keyword">var</span> args = <span class="title function_">toArray</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    args.<span class="title function_">unshift</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> plugin.<span class="property">install</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      plugin.<span class="property">install</span>.<span class="title function_">apply</span>(plugin, args);   <span class="comment">// 调用 plugin 的 install 函数</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> plugin === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      plugin.<span class="title function_">apply</span>(<span class="literal">null</span>, args); <span class="comment">// 直接执行 plugin 函数</span></span><br><span class="line">    &#125;</span><br><span class="line">    installedPlugins.<span class="title function_">push</span>(plugin);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用-7"><a href="#使用-7" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plugin必须是一个函数 或者包含 install 的对象 </span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(plugin)</span><br></pre></td></tr></table></figure><h4 id="Vue-mixin-plugin"><a href="#Vue-mixin-plugin" class="headerlink" title="Vue.mixin(plugin)"></a>Vue.mixin(plugin)</h4><h5 id="源码-8"><a href="#源码-8" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initMixin$1</span> (<span class="title class_">Vue</span>) &#123;</span><br><span class="line">  <span class="title class_">Vue</span>.<span class="property">mixin</span> = <span class="keyword">function</span> (<span class="params">mixin</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">options</span> = <span class="title function_">mergeOptions</span>(<span class="variable language_">this</span>.<span class="property">options</span>, mixin);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此方法 调用了 mergeOptions 方法将 传入的参数 与 Vue 的 options 属性合并</p><h5 id="使用-8"><a href="#使用-8" class="headerlink" title="使用"></a>使用</h5><p>  这个方法会影响 所有创建的 Vue 组件，不推介使用，但是可以用于 optionMergeStrategies 自定义 选项<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">mixin</span>(&#123;</span><br><span class="line">  <span class="attr">created</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> myOption = <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">myOption</span></span><br><span class="line">    <span class="keyword">if</span> (myOption) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(myOption)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">myOption</span>: <span class="string">&#x27;hello!&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// =&gt; &quot;hello!&quot;</span></span><br></pre></td></tr></table></figure></p><h4 id="Vue-compile"><a href="#Vue-compile" class="headerlink" title="Vue.compile"></a>Vue.compile</h4><p>将一个模板字符串编译成 render 函数</p><h5 id="源码-9"><a href="#源码-9" class="headerlink" title="源码"></a>源码</h5><p><strong>没看懂，有时间再来研究(2021-01-24)</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createCompileToFunctionFn</span> (compile) &#123;</span><br><span class="line">  <span class="keyword">var</span> cache = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">compileToFunctions</span> (</span><br><span class="line">    template,</span><br><span class="line">    options,</span><br><span class="line">    vm</span><br><span class="line">  ) &#123;</span><br><span class="line">    options = <span class="title function_">extend</span>(&#123;&#125;, options);</span><br><span class="line">    <span class="keyword">var</span> warn$$1 = options.<span class="property">warn</span> || warn;</span><br><span class="line">    <span class="keyword">delete</span> options.<span class="property">warn</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// detect possible CSP restriction</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">&#x27;return 1&#x27;</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.<span class="title function_">toString</span>().<span class="title function_">match</span>(<span class="regexp">/unsafe-eval|CSP/</span>)) &#123;</span><br><span class="line">          <span class="title function_">warn$$1</span>(</span><br><span class="line">            <span class="string">&#x27;It seems you are using the standalone build of Vue.js in an &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;environment with Content Security Policy that prohibits unsafe-eval. &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;The template compiler cannot work in this environment. Consider &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;relaxing the policy to allow unsafe-eval or pre-compiling your &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;templates into render functions.&#x27;</span></span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check cache</span></span><br><span class="line">    <span class="keyword">var</span> key = options.<span class="property">delimiters</span></span><br><span class="line">      ? <span class="title class_">String</span>(options.<span class="property">delimiters</span>) + template</span><br><span class="line">      : template;</span><br><span class="line">    <span class="keyword">if</span> (cache[key]) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache[key]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// compile</span></span><br><span class="line">    <span class="keyword">var</span> compiled = <span class="title function_">compile</span>(template, options);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check compilation errors/tips</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (compiled.<span class="property">errors</span> &amp;&amp; compiled.<span class="property">errors</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (options.<span class="property">outputSourceRange</span>) &#123;</span><br><span class="line">          compiled.<span class="property">errors</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="title function_">warn$$1</span>(</span><br><span class="line">              <span class="string">&quot;Error compiling template:\n\n&quot;</span> + (e.<span class="property">msg</span>) + <span class="string">&quot;\n\n&quot;</span> +</span><br><span class="line">              <span class="title function_">generateCodeFrame</span>(template, e.<span class="property">start</span>, e.<span class="property">end</span>),</span><br><span class="line">              vm</span><br><span class="line">            );</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">warn$$1</span>(</span><br><span class="line">            <span class="string">&quot;Error compiling template:\n\n&quot;</span> + template + <span class="string">&quot;\n\n&quot;</span> +</span><br><span class="line">            compiled.<span class="property">errors</span>.<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="keyword">return</span> (<span class="string">&quot;- &quot;</span> + e); &#125;).<span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>) + <span class="string">&#x27;\n&#x27;</span>,</span><br><span class="line">            vm</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (compiled.<span class="property">tips</span> &amp;&amp; compiled.<span class="property">tips</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (options.<span class="property">outputSourceRange</span>) &#123;</span><br><span class="line">          compiled.<span class="property">tips</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123; <span class="keyword">return</span> <span class="title function_">tip</span>(e.<span class="property">msg</span>, vm); &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          compiled.<span class="property">tips</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">msg</span>) &#123; <span class="keyword">return</span> <span class="title function_">tip</span>(msg, vm); &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// turn code into functions</span></span><br><span class="line">    <span class="keyword">var</span> res = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> fnGenErrors = [];</span><br><span class="line">    res.<span class="property">render</span> = <span class="title function_">createFunction</span>(compiled.<span class="property">render</span>, fnGenErrors);</span><br><span class="line">    res.<span class="property">staticRenderFns</span> = compiled.<span class="property">staticRenderFns</span>.<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">code</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">createFunction</span>(code, fnGenErrors)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check function generation errors.</span></span><br><span class="line">    <span class="comment">// this should only happen if there is a bug in the compiler itself.</span></span><br><span class="line">    <span class="comment">// mostly for codegen development use</span></span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ((!compiled.<span class="property">errors</span> || !compiled.<span class="property">errors</span>.<span class="property">length</span>) &amp;&amp; fnGenErrors.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="title function_">warn$$1</span>(</span><br><span class="line">          <span class="string">&quot;Failed to generate render function:\n\n&quot;</span> +</span><br><span class="line">          fnGenErrors.<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">ref</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> err = ref.<span class="property">err</span>;</span><br><span class="line">            <span class="keyword">var</span> code = ref.<span class="property">code</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> ((err.<span class="title function_">toString</span>()) + <span class="string">&quot; in\n\n&quot;</span> + code + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;).<span class="title function_">join</span>(<span class="string">&#x27;\n&#x27;</span>),</span><br><span class="line">          vm</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (cache[key] = res)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="使用-9"><a href="#使用-9" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = <span class="title class_">Vue</span>.<span class="title function_">compile</span>(<span class="string">&#x27;&lt;div&gt;&lt;span&gt;&#123;&#123; msg &#125;&#125;&lt;/span&gt;&lt;/div&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">render</span>: res.<span class="property">render</span>,</span><br><span class="line">  <span class="attr">staticRenderFns</span>: res.<span class="property">staticRenderFns</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="Vue-observable-object"><a href="#Vue-observable-object" class="headerlink" title="Vue.observable(object)"></a>Vue.observable(object)</h4><p>让一个对象可响应。Vue 内部会用它来处理 data 函数返回的对象</p><h5 id="源码-10"><a href="#源码-10" class="headerlink" title="源码"></a>源码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">observe</span> (value, asRootData) &#123;</span><br><span class="line">   <span class="keyword">if</span> (!<span class="title function_">isObject</span>(value) || value <span class="keyword">instanceof</span> <span class="title class_">VNode</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">var</span> ob;</span><br><span class="line">   <span class="keyword">if</span> (<span class="title function_">hasOwn</span>(value, <span class="string">&#x27;__ob__&#x27;</span>) &amp;&amp; value.<span class="property">__ob__</span> <span class="keyword">instanceof</span> <span class="title class_">Observer</span>) &#123;</span><br><span class="line">     ob = value.<span class="property">__ob__</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">     shouldObserve &amp;&amp;</span><br><span class="line">     !<span class="title function_">isServerRendering</span>() &amp;&amp;</span><br><span class="line">     (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(value) || <span class="title function_">isPlainObject</span>(value)) &amp;&amp;</span><br><span class="line">     <span class="title class_">Object</span>.<span class="title function_">isExtensible</span>(value) &amp;&amp;</span><br><span class="line">     !value.<span class="property">_isVue</span></span><br><span class="line">   ) &#123;</span><br><span class="line">     ob = <span class="keyword">new</span> <span class="title class_">Observer</span>(value);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (asRootData &amp;&amp; ob) &#123;</span><br><span class="line">     ob.<span class="property">vmCount</span>++;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> ob</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>调用了 通過 new Observer() 在 Observer 内部通过 walk 方法 调用 defineReactive$$1 进行对象响应式处理</p><h5 id="使用-10"><a href="#使用-10" class="headerlink" title="使用"></a>使用</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="title class_">Vue</span>.<span class="title function_">observable</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Demo</span> = &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;button&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">on</span>: &#123; <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123; state.<span class="property">count</span>++ &#125;&#125;</span><br><span class="line">    &#125;, <span class="string">`count is: <span class="subst">$&#123;state.count&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Vue-version"><a href="#Vue-version" class="headerlink" title="Vue.version"></a>Vue.version</h4><p>提供 Vue 的版本号</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property">version</span> = <span class="string">&#x27;2.6.12&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;Vue-extend&quot;&gt;&lt;a href=&quot;#Vue-extend&quot; class=&quot;headerlink&quot; title=&quot;Vue.extend({})&quot;&gt;&lt;/a&gt;Vue.extend({})&lt;/h4&gt;&lt;h5 id=&quot;源码&quot;&gt;&lt;a href=&quot;#源码&quot; class=&quot;</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/categories/SourceCode/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/tags/SourceCode/"/>
    
  </entry>
  
  <entry>
    <title>Vue3 + Vite + TypeScript 项目实战 -----（二）Vue3 生命周期</title>
    <link href="https://lxx1997.github.io/2021/01/17/vue/vue3-vite-typescript-02/"/>
    <id>https://lxx1997.github.io/2021/01/17/vue/vue3-vite-typescript-02/</id>
    <published>2021-01-17T14:24:46.000Z</published>
    <updated>2021-01-17T14:24:46.000Z</updated>
    
    <content type="html"><![CDATA[<hr><p>Vue3 继承了 Vue2 的所有生命周期函数，所以 Vue2 的生命周期的应用方式同样适用于 Vue3。同时 Vue3 还新增了一些新的生命周期。</p><p>原有的生命周期函数我们这边不做过多的赘述，我们来讲解一下 Vue3 相对于 Vue2 变更了和新增了哪些生命周期函数</p><ul><li><code>beforeUnmount</code> <code>unmounted</code></li></ul><p>这两个生命周期替代了 Vue2 的 <code>beforeDestory</code> 和 <code>destoryed</code>生命周期，两者的作用是一致的，都是在组件卸载的时候调用的，在 Vue3 还可以使用 <code>unmout</code> API 来卸载应用</p><ul><li><p><code>renderTracked</code></p><p>跟踪 虚拟DOM 渲染时候调用，接收 <code>debugger event</code> 作为参数<br><em>组件第一次渲染的时候调用，数据发生改变不会调用</em></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Cart: &#123;&#123;cart&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">cart</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// key: 渲染的属性的键名</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// target: 渲染属性的键值对</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// type: 对当前属性的操作</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">renderTracked</span>(<span class="params">&#123;key, target, type&#125;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>renderTriggered</code></p><p>当虚拟 DOM 重新渲染为 triggered.Similarly 为renderTracked，接收 debugger event 作为参数。此事件告诉你是什么操作触发了重新渲染，以及该操作的目标对象和键<br><em>触发属性值的变更的时候触发</em></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Cart: &#123;&#123;cart&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">cart</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// key: 渲染的属性的键名</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// target: 渲染属性的键值对,值是修改之后的值</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// type: 对当前属性的操作</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">renderTracked</span>(<span class="params">&#123;key, target, type&#125;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;<span class="variable language_">this</span>.<span class="property">cart</span>++&#125;, <span class="number">10000</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建应用</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;&#125;)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&quot;#app&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 卸载应用</span></span><br><span class="line">app.<span class="title function_">unmount</span>(<span class="string">&quot;#app&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li><code>setup</code>  -&gt; <code>created</code> 和 <code>beforeCreate</code></li></ul><p><code>setup</code> 在 创建组件之前执行，作为组合式 API 的入口点,return 的返回值可以渲染到页面上</p><p><strong>传参</strong></p><ol><li><p><strong>props</strong> 父组件传入的 props 对象，是响应式的，prop 发生变化时会同时发生更新</p><p><em>注意不能使用结构赋值，否则会失去响应式的特性，如果想要解构出 <code>props</code> 中的属性可以选择使用 <code>toRefs</code> 来完成此操作</em></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 记录 Vue3 生命周期的相关使用方法 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setup-hook</span> <span class="attr">:time</span>=<span class="string">&quot;time&quot;</span> <span class="attr">other</span>=<span class="string">&quot;other&quot;</span> <span class="attr">:other-time</span>=<span class="string">&quot;time&quot;</span> @<span class="attr">success</span>=<span class="string">&quot;handleSuccess&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span> 23123<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:title</span>&gt;</span> 23123<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:bottom</span>&gt;</span> 23123<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">setup-hook</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>test text<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> components <span class="keyword">from</span> <span class="string">&#x27;./components/index&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    ...components</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">time</span>: <span class="number">1000</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">time</span> += <span class="number">1000</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleSuccess</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;success&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>当前时间：&#123;&#123;time&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>截取props&#123;&#123;newTime&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>toRefs(props)&#123;&#123;refTime&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;toRefs&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params">props</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> &#123;<span class="attr">time</span>: newTime&#125; = props</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> &#123;<span class="attr">time</span>: refTime&#125; = <span class="title function_">toRefs</span>(props)</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(refTime)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      newTime,</span></span><br><span class="line"><span class="language-javascript">      refTime</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/assets/vue3/vue3-toRefs-code.png" alt="vue3-toRefs-code"><br>使用 toRefs 解构 props 的时候 如果想要直接访问 需要访问其 value 属性，下面是打印出来的解构出来的值,最后需要使用 return 抛出需要渲染和使用的变量及方法<br><img src="/assets/vue3/vue3-toRefs-props.png" alt="vue3-toRefs-props"></p></li><li><p><strong>context</strong> 暴露了三个组件的 <code>property</code> (<code>attrs</code>, <code>slots</code>, <code>emit</code>) </p><blockquote><p><code>attrs</code> 为父组件在子组件上传递的属性(未被<code>props</code>接收)<br><code>slots</code> 为父组件在子组件中传入的插槽 默认有一个 <code>default</code> 插槽<br><code>emit</code>  这是一个执行函数，相当于 <code>Vue.$emit()</code> 可以用于发送事件</p></blockquote><p><code>context</code> 是一个普通的 JavaScript 非响应式对象，可以安全的使用 ES6 的解构赋值操作</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setup-hook</span> <span class="attr">:time</span>=<span class="string">&quot;time&quot;</span> <span class="attr">other</span>=<span class="string">&quot;other&quot;</span> <span class="attr">:other-time</span>=<span class="string">&quot;time&quot;</span> @<span class="attr">success</span>=<span class="string">&quot;handleSuccess&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span> 23123<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:title</span>&gt;</span> 23123<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:bottom</span>&gt;</span> 23123<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">setup-hook</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 子组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params">props, &#123;attrs, emit, slots&#125;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> &#123;<span class="attr">time</span>: newTime&#125; = props</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> &#123;<span class="attr">time</span>: refTime&#125; = <span class="title function_">toRefs</span>(props)</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(refTime)</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(attrs, slots)</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">emit</span>(<span class="string">&#x27;success&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      newTime,</span></span><br><span class="line"><span class="language-javascript">      refTime</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/assets/vue3/vue3-toRefs-context.png" alt="vue3-toRefs-context"></p></li></ol><p>因此在执行 <code>setup</code> 的时候组件实例还未被创建，只能访问 <code>props</code>, <code>attrs</code>, <code>slots</code>, <code>emit</code>实例，无法访问 <code>data</code>, <code>computed</code>, <code>methods</code></p><p><code>setup</code> 在最后会有一个返回值，这个返回值是包含我们需要渲染或者在其他生命周期需要使用的变量的对象。</p><p>我们在使用 <code>setup</code> 需要注意以下几点：</p><ol><li><p><code>setup</code> 中的 <code>this</code> 并不是 Vue 实例的引用，因为 <code>setup()</code> 是在解析其它组件选项之前被调用的，所以 <code>setup()</code> 内部的 <code>this</code> 的行为与其它选项中的 <code>this</code> 完全不同。这在和其它选项式 API 一起使用 <code>setup()</code> 时可能会导致混淆。 </p></li><li><p>如果在 <code>setup</code> 中，我们定义了一个引用类型的变量，并针对这个变量进行了延时修改，这时修改之后的值并不会改变页面渲染，因为我们定义的并不是一个响应式类型的数据，如果想要创建一个响应式类型的数据，可以使用 <code>reactive</code> 来创建</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = <span class="title function_">reactive</span>(&#123;<span class="attr">value</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">&#x27;object&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure></li><li><p>如果我们定义的是一个基础类型的变量，此时也想要他实现响应式的一个变化，这是可以使用 <code>ref</code> 来创建，访问对象的值可以通过访问变量的 <code>value</code> 属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>) <span class="comment">// 0</span></span><br><span class="line"><span class="comment">// 此外还可以对 ref 内部进行类型指定</span></span><br><span class="line"><span class="keyword">const</span> count = ref&lt;string | number&gt;(<span class="number">0</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>setup</code> 的返回值可以在其他生命周期或者函数中直接通过 <code>this</code> 调用，并且已进行过响应式处理</p></li></ol><p>在 <code>setup</code> 中还新增了一下几种 生命周期钩子，这些钩子函数只能在 <code>setup</code> 中使用</p><blockquote><p><code>onBeforeMount</code><br><code>onMounted</code><br><code>onBeforeUpdate</code><br><code>onUpdated</code><br><code>onBeforeUnmount</code><br><code>onUnmount</code><br><code>onErrorCaptured</code><br><code>onRenderTracked</code><br><code>onRenderTriggered</code></p></blockquote><p>具体使用方法与生命周期函数类似，但是注意以上这些只能在 setup 中使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;mounted&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Vue3 还提供了 <code>provide</code> 和 <code>inject</code> 方便在 <code>setup</code> 中进行 提供和注入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">provide</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;this is a title&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> title = <span class="title function_">inject</span>(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;default value&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;hr&gt;
&lt;p&gt;Vue3 继承了 Vue2 的所有生命周期函数，所以 Vue2 的生命周期的应用方式同样适用于 Vue3。同时 Vue3 还新增了一些新的生命周期。&lt;/p&gt;
&lt;p&gt;原有的生命周期函数我们这边不做过多的赘述，我们来讲解一下 Vue3 相对于 Vue2 变更了和新增了</summary>
      
    
    
    
    <category term="Vue3" scheme="https://lxx1997.github.io/categories/Vue3/"/>
    
    <category term="vite" scheme="https://lxx1997.github.io/categories/vite/"/>
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/categories/TypeScript/"/>
    
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/tags/TypeScript/"/>
    
    <category term="Vue3" scheme="https://lxx1997.github.io/tags/Vue3/"/>
    
    <category term="vite" scheme="https://lxx1997.github.io/tags/vite/"/>
    
  </entry>
  
  <entry>
    <title>Vue3 + Vite + TypeScript 项目实战 -----（一）搭建项目</title>
    <link href="https://lxx1997.github.io/2021/01/15/vue/vue3-vite-typescript-01/"/>
    <id>https://lxx1997.github.io/2021/01/15/vue/vue3-vite-typescript-01/</id>
    <published>2021-01-15T14:56:10.000Z</published>
    <updated>2021-01-15T14:56:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>Vue3 新版出来了这么久，虽然之前也有联系过搭建，但是并没有测试过多的东西，趁着闲暇时间，打算从头采坑，记录自己的 Vue 3.0 的爬坑历程</p><h4 id="搭建项目"><a href="#搭建项目" class="headerlink" title="搭建项目"></a>搭建项目</h4><p>  本次项目搭建采用尤雨溪大大开发的 Vite，这是尤大最近开发出的新的 Web 开发工具具有以下优点</p><ul><li>快速的冷启动</li><li>即时的模块热更新</li><li><p>真正的按需编译</p><p>使用 vite 极大的提高了前端的开发性能及开发速度</p><p><strong>全局安装 Vite</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局安装 vite-app</span></span><br><span class="line">npm i -g vite-app</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建项目</span></span><br><span class="line">npm init vite-app &lt;project-name&gt;</span><br><span class="line"></span><br><span class="line">cd project-name</span><br><span class="line"></span><br><span class="line">yarn || npm install</span><br></pre></td></tr></table></figure></li></ul><h4 id="安装-必要第三方插件"><a href="#安装-必要第三方插件" class="headerlink" title="安装 必要第三方插件"></a>安装 必要第三方插件</h4><p>  <strong>安装 TypeScript</strong></p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D typescript</span><br></pre></td></tr></table></figure><p>  根目录(src)下新增 shim.vue.d.ts 文件</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.vue&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">import</span> &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">component</span>: <span class="title class_">Component</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> component</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;*.vue&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">  <span class="comment">// const component: defineComponent&lt;&#123;&#125;,&#123;&#125;,any&gt;</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  修改 main.js 为 main.ts</p><p>  并修改 index.html 文的引用</p><p>  <strong>安装 vue-router</strong></p><p>  vue3.0 最好安装最新的版的 vue-router，版本错误的话无法使用路由进行跳转</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-router@<span class="number">4</span></span><br></pre></td></tr></table></figure><p>  然后在 src 目录下新建 router 目录，在目录下新建 index.ts 文件</p><p>  从 vue-router 引入 <code>createRouter</code> 和 <code>createWebHashHistory</code>(或者<code>createWebHistory</code>)<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createRouter, createWebHashHistory&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br></pre></td></tr></table></figure></p><p>  然后新建 一个 route对象，存放路由配置，使用 createRouter 方法 创建 router 对象，最后通过 export default 导出</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;../views/home/index.vue&#x27;</span>),</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/index&#x27;</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;../views/login/index.vue&#x27;</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHashHistory</span>(),</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><p>  在 mian.ts 对象中 通过 import 引入，并用 Vue 的 use 方法 注册到 Vue 实例上</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(router).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p>  <strong>使用 Vue 状态管理工具 Vuex</strong></p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安装</span></span><br><span class="line">npm install vuex@next</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="comment">// /src/store/index.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">modules</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;lxx&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">getters</span>: &#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(router).<span class="title function_">use</span>(store).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p>  <strong>使用 sass 语法</strong></p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安装 sass</span></span><br><span class="line">yarn add sass</span><br><span class="line"></span><br><span class="line"><span class="comment">// 安装完成之后 将 sass 从 dependencies 移动到 devDependencies</span></span><br><span class="line"><span class="comment">// 使用时 在 style 后加 lang=&quot;scss&quot;</span></span><br></pre></td></tr></table></figure><p>如果想要对 Vite 构建的 Vue3.0应用进行新的配置，首先需要在根目录创建一个 <code>vite.config.js</code> 文件</p><h4 id="配置路径别名"><a href="#配置路径别名" class="headerlink" title="配置路径别名"></a>配置路径别名</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> path.<span class="title function_">join</span>(__dirname, dir)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">export</span> = &#123;</span><br><span class="line">  <span class="attr">alias</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;/@/&#x27;</span>: <span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时访问 src 目录下的文件就可以通过 <code>/@/</code>来进行访问</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 访问 src 目录下的 component 目录下的 index 文件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Component</span> <span class="keyword">from</span> <span class="string">&#x27;/@/component&#x27;</span></span><br></pre></td></tr></table></figure><p>为什么要使用 <code>/@/</code> 而不是直接 <code>@/</code> 呢，在这里 Vite 的<a href="https://vitejs.dev/config/#alias">官方配置</a>给我们做了解释</p><p><em>当别名为文件系统路径的时候，请使用绝对路径，相对别名值将按原样使用，并不会解析为文件路径</em>，所有要使用 <code>/@/</code> 来代表绝对路径</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Vue3 新版出来了这么久，虽然之前也有联系过搭建，但是并没有测试过多的东西，趁着闲暇时间，打算从头采坑，记录自己的 Vue 3.0 的爬坑历程&lt;/p&gt;
&lt;h4 id=&quot;搭建项目&quot;&gt;&lt;a href=&quot;#搭建项目&quot; class=&quot;headerlink&quot; title=&quot;搭建项目</summary>
      
    
    
    
    <category term="Vue3" scheme="https://lxx1997.github.io/categories/Vue3/"/>
    
    <category term="vite" scheme="https://lxx1997.github.io/categories/vite/"/>
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/categories/TypeScript/"/>
    
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/tags/TypeScript/"/>
    
    <category term="Vue3" scheme="https://lxx1997.github.io/tags/Vue3/"/>
    
    <category term="vite" scheme="https://lxx1997.github.io/tags/vite/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript 原型链</title>
    <link href="https://lxx1997.github.io/2021/01/14/web/js-prototype-chain/"/>
    <id>https://lxx1997.github.io/2021/01/14/web/js-prototype-chain/</id>
    <published>2021-01-14T14:57:43.000Z</published>
    <updated>2021-01-14T14:57:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>当我们定义了一个函数或者对象的时候，自带有属性中有一个属性 <code>__proto__</code>，这个属性又被称作原型链，指向构造当前函数的 <code>prototype</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> test = <span class="keyword">new</span> <span class="title class_">Test</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="property">__proto__</span>)  <span class="comment">// &#123;constructor: f&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Test</span>.<span class="property"><span class="keyword">prototype</span></span>)  <span class="comment">// &#123;constructor: f&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="property">__proto__</span> === <span class="title class_">Test</span>.<span class="property"><span class="keyword">prototype</span></span>)  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>当我们继续打印 <code>Test.prototype.__proto__</code> 的时候会发现 Test 的构造函数是 Object，即</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Test</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>)  <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>这个时候就会发现有些特殊的事情，当我们在 Test 的 prototype 属性上添加一些属性或者 Object 的 prototype 上添加一些属性，这时通过 new 构造出来的实例能不能访问到这些属性或者方法呢，接下来让我们尝试一下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> test = <span class="keyword">new</span> <span class="title class_">Test</span>()</span><br><span class="line">  <span class="title class_">Test</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">b</span> = <span class="number">3</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">c</span> = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="property">a</span>)   <span class="comment">// 1</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="property">b</span>)   <span class="comment">// 3</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="property">c</span>)   <span class="comment">// 4</span></span><br><span class="line">~~~~</span><br><span class="line"></span><br><span class="line">这个时候如果我们在 test 实例上新增一个属性 b 并赋值，这时侯打印出来的 test.<span class="property">b</span> 的值是多少呢</span><br><span class="line">~~~js</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> test = <span class="keyword">new</span> <span class="title class_">Test</span>()</span><br><span class="line">  <span class="title class_">Test</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">b</span> = <span class="number">3</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">c</span> = <span class="number">4</span></span><br><span class="line">  test.<span class="property">b</span> = <span class="number">5</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="property">b</span>)   <span class="comment">// b</span></span><br></pre></td></tr></table></figure><p>这是因为 使用 new 构造函数的时候，会自动继承构造函数上的所有方法及属性，当我们在访问实例的某个属性的时候，会现在实例对象上查找是否包含有这个属性，如果包含就直接返回，不包含的话就会在实例的原型链 <code>__proto__</code> 上继续查找，如果仍未找到，则会继续通过 <code>__proto__</code>一级一级的向上查找，直到找到 原型链的最后一级 <code>Object</code>,如果仍未找到就返回 <code>undefined</code></p><p><strong>constructor</strong></p><p>在实例的自身属性及 <code>__proto__</code> 属性上有一个 <code>contructor</code> 属性，该属性指向 构造当前实例的 构造函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> test = <span class="keyword">new</span> <span class="title class_">Test</span>()</span><br><span class="line"><span class="comment">// 这是因为 使用 new  构造函数的时候 把 Test 的所有属性都赋予了 test</span></span><br><span class="line">test.<span class="property">__proto__</span>.<span class="property">constructor</span>  <span class="comment">// f Test() &#123;this.a = 1&#125;</span></span><br><span class="line">test.<span class="property">constructor</span>  <span class="comment">// f Test() &#123;this.a = 1&#125;</span></span><br></pre></td></tr></table></figure><p><strong>判断是否包含属性</strong></p><p>如何判断 实例的属性 是在实例自身身上还是在原型链上呢，这时候可以通过 <code>Object.hasOwnProperty</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> test = <span class="keyword">new</span> <span class="title class_">Test</span>()</span><br><span class="line"><span class="title class_">Test</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">b</span> = <span class="number">3</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">c</span> = <span class="number">4</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;a&#x27;</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;b&#x27;</span>)) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(test.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;c&#x27;</span>)) <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a&#x27;</span> <span class="keyword">in</span> test) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b&#x27;</span> <span class="keyword">in</span> test) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;v&#x27;</span> <span class="keyword">in</span> test) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>属性 b 和 c 是挂载到 test 的原型链上的属性，并不属于 test 自身，所以通过 <code>Object.hasOwnProperty</code> 访问的时候返回为 false</p><p><strong>特殊的原型 Object 和 Function</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>   <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>   <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property">__proto__</span> === <span class="title class_">Function</span>.<span class="property">__proto__</span>   <span class="comment">// true</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;当我们定义了一个函数或者对象的时候，自带有属性中有一个属性 &lt;code&gt;__proto__&lt;/code&gt;，这个属性又被称作原型链，指向构造当前函数的 &lt;code&gt;prototype&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table</summary>
      
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/categories/JavaScript/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="prototype" scheme="https://lxx1997.github.io/tags/prototype/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript - this 指向问题</title>
    <link href="https://lxx1997.github.io/2021/01/11/web/js-this-point/"/>
    <id>https://lxx1997.github.io/2021/01/11/web/js-this-point/</id>
    <published>2021-01-11T01:30:46.000Z</published>
    <updated>2021-01-11T01:30:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>this 的指向问题一直是 JavaScript 中一个很重要的问题，我们在日常编程中，经常会遇到在函数中执行的时候，发现从 this 中取不到我们想要的东西，面试的过程中，this 也是经常会被面试官问到的一个问题。</p><p>接下来，我们将会在此篇文章中详细的讲解一个 JavaScript 中 this 的获取及指向问题</p><h4 id="this-指向"><a href="#this-指向" class="headerlink" title="this 指向"></a>this 指向</h4><p>在 JavaScript 中一个特殊的关键字 this，通过 this 我们可以获取当前代码块执行环境的对象</p><p>我们可以通过 <code>this.xxx</code> 来获取到 this 所代表的对象的属性</p><p>this 取何值，取决于 this 所处代码块为谁调用的</p><p>总结一下 this 指向几种情况</p><h5 id="普通函数调用的时候，this-指向-window-又称作默认绑定"><a href="#普通函数调用的时候，this-指向-window-又称作默认绑定" class="headerlink" title="普通函数调用的时候，this 指向 window 又称作默认绑定"></a>普通函数调用的时候，this 指向 window 又称作默认绑定</h5><p>  来看下面这一段代码</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;zhangsan&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">&#x27;lisi&#x27;</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>()</span><br></pre></td></tr></table></figure><p>  猜一下上述代码 输出的 <code>name</code> 是什么？</p><p>  对的，输出的 <code>zhangsan</code>，也许你会问为什么 函数 fn 里面的 this 不是指向函数 fn，这是因为在全局中通过 var 创建的变量也会默认挂载在 window 对象中， 调用 <code>fn()</code> 函数的时候，直接调用相当于 <code>window.fn()</code>，此时 this 指向调用函数 fn 的对象 即 window，所以输出的是 <code>zhangsan</code>。</p><p>  需要注意一点的是，这段代码在浏览器执行和在 node 环境在执行输出的结果是不一样，因为在  node 环境中 全局对象是 global，而不是 window。</p><h5 id="通过对象方法调用的时候，函数的-this-指向这个对象-又称作隐式绑定"><a href="#通过对象方法调用的时候，函数的-this-指向这个对象-又称作隐式绑定" class="headerlink" title="通过对象方法调用的时候，函数的 this 指向这个对象 又称作隐式绑定"></a>通过对象方法调用的时候，函数的 this 指向这个对象 又称作隐式绑定</h5><p>  我们对以上代码再次进行改装</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;zhangsan&#x27;</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;lisi&#x27;</span>,</span><br><span class="line">  <span class="attr">fn</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fn = obj.<span class="property">fn</span></span><br><span class="line">obj.<span class="title function_">fn</span>()</span><br><span class="line"><span class="title function_">fn</span>()</span><br></pre></td></tr></table></figure><p>  上述代码输出的是什么呢？可能有会说输出的都是 <code>lisi</code>，因为函数 fn 位于 obj 对象里，所以它的 this 指向 obj，但是我们想说这是一种错误的理解方式，因为 <strong>this 的指向不是由他位于哪个代码块中决定，而是由它所在的代码块由谁调用来决定</strong>。</p><p>  我们知道函数在执行之前都会经过解析，然后在栈内存中存放解析后的键值对，当解析到 obj 的时候，因为 obj 的类型是 Object 所以会在栈内存中开辟一个新的栈内存，用来存储 obj 的键值对，然后将新建的栈内存通过引用赋予 obj，当解析到 obj 的 fn 函数的时候，同样会开辟一个新的栈内存 <code>AAAFFF000</code>，这个栈内存用来存放 fn 的函数字符串</p><p>  当我们通过 obj 来调用的时候，可以理解为 <code>AAAFFF000</code> 这个栈内存 上下文对象是 obj， 此时通过 this 调用的时候，this 指的就是 obj 这个对象</p><p>  而将 obj.fn 赋值于 fn 的时候，由于 obj.fn 是一个引用对象，所以将 obj.fn 的引用地址复制给了 fn，然后调用 fn 相当于在 window 的环境下执行 <code>AAAFFF000</code> 这个代码块，此时的 this 指向 window</p><p>  所以输出的是<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  &#x27;lisi&#x27;</span></span><br><span class="line"><span class="comment">//  &#x27;zhangsan&#x27;</span></span><br></pre></td></tr></table></figure></p><p>  接下来我们对这段代码进行进一步改造，然后看一下它的执行结果</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;zhangsan&#x27;</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;lisi&#x27;</span>,</span><br><span class="line">  <span class="attr">fn</span>: (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fn = obj.<span class="property">fn</span></span><br><span class="line">obj.<span class="title function_">fn</span>()</span><br><span class="line"><span class="title function_">fn</span>()</span><br></pre></td></tr></table></figure><p>  你猜到这段代码输出的结果了吗？</p><p>  这段代码输出的结果是</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  &#x27;zhangsan&#x27;</span></span><br><span class="line"><span class="comment">//  &#x27;lisi&#x27;</span></span><br><span class="line"><span class="comment">//  zhangsan</span></span><br></pre></td></tr></table></figure><p>  大家看 obj 对象中的 fn 函数，这个函数是一个自执行函数，会在解析的时候就执行，这个时候上下文对象是 window，所以输出的是 ‘zhangsan’ 然后返回一个函数，此时这个 obj.fn 就等于这个 return 回来的函数</p><p>  后面的输出的数据执行方法和上一个例子是一样的，这里就不在多做赘述</p><p>  <strong>特殊的例子: 回调函数模式</strong></p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> test</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>()()  <span class="comment">// window</span></span><br><span class="line"><span class="comment">// 因为 foo() 执行的相当于返回了 test 再一次调用和调用 test() 方法相等</span></span><br><span class="line"><span class="comment">// foo()() === test()</span></span><br></pre></td></tr></table></figure><p>  <strong>特殊情况：参数赋值的情况</strong><br>  首先上代码<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">3</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="title function_">fn</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">foo</span>: foo</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">bar</span>(obj.<span class="property">foo</span>)  <span class="comment">// window</span></span><br></pre></td></tr></table></figure></p><p>  在 bar 函数中， fn 为形参，在调用 bar 函数传入 obj.foo 实参的时候，实际上相当于隐形的将 obj.foo 赋值于 fn，fn进行调用的时候，正好符合 this 的默认绑定规则，此时 this 指向 window</p><p>  总结起来就一句话<br>  <strong>函数每次执行的都会有自己的 this 指向，函数单独调用的时候(包括自调用函数)，this 执行 window，以对象的方法调用时候，this 隐式绑定为 该对象</strong></p><h5 id="显示绑定-call，bind，apply"><a href="#显示绑定-call，bind，apply" class="headerlink" title="显示绑定 call，bind，apply"></a>显示绑定 call，bind，apply</h5><p>  bind,call,apply都可以改变函数的 this 指向</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test</span>()            <span class="comment">// 2</span></span><br><span class="line">test.<span class="title function_">call</span>(obj)    <span class="comment">// 1</span></span><br><span class="line">test.<span class="title function_">bind</span>(obj)    <span class="comment">// 1</span></span><br><span class="line">test.<span class="title function_">apply</span>(obj)   <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>  其中 call 和 apply 在改变 this 指向的时候会自动调用函数，而 bind 只会改变 this 指向并不会执行函数</p><p>  call 和 bind 是可以传入多个参数 call(this, arg1, arg2, …), apply 多个参数需要放到数组里面 apply(this, [arg1, arg2, arg3…])</p><h5 id="通过构造函数-new-关键字创建的，this-指向实例对象"><a href="#通过构造函数-new-关键字创建的，this-指向实例对象" class="headerlink" title="通过构造函数 new 关键字创建的，this 指向实例对象"></a>通过构造函数 new 关键字创建的，this 指向实例对象</h5><p>  在通过 new 关键字构造函数时，主要做了以下四件事</p><ul><li>首先创建了一个空对象</li><li>然后连接到原型，将 obj 的 <code>__proto__</code> 指向构造函数的 prototype<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title function_">A</span>()</span><br><span class="line">a.<span class="property">__proto__</span> === A.<span class="property"><span class="keyword">prototype</span></span></span><br></pre></td></tr></table></figure></li><li>通过 <code>.call(obj)</code> 将 function 的 this 指向 obj</li><li><p>返回创建的这个对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fn = <span class="keyword">new</span> <span class="title class_">Fn</span>() <span class="comment">// Fn&#123;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fn.<span class="property">a</span>)  <span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>如果 Fn 函数 中 return 了一个对象 obj，new 的时候 this 会指向这个 obj对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">a</span> = <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fn = <span class="keyword">new</span> <span class="title class_">Fn</span>() <span class="comment">// &#123;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fn.<span class="property">a</span>)  <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></li></ul><p>通常来说，优先级的顺序大概是  new &gt; call/bind/apply  &gt; 隐式绑定 &gt; 默认绑定</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&#x27;window&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="string">&#x27;obj’,</span></span><br><span class="line"><span class="string">  test: test</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">var obj2 = &#123;</span></span><br><span class="line"><span class="string">  a: &#x27;</span>obj2<span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">test()                // window</span></span><br><span class="line"><span class="string">test.call(obj)         // obj</span></span><br><span class="line"><span class="string">obj.test.call(obj2)    // obj2</span></span><br><span class="line"><span class="string">new obj.test()         // undefined  this 指向 test&#123;&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h4 id="特殊的-this-指向"><a href="#特殊的-this-指向" class="headerlink" title="特殊的 this 指向"></a>特殊的 this 指向</h4><h5 id="es6-的箭头函数"><a href="#es6-的箭头函数" class="headerlink" title="es6 的箭头函数"></a>es6 的箭头函数</h5><p>  先来看一下普通函数的 this 指向<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>)&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) &#125;</span><br><span class="line">  <span class="keyword">let</span> c = <span class="keyword">function</span>(<span class="params"></span>) &#123;<span class="title function_">a</span>()&#125;</span><br><span class="line">  <span class="keyword">let</span> obj2 = &#123;a,c&#125;</span><br><span class="line">  obj2.<span class="title function_">a</span>()<span class="comment">// &#123;a: fn(), c:fn()&#125;</span></span><br><span class="line">  obj2.<span class="title function_">c</span>()<span class="comment">// window</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;b&#125;</span><br><span class="line">obj.<span class="title function_">b</span>()<span class="comment">//使函数b内上下文this为obj</span></span><br></pre></td></tr></table></figure></p><p>  如果加上箭头函数<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="title function_">a</span> = (<span class="params"></span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">  <span class="keyword">let</span> c = <span class="keyword">function</span>(<span class="params"></span>) &#123;<span class="title function_">a</span>()&#125;</span><br><span class="line">  <span class="keyword">let</span> obj2 = &#123;a,c&#125;</span><br><span class="line">  obj2.<span class="title function_">a</span>()<span class="comment">//&#123;b: fn()&#125;</span></span><br><span class="line">  obj2.<span class="title function_">c</span>()<span class="comment">//&#123;b: fn()&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;b&#125;</span><br><span class="line">obj.<span class="title function_">b</span>()<span class="comment">//&#123;b:fn()&#125;</span></span><br></pre></td></tr></table></figure><br>  从上面的例子可以看出，箭头函数在调用的时候，指向声明的时候所在的上下文<br>  也可以说 箭头函数 是没有 this，他的 this 全由所处上下文对象的 this 指向决定，一旦this 指向确定，无法通过 new/call/bind/apply/隐式绑定/显示绑定等方法修改this指向</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;this 的指向问题一直是 JavaScript 中一个很重要的问题，我们在日常编程中，经常会遇到在函数中执行的时候，发现从 this 中取不到我们想要的东西，面试的过程中，this 也是经常会被面试官问到的一个问题。&lt;/p&gt;
&lt;p&gt;接下来，我们将会在此篇文章中详细的讲解一</summary>
      
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/categories/JavaScript/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="this" scheme="https://lxx1997.github.io/tags/this/"/>
    
  </entry>
  
  <entry>
    <title>跟着 Vue源码学习 Vue api 系列 (一) - 全局配置</title>
    <link href="https://lxx1997.github.io/2021/01/09/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-01/"/>
    <id>https://lxx1997.github.io/2021/01/09/vue/vue-learn-api-with-%E6%BA%90%E7%A0%81-01/</id>
    <published>2021-01-09T14:17:53.000Z</published>
    <updated>2021-01-09T14:17:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>此篇文章用来记录 Vue 中 Api 在 Vue源码中的具体实现方法，以便更好的理解 Vue 的各种 Api 的使用方法</p><h4 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h4><p>Vue 的全局配置参数是存放在 <code>config</code> 里面的，我们可以通过修改 config 中的 properties</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Config</span> = &#123;</span><br><span class="line">  <span class="comment">// user</span></span><br><span class="line">  <span class="attr">optionMergeStrategies</span>: &#123; [<span class="attr">key</span>: string]: <span class="title class_">Function</span> &#125;;</span><br><span class="line">  <span class="attr">silent</span>: boolean;</span><br><span class="line">  <span class="attr">productionTip</span>: boolean;</span><br><span class="line">  <span class="attr">performance</span>: boolean;</span><br><span class="line">  <span class="attr">devtools</span>: boolean;</span><br><span class="line">  <span class="attr">errorHandler</span>: ?<span class="function">(<span class="params">err: <span class="built_in">Error</span>, vm: Component, info: string</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">warnHandler</span>: ?<span class="function">(<span class="params">msg: string, vm: Component, trace: string</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">ignoredElements</span>: <span class="title class_">Array</span>&lt;string | <span class="title class_">RegExp</span>&gt;;</span><br><span class="line">  <span class="attr">keyCodes</span>: &#123; [<span class="attr">key</span>: string]: number | <span class="title class_">Array</span>&lt;number&gt; &#125;;</span><br><span class="line">  <span class="comment">// platform</span></span><br><span class="line">  <span class="attr">isReservedTag</span>: <span class="function">(<span class="params">x?: string</span>) =&gt;</span> boolean;</span><br><span class="line">  <span class="attr">isReservedAttr</span>: <span class="function">(<span class="params">x?: string</span>) =&gt;</span> boolean;</span><br><span class="line">  <span class="attr">parsePlatformTagName</span>: <span class="function">(<span class="params">x: string</span>) =&gt;</span> string;</span><br><span class="line">  <span class="attr">isUnknownElement</span>: <span class="function">(<span class="params">x?: string</span>) =&gt;</span> boolean;</span><br><span class="line">  <span class="attr">getTagNamespace</span>: <span class="function">(<span class="params">x?: string</span>) =&gt;</span> string | <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">mustUseProp</span>: <span class="function">(<span class="params">tag: string, type: ?string, name: string</span>) =&gt;</span> boolean;</span><br><span class="line">  <span class="comment">// private</span></span><br><span class="line">  <span class="attr">async</span>: boolean;</span><br><span class="line">  <span class="comment">// legacy</span></span><br><span class="line">  <span class="attr">_lifecycleHooks</span>: <span class="title class_">Array</span>&lt;string&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="1-silent-Boolean"><a href="#1-silent-Boolean" class="headerlink" title="1. silent Boolean"></a>1. silent Boolean</h5><p>  silent 配置 主要用于判断是否输出 Vue 所有的日志和警告</p><ul><li>默认为 false 不取消日志和警告输出</li><li>设置为 true  取消日志和警告输出<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hasConsole = <span class="keyword">typeof</span> <span class="variable language_">console</span> !== <span class="string">&#x27;undefined&#x27;</span>;</span><br><span class="line"><span class="comment">// hasConsole 用于判断 window对象中 是否包含有 console 这个属性</span></span><br><span class="line"><span class="keyword">if</span> (hasConsole &amp;&amp; (!config.<span class="property">silent</span>)) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>((<span class="string">&quot;[Vue warn]: &quot;</span> + msg + trace));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="2-optionMergeStrategies-Object"><a href="#2-optionMergeStrategies-Object" class="headerlink" title="2. optionMergeStrategies Object"></a>2. optionMergeStrategies Object</h5><p>  自定义选项合并策略，覆盖已有值</p><p>  主要用于 mixin 和 Vue.extend() 方法时对子组件和父组件 有相同属性时的合并策略</p><p>  <strong>以下的 parentVal，parent 等父参数 只有 Vue.extend 或者 extends 传入对应类型数据时才有数据</strong></p><p>  Vue源码 自带的属性<br>  <code>el</code>，<code>propsData</code>，<code>provide</code> 子组件和父组件如果有相同的方法，以子组件为主</p><ul><li>el</li><li>propsData<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> defaultStrat = <span class="keyword">function</span> (<span class="params">parentVal, childVal</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> childVal === <span class="literal">undefined</span></span><br><span class="line">    ? parentVal</span><br><span class="line">    : childVal</span><br><span class="line">&#125;;</span><br><span class="line">strats.<span class="property">el</span> = strats.<span class="property">propsData</span> = <span class="keyword">function</span> (<span class="params">parent, child, vm, key</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!vm) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">&quot;option \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; can only be used during instance &quot;</span> +</span><br><span class="line">      <span class="string">&#x27;creation with the `new` keyword.&#x27;</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 在这里进行了判断，如果 child 存在 就返回 child 否则返回 parent</span></span><br><span class="line">  <span class="comment">// 表明在合并的过程中 el 和 propsData 以子的为准</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">defaultStrat</span>(parent, child)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li>provide  <code>strats.provide = mergeDataOrFn;</code></li><li>data<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> (<span class="params">parentVal, childVal, vm </span>) &#123;</span><br><span class="line">  <span class="comment">// childVal 是 组件的 data 函数</span></span><br><span class="line">  <span class="keyword">if</span> (!vm) &#123;</span><br><span class="line">    <span class="comment">// 判断 vue 的 data 对象是一个函数 保证各个组件之间的数据互不影响</span></span><br><span class="line">    <span class="keyword">if</span> (childVal &amp;&amp; <span class="keyword">typeof</span> childVal !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">warn</span>(</span><br><span class="line">        <span class="string">&#x27;The &quot;data&quot; option should be a function &#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;that returns a per-instance value in component &#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;definitions.&#x27;</span>,</span><br><span class="line">        vm</span><br><span class="line">      );</span><br><span class="line">      <span class="comment">// 如果子的值不是函数 返回父的值</span></span><br><span class="line">      <span class="keyword">return</span> parentVal</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">mergeDataOrFn</span>(parentVal, childVal)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">mergeDataOrFn</span>(parentVal, childVal, vm)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><strong>margeDataOrFn 方法</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 合并数据</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergeDataOrFn</span> (parentVal, childVal, vm) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!vm) &#123;</span><br><span class="line">    <span class="comment">// in a Vue.extend merge, both should be functions</span></span><br><span class="line">    <span class="keyword">if</span> (!childVal) &#123;</span><br><span class="line">      <span class="keyword">return</span> parentVal</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!parentVal) &#123;</span><br><span class="line">      <span class="keyword">return</span> childVal</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// when parentVal &amp; childVal are both present,</span></span><br><span class="line">    <span class="comment">// we need to return a function that returns the</span></span><br><span class="line">    <span class="comment">// merged result of both functions... no need to</span></span><br><span class="line">    <span class="comment">// check if parentVal is a function here because</span></span><br><span class="line">    <span class="comment">// it has to be a function to pass previous merges.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">mergedDataFn</span> () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">mergeData</span>(</span><br><span class="line">        <span class="keyword">typeof</span> childVal === <span class="string">&#x27;function&#x27;</span> ? childVal.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>) : childVal,</span><br><span class="line">        <span class="keyword">typeof</span> parentVal === <span class="string">&#x27;function&#x27;</span> ? parentVal.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>) : parentVal</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">mergedInstanceDataFn</span> () &#123;</span><br><span class="line">      <span class="comment">// instance merge</span></span><br><span class="line">      <span class="keyword">var</span> instanceData = <span class="keyword">typeof</span> childVal === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? childVal.<span class="title function_">call</span>(vm, vm)</span><br><span class="line">        : childVal;</span><br><span class="line">      <span class="keyword">var</span> defaultData = <span class="keyword">typeof</span> parentVal === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? parentVal.<span class="title function_">call</span>(vm, vm)</span><br><span class="line">        : parentVal;</span><br><span class="line">      <span class="keyword">if</span> (instanceData) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">mergeData</span>(instanceData, defaultData)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> defaultData</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><strong>margeData 方法</strong><br><a href="/2020/12/15/vue-源码常用方法/#set">set方法详解</a><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mergeData</span> (to, <span class="keyword">from</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">from</span>) &#123; <span class="keyword">return</span> to &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> key, toVal, fromVal;</span><br><span class="line">  <span class="comment">// 判断是否有 Symbol 数据类型，避免合并数据的时候遗漏 Symbol 类型属性</span></span><br><span class="line">  <span class="comment">// Reflect.ownKeys(obj) 可以遍历出 Symbol 类型属性</span></span><br><span class="line">  <span class="comment">// Object.keys,Object.values 无法遍历出 Symbol 类型属性</span></span><br><span class="line">  <span class="keyword">var</span> keys = hasSymbol</span><br><span class="line">    ? <span class="title class_">Reflect</span>.<span class="title function_">ownKeys</span>(<span class="keyword">from</span>)</span><br><span class="line">    : <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="keyword">from</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; keys.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    key = keys[i];</span><br><span class="line">    <span class="comment">// in case the object is already observed...</span></span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&#x27;__ob__&#x27;</span>) &#123; <span class="keyword">continue</span> &#125;</span><br><span class="line">    toVal = to[key];</span><br><span class="line">    fromVal = <span class="keyword">from</span>[key];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">hasOwn</span>(to, key)) &#123;</span><br><span class="line">      <span class="title function_">set</span>(to, key, fromVal);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">      toVal !== fromVal &amp;&amp;</span><br><span class="line">      <span class="title function_">isPlainObject</span>(toVal) &amp;&amp;</span><br><span class="line">      <span class="title function_">isPlainObject</span>(fromVal)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="title function_">mergeData</span>(toVal, fromVal);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> to</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>watch<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> (<span class="params">parentVal, childVal, vm, key</span>) &#123;</span><br><span class="line">  <span class="comment">// work around Firefox&#x27;s Object.prototype.watch...</span></span><br><span class="line">  <span class="keyword">if</span> (parentVal === nativeWatch) &#123; parentVal = <span class="literal">undefined</span>; &#125;</span><br><span class="line">  <span class="keyword">if</span> (childVal === nativeWatch) &#123; childVal = <span class="literal">undefined</span>; &#125;</span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (!childVal) &#123; <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">create</span>(parentVal || <span class="literal">null</span>) &#125;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title function_">assertObjectType</span>(key, childVal, vm);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!parentVal) &#123; <span class="keyword">return</span> childVal &#125;</span><br><span class="line">  <span class="keyword">var</span> ret = &#123;&#125;;</span><br><span class="line">  <span class="title function_">extend</span>(ret, parentVal);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key$<span class="number">1</span> <span class="keyword">in</span> childVal) &#123;</span><br><span class="line">    <span class="keyword">var</span> parent = ret[key$<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">var</span> child = childVal[key$<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (parent &amp;&amp; !<span class="title class_">Array</span>.<span class="title function_">isArray</span>(parent)) &#123;</span><br><span class="line">      parent = [parent];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// parent 存在 则和 child 合并，否则判断 child 是否是数组，返回 数组</span></span><br><span class="line">    ret[key$<span class="number">1</span>] = parent</span><br><span class="line">      ? parent.<span class="title function_">concat</span>(child)</span><br><span class="line">      : <span class="title class_">Array</span>.<span class="title function_">isArray</span>(child) ? child : [child];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><code>hooks</code>，<code>watch</code> 会把子组件和父组件相同的钩子函数合并到一个数组上，父组件的钩子函数先执行</li><li>声明周期函数(在此不一一列举了)<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">LIFECYCLE_HOOKS</span> = [</span><br><span class="line">  <span class="string">&#x27;beforeCreate&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;created&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;beforeMount&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;mounted&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;beforeUpdate&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;updated&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;beforeDestroy&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;destroyed&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;activated&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;deactivated&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;errorCaptured&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;serverPrefetch&#x27;</span></span><br><span class="line">];</span><br><span class="line"><span class="variable constant_">LIFECYCLE_HOOKS</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">hook</span>) &#123;</span><br><span class="line">  strats[hook] = mergeHook;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 使用方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergeHook</span> (parentVal, childVal) &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 下面这个三目表达式可以拆分成下列样式</span></span><br><span class="line"><span class="comment">    * var test1 = Array.isArray(childVal) ? childVal : [childVal]</span></span><br><span class="line"><span class="comment">    * var test2 = parentVal ? parentVal.concat(childVal) : test1</span></span><br><span class="line"><span class="comment">    * var test3 = childVal ? test2 : parentVal</span></span><br><span class="line"><span class="comment">    * 如果 childVal 存在，就执行 test2 语句 不存在 则取 parentVal</span></span><br><span class="line"><span class="comment">    * test2 语句中 如果 parentVal 存在， 则与 childVal 连接成一个新数组 否则执行 test1 语句</span></span><br><span class="line"><span class="comment">    * test1 语句中 如果 childVal 是数组 就取 childVal 否则就转成数组</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">var</span> res = childVal</span><br><span class="line">    ? parentVal</span><br><span class="line">      ? parentVal.<span class="title function_">concat</span>(childVal)</span><br><span class="line">      : <span class="title class_">Array</span>.<span class="title function_">isArray</span>(childVal)</span><br><span class="line">        ? childVal</span><br><span class="line">        : [childVal]</span><br><span class="line">    : parentVal;</span><br><span class="line">  <span class="comment">// 对 获得的 res 进行去重</span></span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">    ? <span class="title function_">dedupeHooks</span>(res)</span><br><span class="line">    : res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dedupeHooks</span> (hooks) &#123;</span><br><span class="line">  <span class="keyword">var</span> res = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; hooks.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 如果 res 数组中不存在 hooks[i],就插入 hooks[i] 否则略过</span></span><br><span class="line">    <span class="keyword">if</span> (res.<span class="title function_">indexOf</span>(hooks[i]) === -<span class="number">1</span>) &#123;</span><br><span class="line">      res.<span class="title function_">push</span>(hooks[i]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>component</li><li>directive</li><li>filter<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mergeAssets</span> (parentVal, childVal, vm, key) &#123;</span><br><span class="line">  <span class="comment">// 以 parentVal 为原型 创建对象 res.prototype === parentVal</span></span><br><span class="line">  <span class="keyword">var</span> res = <span class="title class_">Object</span>.<span class="title function_">create</span>(parentVal || <span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">if</span> (childVal) &#123;</span><br><span class="line">    <span class="comment">//判断 childVal 的类型</span></span><br><span class="line">    <span class="title function_">assertObjectType</span>(key, childVal, vm);</span><br><span class="line">    <span class="comment">// 通过 extend  方法将 childVal 的属性复制到 res 上 并覆盖相同属性的数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">extend</span>(res, childVal)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><code>components</code>，<code>directives</code>，<code>filters</code> 使用了原型继承，返回合并后的新对象</li><li>props</li><li>methods</li><li>inject</li><li><p>computed</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> (<span class="params">parentVal, childVal, vm, key</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (childVal &amp;&amp; <span class="string">&quot;development&quot;</span> !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">assertObjectType</span>(key, childVal, vm);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!parentVal) &#123; <span class="keyword">return</span> childVal &#125;</span><br><span class="line">  <span class="keyword">var</span> ret = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">// 合并 parentVal 和 childVal</span></span><br><span class="line">  <span class="title function_">extend</span>(ret, parentVal);</span><br><span class="line">  <span class="keyword">if</span> (childVal) &#123; <span class="title function_">extend</span>(ret, childVal); &#125;</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>props</code>，<code>methods</code>，<code>computed</code>，<code>inject</code> 采用对象合并的方法，先合并父组件，在合并子组件，如果父组件和子组件有相同的属性，子组件会覆盖父组件的属性</p><p>简单的使用示例</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">optionMergeStrategies</span>.<span class="property">_myOptions</span> = <span class="function">(<span class="params">parntVal, childVal, vm</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(parntVal, childVal, vm)</span><br><span class="line">    <span class="keyword">return</span> parntVal ? childVal ? childVal + parntVal : <span class="number">0</span> : childVal</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">const</span> B = &#123;</span><br><span class="line">  <span class="attr">_myOptions</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> C = &#123;</span><br><span class="line">  <span class="attr">_myOptions</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;test&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">mixins</span>: [B,C],</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">_myOptions</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$options</span>.<span class="property">_myOptions</span>) <span class="comment">// 8</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`&lt;div&gt; children &lt;/div&gt;`</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;div&gt;</span></span><br><span class="line"><span class="string">    test</span></span><br><span class="line"><span class="string">    &lt;test&gt;&lt;/test&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="devtools"><a href="#devtools" class="headerlink" title="devtools"></a>devtools</h4></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// detect devtools</span></span><br><span class="line"><span class="keyword">var</span> devtools = inBrowser &amp;&amp; <span class="variable language_">window</span>.<span class="property">__VUE_DEVTOOLS_GLOBAL_HOOK__</span>;</span><br></pre></td></tr></table></figure><h4 id="errorHandler"><a href="#errorHandler" class="headerlink" title="errorHandler"></a>errorHandler</h4><p>  默认是 <code>undefined</code> 指定组件的渲染和观察期间未捕获错误的处理函数。这个处理函数被调用时，可获取错误信息和 Vue 实例。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">errorHandler</span> = <span class="function">(<span class="params">err, vm, info</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27; 错误拦截:&#x27;</span>, err, vm, info)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  源码位置<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">globalHandleError</span> (err, vm, info) &#123;</span><br><span class="line">  <span class="keyword">if</span> (config.<span class="property">errorHandler</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> config.<span class="property">errorHandler</span>.<span class="title function_">call</span>(<span class="literal">null</span>, err, vm, info)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="comment">// if the user intentionally throws the original error in the handler,</span></span><br><span class="line">      <span class="comment">// do not log it twice</span></span><br><span class="line">      <span class="keyword">if</span> (e !== err) &#123;</span><br><span class="line">        <span class="title function_">logError</span>(e, <span class="literal">null</span>, <span class="string">&#x27;config.errorHandler&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">logError</span>(err, vm, info);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="warnHandler"><a href="#warnHandler" class="headerlink" title="warnHandler"></a>warnHandler</h4><p>  默认值是 <code>undefined</code>，只会在开发环境下生效，生产环境下会被忽略</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">warnHandler</span> = <span class="function">(<span class="params">msg, vm, trace</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27; 错误拦截:&#x27;</span>, msg, vm, trace)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>源码<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">warn = <span class="keyword">function</span> (<span class="params">msg, vm</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> trace = vm ? <span class="title function_">generateComponentTrace</span>(vm) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (config.<span class="property">warnHandler</span>) &#123;</span><br><span class="line">    config.<span class="property">warnHandler</span>.<span class="title function_">call</span>(<span class="literal">null</span>, msg, vm, trace);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hasConsole &amp;&amp; (!config.<span class="property">silent</span>)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>((<span class="string">&quot;[Vue warn]: &quot;</span> + msg + trace));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h4 id="ignoredElements-Array"><a href="#ignoredElements-Array" class="headerlink" title="ignoredElements  Array"></a>ignoredElements  Array<string | RegExp></h4><p>  默认是一个空字符串，是一个由 字符串或者正则表达式组成的数组</p><p>  作用是为了屏蔽 Vue 的组件验证的时候，自定义组件(<a href="http://www.ruanyifeng.com/blog/2019/08/web_components.html">Web Components API</a>)报错提示功能，匹配到数组里面的组件名称的时候，会过滤掉提示</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">ignoredElements</span> = [</span><br><span class="line">  <span class="string">&#x27;my-custom-web-component&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;another-web-component&#x27;</span>,</span><br><span class="line">  <span class="comment">// 用一个 `RegExp` 忽略所有“ion-”开头的元素</span></span><br><span class="line">  <span class="comment">// 仅在 2.5+ 支持</span></span><br><span class="line">  <span class="regexp">/^ion-/</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>  源码位置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isUnknownElement$$1</span> (vnode, inVPre) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    !inVPre &amp;&amp;</span><br><span class="line">    !vnode.<span class="property">ns</span> &amp;&amp;</span><br><span class="line">    !(</span><br><span class="line">      config.<span class="property">ignoredElements</span>.<span class="property">length</span> &amp;&amp;</span><br><span class="line">      config.<span class="property">ignoredElements</span>.<span class="title function_">some</span>(<span class="keyword">function</span> (<span class="params">ignore</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">isRegExp</span>(ignore)</span><br><span class="line">          ? ignore.<span class="title function_">test</span>(vnode.<span class="property">tag</span>)</span><br><span class="line">          : ignore === vnode.<span class="property">tag</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ) &amp;&amp;</span><br><span class="line">    config.<span class="title function_">isUnknownElement</span>(vnode.<span class="property">tag</span>)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="keyCodes-key-string-number-Array"><a href="#keyCodes-key-string-number-Array" class="headerlink" title="keyCodes   {[key: string]: number | Array}"></a>keyCodes   {[key: string]: number | Array<number>}</h4><p>  给 <code>v-on</code> 自定义键位别名<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">keyCodes</span> = &#123;</span><br><span class="line">  <span class="attr">v</span>: <span class="number">86</span>,</span><br><span class="line">  <span class="attr">f1</span>: <span class="number">112</span>,</span><br><span class="line">  <span class="comment">// camelCase 不可用</span></span><br><span class="line">  <span class="attr">mediaPlayPause</span>: <span class="number">179</span>,</span><br><span class="line">  <span class="comment">// 取而代之的是 kebab-case 且用双引号括起来</span></span><br><span class="line">  <span class="string">&quot;media-play-pause&quot;</span>: <span class="number">179</span>,</span><br><span class="line">  <span class="attr">up</span>: [<span class="number">38</span>, <span class="number">87</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.media-play-pause</span>=<span class="string">&quot;method&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.179</span>=<span class="string">&quot;method&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 以上两种方法等效 --&gt;</span></span><br></pre></td></tr></table></figure><h4 id="performance-boolean"><a href="#performance-boolean" class="headerlink" title="performance  boolean"></a>performance  boolean</h4><p>  默认为 false 设置为 true 以在浏览器开发工具的性能/时间线面板中启用对组件初始化、编译、渲染和打补丁的性能追踪</p><h4 id="productionTip-boolean"><a href="#productionTip-boolean" class="headerlink" title="productionTip boolean"></a>productionTip boolean</h4><p>  默认为 true， 设置为 false 阻止 vue 在启动时生成生产提示信息</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;此篇文章用来记录 Vue 中 Api 在 Vue源码中的具体实现方法，以便更好的理解 Vue 的各种 Api 的使用方法&lt;/p&gt;
&lt;h4 id=&quot;全局配置&quot;&gt;&lt;a href=&quot;#全局配置&quot; class=&quot;headerlink&quot; title=&quot;全局配置&quot;&gt;&lt;/a&gt;全局配置&lt;/</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/categories/SourceCode/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/tags/SourceCode/"/>
    
  </entry>
  
  <entry>
    <title>Vue 组件之间通讯的各种情况</title>
    <link href="https://lxx1997.github.io/2021/01/07/vue/vue-components-transfer-data/"/>
    <id>https://lxx1997.github.io/2021/01/07/vue/vue-components-transfer-data/</id>
    <published>2021-01-07T13:11:23.000Z</published>
    <updated>2021-01-07T13:11:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>我们都知道 Vue 的两大核心是<strong>组件化</strong>和<strong>数据驱动</strong>，在 Vue 中，组件之间的值传递是一种十分常见的事情，那么你到底知道多少种组件的值传递的方法呢，接下来由我来带领大家了解一下</p><h4 id="Vue-组件之间的关系"><a href="#Vue-组件之间的关系" class="headerlink" title="Vue 组件之间的关系"></a>Vue 组件之间的关系</h4><p>Vue 的组件根据其在页面上的位置，我认为大致可以分为以下几种:</p><h5 id="父子组件"><a href="#父子组件" class="headerlink" title="父子组件"></a>父子组件</h5><p>  什么是父子组件呢？ 假如现在页面中有一个根组件<code>ParentComponent</code>,现在我们需要在这个根组件中加入其他内容，例如一张图片，一段具有事件和样式的文字等，我们可以假设这个加入内容的组件名称为<code>ChildrenComponent</code>, 这个新加入的组件<code>ChildrenComponent</code> 相对与 <code>ParentComponent</code>就是子组件, <code>ParentComponent</code> 就是 <code>ChildrenComponent</code> 的父组件，如下所示</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent-component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">children-component</span>&gt;</span><span class="tag">&lt;/<span class="name">children-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent-component</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="兄弟组件"><a href="#兄弟组件" class="headerlink" title="兄弟组件"></a>兄弟组件</h5><p>  什么是兄弟组件呢？以上面的父子组件为例，假如现在加入的不是一个组件，而是加入多个组件，加入的这些组件之间的关系就是兄弟组件的关系</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent-component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">children-component</span>&gt;</span><span class="tag">&lt;/<span class="name">children-component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">children-component</span>&gt;</span><span class="tag">&lt;/<span class="name">children-component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">children-component</span>&gt;</span><span class="tag">&lt;/<span class="name">children-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent-component</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="非父子，兄弟关系的组件"><a href="#非父子，兄弟关系的组件" class="headerlink" title="非父子，兄弟关系的组件"></a>非父子，兄弟关系的组件</h5><p>  这种组件的关系是怎么形成的呢，可能就是位于不同父组件下的子组件之间的关系</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent-component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">children-component</span>&gt;</span><span class="tag">&lt;/<span class="name">children-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">other-component</span>&gt;</span><span class="tag">&lt;/<span class="name">other-component</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  比如这种，<code>children-component</code> 和 <code>other-component</code> 之间的关系都是即非父子，兄弟关系组件</p><p>当然以上说法都不是特别组件，因为 Vue 是一个单页面组件，都位于同一个根组件下面，所以 Vue 中的组件之间都或多或少都是有一些关系</p><h4 id="Vue-组件之间的通讯"><a href="#Vue-组件之间的通讯" class="headerlink" title="Vue 组件之间的通讯"></a>Vue 组件之间的通讯</h4><p>上面介绍完了组件，我们现在介绍一下不同组件之间应该如何通讯</p><h5 id="父子组件-1"><a href="#父子组件-1" class="headerlink" title="父子组件"></a>父子组件</h5><ol><li><p>Vue 组件上有个特殊的属性 <code>Props</code> 可以取到通过 <code>v-bind</code>指令或者直接通过 属性 传值 传递过来参数，通常用于<strong>父子组件传值</strong> </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent-component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">children-component</span> <span class="attr">:type</span>=<span class="string">&quot;type&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">children-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent-component</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时子组件可以通过 <code>props</code> 来获取父组件传递过来的参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// children-component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 第一种 (不推介，因为没有类型检测，不利于开发)</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">  <span class="comment">// 第二种 (推介，可以检查通过 props 传递过来值的类型，利于排错和开发)</span></span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Array</span>,  <span class="comment">// 如果需要兼容多重类型检查可以使用数组 [Array, Object, String]</span></span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">name</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>子组件向父组件传值可以采用 <code>$emit()</code> 来发送事件，父组件采用 <code>v-on</code> 来监听事件发生</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$emit(<span class="string">&#x27;change&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent-component</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- v-on: 也可以简化成 @ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">children-component</span> <span class="attr">v-on:change</span>=<span class="string">&quot;handleChange&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">children-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent-component</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当然我们也可以采用 <code>v-model</code> 来传递参数，但是此时子组件必须要用 <code>props</code> 接收 一个名叫 <code>value</code> 的值，当事件触发时，把新的值通过自定义的 <code>input</code> 事件抛出</p><p>因为 <code>v-model</code> 等价 <code>v-bind:value</code> 和 <code>v-on:input</code></p></li><li><p><code>$parent</code> 和 <code>$children</code> 也可以实现父子组件之间传值</p><blockquote><p>但是 Vue 并不推介我们使用这种方法来进行父子组件传值通讯，只是作为访问组件的应急方法，更推介采用 props 和events(<code>$emit</code>,<code>$on</code>)</p></blockquote></li><li><p>父子组件之间也可以通过 <code>$refs</code> 方法来进行通讯</p><p>在子组件上添加属性 <code>ref</code> 值为 <code>refValue</code>, 父组件可以通过 <code>this.$refs[refValue]</code> 或者 <code>this.$refs.refValue</code> 来访问和调用子组件上面的方法和值</p><p><strong>注意：</strong> 使用 <code>$ref</code> 获取子组件必须是子组件已经在页面中加载成功了，即在 除<code>beforeCreate</code>, <code>created</code>, <code>destoryed</code> 生命周期函数以外的其他声明周期调用，如果组件是手动控制显示和隐藏，即使用 <code>v-if</code>，此时可以采用 <code>this.$nextTick(() =&gt; &#123;this.$refs[refValue]&#125;)</code> 方法来访问子组件的方法</p></li></ol><h5 id="兄弟组件之间的传值"><a href="#兄弟组件之间的传值" class="headerlink" title="兄弟组件之间的传值"></a>兄弟组件之间的传值</h5><ol><li><p>通过共有的父组件来进行传值</p><p>子组件通过 <code>$emit</code> 方法调用父组件的方法，然后通过父组件来调用其他的子组件来实现兄弟组件之间之间传值</p></li><li><p>通过 <code>$parent</code> 方法 </p><p>同父子组件传值，可以使用，但是不推介</p></li></ol><h5 id="非父子，兄弟关系的组件-1"><a href="#非父子，兄弟关系的组件-1" class="headerlink" title="非父子，兄弟关系的组件"></a>非父子，兄弟关系的组件</h5><ol><li><p>Vuex  Vue 状态管理工具</p><p>可以使用 Vue 的状态管理工具来进行传值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * state: 存储状态管理对象及数据</span></span><br><span class="line"><span class="comment">  * mutations: 同步修改 state 的属性的值，同时只有 mutations 能够修改 state 的值 使用时通过 commit 来调用</span></span><br><span class="line"><span class="comment">  * actions: 异步修改 state 的属性的值，通过调用 mutations 的方法来修改 通过 dispatch 方法调用</span></span><br><span class="line"><span class="comment">  */</span> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">state</span>: &#123;</span><br><span class="line">    type：<span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">mutations</span>: &#123;</span><br><span class="line">    <span class="title function_">setType</span>(<span class="params">state, type</span>) &#123;</span><br><span class="line">      state.<span class="property">type</span> = type</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">setType</span>(<span class="params">&#123;commit&#125;, type</span>) &#123;</span><br><span class="line">      <span class="title function_">commit</span>(<span class="string">&#x27;setType&#x27;</span>, type)</span><br><span class="line">    &#125;        </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// a 组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;setType&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// b 组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">state</span>.<span class="property">type</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关于 Vuex 的更多使用方法请百度查找官方使用文档</p></li><li><p>Vue bus  也叫<strong>中央事件总线</strong></p><p>定义一个全局的 Vue，通过挂载到 window 对象或者 Vue 实例上面，此时可以通过 Vue bus 的 <code>$emit</code> 和 <code>$on</code> 方法来进行事件传递</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种</span></span><br><span class="line"><span class="keyword">var</span> bus = <span class="keyword">new</span> <span class="title class_">Vue</span>()</span><br><span class="line"><span class="comment">// 发送事件</span></span><br><span class="line">bus.$emit(<span class="string">&#x27;patch&#x27;</span>)</span><br><span class="line"><span class="comment">// 接收事件</span></span><br><span class="line">bus.$on(<span class="string">&#x27;patch)</span></span><br><span class="line"><span class="string">// 第二种 </span></span><br><span class="line"><span class="string">Vue.$bus = new Vue()</span></span><br><span class="line"><span class="string">// 发送事件</span></span><br><span class="line"><span class="string">Vue.$bus.$emit(&#x27;</span>patch<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">// 接收事件</span></span><br><span class="line"><span class="string">Vue.$bus.$on(&#x27;</span>patch)</span><br></pre></td></tr></table></figure></li></ol><h4 id="进阶方法"><a href="#进阶方法" class="headerlink" title="进阶方法"></a>进阶方法</h4><p>以上都是一些比较简单的组件之间传值的方法，相信在座的各位基本上都用到过，接下来介绍一些比较高端的方法，这些方法我们可能没有用过，也可能没有听说过，接下来让我来带领大家去了解他们，使用他们</p><h5 id="attrs-和-listeners"><a href="#attrs-和-listeners" class="headerlink" title="$attrs 和 $listeners"></a>$attrs 和 $listeners</h5><p>  此方法适用于多层父子组件结构进行通讯，因为层级过多，此时使用 <code>$emit</code> 和 <code>$on</code> 方法来进行传值，你需要在需要通讯的两个祖孙组件之间的每个组件都要写上重复的 <code>$emit</code> 和 <code>$on</code>, 增加事件追踪难度，同时难以阅读</p><p>  此时可以采用 <code>$attrs</code> 和 <code>$listeners</code>来进行传值</p><p>  这种方法所采用的办法就是将祖父组件的 传给 父组件的 属性和监听事件传递给孙组件</p><p>  <strong>默认情况下父作用域的不被认作 props 的 attribute 绑定 (attribute bindings) 将会“回退”且作为普通的 HTML attribute 应用在子组件的根元素上</strong></p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 函数我就不写了，只是做一个简略的展示 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- grandfather 组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">grand-father</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a-parent</span> <span class="attr">:a</span>=<span class="string">&quot;a = 4444&quot;</span> <span class="attr">:b</span>=<span class="string">&quot;b = 5555&quot;</span> @<span class="attr">getData</span>=<span class="string">&quot;handleGetData&quot;</span> @<span class="attr">passData</span>=<span class="string">&quot;handlePassdata&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a-parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">grand-father</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- parent 组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a-parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b-children</span> <span class="attr">v-bind</span>=<span class="string">&quot;$attrs&quot;</span> <span class="attr">v-on</span>=<span class="string">&quot;$listeners&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">b-children</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a-parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    ...</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 默认情况下父作用域的不被认作 props 的 attribute 绑定 (attribute bindings) 将会“回退”且作为普通的 HTML attribute 应用在子组件的根元素上</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">props</span>:[] <span class="comment">// 注意如果在此处使用了props接收了参数， 则通过 v-bind 传递给子组件的 $attrs 中就会缺失对应参数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$attrs</span>)  <span class="comment">// &#123;a: 4444, b: 55555&#125;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 如果此时props 接收了 参数 a 那么 console 的值为 &#123; b: 55555 &#125;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$listeners</span>) <span class="comment">// &#123; getData: f(), passData: f()&#125;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    ...</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- children 组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;$attrs.a&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;passData($attrs.a)&quot;</span>  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    ...</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$attrs</span>)  <span class="comment">// &#123;a: 4444, b: 55555&#125;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 如果此时 props 接收了 参数 a 那么 console 的值为 &#123; b: 55555 &#125;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// a 的值 也可以通过 $emit 方法传递给祖组件</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">$listeners</span>) <span class="comment">// &#123; getData: f(), passData: f()&#125;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">passData</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 此处发送的事件名称需要与祖组件监听方法一致 即 @passData</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;passData&#x27;</span>, val)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    ...</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="provide-和-inject"><a href="#provide-和-inject" class="headerlink" title="provide 和 inject"></a>provide 和 inject</h5><p>  父组件通过 <code>provide</code> 提供变量，子组件通过 <code>inject</code> 注入变量，不管子组件多深，只要调用了 <code>inject</code> 就可以注入 <code>provide</code> 中的数据，而不是局限于只能从当前父组件的 <code>prop</code> 属性来获取数据，只要在父组件的生命周期内，子组件都可以调用</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- grandfather 组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">grand-father</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a-parent</span>&gt;</span><span class="tag">&lt;/<span class="name">a-parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">grand-father</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  ...</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">provide</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">test</span>: <span class="string">&#x27;test&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  ...</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- parent 组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a-parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">b-children</span>&gt;</span><span class="tag">&lt;/<span class="name">b-children</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a-parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- children 组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;$attrs.a&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;passData($attrs.a)&quot;</span>  /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  ...</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">inject</span>:[<span class="string">&#x27;test&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">  ...</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="boradcast-和-dispatch"><a href="#boradcast-和-dispatch" class="headerlink" title="boradcast 和 dispatch"></a>boradcast 和 dispatch</h5><p>  这种方法我不太了解，贴上代码，大家自己体会 (＾－＾)</p><p>  vue1.0中提供了这种方式，但vue2.0中没有，但很多开源软件都自己封装了这种方式，比如min ui、element ui和iview等。</p><p>  比如如下代码，一般都作为一个mixins去使用, broadcast是向特定的父组件，触发事件，dispatch是向特定的子组件触发事件，本质上这种方式还是on和emit的封装，但在一些基础组件中却很实用。<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">broadcast</span>(<span class="params">componentName, eventName, params</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$children</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">child</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name = child.<span class="property">$options</span>.<span class="property">componentName</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (name === componentName) &#123;</span><br><span class="line">      child.<span class="property">$emit</span>.<span class="title function_">apply</span>(child, [eventName].<span class="title function_">concat</span>(params));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      broadcast.<span class="title function_">apply</span>(child, [componentName, eventName].<span class="title function_">concat</span>(params));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="params">componentName, eventName, params</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> parent = <span class="variable language_">this</span>.<span class="property">$parent</span>;</span><br><span class="line">      <span class="keyword">var</span> name = parent.<span class="property">$options</span>.<span class="property">componentName</span>;</span><br><span class="line">      <span class="keyword">while</span> (parent &amp;&amp; (!name || name !== componentName)) &#123;</span><br><span class="line">        parent = parent.<span class="property">$parent</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (parent) &#123;</span><br><span class="line">          name = parent.<span class="property">$options</span>.<span class="property">componentName</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (parent) &#123;</span><br><span class="line">        parent.<span class="property">$emit</span>.<span class="title function_">apply</span>(parent, [eventName].<span class="title function_">concat</span>(params));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">broadcast</span>(<span class="params">componentName, eventName, params</span>) &#123;</span><br><span class="line">      broadcast.<span class="title function_">call</span>(<span class="variable language_">this</span>, componentName, eventName, params);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;我们都知道 Vue 的两大核心是&lt;strong&gt;组件化&lt;/strong&gt;和&lt;strong&gt;数据驱动&lt;/strong&gt;，在 Vue 中，组件之间的值传递是一种十分常见的事情，那么你到底知道多少种组件的值传递的方法呢，接下来由我来带领大家了解一下&lt;/p&gt;
&lt;h4 id=&quot;Vue</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="component" scheme="https://lxx1997.github.io/tags/component/"/>
    
  </entry>
  
  <entry>
    <title>new Object() 和 Object.create() 的区别</title>
    <link href="https://lxx1997.github.io/2021/01/04/web/deferent-in-new-Object-object-create/"/>
    <id>https://lxx1997.github.io/2021/01/04/web/deferent-in-new-Object-object-create/</id>
    <published>2021-01-04T12:46:00.000Z</published>
    <updated>2021-01-04T12:46:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>  今天我们来谈一谈通过 <code>new Object()</code> 和 <code>Object.create()</code> 创造的对象有什么区别</p><p>  首先这两个方法都可以用来创建一个对象</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line"><span class="keyword">var</span> a = <span class="title class_">Object</span>.<span class="title function_">create</span>()</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Object</span>(obj)</span><br><span class="line"><span class="keyword">var</span> a = <span class="title class_">Object</span>.<span class="title function_">create</span>(obj)</span><br></pre></td></tr></table></figure><p>  但是这两个方法创建的对象是有一些不同</p><ol><li><p><code>new Object()</code> 创建的对象是通过构造函数创建的对象，添加的属性是在自身实例下面<br><code>Object.create()</code> 创建的对象可以理解为继承一个对象，添加的属性是在 <code>__proto__</code> 属性下面</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="attr">a</span>: <span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title class_">Object</span>(a)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b)            <span class="comment">// &#123;a: 1&#125;</span></span><br><span class="line"><span class="keyword">var</span> c = <span class="title class_">Object</span>.<span class="title function_">create</span>(a)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c)            <span class="comment">// &#123;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c.<span class="property">__proto__</span>)  <span class="comment">// &#123;a: 1&#125;</span></span><br></pre></td></tr></table></figure></li><li><p><code>new Object()</code> 创建空对象的时候也是有 <code>__proto__</code> 原型链的<br><code>Object.create()</code> 创建空对象是没有 <code>__proto__</code> 原型链的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title class_">Object</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b)            <span class="comment">// &#123;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b.<span class="property">__proto__</span>)  <span class="comment">// &#123;a: 1&#125;</span></span><br><span class="line"><span class="keyword">var</span> c = <span class="title class_">Object</span>.<span class="title function_">create</span>(a)  <span class="comment">// 此时有数据，不多描述</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c)            <span class="comment">// &#123;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c.<span class="property">__proto__</span>)  <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></li><li><p>使用 <code>Object.create(&#123;&#125;, &#123;p: &#123;value: 42&#125;&#125;)</code> 创建的对象访问时，p的值不可修改，不可枚举</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c = <span class="title class_">Object</span>.<span class="title function_">create</span>(&#123;&#125;, &#123;<span class="attr">p</span>: &#123;<span class="attr">value</span>: <span class="number">42</span>&#125;&#125;)  <span class="comment">// 此时有数据，不多描述</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c)            <span class="comment">// &#123;p: 42&#125;</span></span><br><span class="line">c = <span class="title class_">Object</span>.<span class="title function_">create</span>(&#123;&#125;, &#123;<span class="attr">p</span>: <span class="number">42</span>&#125;)      <span class="comment">// 此时会报错 VM587:1 Uncaught TypeError: Property description must be an object: 42  要求我们 p 的值 42，要放在一个对象中</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(c)            <span class="comment">// []</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;  今天我们来谈一谈通过 &lt;code&gt;new Object()&lt;/code&gt; 和 &lt;code&gt;Object.create()&lt;/code&gt; 创造的对象有什么区别&lt;/p&gt;
&lt;p&gt;  首先这两个方法都可以用来创建一个对象&lt;/p&gt;
  &lt;figure class=&quot;highlig</summary>
      
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/categories/JavaScript/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Vue keep-alive 组件状态缓存</title>
    <link href="https://lxx1997.github.io/2021/01/04/vue/vue-keep-alive/"/>
    <id>https://lxx1997.github.io/2021/01/04/vue/vue-keep-alive/</id>
    <published>2021-01-04T09:35:02.000Z</published>
    <updated>2021-01-04T09:35:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>  这段时间做项目时，老板要求要缓存一些页面的表单数据，于是想到了 vue 的 keep-alive ，在使用时，自己也犯了一些错误，在此记录一下</p><h4 id="首次使用"><a href="#首次使用" class="headerlink" title="首次使用"></a>首次使用</h4><p>  在阅读文档的时候，没有理解文档的内容，keep-alive 组件，vue官方文档给的解释是 <em>匹配首先检查组件自身的name选项，如果name选项不可用，则匹配他的局部注册名称</em>，但是不知怎的被我理解成为了 <em>路由配置的name属性</em>，结果闹了一个大乌龙</p><p>  然后，自己怎么测试都发现不能缓存页面状态，最后使用<strong>面向百度编程</strong>找到了自己的错误</p><h4 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h4><p>  为了方便我们不用新增一个组件，就把组件的name添加到 keep-alive 组件中，在这里我采用了一个取巧的方法</p><p>  <strong>保证组件的 name 属性与对应路由的 name 属性保持一致</strong></p><ol><li><p>提取我们所需要的路由对象</p><p>这个方法根据我们传入的路由名称 动态提取出我们需要的路由对象，而不是获取所有的路由对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleGetRoutes</span>(<span class="params">routeName</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> routeObj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">  asyncRoutes.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">name</span> === routeName) &#123;</span><br><span class="line">      routeObj = item</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> routeObj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过递归的方法获取到所有的 name 属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = <span class="title function_">handleGetRoutes</span>(<span class="string">&#x27;Classify&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> includes = []</span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">handleGetRouteName</span>(routes, includes)</span><br><span class="line"></span><br><span class="line"><span class="title function_">handleGetRouteName</span>(<span class="params">obj, arr</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      obj.<span class="property">children</span> &amp;&amp;</span><br><span class="line">      obj.<span class="property">children</span> <span class="keyword">instanceof</span> <span class="title class_">Array</span> &amp;&amp;</span><br><span class="line">      obj.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">const</span> length = obj.<span class="property">children</span>.<span class="property">length</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">handleGetRouteName</span>(obj.<span class="property">children</span>[i], arr)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    arr.<span class="title function_">push</span>(obj.<span class="property">name</span>)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>最后在 keep-alive 组件中使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">&quot;includes&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="其他用法"><a href="#其他用法" class="headerlink" title="其他用法"></a>其他用法</h4><ol><li><p>生命周期函数  <code>activated,deactivated</code></p></li><li><p>include<br> include 表示只有匹配到的组件才会被缓存</p></li><li><p>exclude<br> exclude 表示只有匹配到的组件才不会被缓存<br><code>include</code>和<code>exclude</code>允许组件有条件的缓存，有三种表示方式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 字符串 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">&quot;a,b&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- 正则表达式 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">&quot;/a|b/&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- 数组 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">&quot;[&#x27;a&#x27;,&#x27;b&#x27;]&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>max </p><p>max 表示 最大缓存组件个数，缓存组件达到最大个数后，添加新的缓存组件，最久未被访问的实例会被销毁掉</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;  这段时间做项目时，老板要求要缓存一些页面的表单数据，于是想到了 vue 的 keep-alive ，在使用时，自己也犯了一些错误，在此记录一下&lt;/p&gt;
&lt;h4 id=&quot;首次使用&quot;&gt;&lt;a href=&quot;#首次使用&quot; class=&quot;headerlink&quot; title=&quot;首次使</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>发布订阅模式及观察者</title>
    <link href="https://lxx1997.github.io/2021/01/04/reading/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%E5%8F%8A%E8%A7%82%E5%AF%9F%E8%80%85/"/>
    <id>https://lxx1997.github.io/2021/01/04/reading/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%E5%8F%8A%E8%A7%82%E5%AF%9F%E8%80%85/</id>
    <published>2021-01-04T06:30:30.000Z</published>
    <updated>2021-01-04T06:30:30.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><p>  观察者模式的目的就是为了实现<strong>松耦合</strong>，面对接口编程</p><p>  在观察者模式里面，有一个实例对象–<strong>被观察者(Subject)</strong>，他维护一套<strong>观察者(observer)</strong>的结合，这些 Observer 实现相同的接口，subject 只需要知道，通知 Observer 需要调用哪个统一的方法</p><h2 id="发布订阅模式"><a href="#发布订阅模式" class="headerlink" title="发布订阅模式"></a>发布订阅模式</h2><p>  在发布订阅模式里，发布者并不会直接通知订阅者，发布者和订阅者彼此不相识，通过第三方来进行函数调用</p>  <!-- TODO: 学习 使用flow 画流程图 --><p>  发布者 只需要告诉 第三方 我要 发送 的信息是 XXX</p><p>  订阅者 只需要告诉 第三方 我要 订阅 的消息是 XXX</p><p>  当 第三方 接收到 发布者 发送的消息且是 XXX 时，就会报消息推送给订阅了 XXX 的 订阅者，当然也有可能是 订阅者 自己过来拿取</p><p>  <strong>在发布订阅模式中，发布者和订阅者不是松耦合，而是完全解耦的</strong></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol><li><p>从表面上看</p><p><strong>观察者模式</strong>只有两个角色 <strong>观察者</strong>和<strong>被观察者</strong><br><strong>发布订阅模式</strong>中有三个角色 <strong>发布者</strong>、<strong>订阅者</strong>和<strong>第三方</strong></p></li><li><p>深层次</p><p><strong>观察者模式</strong> 是松耦合关系<br><strong>发布订阅模式</strong> 是完全不存在耦合</p></li><li><p>使用层次</p><p><strong>观察者模式</strong> 多用于单个应用内部<br><strong>发布订阅模式</strong> 更多的是一种跨应用的模式</p></li></ol><p><strong>参考文章</strong><br><a href="https://hackernoon.com/observer-vs-pub-sub-pattern-50d3b27f838c">Observer vs Pub-Sub pattern</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;观察者模式&quot;&gt;&lt;a href=&quot;#观察者模式&quot; class=&quot;headerlink&quot; title=&quot;观察者模式&quot;&gt;&lt;/a&gt;观察者模式&lt;/h2&gt;&lt;p&gt;  观察者模式的目的就是为了实现&lt;strong&gt;松耦合&lt;/strong&gt;，面对接口编程&lt;/p&gt;
&lt;p&gt;  在观察者模</summary>
      
    
    
    
    <category term="design-pattern" scheme="https://lxx1997.github.io/categories/design-pattern/"/>
    
    
    <category term="design-pattern" scheme="https://lxx1997.github.io/tags/design-pattern/"/>
    
    <category term="function" scheme="https://lxx1997.github.io/tags/function/"/>
    
  </entry>
  
  <entry>
    <title>Vue源码阅读 part 01</title>
    <link href="https://lxx1997.github.io/2021/01/02/vue/vue-code-part-01/"/>
    <id>https://lxx1997.github.io/2021/01/02/vue/vue-code-part-01/</id>
    <published>2021-01-02T15:37:19.000Z</published>
    <updated>2021-01-02T15:37:19.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Vue源码目录结构"><a href="#Vue源码目录结构" class="headerlink" title="Vue源码目录结构"></a>Vue源码目录结构</h3><blockquote><p><code>compiler</code>          <strong>编译</strong></p><ul><li>Vue 使用<strong>字符串</strong>作为模板</li><li>在编译文件夹中存放对 模板字符串 解析的算法，抽象语法树，优化<br><code>core</code>              <strong>核心</strong></li><li>Vue 构造函数，以及生命周期等方法<br><code>platforms</code>         <strong>平台</strong></li><li>针对运行的环境(browser/andriod/ios) 的不同实现</li><li>也是 vue 的入口<br><code>server</code>            <strong>服务端</strong></li><li>将 vue 用在服务器端的代码<br><code>sfc</code>               <strong>单文件组件</strong><br><code>shared</code>            <strong>共用工具、方法</strong></li></ul></blockquote><h4 id="vue-具体文件"><a href="#vue-具体文件" class="headerlink" title="vue 具体文件"></a>vue 具体文件</h4><ul><li><p>shared/constant   <strong>常量</strong></p><ul><li>ASSET_TYPES  每一个 vue 组件需要挂载的成员</li><li>LIFECYCLE_HOOKS   生命周期函数 <code>hook</code></li></ul></li><li><p>shared/utils  <strong>工具方法</strong></p><ul><li><p>isPrimitive   <strong>判断是否为基本数据类型</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isPrimitive</span> (<span class="attr">value</span>: <span class="built_in">any</span>): <span class="built_in">boolean</span> %checks &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span> ||</span><br><span class="line">    <span class="keyword">typeof</span> value === <span class="string">&#x27;number&#x27;</span> ||</span><br><span class="line">    <span class="comment">// $flow-disable-line</span></span><br><span class="line">    <span class="keyword">typeof</span> value === <span class="string">&#x27;symbol&#x27;</span> ||</span><br><span class="line">    <span class="keyword">typeof</span> value === <span class="string">&#x27;boolean&#x27;</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>toRawType   <strong>获取传入参数的数据类型</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toRawType</span> (<span class="attr">value</span>: <span class="built_in">any</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> _toString.<span class="title function_">call</span>(value).<span class="title function_">slice</span>(<span class="number">8</span>, -<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>isPromise    <strong>判断是否是 Promise 函数</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isPromise</span> (<span class="attr">val</span>: any): boolean &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="title function_">isDef</span>(val) &amp;&amp;</span><br><span class="line">    <span class="keyword">typeof</span> val.<span class="property">then</span> === <span class="string">&#x27;function&#x27;</span> &amp;&amp;</span><br><span class="line">    <span class="keyword">typeof</span> val.<span class="property">catch</span> === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>toString    <strong>重写字符串转化</strong></p></li></ul><p>针对特殊的数据类型 object，array 进行处理</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">toString</span> (<span class="attr">val</span>: any): string &#123;</span><br><span class="line">  <span class="keyword">return</span> val == <span class="literal">null</span></span><br><span class="line">    ? <span class="string">&#x27;&#x27;</span></span><br><span class="line">    : <span class="title class_">Array</span>.<span class="title function_">isArray</span>(val) || (<span class="title function_">isPlainObject</span>(val) &amp;&amp; val.<span class="property">toString</span> === _toString)</span><br><span class="line">      ? <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(val, <span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line">      : <span class="title class_">String</span>(val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>makeMap     <strong>针对需要缓存的数据map映射，提高速度</strong></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">makeMap</span> (</span><br><span class="line">  <span class="attr">str</span>: string,</span><br><span class="line">  expectsLowerCase?: boolean</span><br><span class="line">): <span class="function">(<span class="params">key: string</span>) =&gt;</span> <span class="literal">true</span> | <span class="keyword">void</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> map = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">list</span>: <span class="title class_">Array</span>&lt;string&gt; = str.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    map[list[i]] = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> expectsLowerCase</span><br><span class="line">    ? <span class="function"><span class="params">val</span> =&gt;</span> map[val.<span class="title function_">toLowerCase</span>()]</span><br><span class="line">    : <span class="function"><span class="params">val</span> =&gt;</span> map[val]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>cached      <strong>使用闭包检查是否缓存</strong></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> cached&lt;<span class="attr">F</span>: <span class="title class_">Function</span>&gt; (<span class="attr">fn</span>: F): F &#123;</span><br><span class="line">  <span class="keyword">const</span> cache = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">function</span> <span class="title function_">cachedFn</span> (<span class="attr">str</span>: string) &#123;</span><br><span class="line">    <span class="keyword">const</span> hit = cache[str]</span><br><span class="line">    <span class="keyword">return</span> hit || (cache[str] = <span class="title function_">fn</span>(str))  <span class="comment">// 第一次调用的时候 hit 是没有值的，但是后面调用的时候，因为闭包原理，cache里面就存储了值</span></span><br><span class="line">  &#125;: any)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>camelize    <strong>将-字符连接的变量转化为驼峰模式</strong></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> camelizeRE = <span class="regexp">/-(\w)/g</span></span><br><span class="line"><span class="keyword">const</span> camelize = <span class="title function_">cached</span>((<span class="attr">str</span>: string): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> str.<span class="title function_">replace</span>(camelizeRE, <span class="function">(<span class="params">_, c</span>) =&gt;</span> c ? c.<span class="title function_">toUpperCase</span>() : <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>hyphenate   <strong>将驼峰模式转化为-字符连接的变量</strong></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hyphenateRE = <span class="regexp">/\B([A-Z])/g</span></span><br><span class="line"><span class="keyword">const</span> hyphenate = <span class="title function_">cached</span>((<span class="attr">str</span>: string): <span class="function"><span class="params">string</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> str.<span class="title function_">replace</span>(hyphenateRE, <span class="string">&#x27;-$1&#x27;</span>).<span class="title function_">toLowerCase</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>looseEqual    <strong>判断两个对象是否相等</strong></li></ul><p>js中判断对象是否相等比较的是引用类型<br>因此对比两个对象对象相等有以下步骤</p><ol><li>首先判断传入参数 a, b 的引用类型是否一致，如果一致则返回true</li><li>然后判断传入的 a,b 的类型是否是 Object 类型</li><li>遍历 a 对象的成员，如果 a 中每个成员都在 b 中并且对应成员相等</li><li>遍历 b 对象的成员，如果 b 中每个成员都在 a 中并且对应成员相等</li><li>如果成员是引用类型，使用递归<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">looseEqual</span> (<span class="attr">a</span>: any, <span class="attr">b</span>: any): boolean &#123;</span><br><span class="line">  <span class="keyword">if</span> (a === b) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  <span class="keyword">const</span> isObjectA = <span class="title function_">isObject</span>(a)</span><br><span class="line">  <span class="keyword">const</span> isObjectB = <span class="title function_">isObject</span>(b)</span><br><span class="line">  <span class="keyword">if</span> (isObjectA &amp;&amp; isObjectB) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> isArrayA = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(a)</span><br><span class="line">      <span class="keyword">const</span> isArrayB = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(b)</span><br><span class="line">      <span class="keyword">if</span> (isArrayA &amp;&amp; isArrayB) &#123;</span><br><span class="line">        <span class="comment">// 这一步判断 a 和 b 两个对象的长度是否相等</span></span><br><span class="line">        <span class="keyword">return</span> a.<span class="property">length</span> === b.<span class="property">length</span> &amp;&amp; a.<span class="title function_">every</span>(<span class="function">(<span class="params">e, i</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">looseEqual</span>(e, b[i])</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (a <span class="keyword">instanceof</span> <span class="title class_">Date</span> &amp;&amp; b <span class="keyword">instanceof</span> <span class="title class_">Date</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> a.<span class="title function_">getTime</span>() === b.<span class="title function_">getTime</span>()</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isArrayA &amp;&amp; !isArrayB) &#123;</span><br><span class="line">        <span class="keyword">const</span> keysA = <span class="title class_">Object</span>.<span class="title function_">keys</span>(a)</span><br><span class="line">        <span class="keyword">const</span> keysB = <span class="title class_">Object</span>.<span class="title function_">keys</span>(b)</span><br><span class="line">        <span class="comment">// 这一步判断 a 和 b 两个对象的长度是否相等</span></span><br><span class="line">        <span class="keyword">return</span> keysA.<span class="property">length</span> === keysB.<span class="property">length</span> &amp;&amp; keysA.<span class="title function_">every</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">looseEqual</span>(a[key], b[key])</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* istanbul ignore next */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="comment">/* istanbul ignore next */</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isObjectA &amp;&amp; !isObjectB) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">String</span>(a) === <span class="title class_">String</span>(b)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li>once      <strong>利用闭包， 使函数只调用一次</strong></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">once</span> (<span class="attr">fn</span>: <span class="title class_">Function</span>): <span class="title class_">Function</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> called = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!called) &#123;</span><br><span class="line">      called = <span class="literal">true</span></span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Vue-知识点"><a href="#Vue-知识点" class="headerlink" title="Vue 知识点"></a>Vue 知识点</h3><ul><li><p>性能优化</p><ol><li><p>vue 运行在浏览器中，所以需要考虑性能<br>每次数据的更新都是更新虚拟 DOM (模板解析) 因此将经常使用的字符串和算法进行缓存<br>垃圾回收机制原则中有一个统计现象 “使用的越多的数据，一般都会频繁的使用”</p><ul><li>每次创建一个数据，就会考虑是否将其回收</li><li>数据达到一定限额的时候就会考虑到垃圾回收(不是实时更新)</li><li>每次 都判断对象是否需要回收，需要就遍历</li><li>对对象进行划分，统计，往往一个数据使用完以后就不在使用了</li><li>如果一个对象在一次回收中还保留下来，统计的结果结果就是这个对象会比较持久的在内存中驻留</li></ul><p>vue 模板中 的 指令， 每次数据发生变化都有可能带来 指令 的解析，所以解析就是字符串处理，一般会消耗一定的性能</p></li></ol></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;Vue源码目录结构&quot;&gt;&lt;a href=&quot;#Vue源码目录结构&quot; class=&quot;headerlink&quot; title=&quot;Vue源码目录结构&quot;&gt;&lt;/a&gt;Vue源码目录结构&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;compiler&lt;/code&gt;        </summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>03 - Vue源码解读-发布订阅模式</title>
    <link href="https://lxx1997.github.io/2020/12/21/vue/vue-template-publish-subscribe/"/>
    <id>https://lxx1997.github.io/2020/12/21/vue/vue-template-publish-subscribe/</id>
    <published>2020-12-21T06:06:22.000Z</published>
    <updated>2020-12-21T06:06:22.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="发布订阅模式"><a href="#发布订阅模式" class="headerlink" title="发布订阅模式"></a>发布订阅模式</h4><h6 id="代理方法"><a href="#代理方法" class="headerlink" title="代理方法"></a>代理方法</h6><p>  将 app._data 中的成员给映射到 vue 实例上面，由于app.data 已经是响应式的对象了，所以只需要让app访问的成员去访问 app._data 的对应成员</p><p>  引入一个函数 proxy(target, src, prop),target 的操作映射到 src.prop 上面 <em>(当时没有 es6 的 Proxy 语法)</em></p><p>  使用一个新的方法来处理 <code>Observer</code> 方法对属性进行处理，将这个方法封装到 initData 方法中</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JGVue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">initData</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">_data</span>)</span><br><span class="line">  <span class="comment">// 响应式化  setReactive</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; keys.<span class="property">length</span>; k++) &#123;</span><br><span class="line">    <span class="title function_">setReactive</span>(<span class="variable language_">this</span>.<span class="property">_data</span>, vm)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 代理</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; keys.<span class="property">length</span>; k++) &#123;</span><br><span class="line">    <span class="comment">// 将 this._data[keys[k]] 映射到 this[keys[i]]</span></span><br><span class="line">    <span class="comment">// 访问这个属性的时候相当于访问 this._data 的这个属性</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="variable language_">this</span>, keys[k], &#123;</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_data</span>[keys[k]]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_data</span>[key[i]] = newValue</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  或者以下方法</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">JGVue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">initData</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">_data</span>)</span><br><span class="line">  <span class="comment">// 响应式化  setReactive</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; keys.<span class="property">length</span>; k++) &#123;</span><br><span class="line">    <span class="title function_">setReactive</span>(<span class="variable language_">this</span>.<span class="property">_data</span>, vm)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 代理</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">0</span>; k &lt; keys.<span class="property">length</span>; k++) &#123;</span><br><span class="line">    <span class="comment">// 将 this._data[keys[k]] 映射到 this[keys[i]]</span></span><br><span class="line">    <span class="comment">// 访问这个属性的时候相当于访问 this._data 的这个属性</span></span><br><span class="line">    <span class="title function_">proxy</span>(<span class="variable language_">this</span>, <span class="string">&#x27;_data&#x27;</span>, keys[k])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">proxy</span>(<span class="params">target, prop, key</span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, key, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> target[prop][key]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">      target [prop][key[i]] = newValue</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;发布订阅模式&quot;&gt;&lt;a href=&quot;#发布订阅模式&quot; class=&quot;headerlink&quot; title=&quot;发布订阅模式&quot;&gt;&lt;/a&gt;发布订阅模式&lt;/h4&gt;&lt;h6 id=&quot;代理方法&quot;&gt;&lt;a href=&quot;#代理方法&quot; class=&quot;headerlink&quot; title=&quot;代</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>03 - Vue源码解读-响应式</title>
    <link href="https://lxx1997.github.io/2020/12/18/vue/vue-template-responsive/"/>
    <id>https://lxx1997.github.io/2020/12/18/vue/vue-template-responsive/</id>
    <published>2020-12-18T09:40:59.000Z</published>
    <updated>2020-12-18T09:40:59.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="响应式原理"><a href="#响应式原理" class="headerlink" title="响应式原理"></a>响应式原理</h4><ul><li>我们在使用 Vue 的时候，复制属性获得属性都是直接使用Vue实例</li><li><p>我们在设计属性值的时候，页面数据更新</p><h5 id="Object-defineProperty-obj-key"><a href="#Object-defineProperty-obj-key" class="headerlink" title="Object.defineProperty(obj, key, {})"></a><code>Object.defineProperty(obj, key, &#123;&#125;)</code></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意 value 和 writable 不可以和 get set 连用</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">  <span class="attr">enumerable</span>: !!enumerable,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">  set (newValue)&#123;</span><br><span class="line">    value = newValue</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">get</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>使用 <code>Object.defineProperty()</code> 实现数据监控</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;优·库里伍德·海尔赛兹&#x27;</span>,</span><br><span class="line">  <span class="attr">behavior</span>: <span class="string">&#x27;吃橘子&#x27;</span>,</span><br><span class="line">  <span class="attr">like</span>: [</span><br><span class="line">    &#123;<span class="attr">juice</span>: <span class="string">&#x27;juice&#x27;</span>&#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">other</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;相川步&#x27;</span>,</span><br><span class="line">    <span class="attr">behavior</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;约的人&#x27;</span>,</span><br><span class="line">      <span class="attr">time</span>: <span class="string">&#x27;12m&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setPerperties</span>(<span class="params">obj, key, value, enumerable</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(obj, key, value, !!enumerable)</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: !!enumerable,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    set (newValue)&#123;</span><br><span class="line">      value = newValue</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setReactive</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(o).<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o[key]) === <span class="string">&#x27;[object Object]&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">setReactive</span>(o[key]) </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o[key]) === <span class="string">&#x27;[object Array]&#x27;</span>) &#123;</span><br><span class="line">      o[key].<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(item) === <span class="string">&#x27;[object Object]&#x27;</span> || <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(item) === <span class="string">&#x27;[object Array]&#x27;</span>) <span class="title function_">setReactive</span>(item)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">setPerperties</span>(o, key, o[key], <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setReactive</span>(data)</span><br></pre></td></tr></table></figure><p>针对数组中的特殊方法进行响应式化处理</p></li></ul><ul><li>push      向数组的最后添加元素，并返回新的数组长度</li><li>unshift   向数组的开始添加元素，并返回新的数组长度</li><li>pop       删除数组的最后一个元素，并返回被删除的元素</li><li>shift     删除数组的第一个元素，并返回被删除的元素</li><li>reverse   翻转数组，并返回翻转之后的数组</li><li>sort      数组排序</li><li><p>splice    向/从数组中添加/删除项目，然后返回被删除的项目，rrayObject.splice(index,howmany,item1,…..,itemX) (删除的位置, 删除的个数， 插入的新元素)</p></li><li><p>vue2 中数组发生变化，设置 length 没法通知（Vue3 中使用Proxy语法解决了这个问题）</p></li><li>加进来的元素也应该是响应式的</li><li><p>技巧：如果一个函数已经定义了，但是我们需要扩展其功能，我们一般的处理方法</p><ol><li>使用一个临时的函数名存储函数</li><li>重新定义原来的函数</li><li>定义扩展的功能</li><li>调用临时的那个函数<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">func</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;old property&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第一步</span></span><br><span class="line"><span class="keyword">let</span> _tempFn = func</span><br><span class="line"><span class="comment">// 第二步</span></span><br><span class="line">func = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 第四步</span></span><br><span class="line">  <span class="title function_">_tempFn</span>()</span><br><span class="line">  <span class="comment">// 第三步</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;new property&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">func</span>()</span><br></pre></td></tr></table></figure></li></ol></li><li><p>如何修改数组的扩展函数</p></li><li>不能直接修改数组的 prototype</li><li>修改要进行响应式化的数组的原型(<strong>proto</strong>)</li><li>原型式继承：修改原型链结构</li><li>继承关系： arr -&gt; Array.prototype -&gt; Object.prototype -&gt; …</li><li>修改之后： arr -&gt; 改写的方法 -&gt; Array.prototype -&gt; Object.prototype -&gt; …<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = []</span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">ARRAY_METHOD</span> = [<span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;unshift&#x27;</span>, <span class="string">&#x27;push&#x27;</span>, <span class="string">&#x27;shift&#x27;</span>, <span class="string">&#x27;reverse&#x27;</span>, <span class="string">&#x27;sort&#x27;</span>, <span class="string">&#x27;splice&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arrayMethods = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>)</span><br><span class="line"><span class="variable constant_">ARRAY_METHOD</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  arrayMethods[item] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">arguments</span>).<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setReactive</span>(item)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 在这里对数据进行响应式化</span></span><br><span class="line">    <span class="keyword">let</span> res = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>[item].<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">arr.<span class="property">__proto__</span> = arrayMethods</span><br></pre></td></tr></table></figure></li><li>vue做了兼容，如果浏览器兼容<strong>proto</strong>，就使用 原型式继承</li><li><p>不兼容就使用 混入法 将方法一个个的加入到 arr 中</p><p>将方法整合到设置响应式方法中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setReactive</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(o).<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o[key]) === <span class="string">&#x27;[object Object]&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">setReactive</span>(o[key]) </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o[key]) === <span class="string">&#x27;[object Array]&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(o[key])</span><br><span class="line">      o[key].<span class="property">__proto__</span> = arrayMethods <span class="comment">// 拦截数组，进行数组响应式</span></span><br><span class="line">      o[key].<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(item) === <span class="string">&#x27;[object Object]&#x27;</span> || <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(item) === <span class="string">&#x27;[object Array]&#x27;</span>) <span class="title function_">setReactive</span>(item)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">setPerperties</span>(o, key, o[key], <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对 对象 或者 数组 重新赋值 如何设置响应式</p><p>setPerperties() 函数的set方法中 重新调用一次 setReactive()</p></li></ul><h4 id="变更页面"><a href="#变更页面" class="headerlink" title="变更页面"></a>变更页面</h4><p>  在 JGVue 函数中调用 setReactive 方法 把 this._data 设置成响应式类型，同时传递 vue 实例到 Object.defineProperty<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">JGVue</span>(<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_data</span> = options.<span class="property">data</span></span><br><span class="line">  <span class="title function_">setReactive</span>(<span class="variable language_">this</span>.<span class="property">_data</span>, <span class="variable language_">this</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_template</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(options.<span class="property">el</span>) <span class="comment">// vue 中这里是DOM</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">mount</span>() <span class="comment">// 挂载</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>  修改 setReactive 方法<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setReactive</span>(<span class="params">o, vm</span>) &#123;</span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">keys</span>(o).<span class="title function_">map</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o[key]) === <span class="string">&#x27;[object Object]&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">setReactive</span>(o[key], vm) </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(o[key]) === <span class="string">&#x27;[object Array]&#x27;</span>) &#123;</span><br><span class="line">      o[key].<span class="property">__proto__</span> = arrayMethods <span class="comment">// 拦截数组，进行数组响应式</span></span><br><span class="line">      o[key].<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(item) === <span class="string">&#x27;[object Object]&#x27;</span> || <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(item) === <span class="string">&#x27;[object Array]&#x27;</span>) <span class="title function_">setReactive</span>(item, vm)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      setPerperties.<span class="title function_">call</span>(vm, o, key, o[key], <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>  修改 setPerperties 函数</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setPerperties</span>(<span class="params">obj, key, value, enumerable</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> _that = <span class="variable language_">this</span></span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">    <span class="attr">enumerable</span>: !!enumerable,</span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    set (newValue)&#123;</span><br><span class="line">      value = newValue</span><br><span class="line">      _that.<span class="title function_">mountComponent</span>()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;响应式原理&quot;&gt;&lt;a href=&quot;#响应式原理&quot; class=&quot;headerlink&quot; title=&quot;响应式原理&quot;&gt;&lt;/a&gt;响应式原理&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;我们在使用 Vue 的时候，复制属性获得属性都是直接使用Vue实例&lt;/li&gt;
&lt;li&gt;&lt;p&gt;我们在设计属</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>02 - Vue源码解读-渲染模型</title>
    <link href="https://lxx1997.github.io/2020/12/17/vue/vue-template-render/"/>
    <id>https://lxx1997.github.io/2020/12/17/vue/vue-template-render/</id>
    <published>2020-12-17T07:01:25.000Z</published>
    <updated>2020-12-17T07:01:25.000Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>判断元素</p><p>vue 本质上是使用 HTML 字符串作为模板，将字符串模板转化为 AST(抽象语法树) ,再转换成 VNode</p><ul><li>模板 -&gt; AST</li><li>AST -&gt; VNode</li><li>VNode -&gt; DOM</li></ul><p>最消耗性能的是字符串解析(模板 -&gt; AST)</p><blockquote><p>小例子： let s = “1 + 2 <em> (3 + 4 </em> (5 + 6))” 得到结果<br>建议：将字符串表达式转化为波兰式表达式，使用栈结构来运算</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></blockquote><p>vue源码如何区分HTML标签和自定义组件?</p><p> <strong>vue源码把所有可用的HTML标签都存起来</strong></p><p>使用柯里化操作将需要遍历的 HTML 标签存储起来</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">makeMap</span>(<span class="params">keys</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> obj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">  keys.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    obj[item] = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !!obj[key]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> htmlkey = [<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;div&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;ul&#x27;</span>,<span class="string">&#x27;li&#x27;</span>,<span class="string">&#x27;ol&#x27;</span>,<span class="string">&#x27;dl&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> htmlMap = <span class="title function_">makeMap</span>(htmlkey)</span><br><span class="line"><span class="title function_">htmlMap</span>(<span class="string">&#x27;div&#x27;</span>) <span class="comment">// true</span></span><br><span class="line"><span class="title function_">htmlMap</span>(<span class="string">&#x27;img&#x27;</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="/2020/12/17/fucntion-currying/">函数柯里化</a></p></blockquote></li><li><p>虚拟 DOM 的 render 方法</p><p>vue项目 模板转化为抽象语法树</p><ul><li>页面一开始加载需要渲染</li><li>每一个属性(响应式)数据在发生变化时要渲染</li><li>watch，computed<br>每次需要渲染的时候，模板就会被解析一次</li></ul><p>render 的作用是将虚拟DOM 转化为真正的DOM</p><ul><li>虚拟DOM 可以降级理解为AST</li><li>一个项目运行的时候，模板是不会变得，就表示AST是不会变得</li><li>将虚拟DOM 缓存起来，生成一个函数，只需要传入参数，就可以的到真正的DOM<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      &#123;&#123;name&#125;&#125; &#123;&#123;behavior&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      &#123;&#123;other.name&#125;&#125; &#123;&#123;other.behavior.name&#125;&#125; &#123;&#123;other.behavior.time&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>人员：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>行为：&#123;&#123;behavior&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">JGVue</span>(<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_data</span> = options.<span class="property">data</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_template</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(options.<span class="property">el</span>) <span class="comment">// vue 中这里是DOM</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">mount</span>() <span class="comment">// 挂载</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">JGVue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mount</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 需要提供一个render方法生成虚拟dom</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">render</span> = <span class="variable language_">this</span>.<span class="title function_">createRenderFn</span>()</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">mountComponent</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">JGVue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">mountComponent</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 执行mountComponent</span></span><br><span class="line">  <span class="keyword">let</span> <span class="title function_">mount</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 调用update方法渲染dom</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">update</span>(<span class="variable language_">this</span>.<span class="title function_">render</span>())</span><br><span class="line">  &#125;</span><br><span class="line">  mount.<span class="title function_">call</span>(<span class="variable language_">this</span>) <span class="comment">// 本质上应该交给watcher来调用，此操作并不会改变this的指向</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 在真正的 vue 中使用了 二次提交的设计结构</span></span><br><span class="line"><span class="comment">  * 1 在页面中 DOM 和虚拟 DOM 是一一对应的关系</span></span><br><span class="line"><span class="comment">  *   数据发生变化的时候，就会通过 diff 方法 对比需要更新的虚拟  DOM 节点，更新  DOM </span></span><br><span class="line"><span class="comment">  *   凡是解析就会涉及到 AST</span></span><br><span class="line"><span class="comment">  * 2 现有AST和数据生成VNode</span></span><br><span class="line"><span class="comment">  * 3 将新的VNode 和旧的 VNode 比较(diff)更新(update)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 生成render 函数，缓存抽象语法树（使用虚拟DOM来模拟）</span></span><br><span class="line"><span class="title class_">JGVue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">createRenderFn</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 获取抽象语法树</span></span><br><span class="line">  <span class="keyword">let</span> ast = <span class="title function_">getVnode</span>(<span class="variable language_">this</span>.<span class="property">_template</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(ast)</span><br><span class="line">  <span class="comment">// Vue: 将AST + data =&gt; VNode</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 将带坑的VNode (ast) 转化为真正的带数据的VNode</span></span><br><span class="line">    <span class="keyword">let</span> _temp = <span class="title function_">combine</span>(ast, <span class="variable language_">this</span>.<span class="property">_data</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(_temp)</span><br><span class="line">    <span class="keyword">return</span> _temp</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将虚拟DOM渲染到页面中 diff算法就在这里</span></span><br><span class="line"><span class="title class_">JGVue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">update</span> = <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> dom = <span class="title function_">parseVnode</span>(data)</span><br><span class="line">  <span class="keyword">let</span> app = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>)</span><br><span class="line">  <span class="keyword">let</span> parent = app.<span class="property">parentNode</span></span><br><span class="line">  parent.<span class="title function_">replaceChild</span>(dom, app)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// node 为页面中真实的 DOM 节点</span></span><br><span class="line"><span class="comment">// 使用递归的方法提取出 DOM 节点中所有的子孙节点</span></span><br><span class="line"><span class="comment">// Vue源码中使用 栈 的方式</span></span><br><span class="line"><span class="comment">// 由HTML DOM -&gt; VNode， 将这个函数当做compiler函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getVnode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> nodeType = node.<span class="property">nodeType</span></span><br><span class="line">  <span class="keyword">let</span> _vnode = <span class="literal">null</span></span><br><span class="line">  <span class="comment">// 判断nodeType类型</span></span><br><span class="line">  <span class="keyword">if</span>(nodeType === <span class="number">1</span>) &#123; <span class="comment">// 元素节点</span></span><br><span class="line">    <span class="keyword">let</span> nodeName = node.<span class="property">nodeName</span></span><br><span class="line">    <span class="comment">// 获取 node 元素的 所有 attribute 属性， 是一个伪数组，需要转换成 对象</span></span><br><span class="line">    <span class="keyword">let</span> attrs = node.<span class="property">attributes</span></span><br><span class="line">    <span class="keyword">let</span> _attrs = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; attrs.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      _attrs[attrs[i].<span class="property">nodeName</span>] = attrs[i].<span class="property">nodeValue</span></span><br><span class="line">    &#125;</span><br><span class="line">    _vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(nodeName, _attrs, <span class="literal">undefined</span>, nodeType)</span><br><span class="line">    <span class="comment">// 然后处理元素节点的所有自节点</span></span><br><span class="line">    <span class="keyword">let</span> childNodes = node.<span class="property">childNodes</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; childNodes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      _vnode.<span class="title function_">appendCild</span>(<span class="title function_">getVnode</span>(childNodes[i]))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(nodeType === <span class="number">3</span>) &#123; <span class="comment">// 文本节点</span></span><br><span class="line">    <span class="comment">// 文本节点没有 tag 属性 data属性</span></span><br><span class="line">    _vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(<span class="literal">undefined</span>, <span class="literal">undefined</span>, node.<span class="property">nodeValue</span>, nodeType)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _vnode</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将带有‘&#123;&#123;&#125;&#125;’的虚拟DOM和传入的data数据结合起来，生成带有数据的DOM树</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">combine</span>(<span class="params">node, data</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> _type = node.<span class="property">type</span></span><br><span class="line">  <span class="keyword">let</span> _data = node.<span class="property">data</span></span><br><span class="line">  <span class="keyword">let</span> _value = node.<span class="property">value</span></span><br><span class="line">  <span class="keyword">let</span> _tag = node.<span class="property">tag</span></span><br><span class="line">  <span class="keyword">let</span> _children = node.<span class="property">children</span></span><br><span class="line">  <span class="keyword">let</span> _vnode = <span class="literal">null</span></span><br><span class="line">  <span class="comment">// 判断nodeType类型</span></span><br><span class="line">  <span class="keyword">if</span>(_type === <span class="number">1</span>) &#123; <span class="comment">// 元素节点</span></span><br><span class="line">    _vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(_tag, _data, _value, _type)</span><br><span class="line">    <span class="comment">// 然后处理元素节点的所有自节点</span></span><br><span class="line">    _children.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> _vnode.<span class="property">children</span>.<span class="title function_">push</span>(<span class="title function_">combine</span>(item, data)))</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(_type === <span class="number">3</span>) &#123; <span class="comment">// 文本节点</span></span><br><span class="line">    _value = _value.<span class="title function_">replace</span>(curlyRE, <span class="function">(<span class="params">_, g</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">          * 第一个参数是正则表达式匹配到的东西</span></span><br><span class="line"><span class="comment">          * 第二个参数及以后是第 n-1 个分组</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">const</span> split = <span class="title function_">createSplitAttribute</span>(g.<span class="title function_">trim</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">split</span>(data)</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="comment">// 文本节点没有 tag 属性 data属性</span></span><br><span class="line">    _vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(_tag, _data, _value, _type)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _vnode</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将虚拟dom 转化为真实DOM</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseVnode</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;tag, data, type, value, children&#125; = vnode</span><br><span class="line">  <span class="keyword">let</span> dom = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">if</span>(type === <span class="number">1</span>) &#123;</span><br><span class="line">    dom = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(tag)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">      dom.<span class="title function_">setAttribute</span>(key, data[key])</span><br><span class="line">    &#125;</span><br><span class="line">    dom.<span class="property">nodeType</span> = type</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      dom.<span class="title function_">appendChild</span>(<span class="title function_">parseVnode</span>(children[i]))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(type === <span class="number">3</span>) &#123;</span><br><span class="line">    dom = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(tag)</span><br><span class="line">    dom.<span class="property">nodeValue</span> = value</span><br><span class="line">    dom.<span class="property">nodeType</span> = type</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dom</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用柯里化 存储需要替换的内容</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createSplitAttribute</span>(<span class="params">g</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> paths = g.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">splitAttribute</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> res = data</span><br><span class="line">    <span class="comment">// g.split(&#x27;.&#x27;).map(item =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//   res = res[item]</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="comment">//2.</span></span><br><span class="line">    <span class="keyword">let</span> prop</span><br><span class="line">    <span class="keyword">while</span>(prop = paths.<span class="title function_">shift</span>()) &#123;</span><br><span class="line">      <span class="comment">// 当对一个变量赋值对象时，是对象的引用，变量中的某个值发生变化，对象中对应的值也会发生变化</span></span><br><span class="line">      <span class="comment">// 但是给变量重新赋值对象，并不会造成原先对象的值发生变化，因为此时变量的引用已经发生变化，不在指向源对象</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res, prop)</span><br><span class="line">      res = res[prop]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;优·库里伍德·海尔赛兹&#x27;</span>,</span><br><span class="line">    <span class="attr">behavior</span>: <span class="string">&#x27;吃橘子&#x27;</span>,</span><br><span class="line">    <span class="attr">other</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;相川步&#x27;</span>,</span><br><span class="line">      <span class="attr">behavior</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;约的人&#x27;</span>,</span><br><span class="line">        <span class="attr">time</span>: <span class="string">&#x27;12m&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> curlyRE = <span class="regexp">/\&#123;\&#123;(.+?)\&#125;\&#125;/g</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * tag: node.nodeValue</span></span><br><span class="line"><span class="comment">    * data: node.attributes =&gt; obj =&gt; &#123;node.attribute.nodeName: node.attribute.nodeValue&#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">tag, data, value, type</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tag</span> = tag &amp;&amp; tag.<span class="title function_">toLowerCase</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = data</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">children</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">appendCild</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">children</span>.<span class="title function_">push</span>(vnode)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">JGVue</span>(options)</span><br></pre></td></tr></table></figure></li></ul></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;ol&gt;
&lt;li&gt;&lt;p&gt;判断元素&lt;/p&gt;
&lt;p&gt;vue 本质上是使用 HTML 字符串作为模板，将字符串模板转化为 AST(抽象语法树) ,再转换成 VNode&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;模板 -&amp;gt; AST&lt;/li&gt;
&lt;li&gt;AST -&amp;gt; VNode&lt;/li&gt;
&lt;li</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>函数 - 函数反柯里化（uncurrying）</title>
    <link href="https://lxx1997.github.io/2020/12/17/web/fucntion-uncurrying/"/>
    <id>https://lxx1997.github.io/2020/12/17/web/fucntion-uncurrying/</id>
    <published>2020-12-17T03:00:35.000Z</published>
    <updated>2020-12-17T03:00:35.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://segmentfault.com/a/1190000012912503">参考链接</a></p><blockquote><p><a href="/2020/12/17/fucntion-currying/">函数柯里化</a></p></blockquote><h4 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h4><p>  <strong>柯里化：</strong>是固定部分参数,返回一个接受剩余参数的函数,也称为部分计算函数,目的是为了缩小适用范围，创建一个针对性更强的函数，核心思想是把多参数传入的函数拆成单(部分)参数函数，内部再返回下一个单(部分)参数函数，依次处理剩余函数</p><p>  <strong>反柯里化：</strong>扩大适用范围，创建一个应用范围更广的函数，使本来只有特定对象才适用的方法，扩展到更多对象</p><h4 id="通用实现"><a href="#通用实现" class="headerlink" title="通用实现"></a>通用实现</h4>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种实现方式</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">unCurrying</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> self = <span class="variable language_">this</span></span><br><span class="line">  <span class="comment">// ...rest 方法相当于使用es6语法的解构赋值使用rest接收入参数组，相当于arguments rest的值是传入的所有参数组成的一个数组</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...rest</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">call</span>.<span class="title function_">apply</span>(self, rest)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> push = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>.<span class="title function_">unCurrying</span>()</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 1 为 Function 原型添加 unCurrying 方法，并在执行的时候保存执行 unCurrying 的方法到self</span></span><br><span class="line"><span class="comment">  * 2 借用apply把要借用的函数作为this环境赋予call，并传入之后的形参作为参数执行</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种实现方式</span></span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">unCurrying</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">call</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三种实现方式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unCurrying</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">tar, ...argu</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> fn.<span class="title function_">apply</span>(tar, argu)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用反柯里化"><a href="#使用反柯里化" class="headerlink" title="使用反柯里化"></a>使用反柯里化</h4>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">unCurrying</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> self = <span class="variable language_">this</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...rest</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(rest, <span class="string">&#x27;uncurrying rest&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">call</span>.<span class="title function_">apply</span>(self, rest)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> push = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>.<span class="title function_">unCurrying</span>()</span><br><span class="line">~<span class="keyword">function</span>(<span class="params">...rest</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rest, <span class="string">&#x27;before&#x27;</span>)</span><br><span class="line">  <span class="title function_">push</span>(rest, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rest, <span class="string">&#x27;after&#x27;</span>)</span><br><span class="line">&#125;(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>  反柯里化其实反映的是一种思想 - 扩大方法的适用范围</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">unCurrying</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> self = <span class="variable language_">this</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">...rest</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(rest, <span class="string">&#x27;uncurrying rest&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">call</span>.<span class="title function_">apply</span>(self, rest)</span><br><span class="line">    <span class="comment">// Array.prototype.push.call(&#123;a: 3&#125;, 4, 5)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> push = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>.<span class="title function_">unCurrying</span>()</span><br><span class="line">~<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> rest = &#123;<span class="attr">a</span>: <span class="number">3</span>&#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rest, <span class="string">&#x27;before&#x27;</span>)</span><br><span class="line">  <span class="title function_">push</span>(rest, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rest, <span class="string">&#x27;after&#x27;</span>)</span><br><span class="line">&#125;(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>  只要是方法就可以借用 unCurrying 方法</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// call</span></span><br><span class="line">    <span class="keyword">var</span> call = <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">call</span>.<span class="title function_">unCurrying</span>()</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">$</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">getElementById</span>(id)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// call()</span></span><br><span class="line">    <span class="title function_">call</span>($, <span class="variable language_">document</span>, <span class="string">&#x27;demon&#x27;</span>)</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      * 解题步骤</span></span><br><span class="line"><span class="comment">      * =&gt; Function.prototype.call.apply(Function.prototype.call, [$, document, &#x27;demon&#x27;])</span></span><br><span class="line"><span class="comment">      * =&gt; Function.prototype.call.call($, document, &#x27;demon&#x27;)</span></span><br><span class="line"><span class="comment">      * =&gt; $.call(document, &#x27;demon&#x27;)</span></span><br><span class="line"><span class="comment">      * =&gt; document.getElementById(&#x27;demon)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// unCurrying 借用自己本身</span></span><br><span class="line">    <span class="keyword">const</span> unCurrying = <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">unCurrying</span>.<span class="title function_">unCurrying</span>()</span><br><span class="line">    <span class="keyword">const</span> map = <span class="title function_">unCurrying</span>(<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">map</span>)</span><br><span class="line">    <span class="title function_">map</span>(&#123;<span class="number">0</span>: <span class="number">4</span>, <span class="number">1</span>: <span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>: <span class="literal">null</span>, <span class="attr">length</span>: <span class="number">3</span>&#125;, <span class="function"><span class="params">n</span> =&gt;</span> n + n)</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      * const map = unCurrying(Array.prototype.map) 步骤</span></span><br><span class="line"><span class="comment">      * =&gt; Function.prototype.call.apply(Function.prototype.unCurrying, [Array.prototype.map])</span></span><br><span class="line"><span class="comment">      * =&gt; Function.prototype.unCurrying.call(Array.prototype.map)</span></span><br><span class="line"><span class="comment">      * =&gt; Array.prototype.map.unCurrying()</span></span><br><span class="line"><span class="comment">      * =&gt; map = Array.prototype.map.unCurrying()</span></span><br><span class="line"><span class="comment">      * =&gt; map(&#123;0: 4, 1: &#x27;a&#x27;, 2: null, length: 3&#125;, n =&gt; n + n)</span></span><br><span class="line"><span class="comment">      * =&gt; Function.prototype.call.apply(Array.prototype.map, [&#123;0: 4, 1: &#x27;a&#x27;, 2: null, length: 3&#125;, n =&gt; n + n])</span></span><br><span class="line"><span class="comment">      * =&gt; Array.prototype.map.call(&#123;0: 4, 1: &#x27;a&#x27;, 2: null, length: 3&#125;, n =&gt; n + n)</span></span><br><span class="line"><span class="comment">      * =&gt; &#123;0: 4, 1: &#x27;a&#x27;, 2: null, length: 3&#125;.map(n =&gt; n + n)</span></span><br><span class="line"><span class="comment">      * =&gt; &#123;0: 8, 1: &#x27;aa&#x27;, 2: 0, length: 3&#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  ~~~~</span><br><span class="line"></span><br><span class="line">#### 总结</span><br><span class="line"></span><br><span class="line">  函数柯里化</span><br><span class="line">  ~~~js</span><br><span class="line">    <span class="keyword">function</span>(<span class="params">arg1, arg2</span>)               <span class="comment">// function(arg1)(arg2)</span></span><br><span class="line">    <span class="keyword">function</span>(<span class="params">arg1, arg2, arg3</span>)         <span class="comment">// function(arg1)(arg2)(arg3)</span></span><br><span class="line">    <span class="keyword">function</span>(<span class="params">arg1, arg2, arg3, arg4</span>)   <span class="comment">// function(arg1)(arg2)(arg3)(arg4)</span></span><br></pre></td></tr></table></figure><p>  反柯里化</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj.<span class="title function_">fn</span>(arg1, arg2)             <span class="comment">//  fn(obj, arg1, arg2)</span></span><br></pre></td></tr></table></figure><h4 id="终点知识解析"><a href="#终点知识解析" class="headerlink" title="终点知识解析"></a>终点知识解析</h4><ol><li><p><code>Function.prototype.call.apply(self, rest)</code></p><p>小例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Math</span>.<span class="property">Max</span>.<span class="title function_">apply</span>([], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br></pre></td></tr></table></figure><blockquote><p>先执行 apply 将 math 替换成 []<br>然后在执行 Max 并传入[1,2,3],此时因为 apply 的关系  [1,2,3]扁平化为1,2,3</p></blockquote><p><code>Function.prototype.call.apply(self, rest)</code>过程</p><ul><li><code>Function.prototype.call.apply(Array.prototype.push, rest)</code></li><li><code>Array.prototype.push.call(...rest)</code> <em>所以在传递 rest 的时候，需要操作的对象放在第一位，方便 call 绑定 this</em></li><li>rest[0].push(rest.shift(1))</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">a</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>.<span class="title function_">call</span>(obj, <span class="number">4</span>, <span class="number">5</span>) <span class="comment">// 2</span></span><br><span class="line">obj <span class="comment">// &#123;0: 4, 1: 5, a: 3, length: 2&#125;</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">a</span>: <span class="number">3</span>, <span class="attr">b</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>.<span class="title function_">call</span>(obj, <span class="number">4</span>, <span class="number">5</span>) <span class="comment">// 2</span></span><br><span class="line">obj <span class="comment">//&#123;0: 4, 1: 5, a: 3, b: 3, length: 2&#125;</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://segmentfault.com/a/1190000012912503&quot;&gt;参考链接&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;/2020/12/17/fucntion-currying/&quot;&gt;函数柯里化&lt;/a&gt;&lt;/p&gt;</summary>
      
    
    
    
    <category term="design-pattern" scheme="https://lxx1997.github.io/categories/design-pattern/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="design-pattern" scheme="https://lxx1997.github.io/tags/design-pattern/"/>
    
    <category term="function" scheme="https://lxx1997.github.io/tags/function/"/>
    
  </entry>
  
  <entry>
    <title>函数 - 函数柯里化（Currying）</title>
    <link href="https://lxx1997.github.io/2020/12/17/web/function-currying/"/>
    <id>https://lxx1997.github.io/2020/12/17/web/function-currying/</id>
    <published>2020-12-17T01:16:37.000Z</published>
    <updated>2020-12-17T01:16:37.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/pigtail/p/3447660.html">参考文章</a></p><blockquote><p><a href="/2020/12/17/fucntion-uncurrying/">函数反柯里化</a></p></blockquote><p>函数柯里化其实本身是固定一个可以预期的参数，并返回一个特定的函数，处理批特定的需求，增加了函数的适用性，降低了函数的适用范围</p><p><strong>柯里化函数</strong>通用实现</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">currying</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> slice = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>,</span><br><span class="line">      <span class="comment">// 取出传入的多个参数(不包含第一位)</span></span><br><span class="line">      _args = slice.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> _inargs = slice.<span class="title function_">call</span>(<span class="variable language_">arguments</span>)</span><br><span class="line">    <span class="comment">// 将创建柯里化函数传入的参数与后传入的参数进行合并</span></span><br><span class="line">    <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="literal">null</span>, _args.<span class="title function_">concat</span>(_inargs))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>提高适用性</p><p>解决了兼容性问题，但同时也会再来，使用的不便利性，不同的应用场景往，要传递很多参数，以达到解决特定问题的目的。有时候应用中，同一种规则可能会反复使用，这就可能会造成代码的重复性。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">square</span>(<span class="params">i</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> i * i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dubble</span>(<span class="params">i</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> i *= <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">map</span>(<span class="params">handeler, list</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> list.<span class="title function_">map</span>(handeler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mapSQ = <span class="title function_">currying</span>(map, square);</span><br><span class="line"><span class="title function_">mapSQ</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"><span class="title function_">mapSQ</span>([<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]);</span><br><span class="line"><span class="title function_">mapSQ</span>([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mapDB = <span class="title function_">currying</span>(map, dubble);</span><br><span class="line"><span class="title function_">mapDB</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line"><span class="title function_">mapDB</span>([<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]);</span><br><span class="line"><span class="title function_">mapDB</span>([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>]);</span><br></pre></td></tr></table></figure><p><em>缩小了函数的适用范围，但同时提高函数的适性</em></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Ajax</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">xhr</span> = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Ajax</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">open</span> = <span class="keyword">function</span>(<span class="params">type, url, data, callback</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">callback</span>(<span class="variable language_">this</span>.<span class="property">xhr</span>.<span class="property">responseText</span>, <span class="variable language_">this</span>.<span class="property">xhr</span>.<span class="property">status</span>, <span class="variable language_">this</span>.<span class="property">xhr</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">xhr</span>.<span class="title function_">open</span>(type, url, data.<span class="property">async</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">xhr</span>.<span class="title function_">send</span>(data.<span class="property">paras</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;get post&#x27;</span>.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>).<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">mt</span>) &#123;</span><br><span class="line">  <span class="title class_">Ajax</span>.<span class="property"><span class="keyword">prototype</span></span>[mt] = <span class="title function_">currying</span>(<span class="title class_">Ajax</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">open</span>, mt);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">Ajax</span>();</span><br><span class="line">xhr.<span class="title function_">get</span>(<span class="string">&#x27;/articles/list.php&#x27;</span>, &#123;&#125;,</span><br><span class="line"><span class="keyword">function</span>(<span class="params">datas</span>) &#123;</span><br><span class="line">  <span class="comment">// done(datas)    </span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xhr1 = <span class="keyword">new</span> <span class="title class_">Ajax</span>();</span><br><span class="line">xhr1.<span class="title function_">post</span>(<span class="string">&#x27;/articles/add.php&#x27;</span>, &#123;&#125;,</span><br><span class="line"><span class="keyword">function</span>(<span class="params">datas</span>) &#123;</span><br><span class="line">  <span class="comment">// done(datas)    </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>延迟执行</p><p>不断地柯里化，累计传入的参数，最后执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> add = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="variable language_">this</span>,</span><br><span class="line">  _args = <span class="variable language_">arguments</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">arguments</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, i&lt; _args.<span class="property">length</span>; i++ &#123;</span><br><span class="line">        sum += _args[i]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> sum</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 通过函数的push方法，存储每一次调用的返回参数到 _args 中</span></span><br><span class="line">      <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>.<span class="title function_">apply</span>(_args, <span class="variable language_">arguments</span>)</span><br><span class="line">      <span class="comment">// arguments.callee 返回的是arguments所在函数本身，此操作相当于return</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">arguments</span>.<span class="property">callee</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">add</span>(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)();<span class="comment">//10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通用的写法</span></span><br><span class="line"><span class="keyword">var</span> curry = <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _args = []</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">cb</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, _args)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">push</span>.<span class="title function_">apply</span>(_args, <span class="variable language_">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> cb;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>固定异变因素</p><p>提前把易变因素，传参固定下来，生成一个更明确的应用函数。最典型的代表应用，是bind函数用以固定this这个易变对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">bind</span> = <span class="keyword">function</span>(<span class="params">context</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="variable language_">this</span>,</span><br><span class="line">  _args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="comment">// arguments [this, arg1, arg2 ...]</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 绑定 this 到创建柯里化函数时绑定的this，同时合并参数</span></span><br><span class="line">    <span class="keyword">return</span> _this.<span class="title function_">apply</span>(context, _args.<span class="title function_">concat</span>(<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>)))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/pigtail/p/3447660.html&quot;&gt;参考文章&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;/2020/12/17/fucntion-uncurrying/&quot;&gt;函数反柯里化&lt;/</summary>
      
    
    
    
    <category term="design-pattern" scheme="https://lxx1997.github.io/categories/design-pattern/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="design-pattern" scheme="https://lxx1997.github.io/tags/design-pattern/"/>
    
    <category term="function" scheme="https://lxx1997.github.io/tags/function/"/>
    
  </entry>
  
  <entry>
    <title>javascript-data-methods</title>
    <link href="https://lxx1997.github.io/2020/12/16/web/javascript-data-methods/"/>
    <id>https://lxx1997.github.io/2020/12/16/web/javascript-data-methods/</id>
    <published>2020-12-16T05:59:28.000Z</published>
    <updated>2020-12-16T05:59:28.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="全局函数（function）"><a href="#全局函数（function）" class="headerlink" title="全局函数（function）"></a>全局函数（function）</h4><ul><li>decodeURI()  解码某个编码的URI</li><li>encodeURI()  把字符串编码为URI</li><li>decodeURIComponent()   解码一个编码的URI组件</li><li>encodeURIComponent()   把字符串编码为URI组件</li><li>escape()  对字符串进行编码</li><li>eval()   计算javascript字符串并把它作为脚本来执行</li><li>isFinite()  检查某个值是否为有穷大的数</li><li>isNaN()  检查某个值是否是数字</li><li>Number()   把对象的值转化为数字</li><li>parseFloat()   解析一个字符串并返回一个浮点数</li><li>parseInt() 解析一个字符串并返回一个整数</li><li>String()  把对象的值转为字符串</li><li>unescape()  对由escape()编码的字符串进行解码</li></ul><h4 id="数组（Array）"><a href="#数组（Array）" class="headerlink" title="数组（Array）"></a>数组（Array）</h4><ul><li>concat()   连接两个或者更多的数组，并返回结果</li><li>copyWithin(target, start, end)  将数组的指定位置拷贝元素到数组的另一个指定位置中 （target 指的是元素复制的位数， start指的是元素开始复制的位置，end指的是元素结束复制的位数）</li><li>entries()  返回一个数组的迭代对象，包含数组的键值对[index, vlaue]</li><li>every()  检测数组元素的每个元素是否符合条件，如果都满足条件， 返回true，如果不满足返回false</li><li>some() 检测数值中某个元素是否符合条件，如果有一个符合，返回true，如果全不符合，返回false</li><li>fill()  使用一个固定值来填充数组</li><li>filter()  用于筛选数组，返回符合条件的一个新的数组</li><li>find()  返回符合传入测试的数组元素</li><li>findIndex()  返回符合传入测试数组元素的索引</li><li>forEach()  数组的每一个元素都执行一次回调函数</li><li>map() 循环遍历数组中的每一个值，可以用于修改数组</li><li>from()   Array.from() 通过给定的对象创建一个数组</li><li>indexOf() 搜索数组中国的元素，并返回所在位置</li><li>includes() 判断一个数组是否包含一个指定的值</li><li>isArray() 判断对象是否是数组</li><li>join()  把数组中的元素以某个标识拼接为字符串</li><li>keys()   返回数组的可迭代对象，包含原始数组的键(key)</li><li>lastIndexOf()  搜索数组中的元素，并返回它最后出现的位置</li><li>pop()  删除数组中的最后一个元素，并返回删除的元素</li><li>push()   向数组的末尾添加一个或多个元素，并返回新的长度</li><li>reduce() 计算元素，可以用于计算数组，筛选，遍历，从左到右</li><li>reduceRight()  计算元素，可以用于计算数组，筛选，遍历，从右到左</li><li>reverse()   反转数组的元素顺序</li><li>shift()   删除并返回数组的第一个元素</li><li>slice(start, end)  选取数组的一部分，并选取一个新数组</li><li>sort() 对元素数组进行排序， 可以自定义排序规则</li><li>splice(index,  many,  item)   从数组中添加和删除元素</li><li>toString()  将数组转化为字符串，并返回结果</li><li>unshift()  向数组开头添加一个或多个元素，并返回新的长度</li><li>valueOf()  返回数组对象的原始值</li></ul><h4 id="时间对象（Date）"><a href="#时间对象（Date）" class="headerlink" title="时间对象（Date）"></a>时间对象（Date）</h4><h5 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h5><pre><code>* date.Date()   返回当日的日期和事件* date.getDate()   从Date对象中返回一个月的某一天* date.getDay()    从Date对象中返回一周中的某一天* Date.getMonth()   返回Date对象的月份（0-11）真实月份需要加* date.getFullYear()   返回四位数字的年份* date.getYear()   返回两位数字的年份* date.getHours()   返回对象的小时数* date.getMinutes()  返回对象的分钟数* date.getSeconds()  返回对象的秒数* date.getMilliseconds()   返回对象的毫秒数* date.getTime()  返回1970年1月1日至今的毫秒数* date.getUTCDate()   从Date对象中返回世界时一个月的某一天* date.getUTCDay()    从Date对象中返回世界时一周中的某一天* date.getUTCMonth()   返回Date对象的世界时月份（0-11）真实月份需要加* date.getUTCFullYear()   返回世界时四位数字的年份* date.getUTCYear()   返回世界时两位数字的年份* date.getUTCHours()   返回对象世界时的小时数* date.getUTCMinutes()  返回对象世界时的分钟数* date.getUTCSeconds()  返回对象世界时的秒数* date.getUTCMilliseconds()   返回对象世界时的毫秒数* date.parse()    获取1970年1月1日午夜到制定日期（字符串）的毫秒数* date.setDate()   设置某一天* date.setFullYear()  设置Date对象的年份* date.setMonth()   设置月份* date.setHours() 设置日期的小时* date.setMillisecoends()   设置毫秒数* date.setTime()  以毫秒设置date对象* date.setMinutes()   设置分钟* date.setSeconds()  设置秒* date.toDateString()   把对象的日期部分转化为字符串* date.toJSON()  以json数据格式返回日期字符串* date.toLocaleDateString()   根据本地时间格式，把Date对象的日期部分转为字符串* date.toLocaleTimeString()   根据本地时间格式，把Date对象的日期部分转为字符串* date.toLocaleString()   根据本地时间格式，把Date对象转为字符串* date.valueOf()    返回date对象的原始值</code></pre><h5 id="简单的时间函数"><a href="#简单的时间函数" class="headerlink" title="简单的时间函数"></a>简单的时间函数</h5><pre><code>* 获取当前日期<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  以年月日格式获取时间</span></span><br><span class="line"><span class="title function_">getNewDate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">  date.<span class="title function_">setTime</span>(date.<span class="title function_">getTime</span>())<span class="comment">// 获取上个月的日期（这一行去掉就是获取今天计算机上的日期了）</span></span><br><span class="line">  <span class="keyword">var</span> now = date</span><br><span class="line">  <span class="keyword">var</span> year = now.<span class="title function_">getFullYear</span>() <span class="comment">// 年</span></span><br><span class="line">  <span class="keyword">var</span> month = now.<span class="title function_">getMonth</span>() + <span class="number">1</span> <span class="comment">// 月</span></span><br><span class="line">  <span class="keyword">var</span> day = now.<span class="title function_">getDate</span>() <span class="comment">// 日</span></span><br><span class="line">  <span class="keyword">var</span> clock = year + <span class="string">&#x27;-&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (month &lt; <span class="number">10</span>) &#123; clock += <span class="string">&#x27;0&#x27;</span> &#125;</span><br><span class="line">  clock += month + <span class="string">&#x27;-&#x27;</span></span><br><span class="line">  <span class="keyword">if</span> (day &lt; <span class="number">10</span>) &#123; clock += <span class="string">&#x27;0&#x27;</span> &#125;</span><br><span class="line">  clock += day</span><br><span class="line">  <span class="keyword">return</span> clock</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 以年月日 时分秒获取时间</span></span><br><span class="line"><span class="comment">// fmt 为传入的日期格式 </span></span><br><span class="line"><span class="comment">// yyyy-MM-dd hh:mm:ss  年月日 时分秒</span></span><br><span class="line"><span class="comment">// yyyy-MM-dd  年月日</span></span><br><span class="line"><span class="title function_">getNowTime</span>(<span class="params">fmt</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">  <span class="keyword">var</span> o = &#123;</span><br><span class="line">    <span class="string">&#x27;M+&#x27;</span>: date.<span class="title function_">getMonth</span>() + <span class="number">1</span>, <span class="comment">// 月份</span></span><br><span class="line">    <span class="string">&#x27;d+&#x27;</span>: date.<span class="title function_">getDate</span>(), <span class="comment">// 日</span></span><br><span class="line">    <span class="string">&#x27;h+&#x27;</span>: date.<span class="title function_">getHours</span>(), <span class="comment">// 小时</span></span><br><span class="line">    <span class="string">&#x27;m+&#x27;</span>: date.<span class="title function_">getMinutes</span>(), <span class="comment">// 分</span></span><br><span class="line">    <span class="string">&#x27;s+&#x27;</span>: date.<span class="title function_">getSeconds</span>(), <span class="comment">// 秒</span></span><br><span class="line">    <span class="string">&#x27;q+&#x27;</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>((date.<span class="title function_">getMonth</span>() + <span class="number">3</span>) / <span class="number">3</span>), <span class="comment">// 季度</span></span><br><span class="line">    <span class="string">&#x27;S&#x27;</span>: date.<span class="title function_">getMilliseconds</span>() <span class="comment">// 毫秒</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/(y+)/</span>.<span class="title function_">test</span>(fmt)) &#123; fmt = fmt.<span class="title function_">replace</span>(<span class="title class_">RegExp</span>.<span class="property">$1</span>, (date.<span class="title function_">getFullYear</span>() + <span class="string">&#x27;&#x27;</span>).<span class="title function_">substr</span>(<span class="number">4</span> - <span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="property">length</span>)) &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> o) &#123; <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;(&#x27;</span> + k + <span class="string">&#x27;)&#x27;</span>).<span class="title function_">test</span>(fmt)) fmt = fmt.<span class="title function_">replace</span>(<span class="title class_">RegExp</span>.<span class="property">$1</span>, (<span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="property">length</span> === <span class="number">1</span>) ? (o[k]) : ((<span class="string">&#x27;00&#x27;</span> + o[k]).<span class="title function_">substr</span>((<span class="string">&#x27;&#x27;</span> + o[k]).<span class="property">length</span>))) &#125;</span><br><span class="line">  <span class="keyword">return</span> fmt</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>* 获取当前日期之前或者之后一段时间的日期<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过setTime将时间设置为当前时间100分钟之后，然后获取设置之后的时间</span></span><br><span class="line"><span class="title function_">getTime</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">  date.<span class="title function_">setTime</span>(date.<span class="property">getTime</span> + <span class="number">1000</span> * <span class="number">60</span> * <span class="number">100</span>)</span><br><span class="line">  <span class="keyword">var</span> newDate = date.<span class="title function_">getFullYear</span>() + <span class="string">&#x27;-&#x27;</span> + (<span class="title class_">Number</span>(date.<span class="title function_">getMonth</span>()) + <span class="number">1</span>) + <span class="string">&#x27;-&#x27;</span> + date.<span class="title function_">getDate</span>() + <span class="string">&#x27; &#x27;</span> + date.<span class="title function_">getHours</span>() + <span class="string">&#x27;:&#x27;</span> + date.<span class="title function_">getMinutes</span>() + <span class="string">&#x27;:&#x27;</span> + date.<span class="title function_">getSeconds</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>* 比较两个时间的大小<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比较传入的时间大小 时间格式为 yyyy-MM-dd hh:mm:ss</span></span><br><span class="line"><span class="comment">// 通过date.parse()获取传入时间的毫秒数， 通过new Date() 转化为日期格式，在进行大小比较</span></span><br><span class="line"><span class="title class_">Compare</span>(time1, time2) &#123;</span><br><span class="line">  <span class="keyword">const</span> date1 = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="title class_">Date</span>.<span class="title function_">parse</span>(time1.<span class="title function_">replace</span>(<span class="regexp">/-/g</span>, <span class="string">&#x27;/&#x27;</span>)))</span><br><span class="line">  <span class="keyword">const</span> date2 = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="title class_">Date</span>.<span class="title function_">parse</span>(time2.<span class="title function_">replace</span>(<span class="regexp">/-/g</span>, <span class="string">&#x27;/&#x27;</span>)))</span><br><span class="line">  <span class="keyword">if</span> (date1 &gt; date2) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;时间1 大于 时间2&#x27;</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;时间2 大于 时间1&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>* 计算所选时间是第几周(当前月第几周，当前年份第几周)<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getYearWeek</span>(<span class="params">year,month,date</span>)&#123;</span><br><span class="line">  <span class="comment">/*  </span></span><br><span class="line"><span class="comment">    dateNow是当前日期 </span></span><br><span class="line"><span class="comment">    dateFirst是当年第一天  </span></span><br><span class="line"><span class="comment">    dataNumber是当前日期是今年第多少天  </span></span><br><span class="line"><span class="comment">    用dataNumber + 当前年的第一天的周差距的和在除以7就是本年第几周  </span></span><br><span class="line"><span class="comment">  */</span>      </span><br><span class="line">  <span class="keyword">let</span> dateNow = <span class="keyword">new</span> <span class="title class_">Date</span>(year, <span class="built_in">parseInt</span>(month) - <span class="number">1</span>, date);</span><br><span class="line">  <span class="keyword">let</span> dateFirst = <span class="keyword">new</span> <span class="title class_">Date</span>(year, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">let</span> dataNumber = <span class="title class_">Math</span>.<span class="title function_">round</span>((dateNow.<span class="title function_">valueOf</span>() - dateFirst.<span class="title function_">valueOf</span>()) / <span class="number">86400000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">ceil</span>((dataNumber + ((dateFirst.<span class="title function_">getDay</span>() + <span class="number">1</span>) - <span class="number">1</span>)) / <span class="number">7</span>);        </span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">getMonthWeek</span>(<span class="params">year,month,date</span>)&#123;</span><br><span class="line">  <span class="comment">/*  </span></span><br><span class="line"><span class="comment">    month = 6 - w = 当前周的还有几天过完(不算今天)  </span></span><br><span class="line"><span class="comment">    year + month 的和在除以7 就是当天是当前月份的第几周  </span></span><br><span class="line"><span class="comment">  */</span>      </span><br><span class="line">  <span class="keyword">let</span> dateNow = <span class="keyword">new</span> <span class="title class_">Date</span>(year, <span class="built_in">parseInt</span>(month) - <span class="number">1</span>, date);</span><br><span class="line">  <span class="keyword">let</span> w = dateNow.<span class="title function_">getDay</span>();<span class="comment">//星期数</span></span><br><span class="line">  <span class="keyword">let</span> d = dateNow.<span class="title function_">getDate</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">ceil</span>((d + <span class="number">6</span> - w) / <span class="number">7</span>);      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><h4 id="数学对象（Math）"><a href="#数学对象（Math）" class="headerlink" title="数学对象（Math）"></a>数学对象（Math）</h4><ul><li>Math.E    返回算术常亮e，即自然对数的底数（约等于2.718）</li><li>Math.LN2   返回2的自然对数（约等于0.693）</li><li>Math.LEN10 返回10的自然对数（约等于2.302）</li><li>Math.LOG2E 返回以2为底的e的对数（约等于1.414）</li><li>Math.LOG10E 返回以10为底的e的对数（约等于0.434）</li><li>Math.PI       返回圆周率（约等于3.14159）</li><li>Math.SQRT1_2  返回 2 的平方根的倒数（约等于 0.707）</li><li>Math.SQRT2  返回 2 的平方根（约等于 1.414）</li><li>Math.abs()   返回数的绝对值</li><li>Math.acos() 返回数的反余弦值</li><li>Math.asin() 返回数的反正弦值</li><li>Math.atan()  以介于 -PI/2 与 PI/2 弧度之间的数值来返回 x 的反正切值</li><li>Math.atan2(y,x)   返回从 x 轴到点 (x,y) 的角度（介于 -PI/2 与 PI/2 弧度之间）</li><li>Math.ceil()   向上取整</li><li>Math.cos()    返回余弦值</li><li>Math.exp()   返回e的指数</li><li>Math.floor()   向下取整</li><li>Math.log()   返回自然数的对数</li><li>Math.max(x, y)  返回最大值</li><li>Math.min(x, y)  返回最小值</li><li>Math.pow(x, y) 返回x的y次幂</li><li>Math.random()  返回0~1之间的随机数</li><li>Math.round()  把数四舍五入为最接近的整数</li><li>Math.sin()   返回数的正弦</li><li>Math.sqrt()   返回数的平方根</li><li>Math.tan()  返回角的正切</li><li>Math.toSource() 返回对象的源代码</li><li>Math.valueOf()   返回Math对象的原始值</li></ul><h4 id="字符串对象（String）"><a href="#字符串对象（String）" class="headerlink" title="字符串对象（String）"></a>字符串对象（String）</h4><ul><li>charAt()   返回指定位置的字符</li><li>charCodeAt()  返回指定位置的字符的Unicode编码</li><li>concat()   连接两个或者更多字符串，并返回新的字符串</li><li>fromCharCode()  将Unicode编码转为字符</li><li>indexOf() 返回某个指定的字符串值在字符串首次出现的位置</li><li>includes() 查找字符串中是否包含指定的字符串</li><li>lastIndexOf() 从后向前搜索字符串，并从起始位置(0)开始返回字符串最后出现的位置</li><li>match()   查找找到一个或者多个正则表达式匹配</li><li>repeat()   复制字符串指定次数，并将它们连接在一起返回</li><li>replace()  在字符串中查找匹配的字符串，并替换与正则表达式匹配的字符串</li><li>search()   查找与正则表达式相匹配的值</li><li>slice()   提取字符串的片段，并在新的字符串中返回被提取的部分</li><li>split()  把字符串分割为字符串数组</li><li>startsWith()   查看字符串是否以指定的子字符串开头</li><li>substr(start, num)  从起始索引号提取字符串中指定数目的字符</li><li>substring(start,end)  提取两个字符串索引之间的字符</li><li>toLowerCase()    将字符串转化为小写</li><li>toUpperCase()    将字符串转化为大写   </li><li>trim()   去除字符串两边的空白</li><li>toLocaleLowerCase()  根据本地主机的语言环境把字符串转化为小写</li><li>toLocaleUpperCase()  根据本地主机的语言环境把字符串转换为大写</li><li>toString()   返回一个字符串</li><li><p>valueOf()   返回某个字符串对象的原始值</p></li><li><p>anchor(text)    创建一个HTML锚  <a name="text"></a></p></li><li>big()  用大号字体显示字符串</li><li>blink()   闪动文本  (不能用于IE,Chrome,或者Safari)</li><li>bold()   使用粗体显示字符串</li><li>fixed()   用打字机文本显示字符串</li><li>fontcolor()   用指定的颜色来显示字符串</li><li>fontsize()   使用指定的尺寸来显示字符串</li><li>italics()   使用斜体显示字符串</li><li>link()    将字符串显示为连接</li><li>small()   使用小字号来显示字符串</li><li>strike()   用于显示加删除线的字符串</li><li>sub()  把字符串显示为下标</li><li>sup()  把字符串显示为上标</li></ul><h4 id="async-await"><a href="#async-await" class="headerlink" title="async await"></a>async await</h4><p>  ​      async用于申明一个function是异步的，而await用于等待一个异步方法执行完成，await只能出现在async之后</p><h5 id="async"><a href="#async" class="headerlink" title="async"></a>async</h5><p>  ​      async 定义的函数是一个promise对象，如果函数中return 一个直接良，async会把这个直接量通过peomise.resolve()封装成Promise对象</p><pre><code>async函数返回的是一个Promise对象，所以最外层不能用await获取其返回值，可以用过原始的.then()链来处理这个Promise对象</code></pre><p>  ​      Promise 的特点——无等待，所以在没有 <code>await</code> 的情况下执行 async 函数，它会立即执行，返回一个 Promise 对象，并且，绝不会阻塞后面的语句。这和普通返回 Promise 对象的函数并无二致</p><h5 id="await"><a href="#await" class="headerlink" title="await"></a>await</h5><p>  ​      await是个运算符，用于组成表达式，await表达式的运算结果取决于它等的东西</p><p>  ​      如果它等到的不是一个Promise对象，那await表达式的运算结果就是它等到的东西</p><p>  ​      如果他等到的是一个Promise对象，await会阻塞后面的代码，等着Promise对象resolve 然后得到resolve的值，作为await表达式的运算结果</p><p>  ​      async函数调用不会造成阻塞，它内部所有的阻塞都被封装在一个Promise对象中异步执行</p><h5 id="async-await-帮我们干了啥"><a href="#async-await-帮我们干了啥" class="headerlink" title="async/await 帮我们干了啥"></a>async/await 帮我们干了啥</h5><p>  ​      async会将气候的函数的返回值封装成一个Promise对象，而await会等待这个Promise完成，并将其resolve的结果返回出来</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">takeLongTime</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;long_time_value&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">takeLongTime</span>().<span class="title function_">then</span>(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;got&quot;</span>, v);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">takeLongTime</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;long_time_value&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> v = <span class="keyword">await</span> <span class="title function_">takeLongTime</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test</span>();</span><br></pre></td></tr></table></figure><h5 id="async-await的优势在与处理then链"><a href="#async-await的优势在与处理then链" class="headerlink" title="async/await的优势在与处理then链"></a>async/await的优势在与处理then链</h5><p>  ​      单一的Promise并不能发现async/await的优势，如果处理多个Promise组成的then链时，优势就能体现出来了</p><pre><code>假设一个业务分多个步骤完成，每个步骤都是异步的，而且依赖于上一个步骤的结果，如果使用setTimeout来模拟异步操作</code></pre>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 传入参数 n，表示这个函数执行的时间（毫秒）</span></span><br><span class="line"><span class="comment"> * 执行的结果是 n + 200，这个值将用于下一步骤</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">takeLongTime</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(n + <span class="number">200</span>), n);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">step1</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`step1 with <span class="subst">$&#123;n&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">takeLongTime</span>(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">step2</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`step2 with <span class="subst">$&#123;n&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">takeLongTime</span>(n);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">step3</span>(<span class="params">n</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`step3 with <span class="subst">$&#123;n&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">takeLongTime</span>(n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// setTimeOut</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doIt</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&quot;doIt&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> time1 = <span class="number">300</span>;</span><br><span class="line">  <span class="title function_">step1</span>(time1)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">time2</span> =&gt;</span> <span class="title function_">step2</span>(time2))</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">time3</span> =&gt;</span> <span class="title function_">step3</span>(time3))</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&quot;doIt&quot;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">doIt</span>();</span><br><span class="line"><span class="comment">// async/await</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doIt</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&quot;doIt&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> time1 = <span class="number">300</span>;</span><br><span class="line">  <span class="keyword">const</span> time2 = <span class="keyword">await</span> <span class="title function_">step1</span>(time1);</span><br><span class="line">  <span class="keyword">const</span> time3 = <span class="keyword">await</span> <span class="title function_">step2</span>(time2);</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">step3</span>(time3);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&quot;doIt&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">doIt</span>();</span><br></pre></td></tr></table></figure><p>  ​    现在把业务要求改一下，仍然是三个步骤，但每一个步骤都需要之前每个步骤的结果</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doIt</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&quot;doIt&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> time1 = <span class="number">300</span>;</span><br><span class="line">    <span class="keyword">const</span> time2 = <span class="keyword">await</span> <span class="title function_">step1</span>(time1);</span><br><span class="line">    <span class="keyword">const</span> time3 = <span class="keyword">await</span> <span class="title function_">step2</span>(time1, time2);</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">step3</span>(time1, time2, time3);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&quot;doIt&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setTimeOut</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doIt</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&quot;doIt&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> time1 = <span class="number">300</span>;</span><br><span class="line">  <span class="title function_">step1</span>(time1)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">time2</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">step2</span>(time1, time2)</span><br><span class="line">              .<span class="title function_">then</span>(<span class="function"><span class="params">time3</span> =&gt;</span> [time1, time2, time3]);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">times</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> [time1, time2, time3] = times;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">step3</span>(time1, time2, time3);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`result is <span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&quot;doIt&quot;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="获取屏幕宽高"><a href="#获取屏幕宽高" class="headerlink" title="获取屏幕宽高"></a>获取屏幕宽高</h4><h5 id="获取屏幕高度方法"><a href="#获取屏幕高度方法" class="headerlink" title="获取屏幕高度方法"></a>获取屏幕高度方法</h5><pre><code>- document.body.clientWidth ==&gt; BODY对象宽度  - document.body.clientHeight ==&gt; BODY对象高度  - document.documentElement.clientWidth ==&gt; 可见区域宽度  - document.documentElement.clientHeight ==&gt; 可见区域高度  - 网页可见区域宽： document.body.clientWidth  - 网页可见区域高： document.body.clientHeight  - 网页可见区域宽： document.body.offsetWidth (包括边线的宽)  - 网页可见区域高： document.body.offsetHeight (包括边线的高)  - 网页正文全文宽： document.body.scrollWidth  - 网页正文全文高： document.body.scrollHeight  - 网页被卷去的高： document.body.scrollTop  - 网页被卷去的左： document.body.scrollLeft  - 网页正文部分上： window.screenTop  - 网页正文部分左： window.screenLeft  - 屏幕分辨率的高： window.screen.height  - 屏幕分辨率的宽： window.screen.width  - 屏幕可用工作区高度： window.screen.availHeight  - 屏幕可用工作区宽度： window.screen.availWidth  </code></pre><h5 id="部分jQuery函数"><a href="#部分jQuery函数" class="headerlink" title="部分jQuery函数"></a>部分jQuery函数</h5><pre><code>- $(window).height() 　//浏览器时下窗口可视区域高度   - $(document).height()　　　　//浏览器时下窗口文档的高度   - $(document.body).height()　　　　　　//浏览器时下窗口文档body的高度   - $(document.body).outerHeight(**true**)　//浏览器时下窗口文档body的总高度 包括border padding margin   - $(window).width() 　//浏览器时下窗口可视区域宽度   - $(document).width()//浏览器时下窗口文档对于象宽度   - $(document.body).width()　　　　　　//浏览器时下窗口文档body的高度   - $(document.body).outerWidth(**true**)　//浏览器时下窗口文档body的总宽度 包括border padding  </code></pre><h5 id="HTML精确定位-scrollLeft-scrollWidth-clientWidth-offsetWidth"><a href="#HTML精确定位-scrollLeft-scrollWidth-clientWidth-offsetWidth" class="headerlink" title="HTML精确定位:scrollLeft,scrollWidth,clientWidth,offsetWidth"></a>HTML精确定位:scrollLeft,scrollWidth,clientWidth,offsetWidth</h5><pre><code>- scrollHeight: 获取对象的滚动高度。   - scrollLeft:设置或获取位于对象左边界和窗口中目前可见内容的最左端之间的距离   - scrollTop:设置或获取位于对象最顶端和窗口中可见内容的最顶端之间的距离   - scrollWidth:获取对象的滚动宽度   - offsetHeight:获取对象相对于版面或由父坐标 offsetParent 属性指定的父坐标的高度   - offsetLeft:获取对象相对于版面或由 offsetParent 属性指定的父坐标的计算左侧位置   - offsetTop:获取对象相对于版面或由 offsetTop 属性指定的父坐标的计算顶端位置   - event.clientX 相对文档的水平座标   - event.clientY 相对文档的垂直座标   - event.offsetX 相对容器的水平坐标   - event.offsetY 相对容器的垂直坐标   - document.documentElement.scrollTop 垂直方向滚动的值   - event.clientX+document.documentElement.scrollTop 相对文档的水平座标+垂直方向滚动的量 </code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;全局函数（function）&quot;&gt;&lt;a href=&quot;#全局函数（function）&quot; class=&quot;headerlink&quot; title=&quot;全局函数（function）&quot;&gt;&lt;/a&gt;全局函数（function）&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;decodeURI()  解码某</summary>
      
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/categories/JavaScript/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="array" scheme="https://lxx1997.github.io/tags/array/"/>
    
    <category term="method" scheme="https://lxx1997.github.io/tags/method/"/>
    
  </entry>
  
  <entry>
    <title>01 - Vue源码解读-数据驱动-dom生成</title>
    <link href="https://lxx1997.github.io/2020/12/16/vue/vue-VirtualDOM-template/"/>
    <id>https://lxx1997.github.io/2020/12/16/vue/vue-VirtualDOM-template/</id>
    <published>2020-12-16T02:54:22.000Z</published>
    <updated>2020-12-16T02:54:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>本片文章根据bilibili <a href="https://www.bilibili.com/video/BV1LE411e7HE">vue源码分析</a> 视频练习及知识点记录</p><h2 id="模仿vue原理-实现简单的DOM模板替换"><a href="#模仿vue原理-实现简单的DOM模板替换" class="headerlink" title="模仿vue原理 实现简单的DOM模板替换"></a>模仿vue原理 实现简单的DOM模板替换</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      &#123;&#123;name&#125;&#125; is &#123;&#123;behavior&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>人员：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>行为：&#123;&#123;behavior&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;SoulReader&#x27;</span>,</span><br><span class="line">  <span class="attr">behavior</span>: <span class="string">&#x27;writing&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 惰性匹配 .+? 匹配所有包含在&#123;&#123;&#125;&#125;里面的元素分组</span></span><br><span class="line"><span class="comment">  * 贪婪匹配 .+ 匹配包含在&#123;&#123;&#125;&#125;里面的元素 会忽略中间的&#123;&#123;&#125;&#125;部分</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> curlyRE = <span class="regexp">/\&#123;\&#123;(.+?)\&#125;\&#125;/g</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compiler</span>(<span class="params">template, data</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> tempChilen = template.<span class="property">childNodes</span></span><br><span class="line">  <span class="keyword">const</span> length = tempChilen.<span class="property">length</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> nodeType = tempChilen[i].<span class="property">nodeType</span></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">      * nodeType</span></span><br><span class="line"><span class="comment">      * 1 代表元素节点</span></span><br><span class="line"><span class="comment">      * 2 代表文本节点</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span>(nodeType === <span class="number">3</span>) &#123; <span class="comment">// 代表是文本节点</span></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * nodeValue 只有文本节点才有，nodeName只有元素节点才有</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      tempChilen[i].<span class="property">nodeValue</span> = tempChilen[i].<span class="property">nodeValue</span>.<span class="title function_">replace</span>(curlyRE, <span class="function">(<span class="params">_, g</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">          * 第一个参数是正则表达式匹配到的东西</span></span><br><span class="line"><span class="comment">          * 第二个参数及以后是第 n-1 个分组</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">return</span> data[g.<span class="title function_">trim</span>()]</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(nodeType === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="title function_">compiler</span>(tempChilen[i], data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> node = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(node)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 不能直接用获取到的 node 因为 DOM 是引用类型</span></span><br><span class="line"><span class="comment">  * 需要利用 DOM 元素自带的 cloneNode 方法复制出一个新的node节点</span></span><br><span class="line"><span class="comment">  * 参数传 true 表示复制当前节点的所有子孙节点，否则只复制当前节点 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> copyNode = node.<span class="title function_">cloneNode</span>(<span class="literal">true</span>)</span><br><span class="line"><span class="title function_">compiler</span>(copyNode, data)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(copyNode)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 调用 DOM 元素自带的 replaceChild( newNode, oldNode) 替换子节点方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">app.<span class="property">parentNode</span>.<span class="title function_">replaceChild</span>(copyNode, node)</span><br></pre></td></tr></table></figure><blockquote><p><strong>模板</strong>   要求一直在内存中 <em>不会发生变化</em><br><strong>数据</strong>   数据发生变化后，会引起 DOM 的变化<br><strong>DOM</strong>    由模板和数据生成的<br><strong>页面</strong>   由 DOM 产生</p></blockquote><p>对 DOM 渲染方法进行封装</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      &#123;&#123;name&#125;&#125; &#123;&#123;behavior&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>人员：&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>行为：&#123;&#123;behavior&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  * Vue源码习惯</span></span><br><span class="line"><span class="comment">  * 1 内部的数据使用 _ 开头</span></span><br><span class="line"><span class="comment">  * 2 只读数据用 $ 开头</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LikeVue</span>(<span class="params">options</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_el</span> = options.<span class="property">el</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">_data</span> =  options.<span class="property">data</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$el</span> = <span class="variable language_">this</span>.<span class="property">_templateDOM</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="variable language_">this</span>.<span class="property">_el</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$parent</span> =  <span class="variable language_">this</span>.<span class="property">_templateDOM</span>.<span class="property">parentNode</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">render</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compiler</span>(<span class="params">template, data</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> tempChilen = template.<span class="property">childNodes</span></span><br><span class="line">  <span class="keyword">const</span> length = tempChilen.<span class="property">length</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> nodeType = tempChilen[i].<span class="property">nodeType</span></span><br><span class="line">    <span class="keyword">if</span>(nodeType === <span class="number">3</span>) &#123; <span class="comment">// 代表是文本节点</span></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * nodeValue 只有文本节点才有，nodeName只有元素节点才有</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      tempChilen[i].<span class="property">nodeValue</span> = tempChilen[i].<span class="property">nodeValue</span>.<span class="title function_">replace</span>(curlyRE, <span class="function">(<span class="params">_, g</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">          * 第一个参数是正则表达式匹配到的东西</span></span><br><span class="line"><span class="comment">          * 第二个参数及以后是第 n-1 个分组</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">return</span> data[g.<span class="title function_">trim</span>()]</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(nodeType === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="title function_">compiler</span>(tempChilen[i], data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渲染</span></span><br><span class="line"><span class="title class_">LikeVue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">render</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">compiler</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 编译</span></span><br><span class="line"><span class="title class_">LikeVue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">compiler</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> template = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="variable language_">this</span>.<span class="property">_el</span>)</span><br><span class="line">  <span class="title function_">compiler</span>(template, <span class="variable language_">this</span>.<span class="property">_data</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">update</span>(template)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 更新DOM</span></span><br><span class="line"><span class="title class_">LikeVue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">update</span> = <span class="keyword">function</span>(<span class="params">template</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$parent</span>.<span class="title function_">replaceChild</span>(template, <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="variable language_">this</span>.<span class="property">_el</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;优·库里伍德·海尔赛兹&#x27;</span>,</span><br><span class="line">    <span class="attr">behavior</span>: <span class="string">&#x27;吃橘子&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> curlyRE = <span class="regexp">/\&#123;\&#123;(.+?)\&#125;\&#125;/g</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Vue</span> = <span class="keyword">new</span> <span class="title class_">LikeVue</span>(options)</span><br></pre></td></tr></table></figure><p>对函数进行改造，使其能够转换DOM中多层嵌套的对象，例如<code>other.behavior.name</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改data对象里面的属性为多层嵌套</span></span><br><span class="line"><span class="attr">data</span>: &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;优·库里伍德·海尔赛兹&#x27;</span>,</span><br><span class="line">  <span class="attr">behavior</span>: <span class="string">&#x27;吃橘子&#x27;</span>,</span><br><span class="line">  <span class="attr">other</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;相川步&#x27;</span>,</span><br><span class="line">    <span class="attr">behavior</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;魔装少女&#x27;</span>,</span><br><span class="line">      <span class="attr">time</span>: <span class="string">&#x27;12min&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 新增一个函数用来处理模板中多层嵌套的对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">splitAttribute</span>(<span class="params">data, g</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> res = data</span><br><span class="line">  <span class="comment">// 1.</span></span><br><span class="line">  <span class="comment">// g.split(&#x27;.&#x27;).map(item =&gt; &#123;</span></span><br><span class="line">  <span class="comment">// 当对一个变量赋值对象时，是对象的引用，变量中的某个值发生变化，对象中对应的值也会发生变化</span></span><br><span class="line">  <span class="comment">// 但是给变量重新赋值对象，并不会造成原先对象的值发生变化，因为此时变量的引用已经发生变化，不在指向源对象</span></span><br><span class="line">  <span class="comment">//   res = res[item]</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//2.</span></span><br><span class="line">  <span class="keyword">let</span> paths = g.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">  <span class="keyword">let</span> prop</span><br><span class="line">  <span class="keyword">while</span>(prop = paths.<span class="title function_">shift</span>()) &#123;</span><br><span class="line">    res = res[prop]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 修改正则表达式替换函数的回调函数的返回值</span></span><br><span class="line">tempChilen[i].<span class="property">nodeValue</span> = tempChilen[i].<span class="property">nodeValue</span>.<span class="title function_">replace</span>(curlyRE, <span class="function">(<span class="params">_, g</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">splitAttribute</span>(data, g.<span class="title function_">trim</span>())</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>函数柯里化</strong></p><p>  目的是为了缓存一些内容，减少解析</p><ul><li>柯里化: 一个函数原本有多个参数，传入一个参数，生成一个新函数，由新函数来接收剩余的参数，运行得到结果</li><li>偏函数: 一个函数原本有多个参数，传入一部分参数，生成一个新函数，由新函数来接收剩余的参数，运行得到结果</li><li>高阶函数: 一个函数，参数是一个函数，该函数对参数函数进行加工，得到加工后的函数<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createSplitAttribute</span>(<span class="params">g</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> paths = g.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">splitAttribute</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> res = data</span><br><span class="line">    <span class="comment">// g.split(&#x27;.&#x27;).map(item =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//   res = res[item]</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="comment">//2.</span></span><br><span class="line">    <span class="keyword">let</span> prop</span><br><span class="line">    <span class="keyword">while</span>(prop = paths.<span class="title function_">shift</span>()) &#123;</span><br><span class="line">      <span class="comment">// 当对一个变量赋值对象时，是对象的引用，变量中的某个值发生变化，对象中对应的值也会发生变化</span></span><br><span class="line">      <span class="comment">// 但是给变量重新赋值对象，并不会造成原先对象的值发生变化，因为此时变量的引用已经发生变化，不在指向源对象</span></span><br><span class="line">      res = res[prop]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line"><span class="keyword">const</span> split = <span class="title function_">createSplitAttribute</span>(g.<span class="title function_">trim</span>())</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">split</span>(data)</span><br></pre></td></tr></table></figure></li></ul><h4 id="虚拟DOM"><a href="#虚拟DOM" class="headerlink" title="虚拟DOM"></a>虚拟DOM</h4><p>  思路和深拷贝类似</p><ol><li><p>将 真正的DOM 转化为 虚拟DOM</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 虚拟DOM 减少了回流和重绘 提高了速度</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  * &lt;div /&gt; =&gt; &#123;tag: &#x27;div&#x27;&#125;</span></span><br><span class="line"><span class="comment">  * &lt;div title=&quot;1&quot; class=&quot;c&quot; /&gt; =&gt; &#123;tag: &#x27;div&#x27;,data: &#123;title: &#x27;1&#x27;, class: &#x27;c&#x27;&#125;&#125;</span></span><br><span class="line"><span class="comment">  * &lt;div&gt;&lt;div /&gt;&lt;/div&gt; =&gt; &#123;tag: &#x27;div&#x27;, children: [&#123;tag: &#x27;div&#x27;&#125;]&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VNode</span> &#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * tag: node.nodeValue</span></span><br><span class="line"><span class="comment">    * data: node.attributes =&gt; obj =&gt; &#123;node.attribute.nodeName: node.attribute.nodeValue&#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">tag, data, value, type</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tag</span> = tag &amp;&amp; tag.<span class="title function_">toLowerCase</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">data</span> = data</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">children</span> = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">appendCild</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">children</span>.<span class="title function_">push</span>(vnode)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// node 为页面中真实的 DOM 节点</span></span><br><span class="line"><span class="comment">// 使用递归的方法提取出 DOM 节点中所有的子孙节点</span></span><br><span class="line"><span class="comment">// Vue源码中使用 栈 的方式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getVnode</span>(<span class="params">node</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> nodeType = node.<span class="property">nodeType</span></span><br><span class="line">  <span class="keyword">let</span> _vnode = <span class="literal">null</span></span><br><span class="line">  <span class="comment">// 判断nodeType类型</span></span><br><span class="line">  <span class="keyword">if</span>(nodeType === <span class="number">1</span>) &#123; <span class="comment">// 元素节点</span></span><br><span class="line">    <span class="keyword">let</span> nodeName = node.<span class="property">nodeName</span></span><br><span class="line">    <span class="comment">// 获取 node 元素的 所有 attribute 属性， 是一个伪数组，需要转换成 对象</span></span><br><span class="line">    <span class="keyword">let</span> attrs = node.<span class="property">attributes</span></span><br><span class="line">    <span class="keyword">let</span> _attrs = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; attrs.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      _attrs[attrs[i].<span class="property">nodeName</span>] = attrs[i].<span class="property">nodeValue</span></span><br><span class="line">    &#125;</span><br><span class="line">    _vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(nodeName, _attrs, <span class="literal">undefined</span>, nodeType)</span><br><span class="line">    <span class="comment">// 然后处理元素节点的所有自节点</span></span><br><span class="line">    <span class="keyword">let</span> childNodes = node.<span class="property">childNodes</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; childNodes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      _vnode.<span class="title function_">appendCild</span>(<span class="title function_">getVnode</span>(childNodes[i]))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(nodeType === <span class="number">3</span>) &#123; <span class="comment">// 文本节点</span></span><br><span class="line">    <span class="comment">// 文本节点没有 tag 属性 data属性</span></span><br><span class="line">    _vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(<span class="literal">undefined</span>, <span class="literal">undefined</span>, node.<span class="property">nodeValue</span>, nodeType)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _vnode</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> app = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> app1 = <span class="title function_">getVnode</span>(app)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(app1)</span><br></pre></td></tr></table></figure></li><li><p>将 虚拟DOM 转化为 真正的DOM</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">parseVnode</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;tag, data, type, value, children&#125; = vnode</span><br><span class="line">  <span class="keyword">let</span> dom = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">if</span>(type === <span class="number">1</span>) &#123;</span><br><span class="line">    dom = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(tag)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">      dom.<span class="title function_">setAttribute</span>(key, data[key])</span><br><span class="line">    &#125;</span><br><span class="line">    dom.<span class="property">nodeType</span> = type</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="comment">// dom.append(parseVnode(children[i]))</span></span><br><span class="line">      dom.<span class="title function_">appendChild</span>(<span class="title function_">parseVnode</span>(children[i]))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(type === <span class="number">3</span>) &#123;</span><br><span class="line">    dom = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(tag)</span><br><span class="line">    dom.<span class="property">nodeValue</span> = value</span><br><span class="line">    dom.<span class="property">nodeType</span> = type</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dom</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> dom = <span class="title function_">parseVnode</span>(app1)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dom, <span class="string">&#x27;dom&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本片文章根据bilibili &lt;a href=&quot;https://www.bilibili.com/video/BV1LE411e7HE&quot;&gt;vue源码分析&lt;/a&gt; 视频练习及知识点记录&lt;/p&gt;
&lt;h2 id=&quot;模仿vue原理-实现简单的DOM模板替换&quot;&gt;&lt;a href=&quot;#模</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>vue-源码</title>
    <link href="https://lxx1997.github.io/2020/12/15/vue/vue-%E6%BA%90%E7%A0%81%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <id>https://lxx1997.github.io/2020/12/15/vue/vue-%E6%BA%90%E7%A0%81%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/</id>
    <published>2020-12-15T01:34:37.000Z</published>
    <updated>2020-12-15T01:34:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>本片文章只用于引导自己如何对源码进行探索，因为看到源码的时候是一脸懵逼，完全不知道该从那个地方看起，所以用本篇文章记录一下自己的解读顺序，以免自己忘记</p><h4 id="LIFECYCLE-HOOKS"><a href="#LIFECYCLE-HOOKS" class="headerlink" title="LIFECYCLE_HOOKS"></a>LIFECYCLE_HOOKS</h4><p>  vue 钩子函数</p><blockquote><p>beforeCreate<br>created<br>beforeMounte<br>mounted<br>beforeUpdate<br>updated<br>beforeDestory<br>destoryed<br>activated<br>deactivated<br>errorCaptured<br>serverPrefetch</p></blockquote><h3 id="SOME-USERFUL-METHODS"><a href="#SOME-USERFUL-METHODS" class="headerlink" title="SOME USERFUL METHODS"></a>SOME USERFUL METHODS</h3><ul><li>判断浏览器类型<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/vue-template-compiler/browser.js</span></span><br><span class="line"><span class="keyword">var</span> inBrowser = <span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&#x27;undefined&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> inWeex = <span class="keyword">typeof</span> <span class="title class_">WXEnvironment</span> !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; !!<span class="title class_">WXEnvironment</span>.<span class="property">platform</span>;</span><br><span class="line"><span class="keyword">var</span> weexPlatform = inWeex &amp;&amp; <span class="title class_">WXEnvironment</span>.<span class="property">platform</span>.<span class="title function_">toLowerCase</span>();</span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">UA</span> = inBrowser &amp;&amp; <span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="property">userAgent</span>.<span class="title function_">toLowerCase</span>();</span><br><span class="line"><span class="keyword">var</span> isIE = <span class="variable constant_">UA</span> &amp;&amp; <span class="regexp">/msie|trident/</span>.<span class="title function_">test</span>(<span class="variable constant_">UA</span>);</span><br><span class="line"><span class="keyword">var</span> isIE9 = <span class="variable constant_">UA</span> &amp;&amp; <span class="variable constant_">UA</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;msie 9.0&#x27;</span>) &gt; <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> isEdge = <span class="variable constant_">UA</span> &amp;&amp; <span class="variable constant_">UA</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;edge/&#x27;</span>) &gt; <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> isAndroid = (<span class="variable constant_">UA</span> &amp;&amp; <span class="variable constant_">UA</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;android&#x27;</span>) &gt; <span class="number">0</span>) || (weexPlatform === <span class="string">&#x27;android&#x27;</span>);</span><br><span class="line"><span class="comment">// Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1</span></span><br><span class="line"><span class="keyword">var</span> isIOS = (<span class="variable constant_">UA</span> &amp;&amp; <span class="regexp">/iphone|ipad|ipod|ios/</span>.<span class="title function_">test</span>(<span class="variable constant_">UA</span>)) || (weexPlatform === <span class="string">&#x27;ios&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> isChrome = <span class="variable constant_">UA</span> &amp;&amp; <span class="regexp">/chrome\/\d+/</span>.<span class="title function_">test</span>(<span class="variable constant_">UA</span>) &amp;&amp; !isEdge;</span><br><span class="line"><span class="keyword">var</span> isPhantomJS = <span class="variable constant_">UA</span> &amp;&amp; <span class="regexp">/phantomjs/</span>.<span class="title function_">test</span>(<span class="variable constant_">UA</span>);</span><br><span class="line"><span class="keyword">var</span> isFF = <span class="variable constant_">UA</span> &amp;&amp; <span class="variable constant_">UA</span>.<span class="title function_">match</span>(<span class="regexp">/firefox\/(\d+)/</span>);</span><br></pre></td></tr></table></figure></li></ul><h4 id="makeMap"><a href="#makeMap" class="headerlink" title="makeMap"></a>makeMap</h4><p>  创建一个闭包判断函数，判断元素是否存在</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/vue-template-compiler/build.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">makeMap</span> (str, expectsLowerCase) &#123;</span><br><span class="line">  <span class="keyword">var</span> map = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">var</span> list = str.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    map[list[i]] = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> expectsLowerCase</span><br><span class="line">    ? <span class="keyword">function</span> (<span class="params">val</span>) &#123; <span class="keyword">return</span> map[val.<span class="title function_">toLowerCase</span>()]; &#125;</span><br><span class="line">    : <span class="keyword">function</span> (<span class="params">val</span>) &#123; <span class="keyword">return</span> map[val]; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isBuiltInTag = <span class="title function_">makeMap</span>(<span class="string">&#x27;slot,component&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="title function_">isBuiltInTag</span>(<span class="string">&#x27;slot&#x27;</span>) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h4>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/vue-template-compiler/build.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">remove</span> (arr, item) &#123;</span><br><span class="line">  <span class="keyword">if</span> (arr.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> index = arr.<span class="title function_">indexOf</span>(item);</span><br><span class="line">    <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> arr.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">set</span> (target, key, val) &#123;</span><br><span class="line">  <span class="comment">// 判断传入的 target 是否是 undefined 类型或者基础数据类型</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isUndef</span>(target) || <span class="title function_">isPrimitive</span>(target)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="title function_">warn</span>((<span class="string">&quot;Cannot set reactive property on undefined, null, or primitive value: &quot;</span> + ((target))));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断 target 是否是数组，以及 key 是否一个正常的数组序号</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(target) &amp;&amp; <span class="title function_">isValidArrayIndex</span>(key)) &#123;</span><br><span class="line">    target.<span class="property">length</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(target.<span class="property">length</span>, key);</span><br><span class="line">    <span class="comment">// 在数组的 key 位替换成 val</span></span><br><span class="line">    target.<span class="title function_">splice</span>(key, <span class="number">1</span>, val);</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// target 为对象的话且 key 不是 Object 的属性，避免修改 Object 的属性，造成对象污染</span></span><br><span class="line">  <span class="keyword">if</span> (key <span class="keyword">in</span> target &amp;&amp; !(key <span class="keyword">in</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>)) &#123;</span><br><span class="line">    target[key] = val;</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 每个被双向绑定的 数据 都有一个 __ob__ 对象</span></span><br><span class="line">  <span class="keyword">var</span> ob = (target).<span class="property">__ob__</span>;</span><br><span class="line">  <span class="comment">// 如果 target 对象是 Vue 实例 或者 ob有值，则禁止向 Vue 实例上添加动态响应式属性</span></span><br><span class="line">  <span class="keyword">if</span> (target.<span class="property">_isVue</span> || (ob &amp;&amp; ob.<span class="property">vmCount</span>)) &#123;</span><br><span class="line">    <span class="title function_">warn</span>(</span><br><span class="line">      <span class="string">&#x27;Avoid adding reactive properties to a Vue instance or its root $data &#x27;</span> +</span><br><span class="line">      <span class="string">&#x27;at runtime - declare it upfront in the data option.&#x27;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果不是 Vue 实例 直接添加属性</span></span><br><span class="line">  <span class="keyword">if</span> (!ob) &#123;</span><br><span class="line">    target[key] = val;</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 在对象上定义被动特性</span></span><br><span class="line">  <span class="title function_">defineReactive$$1</span>(ob.<span class="property">value</span>, key, val);</span><br><span class="line">  <span class="comment">// 触发 通知事件</span></span><br><span class="line">  ob.<span class="property">dep</span>.<span class="title function_">notify</span>();</span><br><span class="line">  <span class="keyword">return</span> val</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本片文章只用于引导自己如何对源码进行探索，因为看到源码的时候是一脸懵逼，完全不知道该从那个地方看起，所以用本篇文章记录一下自己的解读顺序，以免自己忘记&lt;/p&gt;
&lt;h4 id=&quot;LIFECYCLE-HOOKS&quot;&gt;&lt;a href=&quot;#LIFECYCLE-HOOKS&quot; class</summary>
      
    
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/categories/Vue/"/>
    
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
    <category term="SourceCode" scheme="https://lxx1997.github.io/tags/SourceCode/"/>
    
  </entry>
  
  <entry>
    <title>H5基于canvas实现电子签名并生成PDF文档</title>
    <link href="https://lxx1997.github.io/2020/12/14/web/H5%E5%9F%BA%E4%BA%8Ecanvas%E5%AE%9E%E7%8E%B0%E7%94%B5%E5%AD%90%E7%AD%BE%E5%90%8D%E5%B9%B6%E7%94%9F%E6%88%90PDF%E6%96%87%E6%A1%A3/"/>
    <id>https://lxx1997.github.io/2020/12/14/web/H5%E5%9F%BA%E4%BA%8Ecanvas%E5%AE%9E%E7%8E%B0%E7%94%B5%E5%AD%90%E7%AD%BE%E5%90%8D%E5%B9%B6%E7%94%9F%E6%88%90PDF%E6%96%87%E6%A1%A3/</id>
    <published>2020-12-14T09:15:09.000Z</published>
    <updated>2020-12-14T09:15:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>转载<a href="https://mp.weixin.qq.com/s/OTFufemlMW7XhjS2zIrHhw">前端大全</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>电子签名通俗来说就是通过技术手段实现在电子文档上加载电子形式的签名，其作用类似于纸质合同上的手写签名或加盖的公章。虽然电子签名多年来合法性一直遭到质疑，但其在企业工作流审批、请柬、单据保全等场景应用广泛，最近的项目中就有这样一个手写签名并生成PDF文件的需求。</p><h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><p>使用canvas来实现手写签名的功能，然后将canvas转化为图片，贴在签名的位置；<br>将整个需要生成文档的dom区域使用html2canvas插件转成一张大图；<br>使用JsPDF插件将上述图片生成PDF文档；<br>对于文件内容较多的情况，需要合理选择分页位置；<br>生成签名</p><ol><li><p>在tsx中定义canvas画布</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">className</span>=<span class="string">&#123;styles.canvas&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;canvasDom&#125;</span> <span class="attr">width</span>=<span class="string">&quot;350&quot;</span> <span class="attr">height</span>=<span class="string">&quot;150&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>注意：Canvas的宽高必须要使用内联样式定义，这是因为Canvas标签有自己的默认宽高300px×150px。它内联样式定义的width和height是绘画区域（画布）实际宽度和高度，绘制的图形都是在这个上面。如果在style外链文件中定义其width和height，那么这个width和height是Canvas在浏览器中被渲染的高度和宽度。如果Canvas中没有直接定义width和height没或值不正确，就会被设置成默认值{width:300px，height:150px}。所以，如果你在style中外链文件中设置了canvas {width: 200px; height: 200px;}，却没有直接在canvas上定义画布宽高，那么此时你输出canvas.height 值依旧为150，canvas.width值依旧为300。也就是一块150×300的画布在200×200的区域渲染，因而图片会出现拉伸、变形等现象。</p></li><li><p>定义签名函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">writing</span> = (<span class="params"></span></span><br><span class="line"><span class="params">   beginX: number,</span></span><br><span class="line"><span class="params">   beginY: number,</span></span><br><span class="line"><span class="params">   stopX: number,</span></span><br><span class="line"><span class="params">   stopY: number,</span></span><br><span class="line"><span class="params">   ctx: any,</span></span><br><span class="line"><span class="params"> </span>) =&gt; &#123;</span><br><span class="line">   ctx.<span class="title function_">beginPath</span>();  <span class="comment">// 开启一条新路径</span></span><br><span class="line">   ctx.<span class="property">globalAlpha</span> = <span class="number">1</span>;  <span class="comment">// 设置图片的透明度</span></span><br><span class="line">   ctx.<span class="property">lineWidth</span> = <span class="number">3</span>;  <span class="comment">// 设置线宽</span></span><br><span class="line">   ctx.<span class="property">strokeStyle</span> = <span class="string">&#x27;red&#x27;</span>;  <span class="comment">// 设置路径颜色</span></span><br><span class="line">   ctx.<span class="title function_">moveTo</span>(beginX, beginY);  <span class="comment">// 从(beginX, beginY)这个坐标点开始画图</span></span><br><span class="line">   ctx.<span class="title function_">lineTo</span>(stopX, stopY);  <span class="comment">// 定义从(beginX, beginY)到(stopX, stopY)的线条（该方法不会创建线条）</span></span><br><span class="line">   ctx.<span class="title function_">closePath</span>();  <span class="comment">// 创建该条路径</span></span><br><span class="line">   ctx.<span class="title function_">stroke</span>();  <span class="comment">// 实际地绘制出通过 moveTo() 和 lineTo() 方法定义的路径。默认颜色是黑色。</span></span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure></li><li>注册监听事件<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">beginX</span>: number, <span class="attr">beginY</span>: number;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">canvas</span>: <span class="title class_">HTMLCanvasElement</span> = canvasDom.<span class="property">current</span>;</span><br><span class="line"><span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;#fff&#x27;</span>;</span><br><span class="line">ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span><br><span class="line">canvas.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchstart&#x27;</span>, <span class="keyword">function</span>(<span class="params">event: any</span>) &#123;</span><br><span class="line">  event.<span class="title function_">preventDefault</span>(); <span class="comment">// 阻止在canvas画布上签名的时候页面跟着滚动</span></span><br><span class="line">  beginX = event.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">clientX</span> - <span class="variable language_">this</span>.<span class="property">offsetLeft</span>; </span><br><span class="line">  beginY = event.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">pageY</span> - <span class="variable language_">this</span>.<span class="property">offsetTop</span>;</span><br><span class="line">&#125;);</span><br><span class="line">canvas.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchmove&#x27;</span>, <span class="function">(<span class="params">event: any</span>) =&gt;</span> &#123;</span><br><span class="line">  event.<span class="title function_">preventDefault</span>(); <span class="comment">// 阻止在canvas画布上签名的时候页面跟着滚动</span></span><br><span class="line">  event = event.<span class="property">touches</span>[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">let</span> stopX = event.<span class="property">clientX</span> - canvas.<span class="property">offsetLeft</span>;</span><br><span class="line">  <span class="keyword">let</span> stopY = event.<span class="property">pageY</span> - canvas.<span class="property">offsetTop</span>;</span><br><span class="line">  <span class="title function_">writing</span>(beginX, beginY, stopX, stopY, ctx);</span><br><span class="line">  beginX = stopX; <span class="comment">// 这一步很关键，需要不断更新起点，否则画出来的是射线簇</span></span><br><span class="line">  beginY = stopY;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>注意：</li></ol><p>在注册“touchstart”和“touchmove”事件时，需要阻止默认事件，否则页面会跟着手势上下滑动。<br>移动端的每个触摸事件对象中都包括了touches这个属性，它用于描述位于屏幕上的所有手指的一个列表，获取当前事件对象我们习惯性的使用event = event.touches[0],而在PC端则不需要这么操作。<br>offsetLeft值跟offsetTop值跟父级元素没关系，而是跟其上一级的定位元素(除position:static外的所有定位如fixed,relative,absolute元素)有关系。若上一级定位元素都没有除position:staice外的定位，则这个偏移量是相对于body而言的。<br>需要理清移动端事件对象的几个属性，⏬<br><img src="/assets/blogImg/h5-canvas-electric-sign2pdf-2.jpg" alt="图片"><br>clientX/clientY: 触摸位置距离当前body可视区域的x,y坐标;<br>pageX/pageY: 对于整个页面来说，触摸位置距离body左上角的x,y坐标，包括被scrollTop和scrollLeft的值；<br>screenX/screenY: 触摸位置距离显示器左边和顶部的x,y距离。<br>所以，在获取结束点坐标的时候，如果当前页面没有出现滚动条，使用clientY和pageY计算差别不大，如果页面比较长，出现了滚动条，那么就必须要使用pageY来计算。clientX同理，但是移动端通常横向滚动的场景不多，所以用clientX来计算即可。</p><p>在签名（touchmove）这个动作过程中，我们需要不断的更新起点位置，否则画出来是这样🔽<br><img src="/assets/blogImg/h5-canvas-electric-sign2pdf1.jpg" alt="图片"><br>图片其实这个原理和微积分很相似，线段本质上就是由无穷多个小线段组成，宏观一点来看可以把线段当成一个个长度很小的小线段首尾相连构成。所以我一直觉得编程编到最后就是考验一个人的数学能力，交并集、逻辑思维、算法等都能看到数学的身影。最后生成签名如下：图片<br><img src="/assets/blogImg/h5-canvas-electric-sign2pdf.png" alt="图片"></p><p>生成PDF文档<br>html2canvas是一款将HTML代码转换成Canvas的插件，因此需要用一个div包裹住需要打印的内容区域，获得这个dom节点。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">html2Canvas</span>(dom, &#123;</span><br><span class="line">  <span class="attr">allowTaint</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">width</span>: dom.<span class="property">offsetWidth</span>, <span class="comment">//设置获取到的canvas宽度</span></span><br><span class="line">  <span class="attr">height</span>: dom.<span class="property">offsetHeight</span>, <span class="comment">//设置获取到的canvas高度</span></span><br><span class="line">  <span class="attr">x</span>: <span class="number">0</span>, <span class="comment">//页面在水平方向滚动的距离</span></span><br><span class="line">  <span class="attr">y</span>: <span class="number">0</span>, <span class="comment">//页面在垂直方向滚动的距离</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br>注意：此处需要设置width和height及x,y，否则当页面内容只有一页的时候没有问题，但是若页面内容有很多页的时候，就会出现生成的图片只有一小部分有内容的现象。问题就出现在这个配置参数上，若没有设置宽高，则默认只取当前视口的内容，丢弃掉其他超出当前视口的内容。<br>设置打印参数：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">print</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">dom</span>: <span class="title class_">HTMLElement</span> = pdfDom.<span class="property">current</span>;</span><br><span class="line">    <span class="title function_">html2Canvas</span>(dom, &#123;</span><br><span class="line">      <span class="attr">allowTaint</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">width</span>: dom.<span class="property">offsetWidth</span>, <span class="comment">//设置获取到的canvas宽度</span></span><br><span class="line">      <span class="attr">height</span>: dom.<span class="property">offsetHeight</span>, <span class="comment">//设置获取到的canvas高度</span></span><br><span class="line">      <span class="attr">x</span>: <span class="number">0</span>, <span class="comment">//页面在水平方向滚动的距离</span></span><br><span class="line">      <span class="attr">y</span>: <span class="number">0</span>, <span class="comment">//页面在垂直方向滚动的距离</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">canvas: HTMLCanvasElement</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> canvasWidth = canvas.<span class="property">width</span>;</span><br><span class="line">      <span class="keyword">let</span> canvasHeight = canvas.<span class="property">height</span>;</span><br><span class="line">      <span class="keyword">let</span> pageHeight = (canvasWidth / <span class="number">592.28</span>) * <span class="number">841.89</span>; <span class="comment">// 一页A4 pdf能显示的canvas高度</span></span><br><span class="line">      <span class="keyword">let</span> imgWidth = <span class="number">595.28</span>; <span class="comment">// 设置图片宽度和A4纸宽度相等</span></span><br><span class="line">      <span class="keyword">let</span> imgHeight = (<span class="number">592.28</span> / canvasWidth) * canvasHeight;<span class="comment">//等比例换算成A4纸的高度</span></span><br><span class="line">      <span class="keyword">let</span> totalHeight = imgHeight; <span class="comment">// 需要打印的图片总高度，初始状态和图片高度相等</span></span><br><span class="line">      <span class="keyword">let</span> pageData = canvas.<span class="title function_">toDataURL</span>(<span class="string">&#x27;image/png&#x27;</span>, <span class="number">1.0</span>);</span><br><span class="line">      <span class="keyword">let</span> <span class="variable constant_">PDF</span> = <span class="keyword">new</span> <span class="title class_">JsPDF</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;pt&#x27;</span>, <span class="string">&#x27;a4&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">      <span class="keyword">if</span> (totalHeight &lt; pageHeight) &#123; <span class="comment">//</span></span><br><span class="line">        <span class="variable constant_">PDF</span>.<span class="title function_">addImage</span>(pageData, <span class="string">&#x27;JPEG&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>, imgWidth, imgHeight); <span class="comment">// 从顶部开始打印</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> top = <span class="number">0</span>;   <span class="comment">// 打印初始区域</span></span><br><span class="line">        <span class="keyword">while</span> (totalHeight &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="variable constant_">PDF</span>.<span class="title function_">addImage</span>(pageData, <span class="string">&#x27;JPEG&#x27;</span>, <span class="number">0</span>, top, imgWidth, imgHeight);  <span class="comment">// 从图片顶部往下top位置开始打印</span></span><br><span class="line">          totalHeight -= pageHeight;</span><br><span class="line">          top -= <span class="number">841.89</span>;</span><br><span class="line">          <span class="keyword">if</span> (totalHeight &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable constant_">PDF</span>.<span class="title function_">addPage</span>();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable constant_">PDF</span>.<span class="title function_">save</span>(<span class="string">&#x27;test.pdf&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><br>选择分页位置</p><p>按照上述步骤生成了一份PDF文档，但是当PDF页数有很多的时候，会有这样的问题<br><img src="/assets/blogImg/h5-canvas-electric-sign2pdf3.png" alt="图片"><br>可以看到，分页的时候从这段文字这里懒腰截断了。这显然不是我们想要看到的效果，如何解决这个问题呢？🤔</p><p>PDF文档页数较少的情况<br>可以在开发测试的时候预先在将要分页的地方插入一个padding，就是提前预留分页位置</p><p>PDF文档页数较多<br>对于这种情况，笔者尝试遍历要打印的dom节点的子节点，将每一页所能打印的dom节点高度累加，若超过了页面所能承载的最大高度，则将最后一个节点增加padding，打印完毕将样式还原。这种方法因为要计算每个dom节点的高度，非常耗性能，也要求页面dom元素的颗粒度较细，否则会出现一个页面有大块空白，完全无法模拟出word生成pdf的那种效果，所以就不展开讨论了。如若有读者有比较好的解放方案，欢迎不吝赐教，感谢~❤️</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;转载&lt;a href=&quot;https://mp.weixin.qq.com/s/OTFufemlMW7XhjS2zIrHhw&quot;&gt;前端大全&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="canvas" scheme="https://lxx1997.github.io/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>前端性能优化 - 转载</title>
    <link href="https://lxx1997.github.io/2020/12/11/web/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/"/>
    <id>https://lxx1997.github.io/2020/12/11/web/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/</id>
    <published>2020-12-11T03:05:09.000Z</published>
    <updated>2020-12-11T03:05:09.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>当我们去面试的时候，很大概率会被面试官问这么一个问题：你有尝试过对项目做性能优化吗？或者你了解哪些性能优化的方法？听到这个问题的你可能是这样的：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8k580cRvJ945MQvNe17e1aoNE1ys4KNRheWzhxm2gzXvRrcVg1N4Yuw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>似曾相识但又说不清楚，往往只能零散地说出那么几点，难以做到有条理的回答。那么，本文就带你简单了解前端性能优化的几个主要方面，旨在抛砖引玉。</p><h2 id="一、资源的合并和压缩"><a href="#一、资源的合并和压缩" class="headerlink" title="一、资源的合并和压缩"></a>一、资源的合并和压缩</h2><p><code>web</code>前端应用的开发与部署过程：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8z3geDgo44h6jSG8M0Q5ByPwl6AIfQHyZ01cqRmmt6hCzxXh017eiasg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>输入<code>url</code>到页面显示出来的过程：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8qcxKutTDXVA2qT7SNWGoialdnjXaibnLEwh8UAZw8zKwN5Wcj7DF3jMA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>请求过程中一些潜在的性能优化点：</p><ul><li><code>dns</code>是否可以通过缓存减少<code>dns</code>查询时间？</li><li>网络请求的过程如何走最近的网络环境？</li><li>相同的静态资源是否可以缓存？</li><li>能否减少<code>http</code>请求的大小和次数？</li><li>能否进行服务端渲染？</li></ul><p><strong>总结：</strong>深入理解<code>http</code>请求的过程是前端性能优化的核心。</p><p><strong>优化核心</strong></p><ul><li>减少<code>http</code>请求数量；</li><li>减少请求资源的大小；</li></ul><p><strong><code>google</code>首页案例学习</strong></p><ul><li><code>html</code>压缩；</li><li><code>css</code>压缩；</li><li><code>js</code>的压缩和混乱；</li><li>文件合并；</li><li>开启<code>gzip</code>；</li></ul><h3 id="1-html压缩"><a href="#1-html压缩" class="headerlink" title="1.html压缩"></a>1.<code>html</code>压缩</h3><p><code>HTML</code>代码压缩就是压缩一些在文本文件中有意义，但是在<code>HTML</code>中<strong>不显示</strong>的字符，包括<strong>空格</strong>，<strong>制表符</strong>，<strong>换行符</strong>等，还有一些其他意义的字符，如<strong><code>HTML</code>注释</strong>也可以被压缩；</p><p><strong>一个简单的计算：</strong></p><p><code>google</code>的流量，占到整个互联网的<code>40%</code>，预计<code>2016</code>年全球网络流量将达到<code>1.3ZB(1ZB = 10^9TB)</code>，那么<code>google</code>在<code>2016</code>年的流量就是<code>1.3ZB * 40%</code>，如果<code>google</code>每<code>1MB</code>请求减少一个字节，<strong>每年可以节省流量近<code>500TB</code></strong>流量。</p><p><strong>如何进行<code>html</code>压缩</strong></p><ul><li>使用在线网站进行压缩；</li><li><code>nodejs</code>提供的<code>html-minifier</code>工具；</li><li>后端模板引擎渲染压缩；</li></ul><h3 id="2-css代码压缩"><a href="#2-css代码压缩" class="headerlink" title="2.css代码压缩"></a>2.<code>css</code>代码压缩</h3><p>分为两部分：</p><ul><li>无效代码的压缩；</li><li><code>css</code>语义合并；</li></ul><p><strong>如何进行<code>css</code>压缩</strong></p><ul><li>使用在线网站进行压缩；</li><li>使用<code>html-minifier</code>对<code>html</code>中的<code>css</code>进行压缩；</li><li>使用<code>clean-css</code>对<code>css</code>进行压缩；</li></ul><h3 id="3-js压缩与混乱（丑化）"><a href="#3-js压缩与混乱（丑化）" class="headerlink" title="3.js压缩与混乱（丑化）"></a>3.<code>js</code>压缩与混乱（丑化）</h3><p>包括：</p><ul><li>无效字符的删除（空格，回车等）；</li><li>剔除注释；</li><li>代码语义的缩减和优化；</li><li>代码保护（如果代码不经处理，客户端可直接窥探代码漏洞）；</li></ul><p><strong><code>JS</code>压缩与混乱（丑化）</strong></p><ul><li>使用在线网站进行压缩：<a href="https://tool.oschina.net/jscompress/">https://tool.oschina.net/jscompress/</a></li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8aRqqP3nFCMx7mobhsf1ib5kiaBmiaKibBib2ZdtIftRgFNnP6rJGXoEiaBGw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><ul><li>使用<code>html-minifier</code>对<code>html</code>中的<code>js</code>进行压缩；</li><li>使用<code>uglify.js2</code>对<code>js</code>进行压缩；</li></ul><h3 id="4-文件合并"><a href="#4-文件合并" class="headerlink" title="4.文件合并"></a>4.文件合并</h3><p>文件合并的好处：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8Ubw2T1JmX9beDL26k6eKvs2wejn9oYIu3XIhEHPsmArKm6NXlZD8Rg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>左边的表示使用<code>http</code>长链接<code>keep-alive</code>但不合并请求的情况，需要分三次去获取<code>a.js</code>、<code>b.js</code>、<code>c.js</code>；右边是使用长链接并且合并请求的情况，只需要发送一次获取合并文件<code>a-b-c.js</code>的请求，就能将三个文件都请求回来。</p><p>不合并请求有下列缺点：</p><ul><li>文件与文件之间有插入的上行请求，会增加<code>N-1</code>个网络延迟；</li><li>受丢包问题的影响更严重：因为每次请求都可能出现丢包的情况，减少请求能有效减少丢包情况；</li><li><code>keep-alive</code>本身也存在问题：经过代理服务器时可能会被断开；</li></ul><p><strong>文件合并存在的问题</strong></p><ul><li>首屏渲染问题：当请求<code>js</code>文件的时候，如果页面渲染只依赖<code>a.js</code>文件，由于文件合并，需要等待合并后的<code>a-b-c.js</code>文件请求回来才能继续渲染，这样就会导致页面渲染速度变慢。这种情况大多出现在现代化的前端框架，如<code>Vue</code>等的使用过程中；</li><li>缓存失效问题：合并后的文件<code>a-b-c.js</code>中只要其中一个文件（比如<code>a.js</code>）发生变化，那么整个合并文件都将失效，而不采用文件合并就不会出现这种情况；</li></ul><p><strong>使用建议</strong></p><ul><li>公共库合并：将不经常发生变化的公共组件库文件进行合并；</li><li>将不同页面的<code>js</code>文件单独合并：比如在单页面应用<code>SPA</code>中，当路由跳转到具体的页面时才请求该页面需要的<code>js</code>文件；</li></ul><p><strong>如何进行文件合并</strong></p><ul><li>使用在线网站进行文件合并；</li><li>使用<code>nodejs</code>实现文件合并；</li><li>使用<code>webpack</code>等前端构件化工具也可以很好地实现；</li></ul><h2 id="二、图片相关的优化"><a href="#二、图片相关的优化" class="headerlink" title="二、图片相关的优化"></a>二、图片相关的优化</h2><p><strong>有损压缩过程：</strong></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8ljyia0zwJAgNDUtzqBex0hib7BRiadictqAlr6s6sODyPDVVU8d1rMzZTA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>一张<code>JPG</code>图片的解析分别要进行：</p><ul><li>颜色空间的转换：从<code>RGB</code>的颜色空间转到其他的颜色空间 ；</li><li>进行重采样：区分高频和低频的颜色变换；</li><li>进行<code>DCT</code>过程：对高频的颜色采样结果进行压缩，这样压缩的收益会比较大；</li><li>再对数据进行量化；</li><li>最后进行编码（<code>encoding</code>）；</li></ul><p>最终得到<code>JPEG-Compressed Image Data</code>，即真正显示出来的<code>JPG</code>图片。虽然这是一种有损压缩，但是很多情况下，这些损失的数据并不影响显示；</p><p><strong><code>png8/png24/png32</code>之间的区别</strong></p><ul><li><code>png8</code>：<code>256</code>色 <code>+</code> 支持透明；</li><li><code>png24</code>：<code>2^24</code>色 <code>+</code> 不支持透明；</li><li><code>png32</code>：<code>2^32</code>色 <code>+</code> 支持透明；</li></ul><p><strong>不同格式图片常用的业务场景</strong></p><ul><li><code>jpg</code>有损压缩，压缩率高，支持透明；应用：大部分不需要透明图片的业务场景；</li><li><code>png</code>支持透明，浏览器兼容好；应用：大部分需要透明图片的业务场景；</li><li><code>webp</code>（<code>2010</code>年由谷歌推出）压缩程度更好，在<code>ios webview</code>中有兼容性问题；应用：安卓全部；</li><li><code>svg</code>矢量图，代码内嵌，相对较小，用于图片样式相对简单的场景；应用：比如<code>logo</code>和<code>iconfont</code>；</li></ul><h3 id="1-图片压缩"><a href="#1-图片压缩" class="headerlink" title="1.图片压缩"></a>1.图片压缩</h3><p>针对真实图片情况，舍弃一些相对无关紧要的色彩信息，对图片进行压缩；比如在线压缩网站：<a href="https://tinypng.com/">https://tinypng.com/</a></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK837oWiaExpxYibY9fVhZbHPpU2YQxiaubicKDcWrUQP9D3WSYoNFkGLBeGQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="2-css雪碧图"><a href="#2-css雪碧图" class="headerlink" title="2.css雪碧图"></a>2.<code>css</code>雪碧图</h3><p>将网站上用到的一些图片整合到一张单独的图片中，从而减少网站<code>HTTP</code>请求数量。原理为：设定整张雪碧图可示区域，将想要显示的图标定位到该处（左上角）；<strong>缺点：</strong>整合图片比较大时，一次加载比较慢。</p><p>如天猫的雪碧图：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8sgnZKSJPV5JPXlh03K0kthBywB4TicJJDBWDos6MlXAac1luG9J83IQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>很多情况下，并不是所有的小图标都放在一张雪碧图中，而是会适当进行拆分。现在使用雪碧图的场景比较少了。</p><p>自动生成雪碧图样式的网站：<a href="http://www.spritecow.com/">http://www.spritecow.com/</a></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8hWuhPic73ibl6M0T3jAiaN4AH72vkuqQV1oGibTXFkU3BSUCjgm0D08rTQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>选中雪碧图中对应的图标，就会生成对应的样式。</p><h3 id="3-网页内联图片（Image-inline）"><a href="#3-网页内联图片（Image-inline）" class="headerlink" title="3.网页内联图片（Image inline）"></a>3.网页内联图片（<code>Image inline</code>）</h3><p>将图片的内容内嵌到<code>html</code>当中，减少网站的<code>HTTP</code>请求数量，常用于处理小图标和背景图片。网页内联图片写法为：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;imgsrc<span class="operator">=</span><span class="string">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA...&quot;</span>alt<span class="operator">=</span><span class="string">&quot;&quot;</span>&gt;</span><br></pre></td></tr></table></figure><p>浏览器上的表现形式为：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8xAE6YXIq6rloYsxicpLhwBGa9hI9bw4I1OxMyS8EsdmuFShf52icDx8A/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>这里提供一个将：<code>image</code> 转 <code>DataUrI</code>的网址：<a href="http://tool.c7sky.com/datauri/">http://tool.c7sky.com/datauri/</a></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8vbpsU7GVRaPnLicjlx7hSyYNgibvf0fse2qupTBzwza0f63libg00e8GA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><strong>缺点：</strong></p><ul><li>浏览器不会缓存内联图片资源；</li><li>兼容性较差，只支持<code>ie8</code>以上浏览器；</li><li>超过<code>1000kb</code>的图片，<code>base64</code>编码会使图片大小增大，导致网页整体下载速度减慢；</li></ul><p>所以要根据场景使用，不过内联图片<strong>减少<code>HTTP</code>请求</strong>的优点还是很显著的。比如，在开发中小于<code>4KB</code>或<code>8KB</code>的图片都会通过构建工具自动<code>inline</code>到<code>HTML</code>中，这种情况下<code>Image inline</code>带来的图片大小增长其实是比增加<code>HTTP</code>请求次数更优的。</p><h3 id="4-矢量图SVG与iconfont"><a href="#4-矢量图SVG与iconfont" class="headerlink" title="4.矢量图SVG与iconfont"></a>4.矢量图<code>SVG</code>与<code>iconfont</code></h3><p><strong>使用<code>iconfont</code>解决<code>icon</code>问题</strong></p><p>应尽量使用该方式，比如可以采用阿里巴巴矢量图库：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8JEWgBBaO442CEF4q2PicAVic8IVScsBiczGU0ic3J01bUQkJ48ICBeDEiag/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>可以选择格式进行下载：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8ISXVbatkl8xdKn44bgIFDzzMIkxIYhheUItWhzKOl58dShn26TJT2Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>可以看到它们的大小有着明显的差异：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8MRz6s7MLC7S1QBwQn1YcX2XttXrU54QLgOibLCk3ujIxKPibaQickmn4Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><strong>使用<code>SVG</code>进行矢量图的控制</strong></p><p><code>SVG</code>意为可缩放矢量图形（<code>Scalable Vector Graphics</code>）。<code>SVG</code> 使用 <code>XML</code> 格式定义图像。下为示例：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8cEPthficJfqIzOR9IaBqpxEbia0NH46mjR1QRPeVibLe4tWiauqEp6TPIw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>在线转换网站：<a href="http://www.bejson.com/convert/image_to_svg/">http://www.bejson.com/convert/image_to_svg/</a></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8MiaOgic9SnufX7ic2wfCHPWYJWBDMicDflAl9hlm17KOJziaZ12wKLkxiaGA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="5-webp"><a href="#5-webp" class="headerlink" title="5.webp"></a>5.<code>webp</code></h3><p><code>webp</code>的优势体现在它具有更优的图像压缩算法，能带来更小的图片体积，而且拥有肉眼识别无差异的图像质量；同时具备了无损和有损的压缩模式、<code>Alpha</code>透明以及动画的特性。在<code>JPEG</code>和<code>PNG</code>上的转化效果都非常优秀、稳定和统一。安卓上不存在兼容性问题，推荐安卓下使用。</p><p>以下为淘宝网首页请求的图片：<br><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK86zibH88aiaUXjzHV2ahkkJ5ySuXOrOogMRljswHficTTJStQ2hDm0hazg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>可以看到，图片中大量地添加了<code>webp</code>格式的选择。<code>.jpg_.webp</code>表示当浏览器支持<code>webp</code>时采用<code>webp</code>格式，否则采用<code>jpg</code>格式。</p><p>下面为<code>B</code>站首页的图片，可以看到基本都采用了<code>webp</code>格式：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8XSgT5N8BibpCf2SPL0yohcwuAyViapN9brV7Y0uCbE9ibmX2kib73rZzCA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>同一张图片<code>jpg</code>格式和<code>webp</code>格式压缩率有着明显的差异：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK85Vib2rxjiaPKkr4nfYBrrql4oMud5tS6v1ZcuOFhcSpywrcbnRHY0efw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>可以通过在线网站将图片转换为<code>webp</code>：<a href="https://zhitu.isux.us/">https://zhitu.isux.us/</a></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8dGM0o4X1ibYBEMbbcNibS8WMbOLdtAP10ibvbibRxtXWQIsZdwzCQI0wEA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>像图片这样的静态文件可以存放在<code>CDN</code>服务器上，让<code>CDN</code>服务器批量地将图片转换成<code>Webp</code>格式；</p><h2 id="三、浏览器渲染引擎与阻塞"><a href="#三、浏览器渲染引擎与阻塞" class="headerlink" title="三、浏览器渲染引擎与阻塞"></a>三、浏览器渲染引擎与阻塞</h2><h3 id="1-渲染的主要模块"><a href="#1-渲染的主要模块" class="headerlink" title="1.渲染的主要模块"></a>1.渲染的主要模块</h3><p>版本一：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK89PuBTH3zsW9sM9nRJYjPj4WVGPjS9zMiaY79WKFc85icX6vtSNj8mCgw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>版本二：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8rEUwxBgKYlkuIZICccfpGxX37gYAw3N7EL4cbXS1XwHQY7ia8PMTrVQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>一个渲染引擎主要包括：<code>HTML</code>解析器，<code>CSS</code>解析器，<code>javascript</code>引擎，布局<code>layout</code>模块，绘图模块：</p><ul><li><code>HTML</code>解析器：解释<code>HTML</code>文档的解析器，主要作用是将<code>HTML</code>文本解释成<code>DOM</code>树；</li><li><code>CSS</code>解析器：它的作用是为<code>DOM</code>中的各个元素对象计算出样式信息，为布局提供基础设施；</li><li><code>Javascript</code>引擎：使用<code>Javascript</code>代码可以修改网页的内容，也能修改<code>css</code>的信息，<code>javascript</code>引擎能够解释<code>javascript</code>代码，并通过<code>DOM</code>接口和<code>CSS</code>树接口来修改网页内容和样式信息，从而改变渲染的结果；</li><li>布局（<code>layout</code>）：在<code>DOM</code>创建之后，<code>Webkit</code>需要将其中的元素对象同样式信息结合起来，计算他们的大小位置等布局信息，形成一个能表达这所有信息的内部表示模型；</li><li>绘图模块（<code>paint</code>）：使用图形库将布局计算后的各个网页的节点绘制成图像结果；</li></ul><h3 id="2-渲染过程"><a href="#2-渲染过程" class="headerlink" title="2.渲染过程"></a>2.渲染过程</h3><p>浏览器渲染页面的整个过程：浏览器会从上到下解析文档。</p><ol><li><p>浏览器解析时遇见 <code>HTML</code> 标记，就会调用<code>HTML</code>解析器解析为对应的 <code>token</code> （一个<code>token</code>就是一个标签文本的序列化）并构建 <code>DOM</code> 树（就是一块内存，保存着<code>tokens</code>，建立它们之间的关系）。在生成<code>DOM</code>的最开始阶段（应该是<code>Bytes</code> → <code>characters</code>后），并行发起<code>css</code>、图片、<code>js</code>的请求，无论他们是否在<code>HEAD</code>标签中。</p><blockquote><p>注意：发起<code>js</code>文件的下载请求（<code>request</code>）并不需要<code>DOM</code>处理到那个<code>script</code>节点；</p></blockquote></li><li><p>遇见 <code>style/link</code> 标记 调用解析器 处理 <code>CSS</code> 标记并构建 <code>CSS</code>样式树；</p></li><li><p>遇见 <code>script</code> 标记 调用 <code>javascript</code>解析器处理<code>script</code>标记，绑定事件、修改<code>DOM</code>树/<code>CSS</code>树等；</p></li><li><p>将 <code>DOM</code>树 与 <code>CSS</code>树 合并成一棵渲染树（<code>Render Tree</code>）。</p></li><li><p>布局（<code>Layout</code>）：根据渲染树中各节点的样式和依赖关系，计算出每个节点在屏幕中的位置；</p></li><li><p>绘图（<code>Painting</code>）：按照计算出来的结果：要显示的节点、节点的<code>CSS</code>与位置信息，通过显卡，把内容画到屏幕上；</p></li></ol><p>经过第一次<code>Painting</code>之后<code>DOM</code>、<code>CSSOM</code>、<code>Render Tree</code>都可能会被多次更新，比如<code>JS</code>修改了<code>DOM</code>或者<code>CSS</code>属性时，<code>Layout</code>和<code>Painting</code>就会被重复执行。除了<code>DOM</code>、<code>CSSOM</code>更新的原因外，图片下载完成后也需要调用<code>Layout</code> 和 <code>Painting</code>来更新网页。</p><blockquote><p><strong>补充：</strong></p><p>\1. HTML中可能会引入很多的css、js这样的外部资源，这些外部资源在浏览器端是并发加载的。但是浏览器会对同一域名进行并发数量（度）的限制，即单个域名的并发度是有限的；</p><p>\2. 所以，经常将大部分的资源托管到CDN服务器上，并且设置3~4个CDN域名。防止只有一个CDN域名的情况下，达到了浏览器外部资源并发请求数目的上限，导致很多资源无法做到并发请求。所以，应设置多个CDN域名；</p></blockquote><h3 id="3-css阻塞"><a href="#3-css阻塞" class="headerlink" title="3.css阻塞"></a>3.<code>css</code>阻塞</h3><p>只有通过<code>link</code>引入的外部<code>css</code>才会产生阻塞：</p><ul><li><p><strong><code>style</code>标签中的样式：</strong></p></li><li><ul><li>由<code>html</code>解析器进行解析；</li><li>不阻塞浏览器渲染（可能会产生“闪屏现象”）；</li><li>不阻塞<code>DOM</code>解析；</li></ul></li><li><p><strong><code>link</code>引入的外部<code>css</code>样式（推荐使用的方式）：</strong></p></li><li><ul><li>由<code>CSS</code>解析器进行解析；</li><li>阻塞浏览器渲染：由于<code>css</code>已经加载完毕，所以整个渲染过程是带样式的，所以这种阻塞可以避免“闪屏现象”；</li><li>阻塞其后面的<code>js</code>语句的执行：这个不难理解，<code>js</code>文件中经常会出现<code>DOM</code>操作，操作过程中有可能涉及到<code>css</code>样式的修改。实际上，这些修改往往是依赖于之前引入的<code>css</code>设定的样式的，所以<code>css</code>会阻塞<code>js</code>的执行；</li><li>不阻塞DOM的解析；</li></ul></li><li><p><strong>优化核心理念：尽可能快的提高外部<code>css</code>加载速度：</strong></p></li><li><ul><li>使用<code>CDN</code>节点进行外部资源加速；</li><li>对<code>css</code>进行压缩(利用打包工具，比如<code>webpack</code>，<code>gulp</code>等)；</li><li>减少<code>http</code>请求数，将多个<code>css</code>文件合并；</li><li>优化样式表的代码；</li></ul></li></ul><h3 id="4-js阻塞"><a href="#4-js阻塞" class="headerlink" title="4.js阻塞"></a>4.<code>js</code>阻塞</h3><ul><li><p><strong>阻塞DOM解析:</strong></p><p>原因：浏览器不知道后续脚本的内容，如果先去解析了下面的<code>DOM</code>，而随后的<code>js</code>删除了后面所有的<code>DOM</code>，那么浏览器就做了无用功，浏览器无法预估脚本里面具体做了什么操作，例如像<code>document.write</code>这种操作，索性全部停住，等脚本执行完了，浏览器再继续向下解析<code>DOM</code>；可以通过给<code>script</code>标签添加<code>defer</code>和<code>async</code>属性，异步引入<code>js</code>文件，以此来解决这一问题。</p></li><li><p><strong>阻塞页面渲染:</strong></p><p>原因：<code>js</code>中也可以给<code>DOM</code>设置样式，浏览器同样等该脚本执行完毕，再继续干活，避免做无用功；</p></li><li><p><strong>阻塞后续<code>js</code>的执行:</strong></p><p>原因：<code>js</code>是按顺序执行的，这样可以维护依赖关系，例如：必须先引入<code>jQuery</code>再引入<code>bootstrap</code>；</p></li><li><p><strong>不阻塞资源的加载：</strong></p><p>这并不与上面矛盾，因为不可能由于加载一个<code>js</code>文件就把其他资源的加载都阻塞了。针对这种常见的情况，浏览器会通过预加载的方式加载后续的资源；</p></li></ul><h3 id="5-总结"><a href="#5-总结" class="headerlink" title="5.总结"></a>5.总结</h3><ul><li><p><code>css</code>的解析和<code>js</code>的执行是互斥的（互相排斥），<code>css</code>解析的时候<code>js</code>停止执行，<code>js</code>执行的时候<code>css</code>停止解析；</p></li><li><p>无论<code>css</code>阻塞，还是<code>js</code>阻塞，都不会阻塞浏览器<strong>加载</strong>外部资源（图片、视频、样式、脚本等）；</p><p>因为览器始终处于一种：“先把请求发出去”的工作模式，只要是涉及到网络请求的内容，无论是：图片、样式、脚本，都会先发送请求去获取资源，至于资源到本地之后什么时候用，由浏览器自己协调。显然这种做法效率很高；</p></li><li><p><code>WebKit</code> 和<code>Firefox</code> 都进行了【<strong>预解析</strong>】这项优化。在执行<code>js</code>脚本时，浏览器的其他线程会解析文档的其余部分，找出并加载需要通过网络加载的其他资源。通过这种方式，资源可以在并行连接上加载，从而提高总体速度。请注意，预解析器不会修改 <code>DOM</code> 树</p></li></ul><h2 id="四、懒加载和预加载"><a href="#四、懒加载和预加载" class="headerlink" title="四、懒加载和预加载"></a>四、懒加载和预加载</h2><h3 id="1-懒加载"><a href="#1-懒加载" class="headerlink" title="1.懒加载"></a>1.懒加载</h3><p>图片进入可视区域之后再请求图片资源的方式称为图片懒加载。适用于图片很多，页面很长的业务场景，比如电商；</p><p><strong>懒加载的作用：</strong></p><ul><li><p><strong>减少无效资源的加载：</strong></p><p>比如一个网站有十页图片，用户只查看了第一页的图片，这就没必要将十页图片全都加载出来；</p></li><li><p><strong>并发加载的资源过多会阻塞<code>js</code>的加载，影响网站正常的使用：</strong></p><p>由于浏览器对某一个<code>host name</code>是有并发度上限的，如果图片资源所在的<code>CDN</code>和静态资源所在的<code>CDN</code>是同一个的话，过多图片的并发加载就会阻塞后续<code>js</code>文件的并发加载。</p></li></ul><p><strong>懒加载实现的原理：</strong></p><p>监听<code>onscroll</code>事件，判断可视区域位置：</p><p>图片的加载是依赖于<code>src</code>路径的，首先可以为所有懒加载的静态资源添加自定义属性字段，用于存储真实的<code>url</code>。比如是图片的话，可以定义<code>data-src</code>属性存储真实的图片地址，<code>src</code>指向<code>loading</code>的图片或占位符。然后当资源进入视口的时候，才将<code>src</code>属性值替换成<code>data-src</code>中存放的真实<code>url</code>。</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src<span class="operator">=</span><span class="string">&quot;&quot;</span> class<span class="operator">=</span><span class="string">&quot;image-item&quot;</span> alt<span class="operator">=</span><span class="string">&quot;&quot;</span> lazyload <span class="operator">=</span> <span class="string">&quot;true&quot;</span> data-src<span class="operator">=</span><span class="string">&quot;TB27YQvbm_I8KJjy0FoXXaFnVXa_!!400677031.jpg_180x180xzq90.jpg_.webp&quot;</span>&gt;</span><br></pre></td></tr></table></figure><p><strong>懒加载实例</strong></p><p>可以使用元素的<code>getBoundingClientRect().top</code>来判断当前位置是否在视口内，也可以使用元素距离文档顶部的距离<code>offsetTop</code>和<code>scrollTop</code>是否小于视口高度来判断：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8RRiaNCic3pnibYSgGMVKksoib70ZIVUvjCPzAnPg0mCOSxUCYiay4caftew/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><em>下面是我针对getBoundingClientRect的补充</em><br>getBoundingClientRect 有四个属性</p><ul><li><ul><li>top - 获取到的是元素上边框到浏览器顶部的距离，包含html和body的边框及margin，padding</li><li>bottom - 获取到的是元素下边框到浏览器顶部的距离，包含html和body的边框及margin，padding</li><li>left - 获取到的是元素左边框到浏览器左边的距离，包含html和body的边框及margin，padding</li><li>right - 获取到的是元素右边框到浏览器左边的距离，包含html和body的边框及margin，padding</li></ul></li></ul><p><strong>举例</strong></p><p>比如手机淘宝首页：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8KvyCUBvgQw5Mqt5gwuEZONAZFZ725Cu2M1GdZhhDU032CmOvkaqpQw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>当快要滚动到需要展示的图片时才进行图片的请求，可以看到图片上有一个<code>lazyload</code>的属性：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8nEooeWN9iaroSKxe81onJwomj3EwJRqLQRUEgeZrhxltT4CP88Syodw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="2-预加载"><a href="#2-预加载" class="headerlink" title="2.预加载"></a>2.预加载</h3><p>预加载与懒加载正好是相反的过程：<strong>懒加载</strong>实际上是延迟加载，将我们所需的静态资源加载时间延后；而<strong>预加载</strong>是将图片等静态资源在使用之前的提前请求，这样资源在使用到时能从缓存中直接加载，从而提升用户体验；</p><p><strong>预加载的作用：</strong></p><ul><li><p><strong>提前请求资源，提升加载速度</strong>：使用时只需要读取浏览器缓存中提前请求到的资源即可；</p></li><li><p><strong>维护页面的依赖关系</strong>：比如<code>WebGL</code>页面，会依赖一些<code>3D</code>模型，这些都是页面渲染所必须的资源。如果资源都没有加载完毕就进行页面的渲染，就会造成非常不好的体验。</p><p>所以时常使用预加载的方式维护页面渲染的依赖关系，比如将<code>WebGL</code>页面依赖的<code>3D</code>模型加载完之后才进行页面渲染。这样渲染的过程就不会有任何阻碍，具有较好的用户体验；</p></li></ul><p><strong>预加载的实例</strong></p><p>例如九宫格抽奖业务，每个奖品都有一个选中态和非选中态，实际上这是由两张图片组合而成的。由于每个奖品的选中过程都是一瞬间，这就对图片的选中态和非选中态切换效率要求很高，如果选中态的图片没有预加载的话显然是来不及的。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8MyGBT4iamdIGZ6CgYTe1hsznqIyhJiaYIDI52fQCFicibS65MeBTic2iab3g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>所以，实际上对于九宫格中所有图片选中态的样式和对应的图片都需要进行预加载，从而让我们在抽奖的过程中，能够瞬间从缓存中读取到选中态的图片，从而不影响抽奖效果的展示。</p><p>除此之外还有网站登录或活动时需要用到的动画，这是在动画需要的每帧图片都完全预加载完之后才会进行显示的。</p><h2 id="五、重绘与回流"><a href="#五、重绘与回流" class="headerlink" title="五、重绘与回流"></a>五、重绘与回流</h2><h3 id="1-CSS图层"><a href="#1-CSS图层" class="headerlink" title="1.CSS图层"></a>1.<code>CSS</code>图层</h3><p>浏览器在渲染一个页面时，会将页面分为很多个图层，图层有大有小，每个图层上有一个或多个节点。在渲染 <code>DOM</code>的时候，浏览器所做的工作实际上是：</p><p>1、获取<code>DOM</code>后分割为多个图层；</p><p>2、对每个图层的节点计算样式结果（<code>Recalculate style</code>–样式重计算）；</p><p>3、为每个节点生成图形和位置（<code>Layout</code>–回流和重布局）；</p><p>4、将每个节点绘制填充到图层位图中（<code>Paint Setup</code>和<code>Paint</code>–重绘）；</p><p>5、图层作为纹理上传至<code>GUI</code>；</p><p>6、复合多个图层到页面上生成最终屏幕图像（<code>Composive Layers</code>–图层重组）；</p><h3 id="2-创建图层的条件"><a href="#2-创建图层的条件" class="headerlink" title="2.创建图层的条件"></a>2.创建图层的条件</h3><ul><li><p>拥有<code>3D</code>或透视变换的<code>css</code>属性（<code>prespective transform</code> ）；</p></li><li><p>使用加速视频解码的<code>&lt;video&gt;</code>节点；</p></li><li><p>拥有<code>3D(WebGL)</code>上下文或加速的<code>2D</code>上下文的<code>&lt;canvas&gt;</code>节点；</p></li><li><p><code>CSS3</code>动画的插件（如<code>Flash</code>）；</p></li><li><p>拥有加速<code>css</code>过滤器的元素；</p></li><li><ul><li><code>transform</code>：如<code>translateZ(0)</code></li><li><code>opacity</code></li><li><code>filter</code></li><li><code>will-change</code>：哪一个属性即将发生变化，进而进行优化。</li></ul></li></ul><p><em>下面是本人针对<code>will-change</code>的一些补充</em></p><ul><li><ul><li>不要使用<code>will-change</code>声明对太多属性或元素的更改</li><li>给浏览器足够的时间来工作，不要对已经发生的变化进行优化</li><li>变更生效之后移除掉<code>will-change</code> 最好使用js来进行属性的赋值和移除</li><li>有选择的在css中使用<code>will-change</code> 用于反复交互或者不断变化的元素</li></ul></li></ul><h3 id="3-重绘（Repaint）"><a href="#3-重绘（Repaint）" class="headerlink" title="3.重绘（Repaint）"></a>3.重绘（Repaint）</h3><p>重绘是一个元素外观的改变所触发的浏览器行为，比如<code>background-color</code>、<code>outline</code>等属性。这些属性不影响<strong>布局</strong>，只影响元素的<strong>外观</strong>，<strong>风格</strong>，会造成<code>DOM</code>元素的重新渲染，这个过程称为重绘。</p><p>需要注意的是：重绘是以图层为单位，如果图层中某个元素需要重绘，那么整个图层都需要重绘。比如一个图层包含很多节点，其中有个<code>gif</code>图，<code>gif</code>图的每一帧，都会重回整个图层的其他节点，然后生成最终的图层位图。</p><p>因此，可以通过特殊的方式来强制<code>gif</code>图单独为一个图层（<code>translateZ(0)</code>或者<code>translate3d(0,0,0)</code>；<code>CSS3</code>的动画也是一样（好在绝大部分情况浏览器自己会为<code>CSS3</code>动画的节点创建图层）；</p><p><strong>所以：</strong>将<strong>频繁重绘回流</strong>的<code>DOM</code>元素作为一个<strong>独立图层</strong>，那么这个<code>DOM</code>元素的重绘和回流<strong>只会</strong>该图层；原则上是要尽量避免新建图层的，因为这会导致图层重组（<code>Composive Layers</code>）时候的计算量增大。所以，只有当某些<code>DOM</code>元素频繁重绘回流时，才新建一个独立图层放置它们；</p><p><strong>只会触发重绘的属性</strong></p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//部分属性</span><br><span class="line"><span class="built_in">color</span></span><br><span class="line"><span class="built_in">border</span>-<span class="built_in">style</span></span><br><span class="line"><span class="built_in">border</span>-<span class="built_in">radius</span></span><br><span class="line">visibility</span><br><span class="line">text-decoration</span><br><span class="line"><span class="built_in">background</span></span><br><span class="line"><span class="built_in">background</span>-<span class="built_in">image</span></span><br><span class="line"><span class="built_in">background</span>-<span class="built_in">position</span></span><br><span class="line"><span class="built_in">background</span>-repeat</span><br><span class="line"><span class="built_in">background</span>-size</span><br><span class="line">outline-<span class="built_in">color</span></span><br><span class="line">outline</span><br><span class="line">outline-<span class="built_in">style</span></span><br><span class="line">outline-<span class="built_in">width</span></span><br><span class="line"><span class="built_in">box</span>-shadow</span><br></pre></td></tr></table></figure><h3 id="4-回流（Reflow）"><a href="#4-回流（Reflow）" class="headerlink" title="4.回流（Reflow）"></a>4.回流（Reflow）</h3><p>当<code>render tree</code>中的一部分（或全部）因为元素的<strong>规模尺寸</strong>，<strong>布局</strong>，<strong>隐藏</strong>等改变而需要重新构建。这就称为回流（<code>reflow</code>）；</p><ul><li>当页面布局和几何属性改变时就需要回流；</li><li><strong>回流必将引起重绘，而重绘不一定会引起回流；</strong></li></ul><p><strong>触发页面重布局（回流）的属性</strong></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8FoD9064QZnjVP3YPE5uQfQhKEwrGP6ibHMgffS24k0K8mBkHIkNLfHA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>频繁触发<strong>重绘</strong>和<strong>回流</strong>，会导致<code>UI</code>频繁渲染。在渲染的过程中由于阻塞了<code>js</code>线程的执行，最终导致<code>js</code>执行变慢。</p><h3 id="5-触发回流的常见操作"><a href="#5-触发回流的常见操作" class="headerlink" title="5.触发回流的常见操作"></a>5.触发回流的常见操作</h3><ul><li>增加、删除、修改 <code>DOM</code> 结点；</li><li>移动 <code>DOM</code> 的位置；</li><li>修改 <code>CSS</code> 样式；</li><li><code>Resize</code> 窗口；移动端没有这个问题，因为移动端的缩放没有影响布局视口（<code>vw/vh</code>）；</li><li>修改网页的默认字体；</li><li>获取某些<code>DOM</code>元素的属性(<code>width</code>，<code>height</code>等)；</li></ul><blockquote><p><strong>注</strong>：<code>display：none</code> 会触发 <code>Reflow</code>，而<code>visibility：hidden</code> 只会触发 <code>Repaint</code>，因为没有发生位置变化；</p></blockquote><h3 id="6-示例"><a href="#6-示例" class="headerlink" title="6.示例"></a>6.示例</h3><p><strong>案例一：淘宝轮播图</strong></p><p>可以使用<code>Chrome</code>浏览器调试工具的<code>Performance</code>来观察淘宝首页一个轮播图引起的重绘回流过程：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8fslsmlHaDjdYKvW00b1hGNCrkicxxAiajoiaNiaqJEZcHtRQ4d2chZO8uQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><code>Update Layer Tree</code>回流和重布局：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8tLQiaouG8UfJlHyJRomFMZgWzicRHa8FHUOu2wSlvNMAdoaV5d8w7FicQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><code>Paint</code>重绘：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8TGY9Iql4THr3KkniaCzYVsVOgUOBb1VUViaqBPfwgW1tm39kY4yfXXgQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><code>Composite Layers</code>图层重组：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8SQd6rWZP94XEtPfH7LxtHrp1Br4QP8Xibp2mzLawZ7ZFGNnJt9kYMmA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><strong>案例二：播放器</strong></p><p>通过<code>Chrome</code>调试工具的<code>Layers</code>选项查看图层，及新增图层的原因：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8IPzBuOyHHCnwNuDL0F49jAnuWNGg4oD32C5XP0MH8hoItTuxNCr8WQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>视频播放的过程中，<code>video</code>标签的<code>DOM</code>元素会一直重绘，所以把它限制在一个图层上是非常好的，这样只会涉及到这个图层的重绘，而不会影响其他图层的元素。</p><blockquote><p><strong>图层不能滥用，否则会在图层重组的过程中严重消耗性能！</strong></p></blockquote><p>比如可以将淘宝首页的所有的<code>DOM</code>元素都变为一个图层：在<code>html</code>标签中的全局样式（<code>*</code>）中添加<code>transform:translateZ(0)</code>来触发新建图层：</p><blockquote><p>还可以通过添加：<code>will-change: transform</code>属性新建图层；</p></blockquote><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8zJ6QiaQeLZIh7Qenjf9oiayzicE9poic9ZvoYOKjibqp0YfibOJSLYEiaLGKg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>再次查看此时的图层情况，可以看到此时首页的图层非常之多，十分地卡：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK85SvJUbQLCR6V80WPTejlIPUViatHm96CVQtyVGS92CicyibDgibR5Be2jA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="7-实战优化点"><a href="#7-实战优化点" class="headerlink" title="7.实战优化点"></a>7.实战优化点</h3><p>如果我们需要使得动画或其他节点渲染的性能提高，需要做的就是减少浏览器在运行时所需要做的下列工作：</p><ul><li>计算需要被加载到节点上的样式结果（<code>Recalculate style</code>–样式重计算）；</li><li>为每个节点生成图形和位置（<code>Layout</code>–回流和重布局）；</li><li>将每个节点填充到图层中（<code>Paint Setup</code>和<code>Paint</code>–重绘）；</li><li>组合图层到页面上（<code>Composite Layers</code>–图层重组）；</li></ul><p><strong>1、使用<code>translate</code>替代<code>top</code>等属性来改变位置；</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line">&lt;htmllang=&quot;en&quot;&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  &lt;metacharset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;metaname=&quot;viewport&quot;content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#box</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/*方法1*/</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">     </span></span><br><span class="line"><span class="language-css">     <span class="comment">/*方法2*/</span></span></span><br><span class="line"><span class="language-css">     <span class="comment">/* transform: translateY(0); */</span></span></span><br><span class="line"><span class="language-css">        </span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: pink;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  &lt;divid=&quot;box&quot;&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;box&quot;</span>).<span class="property">style</span>.<span class="property">top</span> = <span class="string">&#x27;100px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//document.getElementById(&quot;box&quot;).style.transform = &#x27;translateY(100px)&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用<code>top</code>属性改变正方形位置时，存在重绘和回流<code>Layout</code>：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8usbSfX7U4NicoM1fQFbTH3rBgjq3ZCdXeDSxvuBAaekrUWYJXBe8Y6w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>而使用translate属性改变正方形位置时，并不会引起重绘和回流：<br><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8Q7ozsYVbFat8SH38zoVPAMC8A3Bz876mlUSCicQASPDO347FYZx7z1A/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>比如有的网站会有一些左右飘动的浮窗，由于这些浮窗是采用定时器来实现的，如果每经过<code>100ms</code>就改变浮窗的位置。这种时候使用<code>transform</code>来替代<code>top/left</code>的话<code>1s</code>内就减少了十次回流，十分有利于网页速度的提升。</p><p><strong>2、使用<code>opacity</code>替代<code>visibility</code>：</strong></p><ul><li><p>使用<code>visibility</code>不触发重排，但是依然重绘；</p></li><li><p>直接使用<code>opacity</code>既触发重绘，又触发重排（<code>GPU</code>底层设计如此！）；</p></li><li><p><code>opacity</code>配合图层使用，既不触发重绘也不触发重排；</p><p>原因：透明度的改变时，<code>GPU</code>在绘画时只是简单的降低之前已经画好的纹理的<code>alpha</code>值来达到效果，并不需要整体的重绘。不过这个前提是这个被修改<code>opacity</code>本身必须是一个单独的图层。</p></li></ul><p><strong>3、将多次改变<code>DOM</code>元素样式属性的操作合并成一次操作：</strong></p><ul><li>预先定义好<code>class</code>，然后通过修改<code>DOM</code>的<code>className</code>来添加样式；</li></ul><p><strong>4、把<code>DOM</code>离线后再修改：</strong></p><ul><li>由于<code>display</code>属性为<code>none</code>的元素不在渲染树中，对隐藏的元素操作不会引发其他元素的重排。如果要对一个元素进行复杂的操作时，可以先隐藏它，操作完成后再显示。这样只在隐藏和显示时触发<code>2</code>次回流；</li></ul><p><strong>5、不要把获取某些<code>DOM</code>节点的属性值放在一个循环里当成循环的变量</strong></p><p>当向浏览器请求某些 <code>style</code>信息的时候，浏览器就会清空（<code>flush</code>）队列，比如：</p><ul><li><code>ffsetTop</code>，<code>offsetLeft</code>，<code>offsetWidth</code>，<code>offsetHeight</code>；</li><li><code>scrollTop/Left/Width/Height</code>；</li><li><code>clientTop/Left/Width/Height</code>；</li><li><code>width</code>，<code>height</code>；</li></ul><p>浏览器为了获取最精确的值，需要刷新内部队列。因为队列中可能存在影响到这些值的操作，即使没有，浏览器也会强行刷新渲染队列。这样就无法利用渲染队列的缓存来避免回流过于频繁了，所以在使用到<code>DOM</code>元素这些相关的属性时，可以将获取到的属性值存在一个变量中，而不是每次都去重新获取。</p><p><strong>6、不要使用<code>table</code>布局：</strong></p><ul><li>因为很小的一个改动都会造成整个<code>table</code>的重新布局；所以尽量使用<code>div</code>布局；</li></ul><p><strong>7、启用<code>GPU</code>硬件加速：</strong></p><p>原理为：浏览器会检测一些特定的<code>css</code>属性，当<code>DOM</code>元素拥有这些<code>css</code>属性的时候，浏览器就会对该<code>DOM</code>元素启动<code>GPU</code>硬件加速；比如：<code>transform: translateZ(0)</code>和<code>transform: translate3d(0, 0, 0)</code>这两个属性都可以启动硬件加速；硬件加速同样不能滥用，否则会导致图层过多，导致合并图层时消耗大量性能。</p><p><strong>8、动画实现速度的选择：</strong></p><ul><li>因为动画的每次变化都会引起重绘和回流，所以要根据业务场景适当地在动画帧数（顺畅程度）和回流次数中进行平衡；</li></ul><p><strong>9、为动画元素新建图层，提高动画元素的<code>z-index</code>；</strong></p><p><strong>10、利用文档碎片(<code>documentFragment</code>)——<code>vue</code>使用了该种方式提升性能</strong></p><p>如果我们要在一个<code>ul</code>中添加<code>10000</code>个<code>li</code>，如果不使用文档碎片，那么我们就需要使用<code>append</code>进行<code>10000</code>次的追加，这会导致页面不停地回流，非常地消耗资源：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var oUl <span class="operator">=</span> document.createElement(<span class="string">&quot;ul&quot;</span>)<span class="comment">; </span></span><br><span class="line">for(var i<span class="operator">=</span><span class="number">0</span><span class="comment">;i&lt;10000;i++)</span></span><br><span class="line">&#123; </span><br><span class="line">    var oLi <span class="operator">=</span> document.createElement(<span class="string">&quot;li&quot;</span>)<span class="comment">; </span></span><br><span class="line">    oUl.appendChild(oLi)<span class="comment">; </span></span><br><span class="line">&#125; </span><br><span class="line">document.body.appendChild(oUl)<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>我们可以引入<code>createDocumentFragment()</code>方法，它的作用是创建一个<strong>文档碎片</strong>。先将要插入<code>10000</code>个<code>li</code>添加到文档碎片里，然后再一次性添加到<code>document</code>中。即文档碎片相当于一个<strong>临时仓库</strong>，这样能够大量减少<code>DOM</code>操作：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先创建文档碎片</span></span><br><span class="line">var oFragment = document.create<span class="constructor">DocumentFragment()</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">//再创建ul标签</span></span><br><span class="line">var oUl = document.create<span class="constructor">Element(<span class="string">&quot;ul&quot;</span>)</span>; </span><br><span class="line"><span class="keyword">for</span>(var i=<span class="number">0</span>;i&lt;<span class="number">10000</span>;i++)</span><br><span class="line">&#123; </span><br><span class="line">  <span class="comment">//创建li标签</span></span><br><span class="line">  var oLi = document.create<span class="constructor">Element(<span class="string">&quot;li&quot;</span>)</span>; </span><br><span class="line">  <span class="comment">//先附加在文档碎片中</span></span><br><span class="line">  oFragment.append<span class="constructor">Child(<span class="params">oLi</span>)</span>;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将文档碎片添加到ul标签中 </span></span><br><span class="line">oUl.append<span class="constructor">Child(<span class="params">oFragment</span>)</span>;</span><br><span class="line"><span class="comment">//将ul标签添加到body标签中</span></span><br><span class="line">document.body.append<span class="constructor">Child(<span class="params">oUl</span>)</span>;</span><br></pre></td></tr></table></figure><p><strong>11、</strong>如果涉及到一些可以使用合成线程来处理 <code>CSS</code> 特效或者动画的情况，就尽量使用 <code>will-change</code> 来提前告诉渲染引擎，让它为该元素准备独立的层。</p><p><strong>12、采用虚拟<code>DOM</code>；</strong></p><p><strong>13、使用<code>requestAnimationFrame</code>制作动画：</strong>详细内容如下。</p><h3 id="8-请求动画帧（requestAnimationFrame）"><a href="#8-请求动画帧（requestAnimationFrame）" class="headerlink" title="8.请求动画帧（requestAnimationFrame）"></a>8.请求动画帧（<code>requestAnimationFrame</code>）</h3><p><strong><code>window.requestAnimationFrame()</code> ：</strong>该方法会告诉浏览器在重绘之前调用指定的函数：</p><ul><li><p><strong>参数：</strong>该方法以一个回调函数作为参数，这个回调函数会在浏览器重绘之前被调用；</p><p>回调函数会被自动传入一个参数：<code>DOMHighResTimeStamp</code>，标识<code>requestAnimationFrame()</code>开始触发回调函数的当前时间；</p></li><li><p><strong>返回值：</strong> 一个非零的整数，也称为请求<code>ID</code>，是回调列表中唯一的标识，没有其他意义；</p></li></ul><p><strong><code>window.cancelAnimationFrame(requestID)</code>：</strong>该方法取消一个先前通过调用<code>window.requestAnimationFrame()</code>方法添加到计划中的动画帧请求。<code>requestID</code>是先前调用<code>window.requestAnimationFrame()</code>方法时返回的<code>ID</code>。</p><p><strong>用途</strong></p><ul><li>当无法使用<code>CSS3</code>制作动画的情况下，使用这种方法替代定时器制作动画；</li><li>由于重绘就调用的机制，制作的动画频率与浏览器的刷新频率一致，不会出现闪动，保证了动画的流畅；</li></ul><p><strong>示例</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#box</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: pink;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> i = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//获取请求ID</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> id = <span class="title function_">requestAnimationFrame</span>(move)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">move</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      i++</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;box&#x27;</span>).<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateX(<span class="subst">$&#123;i&#125;</span>px)`</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//递归调用requestAnimationFrame,更新请求ID,实现动画效果</span></span></span><br><span class="line"><span class="language-javascript">      id = <span class="title function_">requestAnimationFrame</span>(move)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//2s后停止动画</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">cancelAnimationFrame</span>(id)</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">2000</span>);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="六、函数防抖与节流"><a href="#六、函数防抖与节流" class="headerlink" title="六、函数防抖与节流"></a>六、函数防抖与节流</h2><h3 id="1-函数防抖"><a href="#1-函数防抖" class="headerlink" title="1.函数防抖"></a>1.函数防抖</h3><ul><li><strong>概念：</strong>不断触发一个函数，在规定时间内只让最后一次生效，前面都不生效；</li><li><strong>实现：</strong>定时器；</li><li><strong>应用：</strong>搜索时等用户完整输入内容后再发送查询请求；</li></ul><p><strong>代码实现</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">debounce</span>(<span class="params">fn,delay</span>)&#123;</span><br><span class="line">     <span class="keyword">var</span> timer = <span class="literal">null</span></span><br><span class="line">  <span class="comment">//  清除上一次延时器</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">         <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">        <span class="comment">//  重新设置一个新的延时器</span></span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            fn.<span class="title function_">call</span>(<span class="variable language_">this</span>)</span><br><span class="line">        &#125;, delay);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>使用函数防抖可以减少事件触发的次数和频率，在某些情况下可以起到优化的作用。比如：搜索框，对于核心业务非搜索的网站，一般都是等待用户完整输入内容后才发送查询请求，一次来减少服务器的压力。像百度这样的核心业务为搜索的网站，服务器性能足够强大，所以不进行函数防抖处理；</p><h3 id="2-函数节流"><a href="#2-函数节流" class="headerlink" title="2.函数节流"></a>2.函数节流</h3><ul><li><strong>概念：</strong>不断触发一个函数后，执行第一次，只有大于设定的执行周期后才会执行第二次，以此控制函数执行频率；</li><li><strong>实现：</strong>定时器，标识；</li><li><strong>应用：</strong>在游戏中，可以设定人物攻击动作的最快频率，无论手速多快也无法超越这一频率；</li></ul><p><strong>代码实现</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> 节流函数：fn:要被节流的函数，delay：规定的时间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="title">functionthrottle</span><span class="params">(fn, delay)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 记录上一次函数出发的时间</span></span><br><span class="line">    <span class="selector-tag">var</span> lastTime = <span class="number">0</span></span><br><span class="line">    return <span class="built_in">function</span>()&#123;</span><br><span class="line">        <span class="comment">// 记录当前函数触发的时间</span></span><br><span class="line">        <span class="selector-tag">var</span> nowTime = new <span class="built_in">Date</span>()<span class="selector-class">.getTime</span>()</span><br><span class="line">        <span class="comment">// 当当前时间减去上一次执行时间大于这个指定间隔时间才让他触发这个函数</span></span><br><span class="line">        <span class="built_in">if</span>(nowTime - lastTime &gt; delay)&#123;</span><br><span class="line">            <span class="comment">// 绑定this指向</span></span><br><span class="line">            fn<span class="selector-class">.call</span>(this)</span><br><span class="line">            <span class="comment">//同步时间</span></span><br><span class="line">            lastTime = nowTime</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="七、浏览器存储"><a href="#七、浏览器存储" class="headerlink" title="七、浏览器存储"></a>七、浏览器存储</h2><h3 id="1-Cookie"><a href="#1-Cookie" class="headerlink" title="1.Cookie"></a>1.<code>Cookie</code></h3><ul><li><code>Cookie</code>翻译过来是小甜饼的意思，是网景公司的前雇员 <code>Lou Montulli</code> 在<code>1993</code>年<code>3</code>月发明的；</li><li><code>Cookie</code>是纯文本格式，不包含任何可执行的代码信息，伴随着用户请求在 <code>Web</code> 服务器和浏览器之间传递；</li><li><code>Cookie</code>本质上属于<code>http</code>的范畴，因为<code>http</code>协议本身是无状态的，服务端是没有办法区分请求来自于哪个客户端，即便是来自于同一个客户端的多次请求，服务端也无法进行区分。所以引入了<code>Cookie</code>去维持客户端的状态（比如每个账号的购物车状态都不一样）。</li></ul><p><strong><code>Cookie</code>的生成方式</strong></p><ul><li><p><strong>客户端生成：</strong></p><p>在 <code>JavaScript</code> 中通过 <code>document.cookie</code> 属性，你可以创建、维护和删除 <code>Cookie</code>；设置 <code>document.cookie</code> 属性的值并不会删除存储在页面中的所有 <code>Cookie</code>，它只简单的创建或修改字符串中指定的 <code>Cookie</code>。</p></li><li><p><strong>服务端生成：</strong></p><p><code>Web</code> 服务器通过在<code>HTTP</code>响应头中添加 <code>Set-Cookie</code>字段来创建一个 <code>Cookie</code>，可以在该字段中添加<code>HttpOnly</code>属性禁止<code>JavaScript</code>脚本访问<code>Cookie</code>，以此来避免跨域脚本 (<code>XSS</code>) 攻击。</p></li></ul><p><strong><code>Cookie</code>的缺陷</strong></p><ul><li><p><strong>安全性：</strong>由于<code>Cookie</code>在<code>HTTP</code>中是明文传递的，其中包含的数据都可以被他人访问，出现篡改、盗用等问题；</p></li><li><p><strong>大小限制：</strong><code>Cookie</code>的大小限制在<code>4KB</code>左右，若要做大量存储显然不是理想的选择；</p></li><li><p><strong>增加流量：</strong>因为<code>Cookie</code>是绑定域名对应的服务器的，所以对同一个域名的每次请求都会在<code>Request Header</code>中带上<code>Cookie</code>。</p></li><li><ul><li>一方面：增加对服务器的请求时间；</li><li>另一方面：导致大部分不需要用到<code>Cookie</code>信息的场合下流量的浪费；这样浏览器对同一域名的每一次请求都会多出<code>4KB</code>流量，对于大型网站来说这是很大的损耗。</li></ul></li></ul><p>因此要慎用<code>Cookie</code>，不要在<code>Cookie</code>中存储重要和敏感的数据。</p><p><strong><code>Cookie</code>性能优化的方法</strong></p><p>将存放静态资源的<code>CDN</code>服务器域名与主站的域名独立开来。这样每次请求静态文件的时候就不需要携带<code>Cookie</code>，从而可以节省很多流量。</p><p><strong>举例</strong></p><p>比如在百度进行登录的时候，请求头里面就会有<code>Set-Cookie</code>字段，其中的<code>BDUSS</code>就是标识用户登录状态的字符串：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8bBQTf5KibVSkhOHau2ibPt7oiciaS9zibz7Picafu9joZPu7ibCJPrt5Xy1oA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><code>Set-Cookie</code>中的<code>httponly</code>属性表示的是禁止<code>js</code>脚本访问<code>cookie</code>，这样能够一定程度防范<code>XSS</code>攻击；</p><p>在<code>Chrome</code>调试工具的<code>Application</code>选项中查看<code>Cookies</code>信息，可以发现该<code>Cookie</code>已经被网站“种”到<code>Domain：.baidu.com</code>这个域名下了，并且该<code>Cookie</code>也设置了<code>HttpOnly</code>属性：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8DGMdlOWYKtliaDHVmwqkib30ibhyRSwakU0RSF9xGgwXVMYuZwibdoImLQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>此后浏览器的每次请求都会在请求头<code>Request Headers</code>中携带这一<code>Cookie</code>信息。刷新页面后可以看到，请求头中携带了<code>Cookie</code>信息<code>BDUSS</code>：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8YSrVOwds3s5a1WYjUYkj1w5IiaibDiauJYDVj5oibVL3xPcYfuyfhXqyNA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>这样服务器就知道这是已经登录的用户了。</p><p>但是不是所有的请求都需要携带<code>Cookie</code>信息，比如优酷：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8ciaTyutswr2CgYKPKIsgzVDIXAdIBFYYeQDJYWQaRb69o5icXnvYtWbA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>可以看到请求<code>index.css</code>文件时也携带了<code>Cookie</code>，但是这是不必要的，这就会导致流量的浪费。</p><blockquote><p>解决方法就是上面所说的：将<strong><code>CDN</code>域名</strong>和<strong>主域名</strong>独立出来；</p></blockquote><p>百度就是这样解决的：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8PeLQxb5zWoADQhH2Uzs1IHOOCicYarlNoPZsRPicnVsZwwichclXs5eOQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>可以看到请求这个静态资源的<code>url</code>并不是<code>.baidu.com</code>，而是静态资源服务器<code>CDN</code>；并且该请求的请求头中不会携带<code>Cookie</code>信息：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8usGFsQGsR1Z2zoeStxOZHbnOwnDpYRdOZzxItcTkWTdicclJCDzpRgg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><strong>设置和获取<code>Cookie</code></strong></p><p>设置<code>Cookie</code>的方式很简单，<code>key</code>和<code>value</code>值通过等号连接：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">document.cookie</span> = <span class="string">&quot;userName=zhangsan&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8G119VtpiccbWdMqdzjHhMR2lnptCfnsIicTribyNLl9XW6N3qX55M0F2g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>打开<code>Application</code>选项查看当前<code>Cookie</code>，可以看到<code>Cookie</code>已被改变：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8PwcibCLoCYbVW1iafUDnZdj0jclBgeHAGL9pA8e2T4k0gwllJMib9NuCA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>获取<code>Cookie</code>：</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.cookie</span><br></pre></td></tr></table></figure><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8BWW7C6xXysxR4nlm7PvtbZb4icic0JrcjJT6zNzHBtPQ0Pj2uaHicUGZA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><blockquote><p><strong>备注：</strong></p><p>\1. 静态资源是不会携带Cookie的；</p><p>\2. Cookie一般都是后台种的，很少让前端来直接写；</p><p>\3. Cookie分:持久级别、session级别；</p><p>\4. Cookie一般用于存放session ID与服务器端进行通信；</p></blockquote><h3 id="2-Web-Storage"><a href="#2-Web-Storage" class="headerlink" title="2.Web Storage"></a>2.<code>Web Storage</code></h3><ul><li><code>Web Storage</code>分为<code>SessionStorage</code>和<code>LocalStorage</code>专门用于客户端浏览器的本地存储，同时空间比<code>Cookie</code>大很多，一般支持<code>5-10M</code>；</li><li>浏览器端通过 <code>Window.sessionStorage</code> 和 <code>Window.localStorage</code> 属性来实现本地存储机制；</li></ul><h4 id="LocalStorage"><a href="#LocalStorage" class="headerlink" title="LocalStorage"></a><code>LocalStorage</code></h4><p><code>LocalStorage</code>是<code>HTML5</code>设计出来专门用于存储浏览器信息的：</p><ul><li>大小为<code>5~10M</code>左右；</li><li>仅在客户端中使用，不和服务端进行通信；</li><li>接口封装较好，提供了<code>js</code>进行读写等操作的<code>API</code>；</li><li>采用浏览器本地缓存方案，可直接使用浏览器本地缓存，提升网页渲染的速度；</li></ul><p><strong>举例</strong></p><p>比如通过<code>Chrome</code>调试工具的<code>Application</code>选项可以查看淘宝中<code>LocalStorage</code>存储的数据：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8aSW8cOpdHNib0mDCiaSgrfhe13Gb527QBDZPiaISib0aicN8mr9CzicQ8WTQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>这些数据只要不手动清除，即使关闭页面也都会存在。当需要使用图片、<code>js/css</code>文件等资源时就不用重新向服务器发出请求，而是可以直接使用<code>LocalStorage</code>中的缓存，这就是<code>LocalStorage</code>缓存的优势；</p><p>而Cookie就不一样了，里面存储的数据都是要带到服务器端的，例如用户登录状态，统计信息等数据：<br><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8QIbaRTo6VepThiaicqkRzib4eULOBxtufRgHnRY55wqsA6KuTXZ5ibdpPQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><strong>设置和获取<code>LocalStorage</code></strong></p><p><code>LocalStorage</code>提供了相对简单的<code>API</code>，采用的也是<code>key</code>和<code>value</code>的形式。</p><p>设置时通过：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8hZfRt9BmytRl5LM3W6upDzLkJbficxVR8vbqsv418LynqwympT6T68A/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>查看<code>LocalStorage</code>，同样设置成功了：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8EzuyZgVsqcokphQzpaV9pWoWO6LZyo61yaB9ffx1icXtjISic7Y6Libzw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>获取时通过：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;key&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8mibibDicofPTOoCRFCUm1q46iaic0gPd6L5AyuNEoWpzLFMWzrAkK8NeWkA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><strong>其他方法</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>该方法接受一个键名作为参数，并把该键名从存储中删除。</span><br><span class="line">localStorage.removeItem(<span class="string">&#x27;key&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="regexp">//</span>调用该方法会清空存储中的所有键名</span><br><span class="line">localStorage.clear();</span><br></pre></td></tr></table></figure><h4 id="SessionStorage"><a href="#SessionStorage" class="headerlink" title="SessionStorage"></a><code>SessionStorage</code></h4><p><code>SessionStorage</code>用于存储浏览器的会话信息，标签页关闭之后它存储的数据就会被清空，而<code>LocalStorage</code>的数据不会被清空，这是二者的区别：</p><ul><li>大小为<code>5~10M</code>左右；</li><li>仅在客户端使用，不和服务端进行通信；</li><li>接口封装较好；</li><li>可对表单信息进行维护；比如添加表单过程中进行了刷新，可以将刷新前填写的信息写入<code>SessionStorage</code>中，这样即使刷新后数据也不会丢失；还有一种场景：分页的表单在进行前进或后退时，如果将信息保存在<code>SessionStorage</code>中就不会丢失；</li></ul><p><strong>设置和获取<code>SessionStorage</code></strong></p><p>设置<code>SessionStorage</code>的方法与设置<code>LocalStorage</code>的方法类似：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>设置</span><br><span class="line">sessionStorage.setItem(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>获取</span><br><span class="line">sessionStorage.getItem(<span class="string">&quot;key&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8SoXUmej1s2DaU2tZQw8nLT4kuOXe4ZhHS8ibtLickaPkQoDXamgRdicZg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>通过<code>Application</code>选项查看<code>SessionStorage</code>，可见已成功修改：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8oYPPCrLqMJpOYsCjoYX8cql4KdzaIbSar7umHhBtau3WJ00wibAqPOg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><strong>其他方法</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>该方法接受一个键名作为参数，并把该键名从存储中删除。</span><br><span class="line">sessionStorage.removeItem(<span class="string">&#x27;key&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="regexp">//</span>调用该方法会清空存储中的所有键名</span><br><span class="line">sessionStorage.clear();</span><br></pre></td></tr></table></figure><h3 id="3-IndexedDB"><a href="#3-IndexedDB" class="headerlink" title="3.IndexedDB"></a>3.<code>IndexedDB</code></h3><p><code>IndexedDB</code>是浏览器提供的一种<code>API</code>，用于存储客户端中大量的结构化数据。该<code>API</code>使用索引来实现对数据的高性能搜索。虽然<code>WebStorage</code>对于存储较少量的数据时很有用（采用<code>key/value</code>的方式），但对于存储更大量的结构化数据来说，还是<code>IndexedDB</code>表现更加优异。</p><p><strong><code>IndexedDB</code>的应用</strong></p><ul><li>为应用创建离线版本；</li></ul><p>可以在浏览器中打印<code>indexedDB</code>对象：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8871ObZxQaNYUadCQ0MbK3uplulwEKyUDWcBkOSwEHSneB7mc1Jayag/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h3 id="4-PWA"><a href="#4-PWA" class="headerlink" title="4.PWA"></a>4.<code>PWA</code></h3><p><code>PWA</code>（<code>Progressive Web Apps</code>）是一种<code>Web App</code>新模型（标准），并不是具体指某一种前沿的技术或者某一个单一的知识点。从英文缩写就能看出，这是一个渐进式的<code>Web App</code>，是通过一系列新的<code>Web</code>特性，配合优秀的<code>UI</code>交互设计，逐步增强用户的体验；</p><p><strong><code>PWA</code>的要求</strong></p><ul><li><strong>可靠：</strong>在没有网络的环境中也能提供基本的页面访问，而不会出现”未连接到互联网”的情况；</li><li><strong>快速：</strong>针对网页渲染及网络数据访问有较好优化；</li><li><strong>融入（<code>Engaging</code>）：</strong>应用可以被增加到手机桌面，并且和普通应用一样有全屏、推送等特性；</li></ul><h3 id="5-Service-Worker"><a href="#5-Service-Worker" class="headerlink" title="5.Service Worker"></a>5.<code>Service Worker</code></h3><p><code>Service Worker</code>是一个脚本，可以使浏览器独立于当前网页，在后台运行。为实现一些不依赖页面或者用户交互的特性打开了一扇大门。在未来这些特性将包括推送信息，背景后台同步，<code>geofencing</code>（地理围栏定位）等它将推出的第一个首要特性，就是拦截和处理网络请求的能力，包括以编程方式来管理被缓存的响应。</p><p>即<code>Service Worker</code>可以帮助浏览器执行大规模的运算而不阻碍主线程的执行。</p><p><strong><code>Service Worker</code>的应用</strong></p><ul><li>使用拦截和处理网络请求的能力，实现一个离线应用；</li><li>使用<code>Service Worker</code>在后台运行的同时能和页面通信的能力，去实现大规模后台数据的处理；</li></ul><p><strong><code>Service Worker</code>应用过程</strong></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8K9AQCT6QW0hsCDdxD3Hia0YXmlFSv3W5yrtQn9kQpBUnnVrFuPSGVCA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><strong>示例</strong></p><p>通过<code>Chrome</code>调试工具的<code>Application</code>选项可以查看淘宝的<code>Service Workers</code>信息：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8f6amM8zJkQ43Vic431b5oCicVtHJEbKz2iczjH5WL89QwXfRNaUf0ItSQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>当我们刷新淘宝网页的时候，查看<code>Network</code>选项，可以从请求文件的<code>size</code>栏发现大量的文件都是从<code>Service Worker</code>缓存中请求回来的：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8U07RGYYDhMTHmzdnSjtlIDq2mXAzWbs4Ub9zRrz15icgtEmhf2Em3Jg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>这样的话就可以利用<code>Service Worker</code>的缓存进行网站的性能优化。</p><p>以下列淘宝请求同一<code>js</code>文件为例，从<code>Service Worker</code>中加载使用了<code>7ms</code>：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8noibrfgiag6hdhgWEkdiamm4UJYRTJYort2Kl2WGj4soxSn5lQp8dNlsQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>使用<code>Ctrl + F5</code>强制刷新后，向服务器请求同一文件花了<code>100ms</code>：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8YoKTpTbf2IpgRvZJ4Ph79Gzhgpg4f8ibUxOgMZocyHzib4SmTtBSMQzw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>这就是使用<code>Service Worker</code>性能上带来的优势。由于是从本地缓存中读取的资源，所以资源读取的速度和整体的性能都会有一个明显的提升。</p><h2 id="八、HTTP通用缓存策略"><a href="#八、HTTP通用缓存策略" class="headerlink" title="八、HTTP通用缓存策略"></a>八、HTTP通用缓存策略</h2><h3 id="1-缓存的简介"><a href="#1-缓存的简介" class="headerlink" title="1.缓存的简介"></a>1.缓存的简介</h3><ul><li><p><strong>缓存定义：</strong></p><p>浏览器在本地磁盘上将用户之前请求的数据存储起来，当访问者再次需要改数据的时候无需再次发送请求，直接从浏览器本地获取数据</p></li><li><p><strong>缓存的好处：</strong></p></li><li><ul><li>减少请求的个数；</li><li>节省带宽，避免浪费不必要的网络资源；</li><li>减轻服务器压力；</li><li>提高浏览器网页的加载速度，提高用户体验；</li></ul></li></ul><h3 id="2-缓存相关的header字段"><a href="#2-缓存相关的header字段" class="headerlink" title="2.缓存相关的header字段"></a>2.缓存相关的header字段</h3><p>可以通过<code>Chrome</code>浏览器调试工具中的<code>Network</code>选项查看浏览器请求资源的情况：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8xupomupHMjKibWMRRxT0pPK9icFZyiazFqFEIjv1LUJyt4UvmAW9QQ8fQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>注意不要勾选图中方框内的选项，否则有些请求会被过滤；</p><h4 id="Cache-Control字段"><a href="#Cache-Control字段" class="headerlink" title="Cache-Control字段"></a><code>Cache-Control</code>字段</h4><p>服务器可通过<code>httpheader</code>中的<code>Cache-Control</code>字段控制客户端与服务器端之间的缓存策略，它的属性值有：</p><h5 id="max-age"><a href="#max-age" class="headerlink" title="max-age"></a><code>max-age</code></h5><p>该字段指定了缓存的最大有效时间，以下为淘宝的一张图片：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK88XwOVNm6PvrNK6ac6UBHjuAABsr3zBehSEEkFF81XYUByMiczAecSkg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>在<code>max-age</code>属性指定的时间未到期前，客户端不会向服务器发起请求，而是从缓存中直接读取该图片。上图中可以看到浏览器直接从<code>ServiceWorker</code>的缓存中读取了该图片资源。</p><p><code>Expires</code>字段同样可以指定缓存的有效期，不过这是<code>HTTP1.0</code>中的字段，优先级比<code>HTTP1.1</code>中的<code>Cache-Control</code>字段的<code>max-age</code>属性低；</p><h5 id="s-maxage"><a href="#s-maxage" class="headerlink" title="s-maxage"></a><code>s-maxage</code></h5><p>缓存设备总体来说有两种：浏览器（客户端）和<code>CDN</code>服务器；</p><ul><li>其中浏览器属于<code>private</code>类型缓存设备，表示只有浏览器才可以对资源进行缓存；</li><li><code>CDN</code>服务器属于<code>public</code>类型缓存设备，这种设备可以对源服务器上的资源进行缓存。并且，这种缓存对于任何用户来说都是可以访问的；</li></ul><p><code>s-maxage</code>的优先级在<code>Expires</code>和<code>max-age</code>三者之中是最高的，用于指定<code>public</code>类型缓存设备（比如<code>CDN</code>）上资源的有效期。如下图所示，该资源设定了该字段后，<strong>浏览器既不会使用浏览器缓存，也不会向服务器请求资源</strong>，而是向<code>public</code>类型的缓存设备（如<code>CDN</code>服务器）请求资源：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8sGTpOF1gflZlZEkv6WWYb6CEZuzXjOicbwicicbMmicmicAMHrY1lticlmJw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h5 id="private"><a href="#private" class="headerlink" title="private"></a><code>private</code></h5><p>服务器端可以通过该属性指定某一资源只能被浏览器（客户端）缓存，而不能被代理缓存服务器（<code>CDN</code>）缓存。</p><h5 id="public"><a href="#public" class="headerlink" title="public"></a><code>public</code></h5><p>服务器端可以通过该属性指定某一资源，既可以被浏览器缓存，也可以被代理缓存服务器缓存；</p><h5 id="no-cache"><a href="#no-cache" class="headerlink" title="no-cache"></a><code>no-cache</code></h5><p><code>no-cache</code>属性规定了浏览器要先向服务器端发送请求确认缓存资源的新鲜度，才能决定是否使用缓存；如下图所示：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK81Ghl3yVt5kuhYvsXEo144b8ejcSUpTAwbXlqemStG3fxhyxUmNMfbA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h5 id="no-store"><a href="#no-store" class="headerlink" title="no-store"></a><code>no-store</code></h5><p>该属性指定了浏览器无论缓存资源是否过期直接跳过缓存，重新向服务器请求资源。<code>no-store</code>属性用的比较少。</p><h4 id="Expires字段"><a href="#Expires字段" class="headerlink" title="Expires字段"></a><code>Expires</code>字段</h4><p>这是<code>http1.0</code>的规范；它的值为一个<strong>绝对时间</strong>的<code>GMT</code>(格林威治标准时间)格式时间字符串，如<code>Mon, 10 Jun 2015 21:31:12 GMT</code>；</p><p>该字段指定了浏览器缓存资源的过期时间，在指定的时间到期前，浏览器可以直接从本地缓存中读取数据，而无需再次向服务器发起请求，属于<strong>强缓存</strong>；相比于<code>max-age</code>与<code>s-maxage</code>优先级最低，在这两个属性存在的情况下<code>Expires</code>字段会失效；</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8WKibiaolHAPXFFvSVzyEBVOtjYa7CSVxP0h8ktGQBGnaVz7ibMFNv7ibYw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h4 id="标识资源变化的字段"><a href="#标识资源变化的字段" class="headerlink" title="标识资源变化的字段"></a>标识资源变化的字段</h4><h5 id="Last-Modified-If-Modified-Since"><a href="#Last-Modified-If-Modified-Since" class="headerlink" title="Last-Modified/If-Modified-Since"></a><code>Last-Modified/If-Modified-Since</code></h5><p>二者是基于客户端和服务端协商的缓存机制，标识资源最后更新时间的字段。<code>last-modified</code>字段位于<code>response header</code>中，<code>If-Modified-Since</code>字段位于<code>request header</code>中，二者配合着<code>Cache-Control</code>字段使用。</p><p>当服务器上的资源发生改变时会同步更新<code>last-modified</code>的字段值，当<code>Expires</code>字段或<code>max-age</code>属性指定的时间到期后，客户端会在请求头中携带<code>If-Modified-Since</code>字段，与服务器端资源的<code>last-modified</code>字段值进行比较：</p><ul><li><strong>情况一：</strong>如果二者相等说明资源自<code>last-modified</code>字段指定的时间以后都没有发生变化，此时服务器返回状态码<code>304</code>，属于<strong>协商缓存</strong>；</li><li><strong>情况二：</strong>如果二者不相等说明资源发生了更新，服务器返回最新的资源和最新的<code>last-modified</code>字段值，此时的状态码为<code>200</code>；</li></ul><p><strong>举例</strong></p><p>下图表示状态码为<code>304</code>的响应：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8ocmenDvHIv7rNKnqwbMctupFO5gd10f4qRaJTlYEaEzAdEtib2v9jng/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><ul><li>请求头中<code>If-Modified-Since</code>字段的值为<code>Mon, 23 Mar 2020 18:14:15 GMT</code>：</li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8F46WHbOTMyGevtGA07JzvKic5jlBuy0wJ9udMllfmrx1t1svwDtpicaw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><ul><li>响应头中<code>Last-Modified</code>字段的值为<code>Mon, 23 Mar 2020 18:14:15 GMT</code>：</li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8OEMdmtlUOib1jibSticO2gyGREIr9rlRj5naVnzv9Gib34gFLOWJ9y6OfQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>二者相等，说明资源没有发生变化，所以服务器返回状态码<code>304</code>，属于<strong>协商缓存</strong>，浏览器继续使用本地缓存；</p><blockquote><p><strong><code>If-Modified-Since</code>字段的值就是服务器端上一次响应资源中的<code>Last-Modified</code>字段值</strong>；</p></blockquote><p><strong><code>Last-Modified</code>的缺点</strong></p><ul><li>一些文件也许会周期性的更改，但是他的内容并不改变(仅仅改变的修改时间)，这个时候我们并不希望客户端认为这个文件被修改了，而重新<code>GET</code>；</li><li>某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说<code>1s</code>内修改了<code>N</code>次)，<code>If-Modified-Since</code>能检查到的粒度是<code>s</code>级的，这种修改无法判断（比如淘宝每<code>ms</code>都会更新数据）；</li><li>某些服务器端不能获取精确的修改时间；</li></ul><p>所以有了</p><h5 id="Etag-If-None-Match"><a href="#Etag-If-None-Match" class="headerlink" title="Etag/If-None-Match"></a><code>Etag/If-None-Match</code></h5><p><code>Etag</code>字段是<code>HTTP1.1</code>中的标准，是一个唯一标识服务器端资源的<code>hash</code>值，该字段存在于响应头（<code>reponse header</code>）中；与请求头（<code>request header</code>）中的<code>If-None-Match</code>字段及<code>Cache-Control</code>字段配合使用。</p><p>只要服务器端的资源发生变化<code>Etag</code>值就会改变，相比于<code>Last-Modified</code>字段优先级更高且更有效；当<code>Expires</code>值或者<code>Cache-Control</code>字段中的<code>max-age</code>值到期时，客户端会在请求头中携带<code>If-None-Match</code>字段，该字段值为服务器端上一次响应资源中的<code>Etag</code>值，并与服务器端上最新资源的<code>Etag</code>值进行比较：</p><ul><li><strong>情况一：</strong>如果两个字段值相等，说明资源未发生改变，服务器端拒绝响应，返回状态码<code>304</code>，属于<strong>协商缓存</strong>；</li><li><strong>情况二：</strong>如果两个字段值不相等说明服务器端上的资源发生了改变，服务器在响应中返回最新的资源和<code>Etag</code>值，此时状态码为<code>200</code>；</li></ul><p><strong>举例</strong></p><p>下图表示状态码为<code>304</code>的响应：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8bguaV3byQB96UMSelBmlgMRfP63yRCETk8sM0MQVLgFKMIWqobDIeA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><ul><li>请求头中<code>If-None-Match</code>字段值为<code>2da25d4039...</code>：</li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8FUflrHvUFHHkWzITLT2eYzY3y3hBO8k90c9wqCPEFEnXgnHaTOalvA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><ul><li>响应头中<code>Etag</code>字段值为<code>2da25d4039...</code>：</li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8VbLlaEVVrlWToUKWTkicJ9RicefBKlUpB6skxvRxt1icdsOeWIvZYrhlQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>二者相等，说明资源没有发生变化，所以服务器返回状态码<code>304</code>，属于<strong>协商缓存</strong>，浏览器继续使用本地缓存；</p><blockquote><p><strong>总结：</strong></p><p>利用<code>Etag</code>能够更加准确的控制缓存，因为<code>Etag</code>是服务器自动生成或者由开发者生成的对应资源在服务器端的唯一标识符；</p><p><code>Last-Modified</code>与<code>ETag</code>是可以一起使用的，由于<code>Etag</code>的优先度更高，所以服务器会优先比较<code>Etag</code>和<code>If-None-Match</code>。一致的情况下，才会继续比对<code>Last-Modified</code>和<code>If-Modified-Since</code>，最后才决定是否返回状态码<code>304</code>。</p></blockquote><h3 id="3-缓存策略"><a href="#3-缓存策略" class="headerlink" title="3.缓存策略"></a>3.缓存策略</h3><h4 id="缓存分类"><a href="#缓存分类" class="headerlink" title="缓存分类"></a>缓存分类</h4><ul><li><p><strong>强缓存：</strong></p></li><li><ul><li>不会向服务器发送请求，直接从本地缓存中获取数；</li><li>请求资源的的状态码为: <code>200 ok(from memory cache)</code>；</li></ul></li><li><p><strong>协商缓存：</strong></p></li><li><ul><li>向服务器发送请求，服务器会根据请求头的资源判断是否命中协商缓存；</li><li>如果命中，则返回状态码<code>304</code>通知浏览器从缓存中读取资源；</li></ul></li></ul><h4 id="强缓存与协商缓存的区别"><a href="#强缓存与协商缓存的区别" class="headerlink" title="强缓存与协商缓存的区别"></a>强缓存与协商缓存的区别</h4><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8YMRHiaG4MZWWibiad7QfKX3LFV33zEf1PPXYCe0CbhAjzs9ibGzUOfY2Pw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h4 id="分级缓存策略"><a href="#分级缓存策略" class="headerlink" title="分级缓存策略"></a>分级缓存策略</h4><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8SuX3uaKrkU78CVjzOPofWaXegR4JcSpgziczdKANnL3KU0HNDWNVBWQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><strong>最下层的<code>200</code>状态</strong></p><ul><li><p>这一层由<code>Expires/Cache-Control</code>字段控制：</p><p>当两者都存在时，<code>Cache-Control</code>会覆盖<code>Expires</code>，只要这些字段没有失效，浏览器都会直接使用本地缓存，属于<strong>强缓存</strong>；</p></li><li><ul><li><code>1.Expires</code>（<code>HTTP1.0</code>版本有效）是绝对时间；</li><li><code>2.Cache-Control</code>（<code>HTTP1.1</code>版本有效）是相对时间；</li></ul></li><li><p>缓存的来源大概有两种<code>memory cache</code>和<code>disk</code> cache：</p></li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8M5BNGMcCFcZabgbeIqwd4QmTZtRlstyRtjFEvwlkbkNlQiaBjmJiaPxA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>可以看到，从<code>memory cache</code>中读取缓存不需要时间，从<code>disk cache</code>中读取缓存则需要一定时间。</p><blockquote><p>相对时间与绝对时间与服务器的设置有关，当服务器设置<code>Atime</code>（最后访问时间）时，二者相等；当服务器设置<code>Mtime</code>（绝对修改时间）时，<code>Expires</code>从资源的创建开始计算过期时间，<code>Max-age</code>从请求发起的时间开始计算过期时间；</p></blockquote><p>下图便是淘宝中采用强缓存的例子，状态码为<code>200</code>，图片资源都是从浏览器缓存<code>memory cache</code>中读取，所以请求时间为0ms：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8GY4ic63heZKL2kPdX2UHrkQJck3h2tTZ6u6vDCW7sbV4gqJdy8Q138Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><strong>中间的<code>304</code>状态</strong></p><ul><li>这一层由<code>last-modified/Etag</code>控制。当下一层失效时或用户点击<code>refresh/F5</code>时，浏览器就会向服务器发起请求，如果服务器上的相关资源没有更新，则返回状态码<code>304</code>，属于<strong>协商缓存</strong>；</li></ul><p>下图便为协商缓存的情况，状态码为<code>304</code>。也可以这样理解：只要状态码是<code>304</code>都属于协商缓存：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8Zic5YBoKiau1pibHveD6GGOaTvtgsCf4z6mv34rU9Udt0yV0uy42XMHHg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><strong>最上层的<code>200</code>状态</strong></p><ul><li>当浏览器本身没有缓存或者下一层失效时，或者用户点击了<code>Ctrl + F5</code>强制刷新时，浏览器会直接向服务器请求最新的资源；</li></ul><p>如下图所示：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8EkY0QCJoibiboTsqB4lPelbb7tfhRXkWribkCaej0MHiazye3OSpWonFeg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h4 id="用户行为对缓存的影响"><a href="#用户行为对缓存的影响" class="headerlink" title="用户行为对缓存的影响"></a>用户行为对缓存的影响</h4><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8k8BH76aynUPBvBYmNicc4NHgWCWBHEWiap0qibjWS64pPdPRzpPEuGicOA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h4 id="缓存策略过程分析"><a href="#缓存策略过程分析" class="headerlink" title="缓存策略过程分析"></a>缓存策略过程分析</h4><p>如图所示，该流程图表示服务器端在处理资源时采用缓存策略的过程：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8FMD6WyA6U8tcRv7pFe5XzHdNo2gibjoHvNNMmF0rOLrO7tOq9QicGGPA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><ul><li>首先服务器判断资源是否可以复用，不可复用则在<code>Cache-Control</code>字段中添加<code>no-store</code>属性；</li><li>可以复用的情况下，判断资源是否要求强一致？若是，则在<code>Cache-Control</code>字段中添加<code>no-cache</code>属性，这样不管缓存资源是否过期，都要求客户端或缓存代理服务器首先向服务器确认资源的新鲜度，属于<strong>协商缓存</strong>；</li><li>随后服务器指定是否允许<code>Web</code>代理缓存资源（比如<code>CDN</code>服务器缓存），如果允许则在<code>Cache-Control</code>字段中添加<code>public</code>属性，并指定代理缓存服务器上资源的有效期<code>s-maxage</code>；不允许则添加<code>private</code>属性，表示只能由客户端浏览器缓存资源，并设定缓存的有效期<code>max-age</code>；</li><li>随后，根据情况在客户端浏览器中，选择强缓存或者协商缓存；</li></ul><h2 id="九、服务端性能优化"><a href="#九、服务端性能优化" class="headerlink" title="九、服务端性能优化"></a>九、服务端性能优化</h2><h3 id="1-CDN服务器"><a href="#1-CDN服务器" class="headerlink" title="1.CDN服务器"></a>1.<code>CDN</code>服务器</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>网站通常将其所有的服务器都放在同一个地方，当用户群增加时，公司就必须在多个地理位置不同的服务器上部署内容。为了缩短<code>http</code>请求的时间，我们应该把大量的静态资源放置的离用户近一点。</p><p>内容发布网络<code>CDN</code>（<code>Content Delivery Networks</code>）就是其中一种方式。<code>CDN</code>是一组分布在多个不同地理位置或网段的<code>web</code>服务器，用于更加有效的向用户发布内容。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8XlUKj1QLNDrVpxFWNj4RUNHT0FomGJJszcV8tkOxUATvYphty282AA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><h4 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h4><ul><li>尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输的更快、更稳定；</li><li>通过在网络各处放置节点服务器，在现有的互联网基础之上构成一层智能虚拟网络；</li><li><code>CDN</code>系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息<br>将用户的请求重新导向离用户最近的服务节点上。</li></ul><h4 id="基础架构"><a href="#基础架构" class="headerlink" title="基础架构"></a>基础架构</h4><p>最简单的<code>CDN</code>网络由一个DNS服务器和几台缓存服务器组成：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8ymr6HJznTLey42lUoFbzqbVZxUzqXZUbPLhRGXUUE5nAMgklAiaCtFA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><ul><li>1、当用户点击网站页面上内容的<code>URL</code>时，经过本地<code>DNS</code>系统解析，<code>DNS</code>系统最终会将域名的解析权交给<code>CNAME</code>指向的<code>CDN</code>专用的<code>DNS</code>服务器；</li></ul><blockquote><p>关于<code>DNS</code>解析，不一定由<code>DNS</code>服务器响应，一般从缓存中读取。比如电脑缓存、浏览器缓存、路由器缓存、运行商缓存等。如果缓存中没有找到，才一级一级地查询：本地<code>DNS</code>-&gt; 权限<code>DNS</code> -&gt; 顶级<code>DNS</code> -&gt; 根<code>DNS</code>。全球只有<code>13</code>台根<code>DNS</code>服务器。</p></blockquote><ul><li><p>2、<code>CDN</code>的<code>DNS</code>服务器将<code>CDN</code>的全局负载均衡设备的<code>IP</code>地址返回给用户；</p></li><li><p>3、用户向<code>CDN</code>的全局负载均衡设备发起内容<code>URL</code>访问请求；</p></li><li><p>4、<code>CDN</code>全局负载均衡设备根据用户的<code>IP</code>地址，以及用户请求的内容<code>URL</code>，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求；</p></li><li><p>5、区域负载均衡设备会为用户选择一台合适的缓存服务器提供服务，选择的依据包括：</p><p>基于以上这些条件的综合分析之后，<code>CDN</code>区域负载均衡设备会向<code>CDN</code>全局负载均衡设备返回一台<code>CDN</code>缓存服务器的<code>IP</code>地址。</p></li><li><ul><li>根据用户<code>IP</code>地址，判断哪一台服务器距用户最近；</li><li>根据用户所请求的<code>URL</code>中携带的内容名称，判断哪一台服务器上有用户所需内容；</li><li>查询各个服务器当前的负载情况，判断哪一台服务器尚有服务能力；</li></ul></li><li><p>6、<code>CDN</code>全局负载均衡设备把服务器的<code>IP</code>地址返回给用户；</p></li><li><p>7、用户向<code>CDN</code>缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端；如果这台<code>CDN</code>缓存服务器上并没有用户想要的内容，但是区域均衡设备依然将它分配给了用户，那么这台<code>CDN</code>服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地；</p></li></ul><h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><ul><li><p><strong>网站站点/应用加速：</strong></p><p>站点或者应用中大量静态资源的加速分发，建议将站点内容进行动静分离，动态文件可以结合云服务器<code>ECS</code>，静态资源如各类型图片、<code>html</code>、<code>css</code>、<code>js</code>文件等，使用<code>CDN</code>服务器存储，可以有效加速内容加载速度，轻松搞定网站图片、短视频等内容分发。</p></li><li><p><strong>移动应用加速：</strong></p><p>移动<code>APP</code>更新文件（<code>apk</code>文件）分发，移动<code>APP</code>内图片、页面、短视频、<code>UGC</code>等内容的优化加速分发。提供<code>httpDNS</code>服务，避免<code>DNS</code>劫持并获得实时精确的<code>DNS</code>解析结果，有效缩短用户访问时间，提升用户体验。</p></li><li><p><strong>视音频点播/大文件下载分发加速；</strong></p></li><li><p><strong>视频直播加速；</strong></p></li></ul><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>简单点说<code>CDN</code>服务器相当于顺丰快递分布于全国各地的仓库，主仓库将快递运送到这些分仓库，用户可以就近取货，由此加快了速度。</p><p>除此之外<code>CDN</code>服务器还有许多高级功能，比如防止<code>DDOS</code>攻击等，这里就不展开了；</p><h3 id="2-SSR-Server-Side-Rendering"><a href="#2-SSR-Server-Side-Rendering" class="headerlink" title="2.SSR(Server Side Rendering)"></a>2.<code>SSR(Server Side Rendering)</code></h3><p>依赖现代框架如<code>Vue</code>和<code>React</code>构建的网站，往往会存在一定的问题，比如<code>Vue</code>框架。</p><p><strong><code>Vue</code>渲染面临的问题</strong></p><p>首屏渲染时，要先下载和解析<code>app.js</code>（打包过后的<code>Vue.js</code>）之后，才能开始渲染页面。</p><p><strong>优化方案</strong></p><ul><li>构建层模板编译：将模板编译的任务放在了构建层中完成，而不是浏览器；</li><li>数据无关的<code>Prerender</code>的方式；</li><li><strong>服务端渲染</strong>：即将浏览器端进行的运算的一部分转移到服务器端上；</li></ul><p>通常采用服务端渲染（<code>SSR</code>）的方式进行优化。所谓<code>SSR</code>就是利用服务器端优秀的计算能力，将一部分的页面渲染任务交由服务器端进行处理。以下为服务端渲染<code>SSR</code>的流程图：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/Hp2EvpxBicAjGNAHslictNl1iaB40KAYEK8TibANyf7X1OZu9Dsc5xV6ZucPSuic2opz8RVpky6VaDQvelwyYf17zjQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>服务端渲染可以很好地优化首屏渲染的问题；可以根据业务需求，适当地分配客户端和服务器端的渲染部分，综合利用客户端和服务器端的计算能力，从而达到性能优化的目的。</p><ul><li>本文作者：AhuntSun</li><li>本文链接：<a href="https://www.cnblogs.com/AhuntSun-blog/p/12641050.html">https://www.cnblogs.com/AhuntSun-blog/p/12641050.html</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;当我们去面试的时候，很大概率会被面试官问这么一个问题：你有尝试过对项目做性能优化吗？或者你了解哪些性能优化的方法？听到这个问题的你可能是这样</summary>
      
    
    
    
    <category term="frontEnd" scheme="https://lxx1997.github.io/categories/frontEnd/"/>
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="html" scheme="https://lxx1997.github.io/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>深拷贝、浅拷贝</title>
    <link href="https://lxx1997.github.io/2020/12/09/web/deep-copy-light-copy/"/>
    <id>https://lxx1997.github.io/2020/12/09/web/deep-copy-light-copy/</id>
    <published>2020-12-09T02:58:38.000Z</published>
    <updated>2020-12-09T02:58:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>  简单值（基本类型值）总是通过值复制的方式来赋值/传递 <code>null</code>,<code>undefined</code>,<code>symbol</code>,<code>string</code>,<code>number</code>,<code>boolean</code><br>  复杂值（对象和函数）总是通过引用复制的方式来赋值/传递 <code>object</code>, <code>array</code>, <code>function</code><br>  <em>由于引用指向的值本身而非变量，因此一个引用无法更改另一个引用的指向</em><br>  <em>不能通过引用一个新的引用来更改旧的引用的指向，只能修改新旧引用共同指向的值</em><br>  如果通过值复制的方式来传递复合值，就需要创建一个复本，这样传递的就不是原始值<code>foo(a.slice())</code>，foo中的操作不会影响到a指向的数组</p><p>  因此会发现复杂值的赋值的时候，例如 <code>a = obj</code>，当我们改变a中某个属性的值时，这是obj里面对应属性的值也发生了变化，这种就是<strong>浅拷贝</strong></p><p>  如果a的属性的值发生改变，obj对应属性的值不发生变化，这种就是<strong>深拷贝</strong></p><h2 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h2><p>  浅拷贝拷贝的是引用地址，实现方式有以下几种</p><ul><li><code>Object.assign(target, obj1, obj2...)</code>将第二个参数及以后的参数合并到第一个对象里  – <em>前提传入的参数都是多层嵌套，单层的话是深拷贝</em></li><li><code>for...in...</code>遍历每一个属性，将他们复制给新的对象，对象必须是多层的状态下才能实现浅拷贝 – <em>前提传入的参数都是多层嵌套，单层的话是深拷贝</em></li><li><code>$.extend(boolean?, &#123;&#125;, obj1, obj2...)</code> jquery的对象扩展方法,boolean如果为true是深拷贝，不填就是浅拷贝，将第三个参数及以后的参数合并到第二个对象里 – <em>前提传入的参数都是多层嵌套，单层的话是深拷贝</em></li><li>es6新方法 扩展运算符 <code>...</code> – <em>前提传入的参数都是多层嵌套，单层的话是深拷贝</em></li><li><p><code>Array.prototype.concat()</code>,<code>Array.prototype.slice()</code><br>slice和concat方法不会修改原数组，只会返回一个浅复制了原数组中的一个新数组 <em>对象会发生变化，<code>String</code>,<code>Number</code>,<code>boolean</code>不会发生变化</em></p><h2 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h2><p>深拷贝拷贝的是对象的数据而不是地址</p></li><li><p><code>JSON.stringify()</code>,<code>JSON.parse()</code>,</p><p>但是使用 这种方法进行深拷贝会有一些几个问题</p><ol><li>这个方法对于对象中包含函数不使用，因为不会拷贝函数</li><li>如果属性的值为 undefined，会在深拷贝的过程被删除</li><li>RegExp，Error 对象会失去原本属性变成 <code>&#123;&#125;</code></li><li>Sympbol 不能被序列化</li><li>会丢失对象原型</li><li>存在循环引用的时候，无法正确实现深拷贝</li></ol></li><li><p>es6新方法 扩展运算符 <code>...</code> – <em>前提传入的参数都是多层嵌套，单层的话是深拷贝</em></p></li><li><p>loadsh</p></li><li><p>手动进行递归赋值</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;  简单值（基本类型值）总是通过值复制的方式来赋值/传递 &lt;code&gt;null&lt;/code&gt;,&lt;code&gt;undefined&lt;/code&gt;,</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Symbol详解</title>
    <link href="https://lxx1997.github.io/2020/12/04/web/Symbol%E8%AF%A6%E8%A7%A3/"/>
    <id>https://lxx1997.github.io/2020/12/04/web/Symbol%E8%AF%A6%E8%A7%A3/</id>
    <published>2020-12-04T07:23:00.000Z</published>
    <updated>2020-12-04T07:23:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="定义Symbol"><a href="#定义Symbol" class="headerlink" title="定义Symbol"></a>定义Symbol</h2>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sym = <span class="title class_">Symbol</span>()</span><br><span class="line"><span class="keyword">var</span> sym1 = <span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>)</span><br></pre></td></tr></table></figure><p>  <code>Symbol(&#39;foo&#39;)</code>并不会强制将字符串foo转化成symbol类型，他每次都会创建一个新的symbol类型<br>  因此<code>Symbol(&#39;foo&#39;) !== Symbol(&#39;foo&#39;)</code></p><p>  <strong>如果想要创建一个Symbol包装器对象</strong>，可以使用<code>Object()</code>函数</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sym = <span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line"><span class="keyword">typeof</span> sym  <span class="comment">// &#x27;symbol</span></span><br><span class="line"><span class="keyword">var</span> symObj = <span class="title class_">Object</span>(sym)</span><br><span class="line"><span class="keyword">typeof</span> symObj <span class="comment">// &#x27;object&#x27;</span></span><br></pre></td></tr></table></figure><p>  <strong>全局共享的Symbol</strong><br>    可以使用<code>Symbol.for()</code>或<code>Symbol.keyFor()</code>方法从全局的symbol注册表设置和取得symbol</p><p>  <strong>在对象中查找symbol属性</strong><br>    <code>Object.getOwnPropertySymbols()</code>查找一个给定对象的符号属性时返回一个symbol类型的数组，数组可能为空</p><h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><ol><li><code>Symbol.iterator</code> 为每一个对象定义了默认的迭代器，可以被<code>for...of</code>循环使用</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">当需要对一个对象进行迭代时，它的<span class="code">`@@iterator`</span>方法都会在不传参情况下被调用，返回的迭代器用于获取要迭代的值</span><br><span class="line"></span><br><span class="line">一些内置类型拥有默认的迭代器行为</span><br><span class="line"><span class="bullet">*</span> <span class="code">`Array.prtotype[@@iterator]()`</span></span><br><span class="line"><span class="bullet">*</span> <span class="code">`TypedArray.prtotype[@@iterator]()`</span></span><br><span class="line"><span class="bullet">*</span> <span class="code">`String.prtotype[@@iterator]()`</span></span><br><span class="line"><span class="bullet">*</span> <span class="code">`Map.prtotype[@@iterator]()`</span></span><br><span class="line"><span class="bullet">*</span> <span class="code">`Set.prtotype[@@iterator]()`</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**自定义迭代器**</span></span><br><span class="line"><span class="code">~~~js</span></span><br><span class="line"><span class="code">  var myIterable = &#123;&#125;</span></span><br><span class="line"><span class="code">  myIterable[Symbol.iterator] = function* () &#123;</span></span><br><span class="line"><span class="code">    yield 1;</span></span><br><span class="line"><span class="code">    yield 2;</span></span><br><span class="line"><span class="code">    yield 3;</span></span><br><span class="line"><span class="code">  &#125;</span></span><br><span class="line"><span class="code">  [...myIterable]  // [1,2,3]</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">  for (var x of myIterable) &#123;</span></span><br><span class="line"><span class="code">    console.log(x) / 1 -&gt; 2 -&gt; 3</span></span><br><span class="line"><span class="code">  &#125;</span></span><br><span class="line"><span class="code">~~~</span></span><br><span class="line"></span><br><span class="line">如果一个迭代器没有返回一个迭代器对象，那么他是一个不合格的迭代器，在运行时将会抛出异常</span><br></pre></td></tr></table></figure><ol start="2"><li><p><code>Symbol.asyncIterator</code> 是一个用于访问对象的<code>@@asyncIteratir</code>方法的内建符号，一个异步可迭代对象必须要有<code>Symbol.asyncIterator</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myAsyncIterable = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">myAsyncIterable[<span class="title class_">Symbol</span>.<span class="property">asyncIterator</span>] = <span class="keyword">async</span> <span class="keyword">function</span>*() &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;async&quot;</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&quot;iteration!&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">const</span> x <span class="keyword">of</span> myAsyncIterable) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line">        <span class="comment">// expected output:</span></span><br><span class="line">        <span class="comment">//    &quot;hello&quot;</span></span><br><span class="line">        <span class="comment">//    &quot;async&quot;</span></span><br><span class="line">        <span class="comment">//    &quot;iteration!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></li><li><p><code>Symbol.match</code>指定了匹配的是正则表达式而不是字符串，<code>String.prototype.match()</code>方法会调用此函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> regexp = <span class="regexp">/foo/</span></span><br><span class="line">regexp[<span class="title class_">Symbol</span>.<span class="property">match</span>] = <span class="literal">false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo&#x27;</span>.<span class="title function_">startWith</span>(regexp))  <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;baz&#x27;</span>.<span class="title function_">startWith</span>(regexp))  <span class="comment">// false</span></span><br></pre></td></tr></table></figure></li><li><p><code>Symbol.replace</code>这个属性指定了当一个字符串替换所匹配字符串时调用的方法，<code>String.prototype.replace()</code>会调用此方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Replace</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value</span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">replace</span>](string) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`s/<span class="subst">$&#123;string&#125;</span>/<span class="subst">$&#123;<span class="variable language_">this</span>.value&#125;</span>/g`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo&#x27;</span>.<span class="title function_">replace</span>(<span class="keyword">new</span> <span class="title class_">Replace</span>(<span class="string">&#x27;bar&#x27;</span>))) <span class="comment">// s/foo/bar/g</span></span><br></pre></td></tr></table></figure></li><li><p><code>Symbol.search</code>指定了一个搜索方法，这个方法接受用户输入的正则表达式，返回改正则表达式在字符串中匹配到的下标 <code>String.prototype.search()</code>会调用此方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">caseInsensitiveSearch</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value.<span class="title function_">toLowerCase</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">search</span>](string) &#123;</span><br><span class="line">    <span class="keyword">return</span> string.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foobar&#x27;</span>.<span class="title function_">search</span>(<span class="keyword">new</span> <span class="title function_">caseInsensitiveSearch</span>(<span class="string">&#x27;BaR&#x27;</span>))); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure></li><li><p><code>Symbol.split</code>指向一个正则表达式的索引处分割字符串的方法，这个方法通过<code>String.prototype.split()</code>调用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/a/[<span class="title class_">Symbol</span>.<span class="property">split</span>](<span class="string">&#x27;aba&#x27;</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> exp = &#123;</span><br><span class="line">  <span class="attr">pat</span>: <span class="string">&#x27;in&#x27;</span></span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">split</span>](str) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">split</span>(<span class="variable language_">this</span>.<span class="property">pat</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">&#x27;dayinlove&#x27;</span>.<span class="title function_">split</span>(exp)</span><br></pre></td></tr></table></figure></li><li><p><code>Symbol.hasInstance</code> 可以判断某对象是否为某构造器的实例，应此你们可以用它自定义<code>instanceof</code>操作符在某个类上的行为</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Array1</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> [<span class="title class_">Symbol</span>.<span class="property">hasInstance</span>](instance) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">isArray</span>(instance)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([] <span class="keyword">instanceof</span> <span class="title class_">Array1</span>)  <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><p><code>Symbol.isConcatSpreadable</code>符号用于配置某对象作为<code>Array.prototype.concat()</code>方法的参数时是否展开数据元素</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> b = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> ab = a.<span class="title function_">concat</span>(b)  <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, 1, 2, 3]</span></span><br><span class="line"></span><br><span class="line">b[<span class="title class_">Symbol</span>.<span class="property">isConcatSpreadable</span>] = <span class="literal">false</span></span><br><span class="line">ab = a.<span class="title function_">concat</span>(b) <span class="comment">// [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, Array[1, 2, 3]]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol start="9"><li><p><code>Symbol.toStringTag</code>作为对象的属性键使用，对用的属性值应该为字符串类型，内置的<code>Object.prototype.toString()</code>方法会读取这个标签并把它包含在自己的返回值里面</p><p>加上<code>toStringTag</code>属性，你的类也可以自定义类型标签</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">myClass</span> &#123;</span><br><span class="line">  get [<span class="title class_">Symbol</span>.<span class="property">toStringTag</span>]() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;myClass&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(<span class="keyword">new</span> <span class="title function_">myClass</span>())) <span class="comment">// &#x27;[object myClass]&#x27;</span></span><br></pre></td></tr></table></figure><ol start="10"><li><code>Symbol.for()</code>方法会根据给定的键<code>key</code>，来从运行时的symbol注册表中找到对应的symbol，如果找到了就返回，没有找到就新建一个symbol并加入到全局symbol的注册表中</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;foo&#x27;</span>)  <span class="comment">// 全局注册 foo</span></span><br><span class="line"><span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;foo&#x27;</span>)  <span class="comment">// 返回上一个全局注册的foo</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;foo&#x27;</span>) === <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;foo&#x27;</span>) <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>) === <span class="title class_">Symbol</span>(<span class="string">&#x27;foo&#x27;</span>) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sym = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;mario&#x27;</span>)</span><br><span class="line">sym.<span class="title function_">toSstring</span>() <span class="comment">// &#x27;Symbol(mario)&#x27;</span></span><br></pre></td></tr></table></figure><ol start="11"><li><code>Symbol.keyFor()</code> 用来获取全局symbol注册表中与某个symbol关联的键</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个全局 Symbol </span></span><br><span class="line"><span class="keyword">var</span> globalSym = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&quot;foo&quot;</span>); </span><br><span class="line"><span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(globalSym); <span class="comment">// &quot;foo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> localSym = <span class="title class_">Symbol</span>(); </span><br><span class="line"><span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(localSym); <span class="comment">// undefined，</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下Symbol不是保存在全局Symbol注册表中</span></span><br><span class="line"><span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(<span class="title class_">Symbol</span>.<span class="property">iterator</span>) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;定义Symbol&quot;&gt;&lt;a href=&quot;#定义Symbol&quot; class=&quot;headerlink&quot; title=&quot;定义Symbol&quot;&gt;&lt;/a&gt;定义Symbol&lt;/h2&gt;  &lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td cla</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="Symbol" scheme="https://lxx1997.github.io/tags/Symbol/"/>
    
    <category term="ES6" scheme="https://lxx1997.github.io/tags/ES6/"/>
    
  </entry>
  
  <entry>
    <title>你不知道的javascript中卷 知识点摘录</title>
    <link href="https://lxx1997.github.io/2020/12/03/reading/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84javascript%E4%B8%AD%E5%8D%B7/"/>
    <id>https://lxx1997.github.io/2020/12/03/reading/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84javascript%E4%B8%AD%E5%8D%B7/</id>
    <published>2020-12-03T06:41:36.000Z</published>
    <updated>2020-12-03T06:41:36.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="第一章-类型和语法"><a href="#第一章-类型和语法" class="headerlink" title="第一章 类型和语法"></a>第一章 类型和语法</h4><ul><li><p><strong>内置类型</strong></p><ul><li>空值 <code>null</code>  <code>typeof null === &#39;object&#39;</code></li><li>未定义 <code>undefined</code>  <code>typeof undefined === &#39;undefined&#39;</code></li><li>布尔值 <code>boolean</code>  <code>typeof true === &#39;boolean&#39;</code></li><li>数字 <code>number</code>  <code>typeof 42 === &#39;number&#39;</code></li><li>字符串 <code>string</code>  <code>typeof &#39;42&#39; === &#39;string&#39;</code></li><li>对象 <code>object</code>  <code>typeof &#123;life: 42&#125; === &#39;object&#39;</code></li><li>符号 <code>symbol</code>  <code>typeof Symbol() === &#39;symbol&#39;</code></li><li><code>typeof function() &#123;/* .. */&#125; === &#39;function&#39;</code></li><li><code>typeof [1,2,3] === &#39;object&#39;</code> 数组是object的一个子类型</li></ul><p>对变量执行<code>typeof</code>操作时，得到的结果并不是该变量的类型，而是该变量持有的值的类型，因为javascript中的变量没有类型</p></li><li><p><code>undefined</code> 和 <code>undeclared</code></p><p>已在作用域中声明但还没有赋值的变量是<code>undefined</code>，还没有在作用域声明过的变量是<code>undeclared</code></p></li><li><p><strong>数组</strong></p><ul><li><p><code>delete</code>运算符可以将单元从数组中删除，但是数据的length属性并不会发生变化</p></li><li><p><em>如果字符串键值能够被强制类型转换为十进制数字的话，他就会被当做数字索引来处理</em></p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = []</span><br><span class="line">a[<span class="string">&#x27;13&#x27;</span>] = <span class="number">43</span></span><br><span class="line">a.<span class="property">length</span> <span class="comment">// 14</span></span><br></pre></td></tr></table></figure><ul><li><p>类数组 - 有时候需要将类数组转换为真正的数组</p><ul><li>通过for循环遍历类数组，将类数组的每一个元素复制到新的数组里</li><li><code>slice</code> 返回的是类数组的一个数组复本<br><code>Array.prototype.slice.call(arguments)</code></li><li><code>concat</code><br><code>Array.prototype.concat.apply([], arguments)</code></li><li><code>splice</code><br><code>Array.prototype.splice.call(arguments, 0)</code></li><li><code>Array.form()</code></li></ul></li></ul></li><li><p><strong>字符串</strong></p><ul><li>字符串和数据的确很相似，都是类数组，都有<code>length</code>属性，以及<code>indexOf</code>和<code>concat</code>方法，但是<em>字符串是不可变的</em>，<em>数组是可变的</em></li><li>字符串可以借用数组的非变更方法来处理字符串<br><code>Array.prototype.join.call(a, &#39;-)</code>,<code>Array.prototype.map.call(a, function() &#123;/* .. */&#125;)</code></li><li>字符串反转 可以先将字符串转成数组反转后再转成字符串<br><code>string.split(&#39;&#39;).reverse().join(&#39;&#39;)</code> 包含复杂的字符，可以使用工具库</li></ul></li><li><p><strong>数字</strong></p><ul><li>数字常亮一般用十进制表示，数字前面的<code>0</code>可以省略，小数部分最后面的<code>0</code>也可以省略</li><li>指数模式 <code>5E10 === 50000000000 === 50000000000.toExponential() //5e+10</code></li><li><code>.toFixed()</code> 指定小数部分的显示位数 输出结果实际上是给定数字的字符串形式，如果指定的小数部分显示位数多余实际位数就用0补齐</li><li><code>.toPrecision()</code> 用来指定有效位数的显示位数</li><li><em>对于<code>.</code>运算符，因为它是一个有效的数字字符，会被优先识别为数字常量的一部分，然后才是对象属性访问运算符</em><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">42.</span><span class="title function_">toFixed</span>(<span class="number">3</span>) <span class="comment">// SyntaxError</span></span><br><span class="line">(<span class="number">42</span>).<span class="title function_">toFixed</span>(<span class="number">3</span>) <span class="comment">// &#x27;42.000&#x27;</span></span><br><span class="line"><span class="number">0.42</span>.<span class="title function_">toFixed</span>(<span class="number">3</span>) <span class="comment">// &#x27;0.420&#x27;</span></span><br><span class="line"><span class="number">42.</span>.<span class="title function_">toFixed</span>(<span class="number">3</span>) <span class="comment">// &#x27;42.000&#x27;</span></span><br><span class="line"><span class="number">42</span> .<span class="title function_">toFixed</span>(<span class="number">3</span>) <span class="comment">// &#x27;42.000&#x27;</span></span><br></pre></td></tr></table></figure></li><li>数字常量的格式<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0xf3</span> <span class="comment">// 243的16进制</span></span><br><span class="line"><span class="number">0363</span> <span class="comment">// 243的八进制</span></span><br><span class="line"><span class="comment">// es6</span></span><br><span class="line"><span class="number">0o363</span> <span class="comment">// 243的八进制</span></span><br><span class="line"><span class="number">0b11110011</span> <span class="comment">// 243的二进制</span></span><br></pre></td></tr></table></figure></li><li>极小数运算 为了保证精准，可以设置一个误差范围值（<em>机械精度</em>）<code>Number.EPSILON</code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果没有Number.EPSILON，自己定义Number.EPSILON，如果有直接拿来使用</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title class_">Number</span>.<span class="property">EPSILON</span>) &#123;</span><br><span class="line">  <span class="title class_">Number</span>.<span class="property">EPSILON</span> = <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">2</span>, -<span class="number">52</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">numbersCloseEnoughToEqual</span>(<span class="params">n1, n2</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">abs</span>(n1 - n2) &lt; <span class="title class_">Number</span>.<span class="property">EPSILON</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">0.1</span> + <span class="number">0.2</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="number">0.3</span></span><br><span class="line"><span class="title function_">numbersCloseEnoughToEqual</span>(a, b)  <span class="comment">// true</span></span><br></pre></td></tr></table></figure></li><li><code>Number.MAX_VALUE</code> 为 <code>Math.pow(2, 53) - 1</code> 即 <code>2^53-1</code> 在es6中被定义为<code>Number.MAX_SAFE_INTEGER</code></li><li>最小整数是 <code>-Math.pow(2, 53) + 1</code> 在es6中被定义为<code>Number.MIN_SAFE_INTEGER</code></li><li>整数检测 <code>Number.isInteger(..)</code></li><li>检查一个值是否是安全的整数 <code>Number.isSafeInteger(..)</code></li><li><code>a | 0</code>可以将变量a中的数值转化为32位有符号整数，因为数位运算符<code>|</code>只适用32位整数，因此与0进行操作即可截取a中的32位数位</li></ul></li><li><p><strong>特殊数值</strong></p><ul><li><p><em>不是值的值</em><br><code>undefined</code>类型只有一个值 <code>undefined</code>, <code>null</code>类型也只有一个值，即<code>null</code><br><code>null</code>指空值，不能作为标识符，不能将其作为变量来使用和赋值, <code>undefined</code>指没有值，是一个标识符，可以被当做变量使用和赋值</p><p><code>undefined</code>是一个内置标识符，他的值为<code>undefined</code>，通过<code>void</code>运算符即可得到该值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">42</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">void</span> a, a) <span class="comment">// undefined 42</span></span><br></pre></td></tr></table></figure></li><li><p>特殊的数字</p><ul><li><code>NaN</code> 它与自身不相等，需要用<code>isNaN</code> or <code>Number.isNaN</code>方法来判断是否是NaN</li><li>无穷数 可以从有穷到无穷，但是无法从无穷到有穷 <code>±Infinity</code></li><li>零值 加法和减法无法的到0值 <code>JSON.stringify(-0) =&gt; &#39;0&#39;  JSON.parse(&#39;-0&#39;) =&gt; &#39;0&#39;</code></li></ul></li><li><p>特殊等式</p><ul><li><code>Object.is()</code> 主要用来处理特殊的相等比较</li><li><code>==</code>和<code>===</code>的效率更高，更为通用</li></ul></li><li><p>值和引用</p><ul><li>简单值（基本类型值）总是通过值复制的方式来赋值/传递 <code>null</code>,<code>undefined</code>,<code>symbol</code>,<code>string</code>,<code>number</code>,<code>boolean</code></li><li>复杂值（对象和函数）总是通过引用复制的方式来赋值/传递 <code>object</code>, <code>array</code>, <code>function</code><br><em>由于引用指向的值本身而非变量，因此一个引用无法更改另一个引用的指向</em><br><em>不能通过引用一个新的引用来更改旧的引用的指向，只能修改新旧引用共同指向的值</em><br>如果通过值复制的方式来传递复合值，就需要创建一个复本，这样传递的就不是原始值<code>foo(a.slice())</code>，foo中的操作不会影响到a指向的数组</li></ul></li></ul></li><li><p><strong>原生函数</strong></p><ul><li>String()</li><li>Number()</li><li>Boolean() <em>通过Boolean创建的真值并不是真正意义的真值 ，它总是<code>true</code></em></li><li>Array()</li><li>Object()</li><li>Function()</li><li>RegExp()</li><li>Date()</li><li>Error()</li><li>Symbol()</li></ul><p>原生函数可以被当做构造函数来使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line"><span class="keyword">typeof</span> a <span class="comment">// object</span></span><br><span class="line">a <span class="keyword">instanceof</span> <span class="title class_">String</span> <span class="comment">// true</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(a) <span class="comment">// &#x27;[object String]&#x27;</span></span><br></pre></td></tr></table></figure><ul><li><p>内部属性[[Class]]<br><code>typeof</code> 返回值为<code>object</code>的对象都包含有一个内部属性[[Class]],这个属性无法直接访问，可以通过<code>Object.prototype.toString.call(..)</code>来查看</p><p><em>Null的内部属性为<code>[object Null]</code> Undefined的内部属性为<code>[object Undefined]</code></em></p></li><li><p>封装对象包装<br>如果想要自行封装基本类型值，可以使用<code>Object(..)</code>函数，一般不推介使用封装对象<br>部分封装对象封装基本类型时获取到的值并非我们想要的值(<code>Boolean</code>)</p></li><li><p>拆封<br>想要得到封装对象中的基本类型值，可以使用<code>valueOf()</code>函数<br>在使用的时候回发生隐式拆分</p></li><li><p>原生函数</p><ul><li><p><code>Array(..)</code><br><em>Array构造函数只带一个数字参数时，会被作为数组的预设长度</em></p><p><strong>对于一个有长度的空数组，无法使用<code>map(..)</code>但是可以使用<code>join(..)</code></strong>,因为<code>join(..)</code>首先嘉定数组不为空，然后通过<code>length</code>属性来遍历其中的元素</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="title function_">apply</span>( <span class="literal">null</span>, &#123; <span class="attr">length</span>: <span class="number">3</span> &#125; ) </span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="title class_">Array</span>(<span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>)</span><br><span class="line"><span class="comment">// apply的第二个参数可以是数组或者类数组</span></span><br></pre></td></tr></table></figure><p><strong>永远不要创建和使用空单元数组</strong></p></li><li><p><code>Object(..)</code>、<code>Function(..)</code>、<code>RegExp(..)</code> 同理，尽量不要使用<br>动态定义正则表达式可以使用<code>new RegExp(pattern, flags)</code>来定义</p></li><li><p><code>Date(..)</code> 和 <code>Error(..)</code><br>创建日期对象使用<code>new Date()</code>, <code>Date(..)</code>可以带参数，用来指定日期和时间<br><code>Date.now()</code>自动获取当前时间戳</p><p><code>Error(..)</code>主要是为了获得当前运行栈的上下文，与throw一起使用</p></li><li><p><code>Symbol(..)</code><br>符号具有唯一性的特殊值<br>符号可以用作属性名，但无论是在代码还是开发控制台中都无法查看和访问它的值，只会 显示为诸如 Symbol(Symbol.create) 这样的值</p></li></ul></li><li><p>原生原型</p><p>原生函数都有自己的<code>prototype</code>对象，包含其对应子类型所特有的行为特征<br><strong>所有的函数都可以调用<code>Function.prototype</code>的<code>apply(..)</code>, <code>call(..)</code>, <code>bind(..)</code></strong></p><ul><li><code>Function.prototype</code> 是一个函数</li><li><code>RegExp.prototype</code> 是一个正则表达式</li><li><code>Array.prototype</code> 是一个数组</li></ul></li></ul></li><li><p><strong>强制类型转换</strong></p><ul><li><p>值类型转换 - 类型转换发生在静态类型语言的编译阶段，强制类型转换发生在动态类型语言的运行时(<code>runtime</code>)，又可以区分为”隐式强制类型转换”和”显示强制类型转换”</p></li><li><p>抽象值操作</p><ul><li><code>toString()</code> - 负责处理非字符串到字符串的强制类型转换</li><li><code>JSON.stringify()</code> <em><code>undefined</code>,<code>function</code>, <code>symbol</code>,循环引用的对象都不能用<code>JSON.stringify</code>进行处理，会被自动忽略，在数组中则会返回null</em><br>如果需要对含有非法JSON值的对象作字符串化，或者对象中的某些值无法被序列化时，需要定义<code>toJSON()</code>方法返回一个安全的JSON值</li></ul><p><code>toJSON</code>返回的是一个能够被字符串化的安全的JSON值，然后再由<code>JSON.stringify</code>对其进行字符串化</p><p>我们可以向<code>JSON.stringify()</code>传递一个可选参数replacer, 可以是数组或者函数，用来指定对象序列化过程中哪些属性应该被处理，哪些被排除</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">b</span>: <span class="number">42</span>,</span><br><span class="line">  <span class="attr">c</span>: <span class="string">&#x27;42&#x27;</span>.</span><br><span class="line">  <span class="attr">d</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// replacer为数组的话，必须是一个字符串数组</span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(a, [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])  <span class="comment">// &quot;&#123;&quot;b&quot;:42,&quot;c&quot;:&quot;42&quot;&#125;&quot; </span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(a, <span class="keyword">function</span>(<span class="params">k,v</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(k!==<span class="string">&quot;c&quot;</span>) <span class="keyword">return</span> v</span><br><span class="line">&#125;) <span class="comment">// &quot;&#123;&quot;b&quot;:42,&quot;d&quot;:[1,2,3]&#125;&quot; </span></span><br></pre></td></tr></table></figure><p><code>JSON.stringify</code> 还有一个可选参数space用来指定输出的缩进格式。space 为正整数时是指定 每一级缩进的字符数，它还可以是字符串</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">b</span>: <span class="number">42</span>,   </span><br><span class="line">  <span class="attr">c</span>: <span class="string">&quot;42&quot;</span>,  </span><br><span class="line">  <span class="attr">d</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">&#125;; </span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( a, <span class="literal">null</span>, <span class="number">3</span> ); </span><br><span class="line"><span class="comment">// &quot;&#123; &quot;b&quot;: 42, &quot;c&quot;: &quot;42&quot;, &quot;d&quot;: [  1,         2,        3     ]  &#125;&quot; </span></span><br><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>( a, <span class="literal">null</span>, <span class="string">&quot;-----&quot;</span> ); <span class="comment">// &quot;&#123; // -----&quot;b&quot;: 42, // -----&quot;c&quot;: &quot;42&quot;, // -----&quot;d&quot;: [ // ----------1, // ----------2, // ----------3 // -----] // &#125;&quot;</span></span><br></pre></td></tr></table></figure></li><li><p><code>toNumber()</code></p><p>true转换为1，false转化为0，undefined转化为NaN，null转化为0</p><p>在进行转化时，抽象操作ToPrimitive会首先检查该值是否有valueOf方法，如果有并且返回基本类型值，就使用该值进行强制类型转换，如果没有就使用toString的返回值来强制类型转换，如果都不返回基本值，就会报TypeError</p></li><li><p><code>toBoolean</code></p><p>假值包含 undefined，null，false，+0，-0，NaN, “” 会被转换为false</p><ul><li>显示强制类型转换</li></ul><p>String(), Number() a.toString() 一元运算符+</p><ul><li><p>日期显示转化为数字  <code>new Date() or +new Date()  new Date().getTime() Date.now()</code></p></li><li><p>奇特的<code>~</code>运算符  返回2的补码 <code>~x ≈ -(x+1)</code><br><code>~a.indexOf(b)</code>强制转化为真假值</p></li><li><p>字位截除 <code>~~ or x | 0</code> 只适用于32位数字</p></li><li><p>显示解析数字字符串</p><ul><li>Number()  不允许出现非数字字符</li><li>parseInt()  允许出现非数字字符 第二个参数表示进制类型</li><li>parseFloat()</li></ul></li><li><p>Boolean() !!</p></li></ul><ul><li><p>隐式强制类型转换</p><ul><li>字符串和数字之间的隐式强制类型转换<br>如果 + 的其中一个操作数是字符串，则执行字符串拼接，否则执行数字加法<br><strong>“[]+{} {} + []” =&gt; [object Object] 0</strong><br><em>第一个表达式{} 被当做空对象来对待 第二个表达式{}被当做代码块来看待</em><br>隐式转换如果有valueOf方法则是会先调用valueOf方法然后通过ToString抽象操作将返回值转为字符串 String直接调用ToString()</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">valueOf</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="number">42</span>&#125;,</span><br><span class="line">  <span class="attr">toString</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="number">4</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">a + <span class="string">&#x27;&#x27;</span>  <span class="comment">// &#x27;42&#x27;</span></span><br><span class="line"><span class="title class_">String</span>(a)  <span class="comment">// &#x27;4&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>会将字符串转化为数字</li></ul><ul><li><p>布尔值到数字的隐式强制类型转换</p></li><li><p>隐式强制转换成布尔值</p></li><li><p>|| &amp;&amp; - 选择器运算符， 他们的返回值是两个操作数中的一个然后返回他的值</p></li><li><p>符号的强制类型转换<br><strong>符号不能被强制类型转换为数字，但可以被强制类型转为布尔值</strong></p></li><li><p>宽松相等 <code>==</code> 严格相等 <code>===</code></p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span> || <span class="string">&#x27;1&#x27;</span></span><br><span class="line"><span class="keyword">var</span> y = <span class="literal">true</span></span><br><span class="line">x == y <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="literal">null</span> == <span class="literal">undefined</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p><strong>对象和非对象之间的比较</strong>，对象会先toString然后才与非对象进行比较</p><p>满足<code>a == 2 &amp;&amp; a == 3</code>为true</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Number</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> i++</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="number">42</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a + <span class="string">&#x27;&#x27;</span>)  <span class="comment">// 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a + <span class="string">&#x27;&#x27;</span>)  <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;0&quot;</span> == <span class="literal">null</span>;           <span class="comment">// false </span></span><br><span class="line"><span class="string">&quot;0&quot;</span> == <span class="literal">undefined</span>;      <span class="comment">// false </span></span><br><span class="line"><span class="string">&quot;0&quot;</span> == <span class="literal">false</span>;          <span class="comment">// true -- 晕！ </span></span><br><span class="line"><span class="string">&quot;0&quot;</span> == <span class="title class_">NaN</span>;            <span class="comment">// false </span></span><br><span class="line"><span class="string">&quot;0&quot;</span> == <span class="number">0</span>;              <span class="comment">// true </span></span><br><span class="line"><span class="string">&quot;0&quot;</span> == <span class="string">&quot;&quot;</span>;             <span class="comment">// false </span></span><br><span class="line"></span><br><span class="line"><span class="literal">false</span> == <span class="literal">null</span>;         <span class="comment">// false </span></span><br><span class="line"><span class="literal">false</span> == <span class="literal">undefined</span>;    <span class="comment">// false </span></span><br><span class="line"><span class="literal">false</span> == <span class="title class_">NaN</span>;          <span class="comment">// false </span></span><br><span class="line"><span class="literal">false</span> == <span class="number">0</span>;            <span class="comment">// true -- 晕！ </span></span><br><span class="line"><span class="literal">false</span> == <span class="string">&quot;&quot;</span>;           <span class="comment">// true -- 晕！ </span></span><br><span class="line"><span class="literal">false</span> == [];           <span class="comment">// true -- 晕！ </span></span><br><span class="line"><span class="literal">false</span> == &#123;&#125;;           <span class="comment">// false </span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;</span> == <span class="literal">null</span>;            <span class="comment">// false </span></span><br><span class="line"><span class="string">&quot;&quot;</span> == <span class="literal">undefined</span>;       <span class="comment">// false </span></span><br><span class="line"><span class="string">&quot;&quot;</span> == <span class="title class_">NaN</span>;             <span class="comment">// false </span></span><br><span class="line"><span class="string">&quot;&quot;</span> == <span class="number">0</span>;               <span class="comment">// true -- 晕！ </span></span><br><span class="line"><span class="string">&quot;&quot;</span> == [];              <span class="comment">// true -- 晕！ </span></span><br><span class="line"><span class="string">&quot;&quot;</span> == &#123;&#125;;              <span class="comment">// false </span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> == <span class="literal">null</span>;             <span class="comment">// false </span></span><br><span class="line"><span class="number">0</span> == <span class="literal">undefined</span>;        <span class="comment">// false </span></span><br><span class="line"><span class="number">0</span> == <span class="title class_">NaN</span>;              <span class="comment">// false </span></span><br><span class="line"><span class="number">0</span> == [];               <span class="comment">// true -- 晕！ </span></span><br><span class="line"><span class="number">0</span> == &#123;&#125;;               <span class="comment">// false</span></span><br></pre></td></tr></table></figure><p>极端的例子</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">        [] == ![]  <span class="comment">// true</span></span><br><span class="line">        <span class="number">2</span> == [<span class="number">2</span>]  <span class="comment">// true</span></span><br><span class="line">        <span class="string">&quot;&quot;</span> == [<span class="literal">null</span>]  <span class="comment">// true</span></span><br><span class="line">        <span class="number">0</span> == <span class="string">&quot;\n&quot;</span>  <span class="comment">// true  &quot;\n&quot;等空字符串被toNumber强制转换成0</span></span><br><span class="line">      ~~~      </span><br><span class="line"></span><br><span class="line">  * 抽象关系比较</span><br><span class="line"></span><br><span class="line">    a &lt; b - a和b的一方一个是数字，另一方将会被转化成数字进行比较</span><br><span class="line">    a &lt; b - a和b的一方两个都是字符串，将会按照字母顺序进行比较</span><br><span class="line"></span><br><span class="line">* **语法**</span><br><span class="line"></span><br><span class="line">  * 语句与表达式</span><br><span class="line"></span><br><span class="line">    * 语句的结果值 </span><br><span class="line">      语法不允许我们获取语句的结果值并将其赋值给另一个变量，如果需要可以使用<span class="string">`eval`</span>来获取结果值 或者 <span class="string">`do&#123;..&#125;`</span>代码块</span><br><span class="line"></span><br><span class="line">      ~~~js</span><br><span class="line">        <span class="keyword">var</span> a,b</span><br><span class="line">        a = <span class="built_in">eval</span>(<span class="string">&quot;if(true)&#123;b=4+38&#125;&quot;</span>)</span><br><span class="line">        a <span class="comment">// 42</span></span><br><span class="line"></span><br><span class="line">        a = <span class="keyword">do</span> &#123;</span><br><span class="line">          <span class="keyword">if</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            b = <span class="number">4</span> + <span class="number">38</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        a <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><ul><li><p><code>++</code>和<code>--</code><br>++a  先执行加法运算然后返回<br>a++  先返回然后执行加法运算<br>–a  先执行减法运算然后返回<br>a–  先返回然后执行减法运算</p></li><li><p><code>,</code>逗号运算符将多个独立的表达式语句串联成一个语句</p></li></ul></li></ul></li><li><p>上下文规则</p><ul><li><p>大括号 <code>&#123;&#125;</code></p><ol><li>对象常量<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">b</span>: <span class="number">10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>标签 / 代码块<br>在这里是一个普通的代码块，可以和let块级作用域声明一起使用<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">b</span>: <span class="title function_">foo</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>标签语句 使用break和continue都可以带标签，实现goto那样的跳转<br><em>continue foo 代表执行foo</em><br><em>break 代表跳出foo函数，从foo结束的位置开始执行</em> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">foo</span>: &#123; </span><br><span class="line">  <span class="attr">other</span>: &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">    <span class="attr">bar</span>: &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;Hello&quot;</span> ); </span><br><span class="line">      <span class="keyword">break</span> foo;   </span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;never runs&quot;</span> );  </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;World&quot;</span> );</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></li><li>对象解构<br><code>&#123;...obj&#125;</code> - 赋值 / 命名参数对象解构 </li><li>else if 和可选代码块</li></ol></li></ul></li><li><p>运算符优先级</p><ul><li><p>&amp;&amp; &gt; ||</p></li><li><p>短路 &amp;&amp; 和 ||可以造成逻辑短路</p></li><li><p>&amp;&amp; 运算符的优先级高于 ||，而 || 的优先级又高于 ? :。</p></li></ul></li><li><p><code>try..finally..</code></p></li><li><p><code>switch() &#123; case &#125;</code></p></li></ul></li></ul><h4 id="第二章-异步和性能"><a href="#第二章-异步和性能" class="headerlink" title="第二章 异步和性能"></a>第二章 异步和性能</h4><ul><li><p><strong>异步</strong></p><ol><li>异步是关于现在和将来的时间间隙，而并行是关于能够同时发生的事情,并行计算最常见的工具就是进程和线程。进程和线程独立运行，但多个线程能够共享单个进程的内存</li><li><p>事件循环把自身的工作分成一个个任务并顺序执行，不允许对共享内存的 并行访问和修改。通过分立线程中彼此合作的事件循环，并行和顺序执行可以共存。</p></li><li><p>并发运行的进程之间可能会存在相互影响，如果进程之间没有影响的话，不确定性是完全可以接受的</p></li><li><p>交互的程序可以采用协调交互顺序来处理这样的竞态条件，通过给请求固定获取位置，使得交互的两个程序无论请求顺序如何，最后返回的结果顺序是固定的。</p></li><li><p>竞态 - 只有第一个运行完成的程序起作用</p></li><li><p>协作 - 取到一个长期运行的“进程”，并将其分割成多个步骤或多批任务，使得其他并发“进程”有机会将自己的运算插入到事件循环队列中交替运行，事件循环队列的交替运行会提高 站点 /App 的响应（性能）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">response</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> chunk = data.<span class="title function_">splice</span>(<span class="number">0</span>,<span class="number">1000</span>)</span><br><span class="line">  res = res.<span class="title function_">concat</span>(</span><br><span class="line">    chunk.<span class="title function_">map</span>(<span class="function"><span class="params">val</span> =&gt;</span> val * <span class="number">2</span>)</span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">if</span>(data.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 通过setTimeout 方法将函数放到异步执行队列，不影响现有函数执行</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">response</span>(data)</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li>任务 - 类似于排队，严格指定任务队列中函数的先后执行顺序</li></ul></li><li><p><strong>回调</strong></p><ul><li>避免回调地狱 代码会变得非常复杂难以维护及更新</li></ul></li><li><p><strong>Promise</strong></p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;第一章-类型和语法&quot;&gt;&lt;a href=&quot;#第一章-类型和语法&quot; class=&quot;headerlink&quot; title=&quot;第一章 类型和语法&quot;&gt;&lt;/a&gt;第一章 类型和语法&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;内置类型&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;l</summary>
      
    
    
    
    <category term="reading" scheme="https://lxx1997.github.io/categories/reading/"/>
    
    
    <category term="reading" scheme="https://lxx1997.github.io/tags/reading/"/>
    
  </entry>
  
  <entry>
    <title>typescript - Pick</title>
    <link href="https://lxx1997.github.io/2020/12/02/web/typescript-pick/"/>
    <id>https://lxx1997.github.io/2020/12/02/web/typescript-pick/</id>
    <published>2020-12-02T02:21:41.000Z</published>
    <updated>2020-12-02T02:21:41.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="什么是Pick"><a href="#什么是Pick" class="headerlink" title="什么是Pick"></a>什么是Pick</h4><p>就是从一个符合类型中，取出几个想要的类型的组合</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Pick</span>&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [key <span class="keyword">in</span> k]: T[key]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TState</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">like</span>: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// if i just want one or two attribute of TState</span></span><br><span class="line"><span class="comment">// we can use Pick to get the attribute we want</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span>  <span class="title class_">TSingleState</span> <span class="keyword">extends</span> <span class="title class_">Pick</span>&lt;<span class="title class_">TState</span>, &#x27;name&#x27; | &#x27;age&#x27;&gt; &#123;&#125;</span><br></pre></td></tr></table></figure><p>泛型中的extends 并不是用来继承的，而是用来约束类型的，所以<code>K extends keyof T</code>，应该是说key被约束在T的key中，不能超出这个范围</p><p><a href="https://blog.csdn.net/qq_28992047/article/details/106879772">原文链接</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;什么是Pick&quot;&gt;&lt;a href=&quot;#什么是Pick&quot; class=&quot;headerlink&quot; title=&quot;什么是Pick&quot;&gt;&lt;/a&gt;什么是Pick&lt;/h4&gt;&lt;p&gt;就是从一个符合类型中，取出几个想要的类型的组合&lt;/p&gt;
&lt;figure class=&quot;highlig</summary>
      
    
    
    
    
    <category term="typescrript" scheme="https://lxx1997.github.io/tags/typescrript/"/>
    
  </entry>
  
  <entry>
    <title>Object的方法</title>
    <link href="https://lxx1997.github.io/2020/11/26/web/Object%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>https://lxx1997.github.io/2020/11/26/web/Object%E7%9A%84%E6%96%B9%E6%B3%95/</id>
    <published>2020-11-26T09:54:45.000Z</published>
    <updated>2020-11-26T09:54:45.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><ul><li><p>Object.length  值为1</p></li><li><p>Object.prototype  可以为所有的Object类型的对象添加属性</p></li></ul><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ul><li><p>Object.assign()</p><p>用于将所有可枚举属性的值从一个或多个源对象分配到目标对象，并返回目标对象</p><p>此方法只会拷贝源对象自身的并且可枚举的属性到目标对象，该方法调用源对象的get和目标对象的set，如果为了将属性定义复制到原型应使用<code>Object.getOwnPropertyDescriptor()</code>和<code>Object.defineProperty()</code></p><p><code>Object.assign()</code>是浅拷贝,会改变源对象的值</p></li></ul><ul><li><p>Object.create()</p><p>创建一个新对象，使用现有的对象来提供新创建的对象的<code>__proto__</code></p></li><li><p>Object.defineProperty()</p></li><li><p>Object.defineProperties()</p></li><li><p>Object.entries()</p></li><li><p>Object.freeze()</p></li><li><p>Object.getOwnPropertyDescriptor()</p></li><li><p>Object.getOwnPropertyNames()</p></li><li><p>Object.getOwnPropertySymbols()</p></li><li><p>Object.getPrototypeOf()</p></li><li><p>Object.is()</p></li><li><p>Object.isExtensible()</p></li><li><p>Object.isFrozen()</p></li><li><p>Object.isSealed()</p></li><li><p>Object.keys()</p></li><li><p>Object.preventExtensions()</p></li><li><p>Object.seal()</p></li><li><p>Object.setPrototypeOf()</p></li><li><p>Object.values()</p></li></ul><h4 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h4><ul><li><p>Object.prototype.constructor</p><p>返回创建实例对象的<code>Object</code>构造函数的引用，此属性的值是对函数本身的引用，而不是一个包含函数名称的字符串</p><p>所有的对象都会从他的原型上继承一个<code>constructor</code>属性</p></li><li><p>Object.prototype.<strong>proto</strong></p><p> <em>该特性已从Web标准中删除，但是目前一些浏览器仍然支持，但是在未来某个时间停止使用，请尽量不要使用该特性</em></p><p> 该属性是一个访问器属性(一个getter函数和setter函数)，暴露了通过它访问的对象的内部prototype(一个对象或null)</p><p> 推介使用<code>Object.getPrototypeOf/Reflect.getPrototypeOf</code>和<code>Object.setPrototypeOf/Reflect.setPrototypeOf</code>(<em>设置对象的prototype是一个缓慢的过程，会影响性能，应该尽量避免</em>)</p></li><li><p>Object.prototype.<strong>noSuchMethod</strong></p></li><li><p>Object.prototype.<strong>count</strong>  <em>已被废弃</em></p></li><li><p>Object.prototype.<strong>parent</strong> <em>已被废弃</em></p></li></ul><h4 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h4><ul><li><p>Object.prototype.<strong>defineGetter</strong>()</p></li><li><p>Object.prototype.<strong>defineGetter</strong>()</p></li><li><p>Object.prototype.<strong>lookupGetter</strong>()</p></li><li><p>Object.prototype.<strong>lookupSetter</strong>()</p></li><li><p>Object.prototype.hasOwnProperty()</p></li><li><p>Object.prototype.isPprototypeOf()</p></li><li><p>Object.prototype.propertyIsEnumerable()</p></li><li><p>Object.prototype.toSource()</p></li><li><p>Object.prototype.toLocaleString()</p></li><li><p>Object.prototype.toString()</p></li><li><p>Object.prototype.unwatch()</p></li><li><p>Object.prototype.valueOf()</p></li><li><p>Object.prototype.watch()</p></li><li><p>Object.prototype.eval()  <em>已废弃</em></p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;属性&quot;&gt;&lt;a href=&quot;#属性&quot; class=&quot;headerlink&quot; title=&quot;属性&quot;&gt;&lt;/a&gt;属性&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Object.length  值为1&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Object.prototype  可以为所有的O</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>《你不知道的javascript上卷》 知识点摘录</title>
    <link href="https://lxx1997.github.io/2020/11/24/reading/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84javascript%E4%B8%8A%E5%8D%B7/"/>
    <id>https://lxx1997.github.io/2020/11/24/reading/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84javascript%E4%B8%8A%E5%8D%B7/</id>
    <published>2020-11-24T05:50:50.000Z</published>
    <updated>2020-11-24T05:50:50.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="第一章-作用域和闭包"><a href="#第一章-作用域和闭包" class="headerlink" title="第一章  作用域和闭包"></a>第一章  作用域和闭包</h4><ul><li><p>编译器查找类型 <em>赋值操作的目标是谁(<code>LHS</code>)</em> 和 <em>谁是赋值操作的源头(<code>RHS</code>)</em></p><p><code>RHS</code>如果在所有嵌套的作用域中遍寻不到所需的变量，引擎就会爆出<code>ReferenceError</code>异常，如果找到了变量，但是要对变量的值进行不合理的操作，引擎就会抛出另一种类型的错误<code>TypeError</code></p><p><code>LHS</code>如何在全局作用域中也无法找到目标变量，就会在全局作用域中创建一个具有该名称的变量，并将其返还给引擎，但是在‘严格模式’下执行的时候并不会创建一个全局变量，而是会和<code>RHS</code>一样抛出<code>ReferenceError</code></p></li></ul><ul><li><code>eval</code> javascript的eval() 函数可以接受一个字符串作为参数，并将其中的内容视为javascript代码，尽量不要使用<code>eval</code>，会对系统安全造成影响</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">&#x27;var b = 3&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li><p><code>with</code> with可以将一个没有或有多个属性的对象处理为一个完全隔离的词法作用域，因此这个对 象的属性也会被处理为定义在这个作用域中的词法标识符</p><p><em>尽管 with 块可以将一个对象处理为词法作用域，但是这个块内部正常的 var 声明并不会被限制在这个块的作用域中，而是被添加到 with 所处的函数作用域中</em></p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">with</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  a = <span class="number">3</span>;</span><br><span class="line">  b = <span class="number">4</span>;</span><br><span class="line">  c = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><strong>匿名函数</strong> 匿名函数没有名称标识符，函数表达式可以是匿名的，而函数声明则不可以省略函数名</p><ul><li>匿名函数在栈追踪中不会显示出有意义的函数名，使得调试很困难</li><li>如果没有函数名，引用自身时只能使用<code>arguments.callee</code>引用</li><li>匿名函数省略了对于代码可读性很重要的函数名</li></ul></li><li><p><strong>具名函数</strong> 有名称标识符</p></li><li><p><strong>立即执行函数表达式</strong> <code>(function()&#123; &#125;)()</code></p></li><li><p><code>try/catch</code>分句会创建一个块级作用域，其中声明的变量仅在catch内部有效</p></li><li><p><code>let</code>为其声明的变量隐式地了所在的块作用域。</p></li><li><p><strong>垃圾收集</strong> 利用作用域进行垃圾回收，变量显式声明块作用域</p></li><li><p><em>变量及函数在内的所有声明都会在任何代码被执行前首先被处理</em>，定义声明在编译阶段进行，赋值声明在执行阶段进行<br><strong>先有声明后有赋值</strong><br><strong>函数声明</strong>会被提升，<strong>函数表达式</strong>及<strong>具名函数</strong>不会被提升<br>在变量提升过程中，函数会被首先提升，其次才是变量<br>尽管重复的声明会被忽略掉，但是出现后面的函数声明可以覆盖前面的</p></li><li><p><strong>模块模式</strong></p><ul><li>必须有外部的封闭函数，函数必须至少被调用一次，每一次调用都会创建一个新的模块实例</li><li>封闭函数必须返回至少一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或者修改私有状态</li></ul></li><li><p><strong>修改模块实例的内容</strong><br>通过在模块实例内部保留对公共API对象的内部引用，可以从内部对模块是咧进行修改，包括添加或删除方法和属性，修改他们的值</p></li><li><p><strong>现代模块机制</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装模块</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">MyModules</span> = (<span class="keyword">function</span> <span class="title function_">Manager</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> modules = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  fucntion <span class="title function_">define</span>(<span class="params">name, deps, impl</span>) &#123;</span><br><span class="line">    <span class="comment">// 通过for循环将deps里面的参数赋值为modules中的数据</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; deps.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      deps[i] = modules[deps[i]]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 通过apply将deps作为参数传给impl，并改变impl函数this的指向，使其指向impl</span></span><br><span class="line">    modules[name] = impl.<span class="title function_">apply</span>(impl, deps)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> modules[name]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">define</span>: define,</span><br><span class="line">    <span class="attr">get</span>: get</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义模块</span></span><br><span class="line"><span class="title class_">MyModules</span>.<span class="title function_">define</span>( <span class="string">&quot;bar&quot;</span>, [], <span class="keyword">function</span>(<span class="params"></span>) &#123;  </span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">hello</span>(<span class="params">who</span>) &#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Let me introduce: &quot;</span> + who;   </span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">return</span> &#123;     </span><br><span class="line">    <span class="attr">hello</span>: hello  </span><br><span class="line">  &#125;;</span><br><span class="line">&#125;); </span><br><span class="line"> </span><br><span class="line"><span class="title class_">MyModules</span>.<span class="title function_">define</span>(<span class="string">&#x27;foo&#x27;</span>, [<span class="string">&#x27;bar&#x27;</span>], <span class="keyword">function</span>(<span class="params">bar</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> hungry = <span class="string">&#x27;hippo&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">awesome</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(bar.<span class="title function_">hello</span>(hangry).<span class="title function_">toUpperCase</span>())</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    awesome</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><em>通过同一个构造模块函数构造的模块之间可以作为参数使用</em></p></li><li><p>作用域</p><p>作用域链是基于动态作用域的，而不是代码中的作用域嵌套</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>( a ); <span class="comment">// 2 </span></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line">  <span class="title function_">foo</span>();</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>; </span><br><span class="line"><span class="title function_">bar</span>();</span><br></pre></td></tr></table></figure></li></ul><h4 id="第二章-this和对象原型"><a href="#第二章-this和对象原型" class="headerlink" title="第二章  this和对象原型"></a>第二章  this和对象原型</h4><p>  <code>this</code>提供了一种更优雅的方式来隐式传递一个对象引用，因此可以将API设计得更加简洁并且易于复用</p><p>  <code>this</code>是在运行的时候绑定的，并不是在编写的时候绑定的，它的上下文取决于函数调用时用的耕种条件。<br>  当一个函数被调用时，会创建一个活动记录（有时候也称为执行上下文）。这个记录会包 含函数在哪里被调用（调用栈）、函数的调用方法、传入的参数等信息。this 就是记录的 其中一个属性，会在函数执行的过程中用到</p><h6 id="this-的綁定"><a href="#this-的綁定" class="headerlink" title="this 的綁定"></a>this 的綁定</h6><ul><li><p>默认绑定 - 如果函数直接使用不带有任何修饰的函数引用进行调用，使用默认绑定规则，如果使用了严格模式，全局对象将无法使用默认绑定，因此this会绑定到undefined</p></li><li><p>隐式绑定 - 如果函数调用位置含有上下文对象，隐式绑定规则会把函数调用中ths绑定到这个上下文对象，对象属性引用链中只有最顶层或者说最后一层会影响调用位置</p></li><li><p>隐式丢失 - 被隐式绑定的函数会丢失绑定对象，会应用默认绑定，从而把this绑定到全局对象或者undefined上(取决于是否是严格模式)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;      <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="variable language_">this</span>.<span class="property">a</span> ); &#125; </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doFoo</span>(<span class="params">fn</span>) &#123;     <span class="comment">// fn 其实引用的是 foo </span></span><br><span class="line"><span class="title function_">fn</span>(); <span class="comment">// &lt;-- 调用位置！ &#125; </span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;      <span class="attr">a</span>: <span class="number">2</span>,     <span class="attr">foo</span>: foo  &#125;; </span><br><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;oops, global&quot;</span>; <span class="comment">// a 是全局对象的属性 </span></span><br><span class="line"><span class="title function_">doFoo</span>( obj.<span class="property">foo</span> ); <span class="comment">// &quot;oops, global&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>显示绑定 - JavaScript的宿主环境会提供一些特殊的函数，如果传入的是一个原始值(<code>Number</code>, <code>String</code>, <code>Boolean</code>)，原始值会被转成它对应的对象形式(<code>new String(..)</code>, <code>new Number(..)</code>, <code>new Boolean(..)</code>)，这种通常认为是<code>装箱</code></p><ul><li>call(this, argument) 第一个对象用来绑定this，调用函数时指向这个this，call的参数是直接放进去的，<em>函数会默认执行一次</em></li><li>apply(this, argument) 第一个对象用来绑定this，调用函数时指向这个this，apply的参数是一个数组，<em>函数会默认执行一次</em></li><li>band(this, argument) 第一个对象用来绑定this，调用函数时指向这个this，band的参数是直接放进去的，<em>函数不会默认执行一次</em></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">arguments</span>[<span class="number">0</span>], <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test</span>(<span class="number">13</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;call&#x27;</span>)</span><br><span class="line">test.<span class="title function_">call</span>(obj, obj.<span class="property">b</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;apply&#x27;</span>)</span><br><span class="line">test.<span class="title function_">apply</span>(obj, [obj.<span class="property">b</span>])</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;bind&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> test1 = test.<span class="title function_">bind</span>(obj, obj.<span class="property">b</span>)</span><br><span class="line"><span class="title function_">test</span>()</span><br><span class="line"><span class="title function_">test1</span>()</span><br><span class="line"><span class="comment">// console</span></span><br><span class="line"><span class="number">13</span> b</span><br><span class="line"><span class="literal">undefined</span> a</span><br><span class="line">call</span><br><span class="line"><span class="number">20</span> b</span><br><span class="line"><span class="number">10</span> a</span><br><span class="line">apply</span><br><span class="line"><span class="number">20</span> b</span><br><span class="line"><span class="number">10</span> a</span><br><span class="line">bind</span><br><span class="line"><span class="literal">undefined</span> b</span><br><span class="line"><span class="literal">undefined</span> a</span><br><span class="line"><span class="number">20</span> b</span><br><span class="line"><span class="number">10</span> a</span><br></pre></td></tr></table></figure></li><li><p><strong>显示绑定变种</strong></p><ul><li>硬绑定</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">something</span>) &#123;      <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="variable language_">this</span>.<span class="property">a</span>, something );      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">a</span> + something; &#125; </span><br><span class="line"><span class="keyword">var</span> obj = &#123;      <span class="attr">a</span>:<span class="number">2</span> &#125;; </span><br><span class="line"><span class="keyword">var</span> bar = <span class="keyword">function</span>(<span class="params"></span>) &#123;     <span class="keyword">return</span> foo.<span class="title function_">apply</span>( obj, <span class="variable language_">arguments</span> ); &#125;; </span><br><span class="line"><span class="keyword">var</span> b = <span class="title function_">bar</span>( <span class="number">3</span> ); <span class="comment">// 2 3 console.log( b ); // 5</span></span><br></pre></td></tr></table></figure><p>ES5 中提供了内置的方法 Function.prototype. bind</p><ul><li>API调用的上下文</li></ul><p>许多第三方库以及javascript内置函数，提供了一个可选参数，统称为上下文，作用和<code>bind(..)</code>，确保回调函数使用指定的this</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">el</span>) &#123;      <span class="variable language_">console</span>.<span class="title function_">log</span>( el, <span class="variable language_">this</span>.<span class="property">id</span> ); &#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;     <span class="attr">id</span>: <span class="string">&quot;awesome&quot;</span> &#125;; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 foo(..) 时把 this 绑定到 obj [1, 2, 3].forEach( foo, obj ); // 1 awesome 2 awesome 3 awesome</span></span><br></pre></td></tr></table></figure></li><li><p>new绑定 - 函数在new表达式中被调用时，它是一个构造函数，会初始化新创建的对象，称之为<em>构造函数调用</em></p><p>使用new来调用函数，会自动执行下面操作</p><ul><li>创建一个全新的对象</li><li>这个新对象会被执行<code>[[原型]]</code>连接</li><li>这个新对象会绑定到函数调用的this</li><li>如果函数没有返回其他对象，那么new表达式中的函数调用会自动返回这个新对象</li></ul></li></ul><ul><li><p>this绑定优先级</p><p>默认绑定 &lt; 隐式绑定 &lt; 显示绑定 &lt; new绑定</p></li><li><p>判断this</p><ul><li>判断是否在new中调用，绑定的是新创建的对象</li><li>是否通过call，apply，bind，绑定的是指定对象</li><li>判断是否在某个上下文对象中调用，绑定的是上下文对象</li><li>以上全部满足使用默认绑定，绑定到全局对象，严格模式下为undefined</li></ul></li></ul><h6 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h6><ul><li><p>主要类型 - <code>string</code>,<code>number</code>,<code>boolean</code>,<code>null</code>,<code>undefined</code>,<code>object</code></p></li><li><p>内置对象 - <code>String</code>,<code>Number</code>,<code>Boolean</code>,<code>Array</code>,<code>Function</code>,<code>Object</code>,<code>Date</code>,<code>RegExp</code>,<code>Error</code></p></li><li><p>判断一个对象的类型</p><ul><li>typeof 返回值是字符串</li><li>instanceof 返回值是boolean</li><li>Object.prototype.toString.call(obj) 返回值是字符串 <code>&#39;[object Object]&#39;</code></li></ul></li><li><p>对象属性访问 - <code>.a</code>语法通常称为属性访问，<code>[a]</code>通常称为键访问，可以接受任意任意字符串作为属性名。</p></li><li><p>对象中，属性名永远都是字符串，如果使用string以外的其他值作为属性名，首先会被转成字符串</p></li><li><p>可计算属性名 - 属性键根据构造函数时传入的键值参数变化</p></li><li><p>属性和方法 - 函数不属于某个对象，只是相同函数对象的多个引用</p></li><li><p>复制对象</p><ul><li>Object.assign(..)方法实现浅复制，它会遍历一个或者多个原对象的可枚举的自有键并将它们复制到目标对象，最后返回目标对象。<br>object.assign使用<code>=</code>操作符来赋值，所以源对象属性的一些特性(比如writable)不会被复制到目标对象</li></ul></li><li><p>属性描述符</p><ul><li>Object.getOwnPropertyDescriptor(obj, key)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">value</span>: ,</span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>writable 决定是否可以修改属性的值</li><li>Configurable 如果属性是可配置的，就可以使用defineProperty(..)来修改</li><li>Enumerable 控制属性是否会出现在对象的属性枚举中，如果为false，遍历的时候不会出现在枚举中，但是仍然可以正常访问</li></ul></li><li><p>不变性</p><ul><li><p>对象常量 - 结合<code>writable: false</code> 和<code>configurable: false</code>就可以创建一个真正的常量属性（不可修改，重定义或者删除）</p></li><li><p>禁止扩展 - 如果想要禁止一个对象添加新属性并保留已有属性，可以使用<code>Object.preventExtensions(..)</code></p></li><li><p>密封 - <code>Object.seal(..)</code>会创建一个密封的对象，这个方法实际上会在一个现有对象的基础上调用<code>Object.preventExtensions(..)</code>并把所有的属性标记为<code>configurable: false</code>，密封之后不仅不能添加新属性，也不能重新配置或者删除任何现有属性</p></li><li><p>冻结 - <code>Object.freeze(..)</code>会创建一个冻结对象，实际上会在一个现有对象的基础上调用<code>Object.seal(..)</code>，并将所有数据访问属性标记为<code>writable: false</code></p></li></ul></li><li><p>存在性 可用通过 <code>in</code>和<code>Object.hasOwnProperty</code>来检查属性是否在对象中，所有的普通对象都可以连接到<code>Object.hasOwnProperty</code>，但是通过<code>Object.create()</code>创建的对象无法访问<code>Object.hasOwnProperty</code>,这时可以通过<code>Object.prototype.hasOwnProperty.call(obj, a)</code>,它借用基础的<code>hasOwnProperty</code>方法并显示绑定到<code>obj</code>上面</p></li></ul><h6 id="混合对象”类”"><a href="#混合对象”类”" class="headerlink" title="混合对象”类”"></a>混合对象”类”</h6><ul><li>类理论</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;第一章-作用域和闭包&quot;&gt;&lt;a href=&quot;#第一章-作用域和闭包&quot; class=&quot;headerlink&quot; title=&quot;第一章  作用域和闭包&quot;&gt;&lt;/a&gt;第一章  作用域和闭包&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;编译器查找类型 &lt;em&gt;赋值操作的目标是谁(&lt;code</summary>
      
    
    
    
    <category term="reading" scheme="https://lxx1997.github.io/categories/reading/"/>
    
    
    <category term="reading" scheme="https://lxx1997.github.io/tags/reading/"/>
    
  </entry>
  
  <entry>
    <title>《你不知道javascript》 知识点摘录</title>
    <link href="https://lxx1997.github.io/2020/11/20/reading/%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93javascript%E3%80%8B%20%E8%AF%BB%E5%90%8E%E6%84%9F/"/>
    <id>https://lxx1997.github.io/2020/11/20/reading/%E3%80%8A%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93javascript%E3%80%8B%20%E8%AF%BB%E5%90%8E%E6%84%9F/</id>
    <published>2020-11-20T01:44:55.000Z</published>
    <updated>2020-11-20T01:44:55.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="第一部分-类型和语法"><a href="#第一部分-类型和语法" class="headerlink" title="第一部分  类型和语法"></a>第一部分  类型和语法</h4><ul><li><p><code>&amp;&amp;</code> 运算符的优先级高于 <code>||</code>, 而 <code>||</code> 的优先级高于 <code>? :</code>, <code>&amp;&amp;</code> <code>||</code> 是左关联， <code>? :</code> 是右关联</p></li><li><p>在 <code>try...catch...</code>中，如果包含在for循环中，在一定情况下会在i++执行之前执行，如果在<code>try...catch...</code>中，加入<code>yield</code>, 由于<code>yield</code>的特性，try并未结束，因此catch、finally并不会立即执行<br>  <em>finally中的return会覆盖try和catch中的return的返回值</em></p></li><li><p><code>switch</code></p><ul><li><code>switch</code>中的匹配算法是<code>===</code></li><li><code>case</code> 中的表达式尽量不要使用 <code>&amp;&amp; or ||</code>，因为匹配的数值并一定严格相等</li></ul></li></ul><ul><li><p>判断字段类型</p><ul><li><code>typeof</code>  </li><li><code>instanceof</code></li><li><code>Object.prototype.toString.call(obj)</code></li></ul></li><li><p>再给html标签添加<code>id</code>标签的时候回默认添加一个和标签相同名称的全局变量</p></li><li><p>在script标签中是使用javascript语言，如果语句中包含<code>&lt;/script&gt;</code>则会被视为script标签的结束，应该使用<code>&quot;&lt;/sc&quot; + &quot;ript&gt;&quot;</code>来代替</p></li></ul><h4 id="第二部分-异步和性能"><a href="#第二部分-异步和性能" class="headerlink" title="第二部分 异步和性能"></a>第二部分 异步和性能</h4><ul><li><p><strong>尽量避免发送同步的ajax请求，因为这样会锁定浏览器的UI,并且阻塞所用的用户交互</strong></p></li><li><p>javascript从不跨线程共享数据</p></li></ul><h6 id="New-Promise"><a href="#New-Promise" class="headerlink" title="New Promise()"></a>New Promise()</h6><ul><li><p><code>Promise.all()</code><br><code>Promise.all</code>可以将多个<code>Promise</code>实例包装成一个新的<code>Promise</code>实例，同时，成功和失败的返回值是不同的, 成功的时候返回一个结果数据，失败的时候则最先被<code>reject</code>失败的状态的值</p><p><em>返回的成功的结果的数据顺序和<code>Promise.all</code>接收到的数组顺序是一致的</em><br><strong>如果有一个<code>promise</code>被拒绝， 主Promise.all()就会被立刻拒绝，并丢弃来自其他所有promise的全部结果</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">fun1, fun2</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([fun1, fun2]).<span class="title function_">then</span>(<span class="function"><span class="params">values</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> values</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> fun1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">2</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="keyword">const</span> fun2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">4</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="title function_">add</span>(fun1, fun2).<span class="title function_">then</span>(<span class="function"><span class="params">values</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(values) <span class="comment">// [2, 4]</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>Promise.race</code></p><p><code>Promise.race</code> 竞赛模式 只要传入的数组里面那个结果先出来，就返回哪个结果（不论返回的接口是成功还是失败）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line">  &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">reject</span>(<span class="string">&#x27;failed&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">500</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([p1, p2]).<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(error)  <span class="comment">// 打开的是 &#x27;failed&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p>调用Promise的then()时，只传入一个完全处理函数，一个默认拒绝处理函数就会顶替上来，把错误重新抛出，是的错误可以沿着Promise链传递下去，知道遇到显式定义的拒绝处理函数</p></li><li><p><code>Promise.finally</code> 通常用来处理被丢弃或者忽略的promise, 如果有需要释放的资源可以在finally进行释放</p></li><li><p><code>Promise.none</code></p><p>所有的promise都被拒绝才返回</p></li><li><p><code>Promise.any</code></p><p>至少需要一个promise完成就返回</p></li><li><p><code>Promise.first</code></p><p>只要第一个Promise完成，后续任何拒绝和完成都会忽略</p></li><li><p><code>Promise.last</code></p><p>只有最后一个完成的Promise胜出</p></li><li><p>并发迭代 <code>Promise.map</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装Promise.map</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title class_">Promise</span>.<span class="property">map</span>) &#123;</span><br><span class="line">  <span class="title class_">Promise</span>.<span class="property">map</span> = <span class="keyword">function</span>(<span class="params">vals, cb</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(</span><br><span class="line">      vals.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">          <span class="title function_">cb</span>(val, resolve)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Promise.map</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">map</span>([p1, p2, p3], <span class="keyword">function</span>(<span class="params">pr, done</span>) &#123;</span><br><span class="line">  promise.<span class="title function_">resolve</span>(pr).<span class="title function_">then</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">done</span>(v * <span class="number">2</span>)</span><br><span class="line">  &#125;, done)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">values</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(values)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li><li><p><code>try...catch...</code> 不能和<code>Promise</code>连用，<code>try...catch...</code>只有在同步的情况下才能捕捉到异常，任何异步的错误都将无法捕捉到</p></li><li><p>一些无效的使用<code>Promise API</code>: <code>new Promise(null)</code>、 <code>Promise.all()</code>、<code>Promise.race(42)</code></p></li></ul><h6 id="生成器-function-foo"><a href="#生成器-function-foo" class="headerlink" title="生成器 function *foo(){ }"></a>生成器 <code>function *foo()&#123; &#125;</code></h6><ul><li>定义生成器函数</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> *<span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// what to do...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>调用生成器函数</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在此处创建了一个生成器foo</span></span><br><span class="line"><span class="keyword">function</span> *<span class="title function_">foo</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建一个的迭代器对象，将迭代器对象赋值给了变量it</span></span><br><span class="line"><span class="keyword">var</span> it = <span class="title function_">foo</span>(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="comment">// 调用it.next() 指示生成器从当前的位置继续运行，停留在下一个yield或者生成器结束</span></span><br><span class="line"><span class="keyword">var</span> res = it.<span class="title function_">next</span>()</span><br><span class="line">res.<span class="property">value</span>   <span class="comment">// 7</span></span><br></pre></td></tr></table></figure><p>  需要的<code>next()</code> 调用比<code>yield</code>语句多一个，因为第一个<code>next()</code>用来启动一个生成器，并运行到第一个<code>yield</code>处，第二个<code>next()</code>调用完第一个被暂停的<code>yield</code>表达式，第三个<code>next()</code>调用完成第二个<code>yield</code>，依次类推</p><p>  <strong>可以通过next向yield表达式传值</strong></p><p>  <code>yield</code> 和 <code>next()</code>组合起来，在生成器的执行过程中，构成了一个双向消息传递系统</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> *<span class="title function_">foo</span>(<span class="params">x</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> y = x * (<span class="keyword">yield</span> <span class="string">&quot;hello&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> y</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> it = <span class="title function_">foo</span>(<span class="number">6</span>)  <span class="comment">//初始化一个迭代器 it</span></span><br><span class="line"><span class="keyword">var</span> res = it.<span class="title function_">next</span>()</span><br><span class="line">res.<span class="property">value</span>  <span class="comment">// hello</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> res = it.<span class="title function_">next</span>(<span class="number">7</span>)</span><br><span class="line">res.<span class="property">value</span>  <span class="comment">// 42</span></span><br></pre></td></tr></table></figure><p>  最后一个<code>next()</code>由<code>return</code>来回答 <code>value</code>为<code>return</code> 出来的值，如果生成器中没有<code>return</code>，会有一个假定的，隐式的<code>return</code>，会在默认的情况下回答最后的<code>next()</code>调用提出的问题</p><ul><li><p>多个迭代器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> *<span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> x = <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  z++</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(z, <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">  <span class="keyword">var</span> y = <span class="keyword">yield</span> (x * z)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(x,y,z)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> z = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> it1 = <span class="title function_">foo</span>()  <span class="comment">// 第一个迭代器</span></span><br><span class="line"><span class="keyword">var</span> it2 = <span class="title function_">foo</span>()  <span class="comment">// 第二个迭代器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> val1 = it1.<span class="title function_">next</span>().<span class="property">value</span></span><br><span class="line"><span class="keyword">var</span> val2 = it2.<span class="title function_">next</span>().<span class="property">value</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(val1, val2, <span class="string">&quot;val1, val2&quot;</span>)</span><br><span class="line"></span><br><span class="line">val1 = it1.<span class="title function_">next</span>(val2 * <span class="number">10</span>).<span class="property">value</span></span><br><span class="line">val2 = it2.<span class="title function_">next</span>(val1 * <span class="number">5</span>).<span class="property">value</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(val1, val2, <span class="string">&quot;val1, val2, two&quot;</span>)</span><br><span class="line"></span><br><span class="line">it1.<span class="title function_">next</span>(val2 / <span class="number">2</span>)</span><br><span class="line">it2.<span class="title function_">next</span>(val1 / <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// console</span></span><br><span class="line"><span class="comment">// 2 2 val1, val2</span></span><br><span class="line"><span class="comment">// 2 z</span></span><br><span class="line"><span class="comment">// 3 z</span></span><br><span class="line"><span class="comment">// 40 600 val1, val2, two</span></span><br><span class="line"><span class="comment">// 20 300 3</span></span><br><span class="line"><span class="comment">// 200 10 3</span></span><br></pre></td></tr></table></figure><p><em>多个迭代器交互的时候，生成器中包含有全局变量时，会对全局变量造成污染</em></p><p><strong>可以用于记录函数生成的最后一个值</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> something = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> nextVal</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">interator</span>]: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">next</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(nextVal === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        nextVal = <span class="number">1</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        nextVal = (<span class="number">3</span> * nextVal) + <span class="number">6</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> &#123;<span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">value</span>: nextVal&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">something.<span class="title function_">next</span>().<span class="property">value</span> <span class="comment">// 1</span></span><br><span class="line">something.<span class="title function_">next</span>().<span class="property">value</span> <span class="comment">// 9</span></span><br><span class="line">something.<span class="title function_">next</span>().<span class="property">value</span> <span class="comment">// 33</span></span><br></pre></td></tr></table></figure><p><code>es6</code>新增了一个<code>for ... of ...</code>循环，意味着可以通过原生循环语法自动贴袋标准迭代器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> v <span class="keyword">of</span> something) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(v)</span><br><span class="line">  <span class="keyword">if</span>(v &gt; <span class="number">10</span>) &#123;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>终止生成器</p><p><code>for ... of ...</code> 循环内的break会触发finally语句，终止生成器，也可以在外部调用<code>it.return(..)</code>手动终止生成器的迭代器实例</p><p>调用<code>it.return</code>之后会立刻终止生成器，运行finally语句</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;第一部分-类型和语法&quot;&gt;&lt;a href=&quot;#第一部分-类型和语法&quot; class=&quot;headerlink&quot; title=&quot;第一部分  类型和语法&quot;&gt;&lt;/a&gt;第一部分  类型和语法&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt; 运算符</summary>
      
    
    
    
    <category term="reading" scheme="https://lxx1997.github.io/categories/reading/"/>
    
    
    <category term="reading" scheme="https://lxx1997.github.io/tags/reading/"/>
    
  </entry>
  
  <entry>
    <title>golang-切割字符串和拼接字符串</title>
    <link href="https://lxx1997.github.io/2020/11/12/golang/golang-%E5%88%87%E5%89%B2%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    <id>https://lxx1997.github.io/2020/11/12/golang/golang-%E5%88%87%E5%89%B2%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2/</id>
    <published>2020-11-12T06:07:23.000Z</published>
    <updated>2020-11-12T06:07:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>今天在Leecode上面练习用go语言做题，偶遇一题</p><h4 id="剑指-Offer-58-II-左旋转字符串"><a href="#剑指-Offer-58-II-左旋转字符串" class="headerlink" title="剑指 Offer 58 - II. 左旋转字符串"></a>剑指 Offer 58 - II. 左旋转字符串</h4><p>  字符串的左旋转操作是把字符串前面的若干个字符转移到字符串的尾部。请定义一个函数实现字符串左旋转操作的功能。比如，输入字符串”abcdefg”和数字2，该函数将返回左旋转两位得到的结果”cdefgab”</p><p>  示例：<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: s = <span class="string">&quot;abcdefg&quot;</span>, k = <span class="number">2</span></span><br><span class="line">输出: <span class="string">&quot;cdefgab&quot;</span></span><br></pre></td></tr></table></figure></p><p>然后我想起来前些天偶然遇到的一个题，有用到这部分的知识</p><p>然后我急忙把对应代码复制过来，然后点击提交，令人激动的是竟然成功了，但是运行内存及时间太不理想</p><p>提交时间 提交结果 运行时间  内存消耗   语言<br>16分钟前     通过      72 ms        9.1 MB      Go</p><p>代码如下<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseLeftWords</span><span class="params">(s <span class="type">string</span>, n <span class="type">int</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">var</span> char <span class="type">int</span> = n</span><br><span class="line"><span class="keyword">for</span> char &lt; <span class="built_in">len</span>(s) &#123;</span><br><span class="line">newstr = newstr + <span class="type">string</span>(s[char])</span><br><span class="line">char++</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> char2 <span class="type">int</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> char2 &lt; n &#123;</span><br><span class="line">newstr =  newstr + <span class="type">string</span>(s[char2])</span><br><span class="line">char2++</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> newstr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>然后我就打算使用golang自带的字符串切割的方法</p><p>结果还是比较理想的</p><p>提交时间 提交结果 运行时间  内存消耗   语言<br>几秒前      通过       0 ms       3.5 MB        Go</p><p>代码差不多只有一行<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseLeftWords</span><span class="params">(s <span class="type">string</span>, n <span class="type">int</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="type">string</span>([]<span class="type">byte</span>(s)[n:]) + <span class="type">string</span>([]<span class="type">byte</span>(s)[:n])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="字符串切割-string-byte-s-n-m"><a href="#字符串切割-string-byte-s-n-m" class="headerlink" title="字符串切割  string([]byte(s)[n:m])"></a>字符串切割  string([]byte(s)[n:m])</h4><p><code>string([]byte(s)[n:m])</code>  : </p><p>首先是通过byte方法将字符串转为字节</p><ul><li><code>s</code>代表需要转换的字符串</li><li><code>n</code>代表切割的起始位置，省略代表从第0位开始</li><li><code>m</code>代表切割的终点位置，省略代表到末尾结束</li><li>最后通过string()方法再将字节转为字符串</li></ul><p><em>但是这种方法并不适用于带有中文的字符串</em></p><p><code>string([]rune(s)[n:m])</code><br>首先是通过byte方法将字符串转为字节</p><ul><li><code>s</code>代表需要转换的字符串</li><li><code>n</code>代表切割的起始位置，省略代表从第0位开始</li><li><code>m</code>代表切割的终点位置，省略代表到末尾结束</li><li>最后通过string()方法再将字节转为字符串</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;今天在Leecode上面练习用go语言做题，偶遇一题&lt;/p&gt;
&lt;h4 id=&quot;剑指-Offer-58-II-左旋转字符串&quot;&gt;&lt;a href=&quot;#剑指-Offer-58-II-左旋转字符串&quot; class=&quot;headerlink&quot; title=&quot;剑指 Offer 58 - II</summary>
      
    
    
    
    
    <category term="golang" scheme="https://lxx1997.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>vue中使用typescript</title>
    <link href="https://lxx1997.github.io/2020/10/22/vue/vue%E4%B8%AD%E4%BD%BF%E7%94%A8typescript/"/>
    <id>https://lxx1997.github.io/2020/10/22/vue/vue%E4%B8%AD%E4%BD%BF%E7%94%A8typescript/</id>
    <published>2020-10-22T07:45:24.000Z</published>
    <updated>2020-10-22T07:45:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>在此记录一下Vue中使用typescript时 遇到的一些问题</p><ul><li>Cannot find module ‘./xxx/xxx’ or its corresponding type declarations<br>原因是ts识别不了vue文件，在引入的最后加上<code>.vue</code>就可以了<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误的写法</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">TestLayout</span> <span class="keyword">from</span> <span class="string">&#x27;./components/test-layout&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确的写法</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">TestLayout</span> <span class="keyword">from</span> <span class="string">&#x27;./components/test-layout.vue&#x27;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>获取DOM元素时提示  <code>Type &#39;HTMLElement | null&#39; is not assignable to type &#39;HTMLElement&#39;. Type &#39;null&#39; is not assignable to type &#39;HTMLElement&#39;</code></p><p>eg: </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">scaleBox</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.scale-box&#x27;</span>)</span><br></pre></td></tr></table></figure><p>对获取到的信息做一次<strong>类型转换</strong>或者<strong>类型断言</strong></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">scaleBox</span> = &lt;<span class="title class_">HTMLDivElement</span>&gt;<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.scale-box&#x27;</span>)</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">scaleBox</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.scale-box&#x27;</span>) <span class="keyword">as</span> <span class="title class_">HTMLElement</span></span><br></pre></td></tr></table></figure></li></ul><p>同时贴上我在网上找到的<code>tslint</code>配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tslint.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;defaultSeverity&quot;</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">  <span class="string">&quot;extends&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;tslint:recommended&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;linterOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;exclude&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;node_modules/**&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;rules&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;indent&quot;</span>: [<span class="literal">true</span>, <span class="string">&quot;spaces&quot;</span>, <span class="number">2</span>],</span><br><span class="line">    <span class="string">&quot;interface-name&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;no-consecutive-blank-lines&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;object-literal-sort-keys&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;ordered-imports&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;quotemark&quot;</span>: [<span class="literal">true</span>, <span class="string">&quot;single&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">　<span class="comment">// 禁止自动检测末尾行必须使用逗号，always总是检测，never从不检测，ignore忽略检测</span></span><br><span class="line">　　<span class="string">&quot;trailing-comma&quot;</span>: [<span class="literal">true</span>, &#123;</span><br><span class="line">　　　　<span class="string">&quot;singleline&quot;</span>: <span class="string">&quot;never&quot;</span>,</span><br><span class="line">　　　　<span class="string">&quot;multiline&quot;</span>: &#123;</span><br><span class="line">　　　　　　<span class="string">&quot;objects&quot;</span>: <span class="string">&quot;ignore&quot;</span>,</span><br><span class="line">　　　　　　<span class="string">&quot;arrays&quot;</span>: <span class="string">&quot;always&quot;</span>,</span><br><span class="line">　　　　　　<span class="string">&quot;functions&quot;</span>: <span class="string">&quot;never&quot;</span>,</span><br><span class="line">　　　　　　<span class="string">&quot;typeLiterals&quot;</span>: <span class="string">&quot;ignore&quot;</span></span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 禁止给类的构造函数的参数添加修饰符</span></span><br><span class="line">  <span class="string">&quot;no-parameter-properties&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 禁止使用 debugger</span></span><br><span class="line">  <span class="string">&quot;no-debugger&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 禁止行尾有空格</span></span><br><span class="line">  <span class="string">&quot;no-trailing-whitespace&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 禁止无用的表达式</span></span><br><span class="line">  <span class="string">&quot;no-unused-expression&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 定义过的变量必须使用</span></span><br><span class="line">  <span class="string">&quot;no-unused-variable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 变量必须先定义后使用</span></span><br><span class="line">  <span class="string">&quot;no-use-before-declare&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止使用 var</span></span><br><span class="line">  <span class="string">&quot;no-var-keyword&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 必须使用 === 或 !==，禁止使用 == 或 !=，与 null 比较时除外</span></span><br><span class="line">  <span class="string">&quot;triple-equals&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 指定类成员的排序规则</span></span><br><span class="line">  <span class="string">&quot;member-ordering&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// 禁止将 this 赋值给其他变量，除非是解构赋值</span></span><br><span class="line">  <span class="string">&quot;no-this-assignment&quot;</span>: [</span><br><span class="line">    <span class="literal">false</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;allowed-names&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;^self$&quot;</span>,</span><br><span class="line">        <span class="string">&quot;^that$&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;allow-destructuring&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 必须使用箭头函数，除非是单独的函数声明或是命名函数</span></span><br><span class="line">  <span class="string">&quot;only-arrow-functions&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;allow-declarations&quot;</span>,</span><br><span class="line">    <span class="string">&quot;allow-named-functions&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 禁止出现空代码块，允许 catch 是空代码块</span></span><br><span class="line">  <span class="string">&quot;no-empty&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;allow-empty-catch&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 禁止无用的类型断言</span></span><br><span class="line">  <span class="string">&quot;no-unnecessary-type-assertion&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 使用 return; 而不是 return undefined;</span></span><br><span class="line">  <span class="string">&quot;return-undefined&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止对 array 使用 for in 循环</span></span><br><span class="line">  <span class="string">&quot;no-for-in-array&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;comment-format&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;check-space&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 单行注释格式化规则</span></span><br><span class="line">  <span class="comment">// 定义函数时如果用到了覆写，则必须将覆写的函数写到一起</span></span><br><span class="line">  <span class="string">&quot;adjacent-overload-signatures&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止对函数的参数重新赋值</span></span><br><span class="line">  <span class="string">&quot;no-parameter-reassignment&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// if 后面必须有 &#123;，除非是单行 if</span></span><br><span class="line">  <span class="string">&quot;curly&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;ignore-same-line&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// for in 内部必须有 hasOwnProperty</span></span><br><span class="line">  <span class="string">&quot;forin&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止在分支条件判断中有赋值操作</span></span><br><span class="line">  <span class="string">&quot;no-conditional-assignment&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止使用 new 来生成 String, Number 或 Boolean</span></span><br><span class="line">  <span class="string">&quot;no-construct&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止 super 在一个构造函数中出现两次</span></span><br><span class="line">  <span class="string">&quot;no-duplicate-super&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止在 switch 语句中出现重复测试表达式的 case</span></span><br><span class="line">  <span class="string">&quot;no-duplicate-switch-case&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止出现重复的变量定义或函数参数名</span></span><br><span class="line">  <span class="string">&quot;no-duplicate-variable&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;check-parameters&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 禁止使用 eval</span></span><br><span class="line">  <span class="string">&quot;no-eval&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止对对象字面量进行类型断言（断言成 any 是允许的）</span></span><br><span class="line">  <span class="string">&quot;no-object-literal-type-assertion&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止没必要的 return await</span></span><br><span class="line">  <span class="string">&quot;no-return-await&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止在数组中出现连续的逗号，如 let foo = [,,]</span></span><br><span class="line">  <span class="string">&quot;no-sparse-arrays&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止 throw 字符串，必须 throw 一个 Error 对象</span></span><br><span class="line">  <span class="string">&quot;no-string-throw&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// switch 的 case 必须 return 或 break</span></span><br><span class="line">  <span class="string">&quot;no-switch-case-fall-through&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 使用实例的方法时，必须 bind 到实例上</span></span><br><span class="line">  <span class="string">&quot;no-unbound-method&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;ignore-static&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 使用 &#123; ...foo, bar: 1 &#125; 代替 Object.assign(&#123;&#125;, foo, &#123; bar: 1 &#125;)</span></span><br><span class="line">  <span class="comment">// 前者的类型检查更完善</span></span><br><span class="line">  <span class="string">&quot;prefer-object-spread&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// parseInt 必须传入第二个参数</span></span><br><span class="line">  <span class="string">&quot;radix&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 必须使用 isNaN(foo) 而不是 foo === NaN</span></span><br><span class="line">  <span class="string">&quot;use-isnan&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// 可维护性</span></span><br><span class="line">  <span class="comment">// 这些规则可以增加代码的可维护性</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">// 禁止函数的循环复杂度超过 20，https://en.wikipedia.org/wiki/Cyclomatic_complexity</span></span><br><span class="line">  <span class="string">&quot;cyclomatic-complexity&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="number">20</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 禁止使用废弃（被标识了 @deprecated）的 API</span></span><br><span class="line">  <span class="string">&quot;deprecation&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 一个缩进必须用四个空格替代</span></span><br><span class="line">  <span class="string">&quot;indent&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;spaces&quot;</span>,</span><br><span class="line">    <span class="number">4</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 禁止出现重复的 import</span></span><br><span class="line">  <span class="string">&quot;no-duplicate-imports&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止一个文件中出现多个相同的 namespace</span></span><br><span class="line">  <span class="string">&quot;no-mergeable-namespace&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 文件类型必须时 utf-8</span></span><br><span class="line">  <span class="string">&quot;encoding&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// import 语句中，关键字之间的间距必须是一个空格</span></span><br><span class="line">  <span class="string">&quot;import-spacing&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 接口可以 implement extend 和 merge</span></span><br><span class="line">  <span class="string">&quot;interface-over-type-literal&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// new 后面只必须有一个空格</span></span><br><span class="line">  <span class="string">&quot;new-parens&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 类型断言必须使用 as Type，禁止使用 &lt;Type&gt;</span></span><br><span class="line">  <span class="comment">// &lt;Type&gt; 容易被理解为 jsx</span></span><br><span class="line">  <span class="string">&quot;no-angle-bracket-type-assertion&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止连续超过三行空行</span></span><br><span class="line">  <span class="string">&quot;no-consecutive-blank-lines&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="number">3</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 禁止使用特殊空白符（比如全角空格）</span></span><br><span class="line">  <span class="string">&quot;no-irregular-whitespace&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止使用 JSDoc，因为 TypeScirpt 已经包含了大部分功能</span></span><br><span class="line">  <span class="string">&quot;no-redundant-jsdoc&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止使用三斜杠引入类型定义文件</span></span><br><span class="line">  <span class="string">&quot;no-reference-import&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 禁止变量定义时赋值为 undefined</span></span><br><span class="line">  <span class="string">&quot;no-unnecessary-initializer&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 小数必须以 0. 开头，禁止以 . 开头，并且不能以 0 结尾</span></span><br><span class="line">  <span class="string">&quot;number-literal-format&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 必须使用 a = &#123;b&#125; 而不是 a = &#123;b: b&#125;</span></span><br><span class="line">  <span class="string">&quot;object-literal-shorthand&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 变量申明必须每行一个，for 循环的初始条件中除外</span></span><br><span class="line">  <span class="string">&quot;one-variable-per-declaration&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;ignore-for-loop&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// if 后的 &#123; 禁止换行</span></span><br><span class="line">  <span class="string">&quot;one-line&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// 必须使用单引号，jsx 中必须使用双引号</span></span><br><span class="line">  <span class="string">&quot;quotemark&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;single&quot;</span>,</span><br><span class="line">    <span class="string">&quot;jsx-double&quot;</span>,</span><br><span class="line">    <span class="string">&quot;avoid-template&quot;</span>,</span><br><span class="line">    <span class="string">&quot;avoid-escape&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 行尾必须有分号</span></span><br><span class="line">  <span class="string">&quot;semicolon&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;always&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ignore-interfaces&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 函数名前必须有空格</span></span><br><span class="line">  <span class="string">&quot;space-before-function-paren&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;asyncArrow&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 括号内首尾禁止有空格</span></span><br><span class="line">  <span class="string">&quot;space-within-parens&quot;</span>: [</span><br><span class="line">    <span class="literal">true</span>,</span><br><span class="line">    <span class="number">0</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 禁止 finally 内出现 return, continue, break, throw 等</span></span><br><span class="line">  <span class="comment">// finally 会比 catch 先执行</span></span><br><span class="line">  <span class="string">&quot;no-unsafe-finally&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在此记录一下Vue中使用typescript时 遇到的一些问题&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cannot find module ‘./xxx/xxx’ or its corresponding type declarations&lt;br&gt;原因是ts识别不了vue文件，在引入的</summary>
      
    
    
    
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/tags/TypeScript/"/>
    
    <category term="Vue" scheme="https://lxx1997.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>一些惊艳的字符串处理方法</title>
    <link href="https://lxx1997.github.io/2020/09/24/web/number-format-methods/"/>
    <id>https://lxx1997.github.io/2020/09/24/web/number-format-methods/</id>
    <published>2020-09-24T07:49:01.000Z</published>
    <updated>2020-09-24T07:49:01.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="数字格式化"><a href="#数字格式化" class="headerlink" title="数字格式化"></a>数字格式化</h3><p>  描述：将一串<code>123483245678</code> 处理成为 <code>123,483,245,678</code></p><ul><li><p>eg1:<br>自己写的一个比较麻烦的方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 只实现了整数，其他同理，最好在获取到参数之后进行验证，是否符合自己的需求</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">formatNumber</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value)</span><br><span class="line">  <span class="keyword">let</span> arrStr = []</span><br><span class="line">  <span class="keyword">const</span> arr = (value + <span class="string">&#x27;&#x27;</span>).<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j = arr[i].<span class="property">length</span> - <span class="number">1</span>; j &gt;= <span class="number">0</span>;j--) &#123;</span><br><span class="line">      <span class="keyword">if</span>(index !== <span class="number">0</span> &amp;&amp; index % <span class="number">3</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      arrStr= [<span class="string">&#x27;,&#x27;</span>,...arrStr]</span><br><span class="line">      &#125;</span><br><span class="line">      arrStr= [arr[i][j],...arrStr]</span><br><span class="line">      index++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arrStr.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">formatNumber</span>(<span class="number">1234567890</span>)</span><br></pre></td></tr></table></figure></li><li><p>eg2:<br><strong>toLocaleString</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">123456789</span>).<span class="title function_">toLocaleString</span>(<span class="string">&#x27;en-US&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p>eg3:<br>正则表达式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">formatNumber</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/\B(?=(\d&#123;3&#125;)+(?!\d))/g</span>, <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">formatNumber</span>(<span class="string">&quot;123456789&quot;</span>))</span><br></pre></td></tr></table></figure></li><li><p>eg4:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">formatNumber</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> arr = [],</span><br><span class="line">    count = str.<span class="property">length</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (count &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">    arr.<span class="title function_">unshift</span>(str.<span class="title function_">slice</span>(count - <span class="number">3</span>, count))</span><br><span class="line">    count -= <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果是不是3的倍数就另外追加到上去</span></span><br><span class="line">  str.<span class="property">length</span> % <span class="number">3</span> &amp;&amp; arr.<span class="title function_">unshift</span>(str.<span class="title function_">slice</span>(<span class="number">0</span>, str.<span class="property">length</span> % <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> arr.<span class="title function_">toString</span>()</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">formatNumber</span>(<span class="string">&quot;1234567890&quot;</span>))</span><br></pre></td></tr></table></figure></li><li><p>eg5:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">formatNumber</span>(<span class="params">str</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [&quot;0&quot;, &quot;9&quot;, &quot;8&quot;, &quot;7&quot;, &quot;6&quot;, &quot;5&quot;, &quot;4&quot;, &quot;3&quot;, &quot;2&quot;, &quot;1&quot;]</span></span><br><span class="line">  <span class="keyword">return</span> str.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>).<span class="title function_">reverse</span>().<span class="title function_">reduce</span>(<span class="function">(<span class="params">prev, next, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ((index % <span class="number">3</span>) ? next : (next + <span class="string">&#x27;,&#x27;</span>)) + prev</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">formatNumber</span>(<span class="string">&quot;1234567890&quot;</span>))</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;数字格式化&quot;&gt;&lt;a href=&quot;#数字格式化&quot; class=&quot;headerlink&quot; title=&quot;数字格式化&quot;&gt;&lt;/a&gt;数字格式化&lt;/h3&gt;&lt;p&gt;  描述：将一串&lt;code&gt;123483245678&lt;/code&gt; 处理成为 &lt;code&gt;123,483,245,6</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="method" scheme="https://lxx1997.github.io/tags/method/"/>
    
  </entry>
  
  <entry>
    <title>react-学习之路-配置</title>
    <link href="https://lxx1997.github.io/2020/09/18/react/react-study-config/"/>
    <id>https://lxx1997.github.io/2020/09/18/react/react-study-config/</id>
    <published>2020-09-18T01:53:38.000Z</published>
    <updated>2020-09-18T01:53:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>Q: 如何配置路径别名</p><p>A: </p><ul><li><p>前置条件 安装 <code>npm react-app-rewired --save-dev</code></p><p>根目录（即src所在目录）创建<code>config-overrides.js</code>, 添加如下内容</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; override, fixBabelImports, addWebpackAlias &#125; = <span class="built_in">require</span>(<span class="string">&#x27;customize-cra&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;.&#x27;</span>, dir)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">override</span>(</span><br><span class="line">    <span class="title function_">addWebpackAlias</span>(&#123;</span><br><span class="line">        [<span class="string">&quot;@&quot;</span>]: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;src&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>修改 <code>package.json</code> 中的启动命令</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;react-app-rewired start&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改完成之后重新启动</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Q: 如何配置路径别名&lt;/p&gt;
&lt;p&gt;A: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;前置条件 安装 &lt;code&gt;npm react-app-rewired --save-dev&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;根目录（即src所在目录）创建&lt;code&gt;config-overrides</summary>
      
    
    
    
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>react - 学习之路 - 问题解决集锦</title>
    <link href="https://lxx1997.github.io/2020/09/18/react/react-study-error/"/>
    <id>https://lxx1997.github.io/2020/09/18/react/react-study-error/</id>
    <published>2020-09-18T01:49:13.000Z</published>
    <updated>2020-09-18T01:49:13.000Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>Q: 如何将带有html标签的字符串以html的形式在div等元素中显示出来</p><p>A: 使用元素的 <code>dangerouslySetInnerHTML</code> 可以将带有html标签的字符串转化为html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dangerouslySetInnerHTML=&#123;&#123; __html:item.content&#125;&#125;（vue中直接使用v-html就可以成功转化）</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Q: 如何将带有html标签的字符串以html的形式在div等元素中显示出来&lt;/p&gt;
&lt;p&gt;A: 使用元素的 &lt;code&gt;dangerouslySetInnerHTML&lt;/code&gt; 可以将带有html标签的字符串转化为html&lt;/p&gt;
&lt;figure c</summary>
      
    
    
    
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>react 项目中使用less</title>
    <link href="https://lxx1997.github.io/2020/09/03/react/react-less-loader/"/>
    <id>https://lxx1997.github.io/2020/09/03/react/react-less-loader/</id>
    <published>2020-09-03T07:30:35.000Z</published>
    <updated>2020-09-03T07:30:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h2>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-app-rewired customize-cra babel-plugin-<span class="keyword">import</span> -D</span><br></pre></td></tr></table></figure><p>  在项目根目录创建文件 config-overrides.js</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;...&#125; = <span class="built_in">require</span>(<span class="string">&#x27;customize-cra&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">override</span>(</span><br><span class="line">    ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="react-按需加载配置"><a href="#react-按需加载配置" class="headerlink" title="react 按需加载配置"></a>react 按需加载配置</h2>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; override, fixBabelImports &#125; = <span class="built_in">require</span>(<span class="string">&quot;customize-cra&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">override</span>(</span><br><span class="line">    <span class="title function_">fixBabelImports</span>(<span class="string">&#x27;import&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">libraryName</span>: <span class="string">&#x27;antd&#x27;</span>,</span><br><span class="line">        <span class="attr">libraryDirectory</span>: <span class="string">&#x27;es&#x27;</span>,</span><br><span class="line">        <span class="attr">style</span>: <span class="literal">true</span>,<span class="comment">//或者css, true代表运用less</span></span><br><span class="line">    &#125;),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>  修改package.json</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="string">&quot;react-app-rewired start&quot;</span>,</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;react-app-rewired build&quot;</span>,</span><br><span class="line">  <span class="string">&quot;test&quot;</span>: <span class="string">&quot;react-app-rewired test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;eject&quot;</span>: <span class="string">&quot;react-app-rewired eject&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>  编译less文件</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yarn add --dev less less-loader <span class="comment">//less-loader用5.0版本，高版本停用了一些配属性//config-overrides.js内容</span></span><br><span class="line"><span class="keyword">const</span> &#123; override,addLessLoader&#125; = <span class="built_in">require</span>(<span class="string">&quot;customize-cra&quot;</span>);<span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">override</span>(</span><br><span class="line">  　　　<span class="title function_">addLessLoader</span>(&#123;</span><br><span class="line">          <span class="attr">javascriptEnabled</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">modifyVars</span>: &#123;&#125;</span><br><span class="line">      &#125;),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul><li><p>装饰器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install -D @babel/plugin-proposal-decorators</span><br><span class="line"><span class="comment">//config-overrides.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; override, addDecoratorsLegacy&#125; = <span class="built_in">require</span>(<span class="string">&#x27;customize-cra&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">override</span>(</span><br><span class="line">  <span class="title function_">addDecoratorsLegacy</span>()</span><br><span class="line">);  </span><br></pre></td></tr></table></figure><h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2></li><li><p>出现如下报错</p><p>ValidationError: Invalid options object. Less Loader has been initialized using an options object that does not match the API schema.<br>options has an unknown property ‘modifyVars’. These properties are valid:<br>object { lessOptions?, prependData?, appendData?, sourceMap?, implementation? }。</p><p><strong>解决方案</strong><br>将</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">addLessLoader</span>(&#123;</span><br><span class="line">  <span class="attr">javascriptEnabled</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">modifyVars</span>: &#123;&#125;</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p>修改为</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">addLessLoader</span>(&#123;</span><br><span class="line">  <span class="attr">lessOptions</span>: &#123;</span><br><span class="line">    <span class="attr">javascriptEnabled</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">modifyVars</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;插件安装&quot;&gt;&lt;a href=&quot;#插件安装&quot; class=&quot;headerlink&quot; title=&quot;插件安装&quot;&gt;&lt;/a&gt;插件安装&lt;/h2&gt;  &lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre</summary>
      
    
    
    
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
    <category term="webpack" scheme="https://lxx1997.github.io/tags/webpack/"/>
    
    <category term="less" scheme="https://lxx1997.github.io/tags/less/"/>
    
    <category term="react-app-rewired" scheme="https://lxx1997.github.io/tags/react-app-rewired/"/>
    
    <category term="customize-cra" scheme="https://lxx1997.github.io/tags/customize-cra/"/>
    
  </entry>
  
  <entry>
    <title>重拾 react</title>
    <link href="https://lxx1997.github.io/2020/08/28/react/react-study/"/>
    <id>https://lxx1997.github.io/2020/08/28/react/react-study/</id>
    <published>2020-08-28T07:11:36.000Z</published>
    <updated>2020-08-28T07:11:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>  由于最近一段时间一直在使用vue做项目，最近打算重拾react，在此记录react的点滴学习，实时更新</p><h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><ul><li><p>routerWillLeave 路由跳转前确认</p><ul><li><code>return false</code> 取消本次跳转</li><li><code>return</code> 返回提示信息，在离开Route前提示用户进行确认</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Lifecycle</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Home</span> = <span class="title class_">React</span>.<span class="title function_">createClass</span>(&#123;</span><br><span class="line">  <span class="comment">// 假设 Home 是一个 route 组件，它可能会使用</span></span><br><span class="line">  <span class="comment">// Lifecycle mixin 去获得一个 routerWillLeave 方法。</span></span><br><span class="line">  <span class="attr">mixins</span>: [ <span class="title class_">Lifecycle</span> ],</span><br><span class="line">  <span class="title function_">routerWillLeave</span>(<span class="params">nextLocation</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">isSaved</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;Your work is not saved! Are you sure you want to leave&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;  由于最近一段时间一直在使用vue做项目，最近打算重拾react，在此记录react的点滴学习，实时更新&lt;/p&gt;
&lt;h2 id=&quot;生命周期&quot;&gt;&lt;a href=&quot;#生命周期&quot; class=&quot;headerlink&quot; title=&quot;生命周期&quot;&gt;&lt;/a&gt;生命周期&lt;/h2&gt;&lt;ul&gt;</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>重拾 react - React模板 antd</title>
    <link href="https://lxx1997.github.io/2020/08/28/react/react-study-antd/"/>
    <id>https://lxx1997.github.io/2020/08/28/react/react-study-antd/</id>
    <published>2020-08-28T04:05:15.000Z</published>
    <updated>2020-08-28T04:05:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>  由于最近一段时间一直在使用vue做项目，最近打算重拾react，在此记录react的点滴学习，实时更新</p><p>  antd 是一款优秀的react 前端页面框架</p><h2 id="插件使用"><a href="#插件使用" class="headerlink" title="插件使用"></a>插件使用</h2><p>  插件： <code>antd</code></p><p>  安装： <code>npm install -S antd</code></p><p>  使用： <code>import &#123;Layout, Button&#125; from &#39;antd&#39;</code></p><h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><ul><li><p>布局 <code>Layout</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Layout</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="title class_">Header</span>,<span class="title class_">Side</span>,<span class="title class_">Content</span>,<span class="title class_">Footer</span>&#125; = <span class="title class_">Layout</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;  由于最近一段时间一直在使用vue做项目，最近打算重拾react，在此记录react的点滴学习，实时更新&lt;/p&gt;
&lt;p&gt;  antd 是一款优秀的react 前端页面框架&lt;/p&gt;
&lt;h2 id=&quot;插件使用&quot;&gt;&lt;a href=&quot;#插件使用&quot; class=&quot;headerlin</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
    <category term="antd" scheme="https://lxx1997.github.io/tags/antd/"/>
    
  </entry>
  
  <entry>
    <title>重拾 react - React-Router</title>
    <link href="https://lxx1997.github.io/2020/08/28/react/react-study-router/"/>
    <id>https://lxx1997.github.io/2020/08/28/react/react-study-router/</id>
    <published>2020-08-28T03:52:22.000Z</published>
    <updated>2020-08-28T03:52:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>  由于最近一段时间一直在使用vue做项目，最近打算重拾react，在此记录react的点滴学习，实时更新</p><h2 id="插件使用"><a href="#插件使用" class="headerlink" title="插件使用"></a>插件使用</h2><p>  插件： <code>react-router-dom</code></p><p>  安装： <code>npm install -S react-router-dom</code></p><p>  使用： <code>import &#123;Router&#125; from &#39;react-router-dom&#39;</code></p><h2 id="Router-配置的方法"><a href="#Router-配置的方法" class="headerlink" title="Router 配置的方法"></a>Router 配置的方法</h2><ul><li><p>第一种</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Redirect</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"><span class="title class_">React</span>.<span class="title function_">render</span>((</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">IndexRoute</span> <span class="attr">component</span>=<span class="string">&#123;Dashboard&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;about&quot;</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;inbox&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Inbox&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/messages/:id&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Message&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        &#123;/* 跳转 /inbox/messages/:id 到 /messages/:id */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">from</span>=<span class="string">&quot;messages/:id&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/messages/:id&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">), <span class="variable language_">document</span>.<span class="property">body</span>)</span><br></pre></td></tr></table></figure></li><li><p>第二种</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routeConfig = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">App</span>,</span><br><span class="line">    <span class="attr">indexRoute</span>: &#123; <span class="attr">component</span>: <span class="title class_">Dashboard</span> &#125;,</span><br><span class="line">    <span class="attr">childRoutes</span>: [</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">component</span>: <span class="title class_">About</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&#x27;inbox&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">Inbox</span>,</span><br><span class="line">        <span class="attr">childRoutes</span>: [</span><br><span class="line">          &#123; <span class="attr">path</span>: <span class="string">&#x27;/messages/:id&#x27;</span>, <span class="attr">component</span>: <span class="title class_">Message</span> &#125;,</span><br><span class="line">          &#123; <span class="attr">path</span>: <span class="string">&#x27;messages/:id&#x27;</span>,</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">nextState, replaceState</span>) &#123;</span><br><span class="line">              <span class="title function_">replaceState</span>(<span class="literal">null</span>, <span class="string">&#x27;/messages/&#x27;</span> + nextState.<span class="property">params</span>.<span class="property">id</span>)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="title class_">React</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">routes</span>=<span class="string">&#123;routeConfig&#125;</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="property">body</span>)</span><br></pre></td></tr></table></figure></li></ul><h2 id="组件类型"><a href="#组件类型" class="headerlink" title="组件类型"></a>组件类型</h2><ul><li><p>Router 最外层路由，包裹所有的路由 <code>HashRouter</code> 哈希路由 <code>BrowserRouter</code> 历史路由 </p></li><li><p>Route 路由页面地址</p></li><li><p>Link 路由跳转</p></li><li><p>IndexRoute 用来设置一个默认路由</p></li><li><p>Redirect 路由重定向</p></li><li><p>Switch 有<code>Switch</code>标签，则其中的<code>Route</code>在路径相同的情况下，只匹配第一个，这个可以避免重复匹配</p></li><li><p>IndexLink 只有定义的路由被渲染后才激活</p></li></ul><h2 id="导航路由"><a href="#导航路由" class="headerlink" title="导航路由"></a>导航路由</h2><ul><li><p>历史路由模式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// somewhere like a redux/flux action file:</span></span><br><span class="line"><span class="keyword">import</span> &#123; browserHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line">browserHistory.<span class="title function_">push</span>(<span class="string">&#x27;/some/path&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p>哈希路由模式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// somewhere like a redux/flux action file:</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HashHistory</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"><span class="title class_">HashHistory</span>.<span class="title function_">push</span>(<span class="string">&#x27;/some/path&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;  由于最近一段时间一直在使用vue做项目，最近打算重拾react，在此记录react的点滴学习，实时更新&lt;/p&gt;
&lt;h2 id=&quot;插件使用&quot;&gt;&lt;a href=&quot;#插件使用&quot; class=&quot;headerlink&quot; title=&quot;插件使用&quot;&gt;&lt;/a&gt;插件使用&lt;/h2&gt;&lt;p&gt; </summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="react" scheme="https://lxx1997.github.io/tags/react/"/>
    
    <category term="router" scheme="https://lxx1997.github.io/tags/router/"/>
    
  </entry>
  
  <entry>
    <title>electron - 使用javascript编写pc应用 - 01</title>
    <link href="https://lxx1997.github.io/2020/08/20/frame/electron-study-01/"/>
    <id>https://lxx1997.github.io/2020/08/20/frame/electron-study-01/</id>
    <published>2020-08-20T01:30:05.000Z</published>
    <updated>2020-08-20T01:30:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>  在<a href="https://www.electronjs.org/">electron官网</a>根据文档指示，下载了一个electron模板并安装依赖成功运行</p><p>  练习项目<a href="https://github.com/lxx1997/react-electron-app">git地址</a></p><h2 id="版本发布"><a href="#版本发布" class="headerlink" title="版本发布"></a>版本发布</h2><p>  插件： <code>electron-packager</code></p><p>  安装： <code>npm install -g electron-packager</code></p><p>  打包： <code>package&quot;: &quot;electron-packager ./ demo_app --platform=win32 --out ../demo_app_release --version 1.4.13 --overwrite --icon=./images/app.ico</code></p><h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><p>  electron 提供了许多api来方便我们调用</p><h4 id="Dialog模块"><a href="#Dialog模块" class="headerlink" title="Dialog模块"></a>Dialog模块</h4><ul><li>showOpenDialog(<em>browserWindow</em>, options, <em>callback</em>)<ul><li><code>_browserWindow_</code> BrowserWindow (可选)</li></ul></li></ul><h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><p>  Q:  react 文件打包之后，访问index.html,文件报错找不到js和css文件</p><p>  A:  react 路由模式由 history模式修改为 hash模式, package.json 里面添加配置 <code>homePage: &#39;.&#39;</code></p><p>  Q:  使用electron打包，窗口白屏，无法加载文件</p><p>  A:  将package.json, electron的入口文件，（以及预加载文件preload.js）复制到react打包后的项目 build文件夹中，<br>      然后修改electron的入口文件<br>      electron.js</p><pre><code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;app, <span class="title class_">BrowserWindow</span>&#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line"><span class="comment">// const &#123; url &#125; = require(&#x27;inspector&#x27;)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createWindow</span> () &#123;</span><br><span class="line">  <span class="comment">// 隐藏菜单栏</span></span><br><span class="line">  <span class="comment">// Menu.setApplicationMenu(null)</span></span><br><span class="line">  <span class="keyword">const</span> mainWindow = <span class="keyword">new</span> <span class="title class_">BrowserWindow</span>(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span>,</span><br><span class="line">    <span class="comment">// icon: path.join(__dirname, &#x27;/assets/img/2.jpg&#x27;),</span></span><br><span class="line">    <span class="comment">// title: &#x27;this is a electron&#x27;</span></span><br><span class="line">    <span class="attr">webPreferences</span>: &#123;</span><br><span class="line">      <span class="attr">javascript</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">plugins</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">nodeIntegration</span>: <span class="literal">true</span>, <span class="comment">// 是否集成 Nodejs</span></span><br><span class="line">      <span class="attr">webSecurity</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">preload</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;preload.js&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// and load the index.html of the app.</span></span><br><span class="line">  <span class="comment">// mainWindow.loadFile(path.join(__dirname, &#x27;index.html&#x27;))</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Open the DevTools.</span></span><br><span class="line">  <span class="comment">// mainWindow.webContents.openDevTools()</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// mainWindow.loadURL(&#x27;http://localhost:3000/&#x27;)</span></span><br><span class="line">  <span class="comment">// 加载应用----react 打包</span></span><br><span class="line"></span><br><span class="line">　　mainWindow.<span class="title function_">loadURL</span>(url.<span class="title function_">format</span>(&#123;</span><br><span class="line">  　　<span class="attr">pathname</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./index.html&#x27;</span>),</span><br><span class="line">  　　<span class="attr">protocol</span>: <span class="string">&#x27;file:&#x27;</span>,</span><br><span class="line">  　　<span class="attr">slashes</span>: <span class="literal">true</span></span><br><span class="line">　　&#125;))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">whenReady</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">createWindow</span>()</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ready&#x27;</span>)</span><br><span class="line">  app.<span class="title function_">on</span>(<span class="string">&#x27;activate&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">BrowserWindow</span>.<span class="title function_">getAllWindows</span>().<span class="property">length</span> === <span class="number">0</span>) <span class="title function_">createWindow</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">on</span>(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.<span class="property">platform</span> !== <span class="string">&#x27;darwin&#x27;</span>) app.<span class="title function_">quit</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;  在&lt;a href=&quot;https://www.electronjs.org/&quot;&gt;electron官网&lt;/a&gt;根据文档指示，下载了一个electron模板并安装依赖成功运行&lt;/p&gt;
&lt;p&gt;  练习项目&lt;a href=&quot;https://github.com/lxx1997/r</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="html" scheme="https://lxx1997.github.io/tags/html/"/>
    
    <category term="electron" scheme="https://lxx1997.github.io/tags/electron/"/>
    
    <category term="css" scheme="https://lxx1997.github.io/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>第三方插件安装采坑  -  01</title>
    <link href="https://lxx1997.github.io/2020/08/19/webpack/npm-third-party-plugin-in/"/>
    <id>https://lxx1997.github.io/2020/08/19/webpack/npm-third-party-plugin-in/</id>
    <published>2020-08-19T09:16:20.000Z</published>
    <updated>2020-08-19T09:16:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>  此博客用来记录使用第三方插件安装及使用的时候采坑记录</p><h4 id="electron"><a href="#electron" class="headerlink" title="electron"></a>electron</h4><p>  安装 <code>npm install</code></p><ul><li><p>报错</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Error</span>: read <span class="variable constant_">ECONNRESET</span></span><br><span class="line"># 或者</span><br><span class="line"><span class="title class_">Error</span>: <span class="title class_">Electron</span> failed to install correctly ...</span><br></pre></td></tr></table></figure></li><li><p>解决方式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置镜像</span></span><br><span class="line">set <span class="string">&quot;ELECTRON_MIRROR=http://npm.taobao.org/mirrors/electron&quot;</span></span><br><span class="line"><span class="comment">// 安装</span></span><br><span class="line">npm install</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;  此博客用来记录使用第三方插件安装及使用的时候采坑记录&lt;/p&gt;
&lt;h4 id=&quot;electron&quot;&gt;&lt;a href=&quot;#electron&quot; class=&quot;headerlink&quot; title=&quot;electron&quot;&gt;&lt;/a&gt;electron&lt;/h4&gt;&lt;p&gt;  安装 &lt;code</summary>
      
    
    
    
    
    <category term="npm" scheme="https://lxx1997.github.io/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>HOW TO 制作一个简易的弹幕demo</title>
    <link href="https://lxx1997.github.io/2020/08/13/web/html-video-chat-bullet/"/>
    <id>https://lxx1997.github.io/2020/08/13/web/html-video-chat-bullet/</id>
    <published>2020-08-13T07:21:48.000Z</published>
    <updated>2020-08-13T07:21:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>  闲来无事，对于bili上面的弹幕感兴趣，于是自己打算尝试制作一个简单的弹幕系统</p><h4 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h4><p>  首先先创建一个容器用来存放video播放器和弹幕发射器,注意要有一个遮罩层设置透明度为0,用来显示我们输入的弹幕,位于视频的上方,为了使视频的显示不那么突兀,我们可以把存放视频的容器的背景颜色设置成深色或者黑色</p>  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.chat-bullet-container</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">300px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.chat-bullet-video-container</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">250px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.chat-bullet-video-container</span> <span class="selector-tag">video</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">max-width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">max-height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>) <span class="built_in">translateY</span>(-<span class="number">62%</span>);</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.chat-bullet-video-container</span> <span class="selector-id">#chat-bullet-video-text</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.chat-text</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">70px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">70px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#000000</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;chat-bullet-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 播放 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chat-bullet-video-container&quot;</span> <span class="attr">class</span>=<span class="string">&quot;chat-bullet-video-container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">&quot;video&quot;</span> <span class="attr">src</span>=<span class="string">&quot;./demo.mp4&quot;</span> <span class="attr">controls</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chat-bullet-video-text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;chat-bullet-video-method&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- &lt;input id=&quot;color&quot; type=&quot;color&quot;&gt; --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;chat-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;handleSend()&quot;</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="功能实现"><a href="#功能实现" class="headerlink" title="功能实现"></a>功能实现</h4><p>  接下来给弹幕发射器添加点击事件，点击的时候让我们发送的文字显示在视频上面</p><p>  获取遮罩层元素及其宽高,作为弹幕显示和滚动的限制条件</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chatContainer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;chat-bullet-video-text&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> height = chatContainer.<span class="property">offsetHeight</span></span><br><span class="line"><span class="keyword">const</span> width = chatContainer.<span class="property">offsetWidth</span></span><br></pre></td></tr></table></figure><p>  为发送弹幕按钮添加点击事件,生成随机颜色和位置的弹幕，然后通过appendChild方法将生成的弹幕放到</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleSend</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;chat-input&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> msg = input.<span class="property">value</span></span><br><span class="line">  <span class="keyword">const</span> text = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;span&#x27;</span>)</span><br><span class="line">  text.<span class="property">innerHTML</span> = msg</span><br><span class="line">  <span class="keyword">let</span> style = <span class="string">`position: absolute;</span></span><br><span class="line"><span class="string">  top: <span class="subst">$&#123;<span class="built_in">Math</span>.random() * height&#125;</span>px;</span></span><br><span class="line"><span class="string">  right: 30px;</span></span><br><span class="line"><span class="string">  color: rgb(<span class="subst">$&#123;<span class="built_in">Math</span>.random() * <span class="number">255</span>&#125;</span>,<span class="subst">$&#123;<span class="built_in">Math</span>.random() * <span class="number">255</span>&#125;</span>,<span class="subst">$&#123;<span class="built_in">Math</span>.random() * <span class="number">255</span>&#125;</span>);`</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span>.<span class="title function_">setAttribute</span>(<span class="string">&#x27;style&#x27;</span>, style)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chatContainer</span>.<span class="title function_">appendChild</span>(<span class="variable language_">this</span>.<span class="property">element</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  这个时候当我们在输入框中输入内容的时候，点击发送的时候就会发现我们写的内容随机显示在视频上面</p><p>  接下来做的就是让弹幕能够动起来，本次实现的是从右向左移动</p><p>  但是弹幕不可能只发送一个，弹幕通常来说是很多个的，这个时候如何用上述的方法来添加弹幕和控制弹幕的话显然是不合理。</p><p>  这个时候我们应该做的是让每个添加的弹幕之间是独立的，互不影响的，能够独立运行，这时候我借鉴了之前学习canvas时使用的方法：创建一个class类，在这个类中实现弹幕的属性初始化，渲染，运行及删除事件</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 弹幕渲染及移动类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Chat</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">element, chatContainer, data</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span> = element</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chatContainer</span> = chatContainer</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ccx</span> = <span class="variable language_">this</span>.<span class="property">chatContainer</span>.<span class="property">offsetWidth</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ccy</span> = <span class="variable language_">this</span>.<span class="property">chatContainer</span>.<span class="property">offsetHeight</span></span><br><span class="line">    <span class="comment">// 弹幕速度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">s</span> = <span class="title class_">Math</span>.<span class="title function_">random</span>() + <span class="number">4</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 渲染带有样式的弹幕</span></span><br><span class="line">  <span class="title function_">paint</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> style = <span class="string">`position: absolute;</span></span><br><span class="line"><span class="string">  top: <span class="subst">$&#123;<span class="built_in">Math</span>.random() * <span class="variable language_">this</span>.ccy&#125;</span>px;</span></span><br><span class="line"><span class="string">  right: <span class="subst">$&#123;<span class="variable language_">this</span>.mx&#125;</span>;</span></span><br><span class="line"><span class="string">  color: rgb(<span class="subst">$&#123;<span class="built_in">Math</span>.random() * <span class="number">255</span>&#125;</span>,<span class="subst">$&#123;<span class="built_in">Math</span>.random() * <span class="number">255</span>&#125;</span>,<span class="subst">$&#123;<span class="built_in">Math</span>.random() * <span class="number">255</span>&#125;</span>);`</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span>.<span class="title function_">setAttribute</span>(<span class="string">&#x27;style&#x27;</span>, style)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chatContainer</span>.<span class="title function_">appendChild</span>(<span class="variable language_">this</span>.<span class="property">element</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">mx</span> = -<span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">offsetWidth</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="variable language_">this</span>.<span class="property">mx</span> + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 移动弹幕，使弹幕从右向左移动</span></span><br><span class="line">  <span class="title function_">move</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">mx</span> = <span class="variable language_">this</span>.<span class="property">mx</span> + <span class="variable language_">this</span>.<span class="property">s</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;inline-block&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="variable language_">this</span>.<span class="property">mx</span> + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">delete</span>(<span class="params">index</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">mx</span> &gt;= <span class="variable language_">this</span>.<span class="property">ccx</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  点击事件也应该根据实际情况进行修改，同时定义一个数组用来存放我们添加的弹幕的类</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chartList = []</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleSend</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;chat-input&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> msg = input.<span class="property">value</span></span><br><span class="line">  <span class="keyword">const</span> text = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;span&#x27;</span>)</span><br><span class="line">  text.<span class="property">innerHTML</span> = msg</span><br><span class="line">  <span class="keyword">const</span> chat = <span class="keyword">new</span> <span class="title class_">Chat</span>(text, chatContainer, &#123;<span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>&#125;)</span><br><span class="line">  chat.<span class="title function_">paint</span>()</span><br><span class="line">  chartList.<span class="title function_">push</span>(chat)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  但是想要让弹幕动起来可不是那么简单的事情，因为我们上述操作只是使弹幕渲染到了视频上面，并没有使弹幕动起来，这时我们可以定义一个定时器，时间间隔要短，在定时器中我们循环存放弹幕的数组，调用弹幕自身的移动事件及删除事件</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; chartList.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    chartList[i].<span class="title function_">move</span>()</span><br><span class="line">    chartList[i].<span class="title function_">delete</span>(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="number">100</span>)</span><br></pre></td></tr></table></figure><h4 id="将弹幕与视频关联起来"><a href="#将弹幕与视频关联起来" class="headerlink" title="将弹幕与视频关联起来"></a>将弹幕与视频关联起来</h4><p>  想要做成根据视频播放来显示历史弹幕就要将弹幕和视频当前播放时间进行关联</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给视频添加监听事件，监听视频运行</span></span><br><span class="line"><span class="comment">// video ended function</span></span><br><span class="line">video.<span class="title function_">addEventListener</span>(<span class="string">&#x27;ended&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(video_Status)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 监听视频播放，获取当前播放时间</span></span><br><span class="line">video.<span class="title function_">addEventListener</span>(<span class="string">&#x27;canplay&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">duration</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 监听视频播放，获取当前播放时间</span></span><br><span class="line">video.<span class="title function_">addEventListener</span>(<span class="string">&#x27;timeupdate&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  currentTime = <span class="variable language_">this</span>.<span class="property">currentTime</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>  获取到视频播放时间之后，接下来就是将时间和弹幕关联起来存储，如果没有后台的支持的话可以使用localStorage和indexedDB来存储数据，这里我推介使用indexedDB，因为可以练习一下indexedDB的知识，同时indexedDB的存储空间也比localStorage的存储空间要大很多</p><p>  首先检测indexedDB是否启用，同时创建所需要使用的数据库和表，设置主键<br>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkIndexedDB</span>(<span class="params">database, table</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> request = <span class="variable language_">window</span>.<span class="property">indexedDB</span>.<span class="title function_">open</span>(database, <span class="number">3</span>)</span><br><span class="line">  request.<span class="property">onupgradeneeded</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> db = e.<span class="property">target</span>.<span class="property">result</span></span><br><span class="line">    <span class="keyword">if</span>(!db.<span class="property">objectStoreNames</span>.<span class="title function_">contains</span>(table)) &#123;</span><br><span class="line">      <span class="keyword">const</span> tables = db.<span class="title function_">createObjectStore</span>(table, &#123;</span><br><span class="line">        <span class="attr">keyPath</span>: <span class="string">&#x27;id&#x27;</span>, <span class="comment">// 使用当前时间戳可以避免id重复</span></span><br><span class="line">        <span class="attr">autoIncreament</span>: <span class="literal">true</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123123</span>)</span><br><span class="line">    db.<span class="title function_">close</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>  然后连接数据库，向表中插入数据</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">linkIndexedDB</span>(<span class="params">database, table</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> request = <span class="variable language_">window</span>.<span class="property">indexedDB</span>.<span class="title function_">open</span>(database)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    request.<span class="property">onsuccess</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> db = e.<span class="property">target</span>.<span class="property">result</span></span><br><span class="line">      <span class="title function_">resolve</span>(db)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  同时将弹幕的print()进行修改，每创建一条弹幕就存储一次</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 渲染带有样式的弹幕</span></span><br><span class="line">  <span class="title function_">paint</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(currentTime, <span class="string">&#x27;chat&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> style = <span class="string">`position: absolute;</span></span><br><span class="line"><span class="string">  top: <span class="subst">$&#123;<span class="built_in">Math</span>.random() * <span class="variable language_">this</span>.ccy&#125;</span>px;</span></span><br><span class="line"><span class="string">  right: <span class="subst">$&#123;<span class="variable language_">this</span>.mx&#125;</span>;</span></span><br><span class="line"><span class="string">  color: rgb(<span class="subst">$&#123;<span class="built_in">Math</span>.random() * <span class="number">255</span>&#125;</span>,<span class="subst">$&#123;<span class="built_in">Math</span>.random() * <span class="number">255</span>&#125;</span>,<span class="subst">$&#123;<span class="built_in">Math</span>.random() * <span class="number">255</span>&#125;</span>);`</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span>.<span class="title function_">setAttribute</span>(<span class="string">&#x27;style&#x27;</span>, style)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chatContainer</span>.<span class="title function_">appendChild</span>(<span class="variable language_">this</span>.<span class="property">element</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">mx</span> = -<span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">offsetWidth</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">style</span>.<span class="property">right</span> = <span class="variable language_">this</span>.<span class="property">mx</span> + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    <span class="title function_">linkIndexedDB</span>(<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;chat&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">db</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(db)</span><br><span class="line">      <span class="keyword">const</span> request = db.<span class="title function_">transaction</span>([<span class="string">&#x27;chat&#x27;</span>], <span class="string">&#x27;readwrite&#x27;</span>).<span class="title function_">objectStore</span>(<span class="string">&#x27;chat&#x27;</span>)</span><br><span class="line">          .<span class="title function_">add</span>(&#123;<span class="attr">id</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(), <span class="attr">element</span>: <span class="variable language_">this</span>.<span class="property">element</span>.<span class="property">innerHTML</span>, <span class="attr">style</span>: style, <span class="attr">currentTime</span>: currentTime, <span class="attr">createUser</span>: <span class="string">&#x27;lxx&#x27;</span>, <span class="attr">speed</span>: <span class="variable language_">this</span>.<span class="property">s</span>&#125;)</span><br><span class="line">      request.<span class="property">onsuccess</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;添加成功&#x27;</span>)</span><br><span class="line">        db.<span class="title function_">close</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>  未完待续。。。。。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;  闲来无事，对于bili上面的弹幕感兴趣，于是自己打算尝试制作一个简单的弹幕系统&lt;/p&gt;
&lt;h4 id=&quot;页面布局&quot;&gt;&lt;a href=&quot;#页面布局&quot; class=&quot;headerlink&quot; title=&quot;页面布局&quot;&gt;&lt;/a&gt;页面布局&lt;/h4&gt;&lt;p&gt;  首先先创建一个容器用来</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="HTML" scheme="https://lxx1997.github.io/tags/HTML/"/>
    
  </entry>
  
  <entry>
    <title>HTML 标签及函数</title>
    <link href="https://lxx1997.github.io/2020/08/11/web/html-label-function/"/>
    <id>https://lxx1997.github.io/2020/08/11/web/html-label-function/</id>
    <published>2020-08-11T02:09:34.000Z</published>
    <updated>2020-08-11T02:09:34.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="HTML全局属性"><a href="#HTML全局属性" class="headerlink" title="HTML全局属性"></a>HTML全局属性</h4><ul><li><p>accesskey 规定激活元素的快捷键，使元素获得焦点（Opera浏览器不支持此选项）</p><p>以下元素支持accesskey a, area, button, input, label, legend 以及 textarea</p></li><li><p>contenteditable 规定元素内容是否可编辑，如果元素未设置contenteditable 属性，那么元素将会从其父元素继承该属性</p><p><code>contenteditable = true | false</code></p></li><li><p>contextmenu 规定 div 元素的上下文菜单。上下文菜单会在用户右键点击元素时出现，contextmenu 属性的值是要打开的 menu 元素的 id，<strong>目前只有fireFox支持</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">contextmenu</span>=<span class="string">&quot;mymenu&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">menu</span> <span class="attr">type</span>=<span class="string">&quot;context&quot;</span> <span class="attr">id</span>=<span class="string">&quot;mymenu&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">menuitem</span> <span class="attr">label</span>=<span class="string">&quot;Refresh&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">menuitem</span> <span class="attr">label</span>=<span class="string">&quot;Twitter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">menuitem</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>data-* 用来嵌入自定义数据，赋予我们在所有 HTML 元素上嵌入自定义 data 属性的能力，属性名不应该包含任何大写字母，并且在前缀 “data-“ 之后必须有至少一个字符</p></li><li><p>dir 属性规定元素内容的文本方向 <code>ltr</code>: 从左到右 <code>rtl</code>: 从右到左</p><p><em>dir属性在以下标签中无效base, br, frame, frameset, hr, iframe, param 以及 script</em></p></li><li><p>draggable 规定元素是否可拖拽 <code>true|false|auto</code></p><p><em>在使用时要和函数连用<code>ondragstart</code>,<code>ondragover</code>,<code>ondrop</code></em></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">html</span>,<span class="selector-tag">body</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#div</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border</span>: <span class="number">1px</span> solid rebeccapurple;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div&quot;</span> <span class="attr">ondrop</span>=<span class="string">&quot;drop(event)&quot;</span> <span class="attr">ondragover</span>=<span class="string">&quot;allowDrop(event)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;drag&quot;</span> <span class="attr">draggable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">dropzone</span>=<span class="string">&quot;link&quot;</span> <span class="attr">ondragstart</span>=<span class="string">&quot;drag(event)&quot;</span>&gt;</span>3242342342<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">drag</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span></span><br><span class="line"><span class="language-javascript">      e.<span class="property">dataTransfer</span>.<span class="title function_">setData</span>(<span class="string">&#x27;Text&#x27;</span>, e.<span class="property">target</span>.<span class="property">id</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">drop</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> data = e.<span class="property">dataTransfer</span>.<span class="title function_">getData</span>(<span class="string">&quot;Text&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      e.<span class="property">target</span>.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(data));</span></span><br><span class="line"><span class="language-javascript">      e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">allowDrop</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><em>在与contenteditable连用时不起作用</em></p></li><li><p>dropzone 拖动数据会产生被拖动数据的副本</p><ul><li><code>copy</code>    拖动数据会产生被拖动数据的副本。</li><li><code>move</code>    拖动数据会导致被拖动数据被移动到新位置。</li><li><code>link</code>    拖动数据会产生指向原始数据的链接。</li></ul><p><em>暂无浏览器支持</em></p></li><li><p>hidden 规定元素是否显示 是布尔属性 hidden属性可以用于防止用户查看元素，知道匹配某些条件</p><p><em>在 XHTML 中，属性简写是禁止的，hidden 属性必须定义为 <code>&lt;element hidden=&quot;hidden&quot;&gt;</code></em></p></li><li><p>lang 规定了元素内容的语言 <code>zh,en</code></p><p><em>lang 属性在以下标签中无效：<code>&lt;base&gt;, &lt;br&gt;, &lt;frame&gt;, &lt;frameset&gt;, &lt;hr&gt;, &lt;iframe&gt;, &lt;param&gt; 以及 &lt;script&gt;</code>。</em></p></li><li><p>spellcheck 规定是否对元素进行拼写和语法检查</p><ul><li>input 元素中的文本值（非密码）</li><li><code>&lt;textarea&gt;</code> 元素中的文本</li><li>可编辑元素中的文本</li></ul></li><li><p>tabindex 规定元素的 tab 键控制次序（当 tab 键用于导航时）</p><p><em>以下元素支持 tabindex 属性：<code>&lt;a&gt;, &lt;area&gt;, &lt;button&gt;, &lt;input&gt;, &lt;object&gt;, &lt;select&gt; 以及 &lt;textarea&gt;</code>,几乎所有浏览器均 tabindex 属性，除了 Safari</em></p></li><li><p>translate 规定不应翻译某些元素</p><p><em>所有主流浏览器都无法正确地支持 translate 属性,请使用 class=”notranslate” 替代</em></p></li></ul><h4 id="HTML事件属性"><a href="#HTML事件属性" class="headerlink" title="HTML事件属性"></a>HTML事件属性</h4><ul><li><p><strong>Window 事件属性</strong>  针对 window 对象触发的事件（应用到 <body> 标签）</p><p>onload  页面结束加载之后触发</p><p>onresize  浏览器窗口被调整大小时触发</p><p>onunload  一旦页面已下载时触发（或者浏览器窗口已被关闭）</p></li><li><p><strong>Form 事件</strong> 由 HTML 表单内的动作触发的事件（应用到几乎所有 HTML 元素，但最常用在 form 元素中）</p><p>onblur  元素失去焦点时运行的脚本</p><p>onchange  元素值被改变时运行的脚本</p><p>onfocus  当元素获得焦点时运行的脚本</p><p>onselect  在元素中文本被选中后触发</p><p>onsubmit  在提交表单时触发</p></li><li><p><strong>keyboard 事件</strong></p><p>onkeyup 用户释放按键时触发</p><p>onkeydown 用户按下按键时触发</p><p>onkeypress 用户敲击按钮时触发</p></li><li><p><strong>mouse 事件</strong></p><p>onclick  元素发生鼠标点击时触发</p><p>ondbclick  元素发生鼠标双击时触发</p><p>ondrag, ondragend, ondragstart ondrop, ondragenter, ondragerleave, ondragover  元素拖拽时触发</p><p>onmousedown  按下鼠标按钮时触发</p><p>onmouseup  释放鼠标按钮时触发</p><p>onmousemove  鼠标指针移动到元素上触发</p><p>onmouseover  鼠标指针移出到元素上触发</p><p>onmousewheel  鼠标滚轮正在滚动时运行的脚本</p><p>onscroll  当元素滚动条被滚动时运行的脚本</p></li><li><p><strong>Media 事件</strong></p><p>onabort  在退出时运行的脚本</p><p>oncanplay  当文件就绪可以开始播放时运行的脚本(缓冲已足够开始时)</p><p>onwaiting  当媒介已停止播放单打算继续播放时</p></li></ul><h4 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h4><ul><li><p>base 标签</p><p><code>&lt;base href=&quot;http://www.baidu.com/static/&quot;&gt;</code></p><p><code>&lt;base&gt;</code> 标签为页面上所有链接规定默认地址和默认目标，在通常情况下浏览器会从单签文档的url中提取响应的元素来填写URL中的空白，但是<code>&lt;base&gt;</code>标签可以改变着一点，浏览器随后将不再使用当前文档的url，而是使用指定的基本url，包括<code>&lt;a&gt;</code>,<code>&lt;img&gt;</code>,<code>&lt;link&gt;</code>,<code>&lt;form&gt;</code>标签中的URL</p><p><strong><code>&lt;base&gt;</code>标签必须位于head元素内部</strong></p></li><li><p>basefont 标签</p><p><code>&lt;basefont color=&quot;red&quot; size=&quot;5&quot;&gt;</code> </p><p>规定页面上默认字体颜色和字号, <em>主流浏览器暂不支持此标签</em></p></li><li><p>blockquote 标签</p><p><code>&lt;blockquote&gt;</code> 标签定义块引用， 标签中的所有文本都会从常规文本中分离出去，经常左右两边有间距，而且有时会使用斜体，也就是说块引用拥有自己的空间</p><p>把页面作为 strict XHTML 进行验证，那么 <code>&lt;blockquote&gt;</code> 元素必须包含块级元素</p></li><li><p>datalist 标签</p><p>datalist 描述了input 标签的可能值</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;myCar&quot;</span> <span class="attr">list</span>=<span class="string">&quot;cars&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">datalist</span> <span class="attr">id</span>=<span class="string">cars</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;BMW&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;FORD&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;VOLVO&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">datalist</span>&gt;</span>  </span><br></pre></td></tr></table></figure><p>datalist 标签标签定义选项列表，与input元素配合使用，定义input可能的值，datalist及其元素不会被显示出来，仅仅是合法输入值列表， 用input的list属性来绑定datalist</p></li><li><p>del 删除线</p></li><li><p>details 标签</p><p>用于描述文档或者文档某个部分的细节</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">details</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">summary</span>&gt;</span>Copyright 2011.<span class="tag">&lt;/<span class="name">summary</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>All pages and graphics on this web site are the property of W3School.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">details</span>&gt;</span></span><br></pre></td></tr></table></figure><p><em>目前只有 Chrome 支持 <code>&lt;details&gt;</code> 标签。</em></p></li><li><p>dialog 标签 </p><p>dialog 标签定义对话框或窗口是HTML5的新标签</p></li><li><p>embed 标签</p><p><code>&lt;embed&gt;</code> 标签定义嵌入的内容，比如插件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;embed src=<span class="string">&quot;helloworld.swf&quot;</span> type=<span class="string">&quot;MIME_type&quot;</span> /&gt;</span><br></pre></td></tr></table></figure></li><li><p>fieldset 标签</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>health information<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">    height: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">    weight: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;fieldset&gt;</code> 元素可将表单内的相关元素分组，将表单内容的一部分打包，生成一组相关表单的字段</p><p><code>&lt;legend&gt;</code> 标签为<code>&lt;fieldset&gt;</code> 元素定义标题。</p></li><li><p>figcaption 标签</p><p>用作文档中插图的图像，带有一个标题</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">figure</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">figcaption</span>&gt;</span>黄浦江上的的卢浦大桥<span class="tag">&lt;/<span class="name">figcaption</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;shanghai_lupu_bridge.jpg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;350&quot;</span> <span class="attr">height</span>=<span class="string">&quot;234&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">figure</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;figcaption&gt;</code> 标签定义 figure 元素的标题,应该被置于 “figure” 元素的第一个或最后一个子元素的位置</p></li><li><p>frame 标签</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">frameset</span> <span class="attr">cols</span>=<span class="string">&quot;25%,50%,25%&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">&quot;frame_a.htm&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">&quot;frame_b.htm&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">frame</span> <span class="attr">src</span>=<span class="string">&quot;frame_c.htm&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">frameset</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;frame&gt;</code> 标签定义 frameset 中的一个特定的窗口</p></li><li><p>frameset 标签</p><p>frameset 元素可定义一个框架集。它被用来组织多个窗口（框架）。每个框架存有独立的文档</p><ul><li>cols 定义框架集中列的数目和尺寸</li><li>rows 定义框架集中行的数目和尺寸</li></ul></li><li><p>iframe 标签</p><p>iframe 元素会创建包含另外一个文档的内联框架（即行内框架）</p><ul><li>frameborder 规定是否显示框架周围的边框</li><li>height 规定iframe的高度</li><li>width 定义 iframe 的宽度</li><li>marginheight 定义 iframe 的顶部和底部的边距</li><li>marginwidth 定义 iframe 的左侧和右侧的边距</li><li>name 规定 iframe 的名称</li><li>scrolling <code>yes/no/auto</code> 规定是否在 iframe 中显示滚动条</li><li>src 规定在 iframe 中显示的文档的 URL</li></ul></li><li><p><strong>img</strong> 标签</p><ul><li>alt 规定图像的替代文本</li><li>src 规定显示图像的 URL</li><li>height 定义图像的高度</li><li>width 设置图像的宽度</li><li>ismap 将图像定义为服务器端图像映射</li><li>usemap 将图像定义为客户器端图像映射</li></ul></li><li><p><strong>input</strong> 标签</p><ul><li>accept 规定通过文件上传来提交的文件的类型</li><li>alt 定义图像输入的替代文本</li><li>autocomplete <code>on/off</code> 规定是否使用输入字段的自动完成功能</li><li>autofocus 规定输入字段在页面加载时是否获得焦点，（不适用于 type=”hidden”）</li><li>checked 规定此 input 元素首次加载时应当被选中</li><li>disabled 当 input 元素加载时禁用此元素</li><li>form 规定输入字段所属的一个或多个表单</li><li>list 引用包含输入字段的预定义选项的 datalist</li><li>max 规定输入字段的最大值</li><li>min 规定输入字段的最小值</li><li>maxlength 规定输入字段中的字符的最大长度</li><li>multiple 如果使用该属性，则允许一个以上的值</li><li>name 定义 input 元素的名称</li><li>pattern 规定输入字段的值的模式或格式，通常用于表单输入内容验证是否规则</li><li>placeholder 规定帮助用户填写输入字段的提示</li><li>readonly 规定输入字段为只读</li><li>required 指示输入字段的值是必需的</li><li>size 定义输入字段的宽度</li><li>src 定义以提交按钮形式显示的图像的 URL</li><li>type <code>button/checkbox/file/hidden/image/password/radio/reset/submit/text/tel/email/teatarea/radio</code> 规定 input 元素的类型</li></ul></li><li><p>keygen 标签</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;demo_keygen.asp&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">  Username: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;usr_name&quot;</span> /&gt;</span></span><br><span class="line">  Encryption: <span class="tag">&lt;<span class="name">keygen</span> <span class="attr">name</span>=<span class="string">&quot;security&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;keygen&gt;</code> 标签规定用于表单的密钥对生成器字段。当提交表单时，私钥存储在本地，公钥发送到服务器</p></li><li><p><strong>link</strong> 标签</p><p><code>&lt;link&gt;</code> 标签定义文档与外部资源的关系</p><ul><li>href 规定被链接文档的位置</li><li>rel  <code>alternate/author/elp/icon/licence/next/pingback/prefetch/prev/search/sidebar/stylesheet/tag</code>  规定当前文档与被链接文档之间的关系</li><li>type 规定被链接文档的 MIME 类型</li></ul></li><li><p>map 标签</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">map</span> <span class="attr">name</span>=<span class="string">&quot;planetmap&quot;</span> <span class="attr">id</span>=<span class="string">&quot;planetmap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">area</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">coords</span>=<span class="string">&quot;180,139,14&quot;</span> <span class="attr">href</span> =<span class="string">&quot;venus.html&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Venus&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">area</span> <span class="attr">shape</span>=<span class="string">&quot;circle&quot;</span> <span class="attr">coords</span>=<span class="string">&quot;129,161,10&quot;</span> <span class="attr">href</span> =<span class="string">&quot;mercur.html&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Mercury&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">area</span> <span class="attr">shape</span>=<span class="string">&quot;rect&quot;</span> <span class="attr">coords</span>=<span class="string">&quot;0,0,110,260&quot;</span> <span class="attr">href</span> =<span class="string">&quot;sun.html&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Sun&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br></pre></td></tr></table></figure><p>定义一个客户端图像映射。图像映射（image-map）指带有可点击区域的一幅图像。</p><p><code>area</code> 元素永远嵌套在 <code>map</code> 元素内部。<code>area</code> 元素可定义图像映射中的区域</p></li><li><p>mark 标签</p><p><code>&lt;mark&gt;</code> 标签定义带有记号的文本。请在需要突出显示文本时使用 <code>&lt;m&gt;</code>标签</p></li><li><p>meta 标签</p><p><code>&lt;meta&gt;</code> 元素可提供有关页面的元信息（meta-information），比如针对搜索引擎和更新频度的描述和关键词,<code>&lt;meta&gt;</code> 标签位于文档的头部，不包含任何内容。<code>&lt;meta&gt;</code> 标签的属性定义了与文档相关联的名称/值对</p><ul><li>content 定义与 http-equiv 或 name 属性相关的元信息</li><li>http-equiv <code>content-type/expires/refresh/set-cookie</code>  把 content 属性关联到 HTTP 头部</li><li>name     <code>author/description/keywords/generator/revised/others</code> 把 content 属性关联到一个名称</li><li>scheme 定义用于翻译 content 属性值的格式</li></ul></li><li><p>meter 标签</p><p>使用meter 元素来度量给定范围内的数据</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meter</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span> <span class="attr">min</span>=<span class="string">&quot;0&quot;</span> <span class="attr">max</span>=<span class="string">&quot;10&quot;</span>&gt;</span>十分之三<span class="tag">&lt;/<span class="name">meter</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>&lt;meter&gt;</code> 标签定义已知范围或分数值内的标量测量。也被称为 gauge（尺度）</p></li><li><p>object 标签</p><p>向 HTML 代码添加一个对象</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:F08DF954-8592-11D1-B16A-00C0F0283628&quot;</span> <span class="attr">id</span>=<span class="string">&quot;Slider1&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100&quot;</span> <span class="attr">height</span>=<span class="string">&quot;50&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;BorderStyle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;MousePointer&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Enabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Min&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Max&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;HTML全局属性&quot;&gt;&lt;a href=&quot;#HTML全局属性&quot; class=&quot;headerlink&quot; title=&quot;HTML全局属性&quot;&gt;&lt;/a&gt;HTML全局属性&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;accesskey 规定激活元素的快捷键，使元素获得焦点（Opera浏览器</summary>
      
    
    
    
    
    <category term="html" scheme="https://lxx1997.github.io/tags/html/"/>
    
    <category term="function" scheme="https://lxx1997.github.io/tags/function/"/>
    
  </entry>
  
  <entry>
    <title>使用js压缩图片</title>
    <link href="https://lxx1997.github.io/2020/08/10/web/js-image-compression/"/>
    <id>https://lxx1997.github.io/2020/08/10/web/js-image-compression/</id>
    <published>2020-08-10T02:17:32.000Z</published>
    <updated>2020-08-10T02:17:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>  压缩图片的方式主要是使用了canvas进行了一次转码和压缩<br>  使用的方法</p><ul><li>var fr =  FileReader()</li><li>fr.readAsDataURL(file)</li><li>Image()</li><li>canvas.toDataURL(imgType, quality)</li></ul><h4 id="FileReader-函数"><a href="#FileReader-函数" class="headerlink" title="FileReader() 函数"></a>FileReader() 函数</h4><ul><li><p>使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>()</span><br><span class="line">reader.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="property">result</span>)</span><br><span class="line">&#125;</span><br><span class="line">reader.<span class="title function_">readAsText</span>(file)</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>属性</p><p><strong>error</strong></p><p>  返回读取文件时的错误信息</p><p><strong>onabort</strong></p><p>  包含在终止事件被触发时执行的事件处理程序，举例，当读取文件的过程中需要中止时。</p><p><strong>onload</strong></p><p>  当<code>FileReader</code>读取文件的方式为<code>readAsArrayBuffer</code>,<code>readAsBinaryString</code>, <code>readAsDataURL</code> 或者 <code>readAsText</code> 的时候，会触发一个 <code>load</code> 事件。从而可以使用  <code>FileReader.onload</code> 属性对该事件进行处理。</p><p><strong>readyState</strong></p><p>  提供 FileReader 读取操作时的当前状态</p><p><strong>result</strong></p><p>  返回文件的内容。只有在读取操作完成后，此属性才有效，返回的数据的格式取决于是使用哪种读取方法来执行读取操作的。</p><p>  一个字符串或者一个ArrayBuffer ，这取决于读取操作是使用哪种方法来进行的</p></li><li><p>方法</p><p><strong>abort()</strong></p><p>abort方法可以取消FileReader的读写操作，触发之后readyState为已完成(DONE)</p><p><strong>readAsArrayBuffer()</strong></p><p>FileReader 接口提供的<code>readAsArrayBuffer</code> 用于启动读取指定的<code>Blob</code>或者<code>File</code>的内容，当操作完成时，<code>readyState</code>变成<code>done</code>并且触发<code>loadend</code>事件，result属性中将包含一个ArrayBuffer对象表示所读取文件的数据</p><p><strong>readAsBinaryString()</strong></p><p><code>readAsBinaryString</code> 方法读取指定的<code>blob</code>或者<code>File</code>的内容，当操作完成时，<code>readyState</code>变成<code>done</code>并且触发<code>loadend</code>事件，result属性中将包含一个ArrayBuffer对象表示所读取文件原始二进制格式</p><p><em>该方法已从 FileAPI 标准移除，请使用 FileReader.readAsArrayBuffer() 代替。</em></p><p><strong>readAsDataURL()</strong></p><p><code>readAsDataURL</code> 方法会读取指定的 <code>Blob</code> 或 <code>File</code> 对象。读取操作完成的时候，<code>readyState</code> 会变成已完成DONE，并触发 <code>loadend</code> 事件，同时 <code>result</code> 属性将包含一个data:URL格式的字符串（base64编码）以表示所读取文件的内容</p><p><strong>readAsText()</strong></p><p><code>readAsText</code> 方法可以将 <code>Blob</code> 或者 <code>File</code> 对象转根据特殊的编码格式转化为内容(字符串形式)</p><p>这个方法是异步的，也就是说，只有当执行完成后才能够查看到结果，如果直接查看是无结果的，并返回undefined</p><p>必须要挂载 实例下的 onload 或 onloadend 的方法处理转化后的结果</p><p>转化完成后， readyState 这个参数就会转换 为 done 即完成态， event(“loadend”) 挂载的事件会被触发，并可以通过事件返回的形参得到中的 FileReader.result 属性得到转化后的结果</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// [encoding] 编码类型， 可选</span></span><br><span class="line"><span class="title class_">FileReader</span>.<span class="title function_">readAsText</span>(blob[, encoding]);</span><br></pre></td></tr></table></figure><h4 id="开始进行图片压缩"><a href="#开始进行图片压缩" class="headerlink" title="开始进行图片压缩"></a>开始进行图片压缩</h4><ul><li>首先，创建一个input输入框用来上传文件</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">multiple</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;handleChoose()&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>获取上传的文件</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleChoose = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> file = <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;file&#x27;</span>).<span class="property">files</span>)</span><br><span class="line">  <span class="keyword">const</span> filePath = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;file&#x27;</span>).<span class="property">value</span></span><br><span class="line">  <span class="keyword">const</span> imgBox = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> imgs = []</span><br><span class="line">  file.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>()</span><br><span class="line">    <span class="keyword">const</span> img = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;img&#x27;</span>)</span><br><span class="line">    <span class="comment">// 将file文件 转码为base64</span></span><br><span class="line">    reader.<span class="title function_">readAsDataURL</span>(item)</span><br><span class="line">    <span class="comment">// FileReader插件转码成功之后</span></span><br><span class="line">    reader.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      img.<span class="property">src</span> = reader[<span class="string">&#x27;result&#x27;</span>]</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(img.<span class="property">src</span>, <span class="number">123</span>)</span><br><span class="line">      <span class="keyword">const</span> imgType = img.<span class="property">src</span>.<span class="title function_">split</span>(<span class="string">&#x27;;&#x27;</span>)[<span class="number">0</span>].<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">      imgBox.<span class="title function_">appendChild</span>(img)</span><br><span class="line">      <span class="keyword">const</span> callback = <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data, <span class="number">456</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">scaleImage</span>(img.<span class="property">src</span>, imgType, callback)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// FileReader插件转码失败</span></span><br><span class="line">    reader.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// FileReader插件转码成功</span></span><br><span class="line">    reader.<span class="property">onloadend</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>进行图片压缩</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">scaleImage</span>(<span class="params">base64Url, imgType, callback </span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>()</span><br><span class="line">  img.<span class="property">src</span>= base64Url</span><br><span class="line">  img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> _this = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">let</span> width = _this.<span class="property">width</span></span><br><span class="line">    <span class="keyword">let</span> height = _this.<span class="property">height</span></span><br><span class="line">    <span class="keyword">let</span> quality = <span class="number">0.7</span></span><br><span class="line">    <span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> canvasW = <span class="variable language_">document</span>.<span class="title function_">createAttribute</span>(<span class="string">&#x27;width&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> canvasH = <span class="variable language_">document</span>.<span class="title function_">createAttribute</span>(<span class="string">&#x27;height&#x27;</span>)</span><br><span class="line">    canvasW.<span class="property">nodeValue</span> = width</span><br><span class="line">    canvasH.<span class="property">nodeValue</span> = height</span><br><span class="line">    canvas.<span class="title function_">setAttributeNode</span>(canvasW)</span><br><span class="line">    canvas.<span class="title function_">setAttributeNode</span>(canvasH)</span><br><span class="line">    ctx.<span class="title function_">drawImage</span>(_this, <span class="number">0</span>, <span class="number">0</span>, width, height)</span><br><span class="line">    <span class="keyword">let</span> base64 = canvas.<span class="title function_">toDataURL</span>(<span class="string">&quot;image/jpeg&quot;</span>, quality)</span><br><span class="line">    <span class="comment">// toDataUrl</span></span><br><span class="line">    <span class="comment">// 图片格式默认为 image/png</span></span><br><span class="line">    <span class="comment">// 在指定格式为image/jpeg 或image.webp得情况下，可以从0,1的区间内压缩图片质量，如果超出取值范围，将会使用默认值0.92</span></span><br><span class="line">    <span class="title function_">callback</span>(base64)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;  压缩图片的方式主要是使用了canvas进行了一次转码和压缩&lt;br&gt;  使用的方法&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;var fr =  FileReader()&lt;/li&gt;
&lt;li&gt;fr.readAsDataURL(file)&lt;/li&gt;
&lt;li&gt;Image()&lt;/li&gt;
&lt;li&gt;</summary>
      
    
    
    
    
    <category term="JavaScript" scheme="https://lxx1997.github.io/tags/JavaScript/"/>
    
    <category term="canvas" scheme="https://lxx1997.github.io/tags/canvas/"/>
    
  </entry>
  
  <entry>
    <title>矢量图形 SVG 学习之路 --- 进阶版</title>
    <link href="https://lxx1997.github.io/2020/07/30/web/svg-study-02/"/>
    <id>https://lxx1997.github.io/2020/07/30/web/svg-study-02/</id>
    <published>2020-07-30T06:42:26.000Z</published>
    <updated>2020-07-30T06:42:26.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="SVG-滤镜"><a href="#SVG-滤镜" class="headerlink" title="SVG 滤镜"></a>SVG 滤镜</h4><p>  SVG可用的滤镜有以下几种</p><ul><li>feBlend - 与图像相结合的滤镜</li><li>feColorMatrix - 用于彩色滤光片转换</li><li>feComponentTransfer</li><li>feComposite</li><li>feConvolveMatrix</li><li>feDiffuseLighting</li><li>feDisplacementMap</li><li>feFlood</li><li>feGaussianBlur</li><li>feImage</li><li>feMerge</li><li>feMorphology</li><li>feOffset - 过滤阴影</li><li>feSpecularLighting</li><li>feTile</li><li>feTurbulence</li><li>feDistantLight - 用于照明过滤</li><li>fePointLight - 用于照明过滤</li><li><p>feSpotLight - 用于照明过滤</p><p>您可以在每个 SVG 元素上使用多个滤镜！</p></li></ul><h4 id="SVG-模糊效果"><a href="#SVG-模糊效果" class="headerlink" title="SVG 模糊效果"></a>SVG 模糊效果</h4><p>  <strong><defs>和<filter></strong></p><p>  所有互联网的SVG滤镜定义在<defs>元素中。<defs>元素定义短并含有特殊元素（如滤镜）定义。<br>  <filter>标签用来定义SVG滤镜。<filter>标签使用必需的id属性来定义向图形应用哪个滤镜？</p><p>  <strong><feGaussianBlur></strong></p><p>  <feGaussianBlur>用于创建模糊效果</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg xmlns=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> version=<span class="string">&quot;1.1&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">defs</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">filter</span> <span class="attr">id</span>=<span class="string">&quot;f1&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">feGaussianBlur</span> <span class="attr">in</span>=<span class="string">&quot;SourceGraphic&quot;</span> <span class="attr">stdDeviation</span>=<span class="string">&quot;15&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">rect</span> <span class="attr">width</span>=<span class="string">&quot;90&quot;</span> <span class="attr">height</span>=<span class="string">&quot;90&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;green&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;3&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">fill</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">filter</span>=<span class="string">&quot;url(#f1)&quot;</span> /&gt;</span></span></span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure><ul><li>filter 元素<code>id</code>属性属性定义了一个滤镜的唯一名称</li><li><feGaussianBlur> 元素定义模糊效果</li><li><code>in=&quot;SourceGraphic&quot;</code> 这个部分定义了由整个图像创建效果</li><li><code>stdDeviation</code> 属性定义模糊量</li><li><rect>元素的滤镜属性用来把元素链接到<code>&quot;f1&quot;</code>滤镜</li></ul><h4 id="SVG-阴影"><a href="#SVG-阴影" class="headerlink" title="SVG 阴影"></a>SVG 阴影</h4><p>  <strong><defs>和<filter></strong></p><p>  所有互联网的SVG滤镜定义在<defs>元素中。<defs>元素定义短并含有特殊元素（如滤镜）定义。<br>  <filter>标签用来定义SVG滤镜。<filter>标签使用必需的id属性来定义向图形应用哪个滤镜？ </p><p>  <strong>feOffset</strong></p><p>  <feOffset>元素是用于创建阴影效果。我们的想法是采取一个SVG图形（图像或元素）并移动它在xy平面上一点儿。<br>  第一个例子偏移一个矩形（带<feOffset>），然后混合偏移图像顶部（含<feBlend>）</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg xmlns=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> version=<span class="string">&quot;1.1&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">defs</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">filter</span> <span class="attr">id</span>=<span class="string">&quot;f1&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200%&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">feOffset</span> <span class="attr">result</span>=<span class="string">&quot;offOut&quot;</span> <span class="attr">in</span>=<span class="string">&quot;SourceGraphic&quot;</span> <span class="attr">dx</span>=<span class="string">&quot;20&quot;</span> <span class="attr">dy</span>=<span class="string">&quot;20&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">feBlend</span> <span class="attr">in</span>=<span class="string">&quot;SourceGraphic&quot;</span> <span class="attr">in2</span>=<span class="string">&quot;offOut&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;normal&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">rect</span> <span class="attr">width</span>=<span class="string">&quot;90&quot;</span> <span class="attr">height</span>=<span class="string">&quot;90&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;green&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;3&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">fill</span>=<span class="string">&quot;yellow&quot;</span> <span class="attr">filter</span>=<span class="string">&quot;url(#f1)&quot;</span> /&gt;</span></span></span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure><p>  feColorMatrix 的 matrix 是一个 4*5 的矩阵。前面 4 列是颜色通道的比例系数，最后一列是常量偏移。</p><p>  上面公式中的 rr 表示 red to red 系数，以此类推。c1~c4 表示常量偏移。</p><p>  第一个 4*5 矩阵为变换矩阵，第二个单列矩阵为待变换对象的像素值。右侧单列矩阵为矩阵 1 和 2 的点积结果。</p><p>  这个变换矩阵看起来比较复杂，在实践上常使用一个简化的对角矩阵，即除了 rr/gg/bb/aa 取值非零外，其余行列取值为 0，这就退化成了简单的各颜色通道的独立调整。</p><p>  <code>feColorMatrix</code>的语法:</p><p>  <filter id="f1" x="0%" y="0%" width="100%" height="100%"><br>    <feColorMatrix         result="original" id="c1" type="matrix"         values="1 0 0 0 0                  0 1 0 0 0                 0 0 1 0 0                 0 0 0 1 0" /><br>  </filter><br>  上述<code>feColorMatrix</code>过滤器的类型值为matrix，除此之外，还有saturate（饱和度）和hueRotate（色相旋转），取值比较简单，这里不做说明。</p><p>  显然当变换矩阵为单位对角矩阵时，变换结果和原值相等。</p><h4 id="SVG渐变"><a href="#SVG渐变" class="headerlink" title="SVG渐变"></a>SVG渐变</h4><p>  渐变是从一种颜色到另一种颜色的平滑过渡，另外把多个元素的过渡应用到同一个元素上</p><p>  渐变主要有两种类型</p><ul><li>linear</li><li><p>Redial</p><p><strong>SVG线性渐变</strong></p><p><code>linearGradient</code> 泳衣定义线性渐变</p><p><code>linearGradient</code>必须套嵌在<code>defs</code>标签内部， 线性渐变可定义水平、垂直、或角渐变</p><ul><li>当y1和y2相等 x1和x2不同时，可创建水平渐变</li><li>当x1和x2相等 y1和y2不同时，可创建垂直渐变</li><li>当x1和x2不同 y1和y2不同时，可创建角形渐变</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">defs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linearGradient</span> <span class="attr">id</span>=<span class="string">&quot;grad1&quot;</span> <span class="attr">x1</span>=<span class="string">&quot;0%&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;0%&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;0%&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">&quot;0%&quot;</span> <span class="attr">style</span>=<span class="string">&quot;stop-color:rgb(255,255,0);stop-opacity:1&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">style</span>=<span class="string">&quot;stop-color:rgb(255,0,0);stop-opacity:1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">linearGradient</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ellipse</span> <span class="attr">cx</span>=<span class="string">&quot;200&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;70&quot;</span> <span class="attr">rx</span>=<span class="string">&quot;85&quot;</span> <span class="attr">ry</span>=<span class="string">&quot;55&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;url(#grad1)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>linearGradient</code> 标签的id属性可为渐变定义一个唯一的名称</li><li><code>linearGradient</code> 标签的x1，y1，x2，y2属性自定义渐变开始和结束位置</li><li>渐变颜色范围可由两种或多种颜色组成，每种颜色通过一个stop标签来规定，offset属性用来定义渐变开始和结束位置</li><li>填充属性吧ellipse元素连接到次渐变</li><li><code>text</code> 元素用来添加一个文本</li></ul><p><strong>SVG放射性渐变</strong></p><p><code>redialGradient</code> 元素用于定义放射性渐变</p><p><code>redialGradient</code> 标签必须嵌套在defs的内部，defs标签是definitions的缩写，他可对诸如渐变之类的特殊元素进行定义</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">defs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">radialGradient</span> <span class="attr">id</span>=<span class="string">&quot;grad1&quot;</span> <span class="attr">cx</span>=<span class="string">&quot;50%&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;50%&quot;</span> <span class="attr">r</span>=<span class="string">&quot;50%&quot;</span> <span class="attr">fx</span>=<span class="string">&quot;50%&quot;</span> <span class="attr">fy</span>=<span class="string">&quot;50%&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">&quot;0%&quot;</span> <span class="attr">style</span>=<span class="string">&quot;stop-color:rgb(255,255,255);</span></span></span><br><span class="line"><span class="string"><span class="tag">      stop-opacity:0&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">style</span>=<span class="string">&quot;stop-color:rgb(0,0,255);stop-opacity:1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">radialGradient</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ellipse</span> <span class="attr">cx</span>=<span class="string">&quot;200&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;70&quot;</span> <span class="attr">rx</span>=<span class="string">&quot;85&quot;</span> <span class="attr">ry</span>=<span class="string">&quot;55&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;url(#grad1)&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>redialGradient</code> 标签的id属性可为渐变定义一个唯一的名称</li><li>cx、cy和r属性定义最外层圆，fx和fy定义最内层圆</li><li>渐变颜色返回可有两个或两个以上的颜色组成，每种颜色用一个<code>stop</code>标签指定，offset标签用于定义渐变色开始和结束的位置</li><li>填充属性把ellipse元素连接到渐变</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;SVG-滤镜&quot;&gt;&lt;a href=&quot;#SVG-滤镜&quot; class=&quot;headerlink&quot; title=&quot;SVG 滤镜&quot;&gt;&lt;/a&gt;SVG 滤镜&lt;/h4&gt;&lt;p&gt;  SVG可用的滤镜有以下几种&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;feBlend - 与图像相结合的滤镜&lt;/li&gt;
</summary>
      
    
    
    
    
    <category term="svg" scheme="https://lxx1997.github.io/tags/svg/"/>
    
  </entry>
  
  <entry>
    <title>矢量图形 SVG 学习之路 --- 基础版</title>
    <link href="https://lxx1997.github.io/2020/07/29/web/svg-study-01/"/>
    <id>https://lxx1997.github.io/2020/07/29/web/svg-study-01/</id>
    <published>2020-07-29T06:33:53.000Z</published>
    <updated>2020-07-29T06:33:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>  SVG意为可缩放矢量图形（Scalable Vector Graphics）<br>  SVG使用XML格式定义图像</p><p>  <strong>如何定义一个SVG图像</strong></p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> standalone=<span class="string">&quot;no&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M200 200</span></span></span><br><span class="line"><span class="string"><span class="tag">  C153 334 151 334 151 334</span></span></span><br><span class="line"><span class="string"><span class="tag">  C151 339 153 344 156 344</span></span></span><br><span class="line"><span class="string"><span class="tag">  C164 344 171 339 171 334</span></span></span><br><span class="line"><span class="string"><span class="tag">  C171 322 164 314 156 314</span></span></span><br><span class="line"><span class="string"><span class="tag">  C142 314 131 322 131 334</span></span></span><br><span class="line"><span class="string"><span class="tag">  C131 350 142 364 156 364</span></span></span><br><span class="line"><span class="string"><span class="tag">  C175 364 191 350 191 334</span></span></span><br><span class="line"><span class="string"><span class="tag">  C191 311 175 294 156 294</span></span></span><br><span class="line"><span class="string"><span class="tag">  C131 294 111 311 111 334</span></span></span><br><span class="line"><span class="string"><span class="tag">  C111 361 131 384 156 384</span></span></span><br><span class="line"><span class="string"><span class="tag">  C186 384 211 361 211 334</span></span></span><br><span class="line"><span class="string"><span class="tag">  C211 300 186 274 156 274&quot;</span> <span class="attr">style</span>=<span class="string">&quot;fill:white;stroke:red;stroke-width:2;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="在HTML页面中使用SVG"><a href="#在HTML页面中使用SVG" class="headerlink" title="在HTML页面中使用SVG"></a>在HTML页面中使用SVG</h4><ul><li><p>使用embed标签</p><p><embed> 标签被所有主流的浏览器支持，并允许使用脚本。</p><p>当在 HTML 页面中嵌入 SVG 时使用 <embed> 标签是 Adobe SVG Viewer 推荐的方法！然而，如果需要创建合法的 XHTML，就不能使用 <embed>。任何 HTML 规范中都没有 <embed> 标签。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">&quot;rect.svg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">type</span>=<span class="string">&quot;image/svg+xml&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">pluginspage</span>=<span class="string">&quot;http://www.adobe.com/svg/viewer/install/&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- pluginspage 属性指向下载插件的 URL。 --&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>使用object标签</p><p><object> 标签是 HTML 4 的标准标签，被所有较新的浏览器支持。它的缺点是不允许使用脚本。</p><p>假如您安装了最新版本的 Adobe SVG Viewer，那么当使用 <object> 标签时 SVG 文件无法工作（至少不能在 IE 中工作）！</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">data</span>=<span class="string">&quot;rect.svg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;image/svg+xml&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">codebase</span>=<span class="string">&quot;http://www.adobe.com/svg/viewer/install/&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- codebase 属性指向下载插件的 URL。 --&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>使用iframe标签</p><p><iframe> 标签可工作在大部分的浏览器中</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;rect.svg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="SVG图像图形"><a href="#SVG图像图形" class="headerlink" title="SVG图像图形"></a>SVG图像图形</h4></li><li><p>svg矩形 <rect></p></li><li>svg圆形 <circle></li><li>svg椭圆 <ellipse></li><li>svg线 <line></li><li>svg折线 <polyline></li><li>svg多边形 <polygon></li><li>svg路径 <path></li><li><p>style 矩形样式</p><ul><li>fill 定义矩形的填充颜色</li><li>stroke-width 矩形边框的宽度</li><li>stroke 矩形边框的颜色</li><li>fill-opacity 定义填充颜色透明度 合法范围 0 - 1</li><li>stroke-opacity 定义笔触颜色透明度 合法范围 0 - 1</li></ul><p><strong>SVG矩形</strong></p><p>rect标签可以用来创建矩形，以及矩形的变种</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> standalone=<span class="string">&quot;no&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">&quot;fill:rgb(0,0,255);stroke-width:1;</span></span></span><br><span class="line"><span class="string"><span class="tag">  stroke:rgb(0,0,0)&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>width 矩形的高度和宽度</li><li>height 矩形的宽度</li><li>x 定义矩形的左侧位置</li><li>y 定义矩形的右侧位置</li><li>rx ry 属性可使矩形产生圆角</li></ul><p><strong>SVG圆形</strong></p><p>circle 标签可用来创建一个圆</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">&quot;100&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;50&quot;</span> <span class="attr">r</span>=<span class="string">&quot;40&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">stroke-width</span>=<span class="string">&quot;2&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;red&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>cx, cy 定义圆点的x和y坐标，如果省略cx和cy，圆的中心会被设置为（0,0）</li><li>r 定义圆的半径</li></ul><p><strong>SVG椭圆</strong></p><p>ellipse 标签用来创建一个椭圆</p><p>椭圆有不同的x和y半径，而圆的x和y的半径是相同的</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ellipse</span> <span class="attr">cx</span>=<span class="string">&quot;240&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;100&quot;</span> <span class="attr">rx</span>=<span class="string">&quot;220&quot;</span> <span class="attr">ry</span>=<span class="string">&quot;30&quot;</span> <span class="attr">style</span>=<span class="string">&quot;fill:purple&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ellipse</span> <span class="attr">cx</span>=<span class="string">&quot;220&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;70&quot;</span> <span class="attr">rx</span>=<span class="string">&quot;190&quot;</span> <span class="attr">ry</span>=<span class="string">&quot;20&quot;</span> <span class="attr">style</span>=<span class="string">&quot;fill:lime&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ellipse</span> <span class="attr">cx</span>=<span class="string">&quot;210&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;45&quot;</span> <span class="attr">rx</span>=<span class="string">&quot;170&quot;</span> <span class="attr">ry</span>=<span class="string">&quot;15&quot;</span> <span class="attr">style</span>=<span class="string">&quot;fill:yellow&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>cx 定义椭圆中心的x坐标</li><li>cy 定义椭圆中心的y坐标</li><li>rx 定义椭圆水平半径</li><li>ry 定义椭圆垂直半径</li></ul><p><strong>SVG直线</strong></p><p>line 元素用来创建一个直线</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;200&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;200&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">&quot;stroke:rgb(255,0,0);stroke-width:2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>x1 在x轴定义线条开始的地方</li><li>y1 在y轴定义线条开始的地方</li><li>x2 在x轴定义线条结束的地方</li><li>y2 在y轴定义线条结束的地方</li></ul><p><strong>SVG多边形</strong></p><p>polyline 用来创建含有不少于三个边的图形，多边形是由直线组成的，其形状是封闭的</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>  <span class="attr">height</span>=<span class="string">&quot;210&quot;</span> <span class="attr">width</span>=<span class="string">&quot;500&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">polygon</span> <span class="attr">points</span>=<span class="string">&quot;200,10 250,190 160,210&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">&quot;fill:lime;stroke:purple;stroke-width:1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p>points 属性定义多边形的每个角的x和y坐标</p><ul><li><p>fill-rule<br>SVG图片填充规则通过fill-rule来指定</p><p>fill-rule 用于指定使用哪一种算法去判断画布上的某区域是否属于该图形内部</p><ul><li><code>nonzero</code> 字面意思上是非零， 按照这个规则 要判断一个点是否在图形内，则从该点做任意方向的一条射线，然后检测射线与图形路径的交点情况，从零开始计数，如果从左向右穿过射线则计数加一，从右到左穿过射线则计数减1 如果结果为0则认为点在图形外部，否则认为在内部</li><li><code>evenodd</code> 字面意思是“奇偶”。按该规则，要判断一个点是否在图形内，从该点作任意方向的一条射线，然后检测射线与图形路径的交点的数量。如果结果是奇数则认为点在内部，是偶数则认为点在外部。</li></ul></li></ul><p><strong>SVG曲线</strong></p><p>polyline 用于创建任何只有直线的形状</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 折线型曲线 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">polyline</span> <span class="attr">points</span>=<span class="string">&quot;20,20 40,25 60,40 80,120 120,140 200,180&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">&quot;fill:none;stroke:black;stroke-width:3&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 楼梯型曲线 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">polyline</span> <span class="attr">points</span>=<span class="string">&quot;0,40 40,40 40,80 80,80 80,120 120,120 120,160&quot;</span> <span class="attr">style</span>=<span class="string">&quot;fill:white;stroke:red;stroke-width:4&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>SVG路径</strong></p><p>path 元素用于定义一个路径</p><ul><li>M = moveto  移动到</li><li>L = lineto  线路到</li><li>H = horizontal lineto  水平线到</li><li>V = vertical lineto  垂直线到</li><li>C = curveto   曲线</li><li>S = smooth curveto  平滑曲线</li><li>Q = quadratic Bézier curve  二次Bézier曲线</li><li>T = smooth quadratic Bézier curveto  光滑二次Bézier曲线</li><li>A = elliptical Arc  椭圆弧</li><li>Z = closepath  闭合路径</li></ul><p>以上所有命令均允许小写字母。大写表示绝对定位，小写表示相对定位</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span> <span class="attr">id</span>=<span class="string">&quot;lineAB&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M 100 350 l 150 -300&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;red&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">stroke-width</span>=<span class="string">&quot;3&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span> <span class="attr">id</span>=<span class="string">&quot;lineBC&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M 250 50 l 150 300&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;red&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">stroke-width</span>=<span class="string">&quot;3&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M 175 200 l 150 0&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;green&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">&quot;M 100 350 q 150 -300 300 0&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;blue&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">stroke-width</span>=<span class="string">&quot;5&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Mark relevant points --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">g</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;3&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;black&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">id</span>=<span class="string">&quot;pointA&quot;</span> <span class="attr">cx</span>=<span class="string">&quot;100&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;350&quot;</span> <span class="attr">r</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">id</span>=<span class="string">&quot;pointB&quot;</span> <span class="attr">cx</span>=<span class="string">&quot;250&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;50&quot;</span> <span class="attr">r</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span> <span class="attr">id</span>=<span class="string">&quot;pointC&quot;</span> <span class="attr">cx</span>=<span class="string">&quot;400&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;350&quot;</span> <span class="attr">r</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Label the points --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">g</span> <span class="attr">font-size</span>=<span class="string">&quot;30&quot;</span> <span class="attr">font</span>=<span class="string">&quot;sans-serif&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;black&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;100&quot;</span> <span class="attr">y</span>=<span class="string">&quot;350&quot;</span> <span class="attr">dx</span>=<span class="string">&quot;-30&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;250&quot;</span> <span class="attr">y</span>=<span class="string">&quot;50&quot;</span> <span class="attr">dy</span>=<span class="string">&quot;-10&quot;</span>&gt;</span>B<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;400&quot;</span> <span class="attr">y</span>=<span class="string">&quot;350&quot;</span> <span class="attr">dx</span>=<span class="string">&quot;30&quot;</span>&gt;</span>C<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>SVG文本</strong></p><p>text 用于定义文本</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;15&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;red&quot;</span>&gt;</span>I love SVG<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>x 表示x轴的起始点</li><li>y 表示y轴的起始点</li><li>transform 动画</li></ul></li></ul><h4 id="SVG-样式设置"><a href="#SVG-样式设置" class="headerlink" title="SVG 样式设置"></a>SVG 样式设置</h4><p>  <strong>Stroke 属性</strong></p><ul><li><p>stroke stroke 属性定义了一条线，文本或元素轮廓颜色</p></li><li><p>stroke-width 属性定义了线 文本或者元素轮廓的厚度</p></li><li><p>stroke-linecap 属性定义了不同类型的开放路径的终结  可选参数  butt,round,square</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">g</span> <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;6&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">stroke-linecap</span>=<span class="string">&quot;butt&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M5 20 l215 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">stroke-linecap</span>=<span class="string">&quot;round&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M5 40 l215 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">stroke-linecap</span>=<span class="string">&quot;square&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M5 60 l215 0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>stroke-dasharray 用于创建虚线 </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">g</span> <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">stroke-dasharray</span>=<span class="string">&quot;5,5&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M5 20 l215 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">stroke-dasharray</span>=<span class="string">&quot;10,10&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M5 40 l215 0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">path</span> <span class="attr">stroke-dasharray</span>=<span class="string">&quot;20,10,5,5,5,10&quot;</span> <span class="attr">d</span>=<span class="string">&quot;M5 60 l215 0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注：stroke-dasharray: [实，虚，实，虚，实，虚，实，虚 ··· ···] --&gt;</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;  SVG意为可缩放矢量图形（Scalable Vector Graphics）&lt;br&gt;  SVG使用XML格式定义图像&lt;/p&gt;
&lt;p&gt;  &lt;strong&gt;如何定义一个SVG图像&lt;/strong&gt;&lt;/p&gt;
  &lt;figure class=&quot;highlight xml&quot;&gt;&lt;t</summary>
      
    
    
    
    
    <category term="svg" scheme="https://lxx1997.github.io/tags/svg/"/>
    
  </entry>
  
  <entry>
    <title>浏览器存储方式学习  cookie, session, localstorage, indexedDB</title>
    <link href="https://lxx1997.github.io/2020/07/22/web/browser-storage-study/"/>
    <id>https://lxx1997.github.io/2020/07/22/web/browser-storage-study/</id>
    <published>2020-07-22T07:27:33.000Z</published>
    <updated>2020-07-22T07:27:33.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="浏览器存储方式"><a href="#浏览器存储方式" class="headerlink" title="浏览器存储方式"></a>浏览器存储方式</h4><ul><li><p>cookie： cookie相当于客户端和服务器之间进行信息交互的一个标识，每次客户端访问服务器的时候都会携带上cookie，这样服务器就可以知道是谁来访问了。</p></li><li><p>Storage: Storage 是专门为浏览器存储提供的数据存储机制，分为localStorage和sessionStorage, 保存的数据以键值对的形式存在，并且以文本格式保存</p></li><li><p>indexedDB: indexedDB是运行在浏览器上的非关系型数据库, 一般来说是没有存储上限的, 不仅可以存储字符串, 还可以存储二进制数据</p></li></ul><h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>  cookie的本职工作并非本地存储,而是维持状态，它是浏览器存储在用户机器上的一个小文本，大小不能超过4K</p><p>  cookie根据过期时间分为两类：会话cookie和持久cookie</p><ul><li><p>会话cookie是一种临时cookie，当用户退出浏览器，会话cookie就会被删除</p></li><li><p>持久cookie则会存储在硬盘中，保存时间更长，浏览器关闭并不会删除cookie，通常持久性cookie会维护某一个用户周期性访问服务器配置文件或者登陆信息</p><p><strong>访问方式</strong></p><p>通过<code>document.cookie</code>来设置或获取cookie的值</p><p>产生Cookie的服务器可以向set-Coolie响应首部添加一个domain属性来控制那些站点可以看到这个cookie</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Set</span>-<span class="title class_">Cookie</span>:name=<span class="string">&quot;losstie&quot;</span>domain=<span class="string">&quot;m.baidu.com&quot;</span></span><br></pre></td></tr></table></figure><p><strong>属性</strong></p></li><li><p>path参数告诉浏览器cokie的路径，默认情况下，cookie属于当前页面</p></li><li><p>secure 设置里secure，cookie只有在https协议加密的情况下才会发送给服务端</p></li><li><p>HttpOnly 禁止javascript操作cookie（避免跨域脚本xss攻击，通过javascript的document.cookie 无法访问带有HttpOnly标记的cookie）</p><p><strong>第三方cookie</strong></p><p>第三方cookie就是cookie的域和地址栏中的域，这种cookie通常悲痛在第三方广告网站，用于跟踪用户的浏览记录，并根据手机的用户浏览习惯，给用户推送相关广告</p><p><strong>劣势</strong></p></li><li><p>cookie 存储信息少，不能超过4K，当cookie超过4KB是，会面临被裁剪的命运</p></li><li><p>每次请求都会携带在http头中，过量的cookie会损耗性能</p></li><li><p>cookie会紧跟域名，同一个域名下的所有请求都会携带cookie</p></li><li><p>不安全，服务器没法分辨用户和攻击者，攻击者可以读取网络上其他用户信息，包含HTTP Cookie的所有内容，以便进行中间攻击，使用跨站点脚本技术可以窃取cookie</p></li></ul><h4 id="Web-Storage"><a href="#Web-Storage" class="headerlink" title="Web Storage"></a>Web Storage</h4><p>  <strong>localStorage</strong></p><p>  localStorage是持久化的本地存储，存储在其中的数据永远不会过期，只能手动删除，遵循同源策略</p><p>  <strong>sessionStorage</strong></p><p>  sessionStorage是临时性的本地存储，会话级别，当页面或者会话结束时，存储内容也随之被释放，遵循同源策略，但是要保证在同一个窗口，否则无法共享内容</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// localStorage</span></span><br><span class="line">保存数据：<span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, value)</span><br><span class="line">读取数据：<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key)</span><br><span class="line">移除数据：<span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(key)</span><br><span class="line">清除所有数据：<span class="variable language_">localStorage</span>.<span class="title function_">clear</span>()</span><br><span class="line">得到某个索引的key：<span class="variable language_">localStorage</span>.<span class="title function_">key</span>(index)</span><br><span class="line"></span><br><span class="line"><span class="comment">// sessionStorage</span></span><br><span class="line">保存数据：sessionStorage.<span class="title function_">setItem</span>(key, value)</span><br><span class="line">读取数据：sessionStorage.<span class="title function_">getItem</span>(key)</span><br><span class="line">移除数据：sessionStorage.<span class="title function_">removeItem</span>(key)</span><br><span class="line">清除所有数据：sessionStorage.<span class="title function_">clear</span>()</span><br><span class="line">得到某个索引的key：sessionStorage.<span class="title function_">key</span>(index)</span><br></pre></td></tr></table></figure><p>  web storage 存储容量大，根据浏览器的不同，存储容量乐意达到5~10M之间 chrome，Firefox，edge都是5M，而且仅位于浏览器端，不与服务端发生通信</p><h4 id="indexedDB"><a href="#indexedDB" class="headerlink" title="indexedDB"></a>indexedDB</h4><p>  indexedDB是一个运行在浏览器上的非关系型数据库，一般来说是没有存储上限的，不仅可以存储字符串，还可以存储二进制数据</p><p>  indexedDB 允许存入大量数据，提供查找接口，还能建立索引，就数据库类型而言，indexedDB 不属于关系型数据库（不支持sql查询语句），更接近NoSQL数据</p><p>  <strong>特点</strong></p><ul><li><p>键值对储存， indexedDB内部采用对象仓库（object store）存放数据</p></li><li><p>异步，indexedDb操作时不会锁死浏览器，用户依然可以进行其他操作</p></li><li><p>支持事务，只要有一步失败，整个事务就都取消，数据库回滚到事务发生之前的状态，不存在之改写一部分数据的情况</p></li><li><p>同源限制，每一个数据库对应创建他的域名，网页只能访问自身域名下的数据库，而不能访问跨域的数据库</p></li><li><p>存储空间大</p></li><li><p>支持二进制存储</p><p><strong>操作</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 建立打开 indexedDB</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">indexedDB</span>.<span class="title function_">open</span>(<span class="string">&#x27;testDB&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭indexedDB </span></span><br><span class="line"></span><br><span class="line">indexdb.<span class="title function_">close</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除indexedDB</span></span><br><span class="line"> </span><br><span class="line"> indexedDB.<span class="title function_">deleteDatabase</span>(indexdb)</span><br></pre></td></tr></table></figure><p><strong>基本概念</strong></p><p>indexedDB是一个比较复杂的API,涉及不少概念，它把不同的实体，抽象成一个个对象接口</p></li><li><p><strong>数据库</strong>  数据库是一系列相关的容器，每个域名（协议+端口+域名）都可以新建任意多个数据库， 同时indexedDB数据库有版本的概念，同一时刻只能有一个版本的数据库存在，如果要修改数据库结构，只能通过升级数据库版本完成</p></li><li><p><strong>对象仓库</strong>  每个数据库包含若干个对象仓库， 类似于关系型数据库的表格</p></li><li><p><strong>数据记录</strong>  对象仓库保存的数据记录，每个记录类似于关系型数据库的行，但是只有逐渐和数据体两部分，主键用来建立默认索引，必须是不同的</p></li><li><p><strong>索引</strong>  为了加速数据的检索，可以在对象仓库里面，为不同的属性建立索引</p></li><li><p><strong>事务</strong>  数据记录的读写和删改都要通过事务完成。事务对象提供<code>error</code>,<code>about</code>和<code>complete</code>三个事件，用来监听操作结果</p><p><strong>操作流程</strong></p></li><li><p>打开数据库</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 打开数据库</span></span><br><span class="line"><span class="keyword">var</span> request = <span class="variable language_">window</span>.<span class="property">indexedDB</span>.<span class="title function_">open</span>(databaseName, version)</span><br><span class="line"><span class="comment">// 改方法接受两个参数，第一个参数是字符串，表示数据库的名字，如果指定的数据不存在，就会创建新的数据库，第二个是整数，表示数据库版本，如果省略，</span></span><br><span class="line"><span class="comment">// indexedDB.open()返回一个IDBRequest对象。这个对象通过三个事件error,success,upgradeneeded 处理数据库的操作结果</span></span><br><span class="line"><span class="comment">// error 事件表示打开数据库失败</span></span><br><span class="line">request.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据库打开失败&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// success 事件表示成功打开的数据</span></span><br><span class="line"><span class="keyword">var</span> db</span><br><span class="line">request.<span class="property">onsuccess</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  db.<span class="property">request</span>.<span class="property">result</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据库打开成功&#x27;</span>)</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// success 事件表示成功打开的数据 此时通过request对象的result属性拿到数据库对象</span></span><br><span class="line"><span class="keyword">var</span> db</span><br><span class="line">request.<span class="property">onsuccess</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  db.<span class="property">request</span>.<span class="property">result</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据库打开成功&#x27;</span>)</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// upgradeneeded 事件如果指定的版本号大于数据的实际版本号，就会发生数据库升级事件 此时通过request对象的result属性拿到数据库对象</span></span><br><span class="line"><span class="keyword">var</span> db;</span><br><span class="line">request.<span class="property">onupgradeneeded</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  db = event.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建数据库</p><p>新建数据库和打开数据库是同一个操作，如果指定的数据库不存在就会创建，后续的操作主要是在<code>upgradeneeded</code>事件的监听函数里面完成，因为这时版本从无到有，所以会触发这个事件</p><p>通常新建数据库之后，第一件事是新建对象仓库（即新建表）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onupgradeneeded</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  db = event.<span class="property">target</span>.<span class="property">result</span></span><br><span class="line">  <span class="keyword">var</span> objectStore = db.<span class="title function_">createObjectStore</span>(<span class="string">&#x27;person&#x27;</span>, &#123;<span class="attr">keyPath</span>: <span class="string">&#x27;id&#x27;</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述代码，数据库新建成功之后，新增一张叫做person的表格，主键是id</p><p>更好的写法是先判断一下这张表格是否存在，如果不存在再新建</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onupgradeneeded</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  db = event.<span class="property">target</span>.<span class="property">result</span></span><br><span class="line">  <span class="keyword">var</span> objectStore;</span><br><span class="line">  <span class="keyword">if</span>(!db.<span class="property">objectStoreNames</span>.<span class="title function_">contains</span>(<span class="string">&#x27;person&#x27;</span>)) &#123;</span><br><span class="line">    objectStore = db.<span class="title function_">createObjectStore</span>(<span class="string">&#x27;person&#x27;</span>, &#123;<span class="attr">keyPath</span>: <span class="string">&#x27;id&#x27;</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果数据记录里面没有适合主键的属性，那么可以让indexedDB自动生成主键</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> objectStore = db.<span class="title function_">createObjectStore</span>(<span class="string">&#x27;person&#x27;</span>, &#123;<span class="attr">autoIncrement</span>: <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure><p>新建对象仓库之后，可以新建索引</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">request.<span class="property">onupgradeneeded</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  db = event.<span class="property">target</span>.<span class="property">result</span></span><br><span class="line">  <span class="keyword">var</span> objectStore = db.<span class="title function_">createObejctStore</span>(<span class="string">&#x27;person&#x27;</span>, &#123;<span class="attr">keyPath</span>: <span class="string">&#x27;id&#x27;</span>&#125;)</span><br><span class="line">  objectStore.<span class="title function_">createIndex</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, &#123;<span class="attr">unique</span>: <span class="literal">false</span>&#125;)</span><br><span class="line">  objectStore.<span class="title function_">createIndex</span>(<span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, &#123;<span class="attr">unique</span>: <span class="literal">false</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>新增数据</p><p>新增数据指的是向对象仓库写入数据记录，这需要通过事务完成</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> request = db.<span class="title function_">transaction</span>([<span class="string">&#x27;person&#x27;</span>], <span class="string">&#x27;readwrite&#x27;</span>)</span><br><span class="line">    .<span class="title function_">objectStore</span>(<span class="string">&#x27;person&#x27;</span>).<span class="title function_">add</span>(&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">24</span>, <span class="attr">email</span>: <span class="string">&#x27;zhangsan@example.com&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">  request.<span class="property">onsuccess</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;数据写入成功&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  request.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;数据写入失败&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">add</span>()</span><br></pre></td></tr></table></figure><p>写入数据需要新建一个事务，新建事务时必须指定表格名称和操作模式(“只读”,”读写”)，新建事务后，通过<code>IDBTransaction.objectStore(name)</code>方法拿到IDBObjectStore对象，在通过表格对象的add()方法，向表格写入一条数据</p><p>写入是一个异步操作，通过监听连接对象的<code>success</code>事件和<code>error</code>事件，了解事件是否写入成功</p></li><li><p>读取数据</p><p>读取数据也是通过事务完成</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">read</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> transaction = db.<span class="title function_">transaction</span>([<span class="string">&#x27;person&#x27;</span>])</span><br><span class="line">  <span class="keyword">var</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">&#x27;person&#x27;</span>)</span><br><span class="line">  <span class="comment">// objectStore.get(1) 参数是主键的值</span></span><br><span class="line">  <span class="keyword">var</span> request  = objectStore.<span class="title function_">get</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  request.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;事务失败&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  request.<span class="property">onsuccess</span> = <span class="keyword">function</span>(<span class="params">event</span>) [</span><br><span class="line">    <span class="keyword">if</span>(request.<span class="property">result</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name:&#x27;</span> + request.<span class="property">result</span>.<span class="property">name</span>)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;age:&#x27;</span> + request.<span class="property">result</span>.<span class="property">age</span>)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;email:&#x27;</span> + request.<span class="property">result</span>.<span class="property">email</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span>  &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;没有获取到数据&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>遍历数据</p><p>遍历数据表格的所有记录，要使用指针对象IDBCursor</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">readAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> objectStore = db.<span class="title function_">transaction</span>(<span class="string">&#x27;person&#x27;</span>).<span class="title function_">objectStore</span>(<span class="string">&#x27;person&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  objectStore.<span class="title function_">openCursor</span>().<span class="property">onsuccess</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> cursor = event.<span class="property">target</span>.<span class="property">result</span></span><br><span class="line">    <span class="keyword">if</span>(cursor) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Id: &#x27;</span> + cursor.<span class="property">key</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Name: &#x27;</span> + cursor.<span class="property">value</span>.<span class="property">name</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Age: &#x27;</span> + cursor.<span class="property">value</span>.<span class="property">age</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Email: &#x27;</span> + cursor.<span class="property">value</span>.<span class="property">email</span>)</span><br><span class="line">      cusor.<span class="title function_">continue</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;没有更多数据了！&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">readAll</span>()</span><br></pre></td></tr></table></figure><p>上述代码中，新建指针对象的openCursor()方法是一个异步操作，所以要监听success时间</p></li><li><p>更新数据</p><p>更新数据用IDBObject.put()方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> request = db.<span class="title function_">transaction</span>([<span class="string">&#x27;person&#x27;</span>], <span class="string">&#x27;readwrite&#x27;</span>)</span><br><span class="line">    .<span class="title function_">objectStore</span>(<span class="string">&#x27;person&#x27;</span>)</span><br><span class="line">    .<span class="title function_">put</span>(&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>， <span class="attr">age</span>: <span class="number">35</span>, <span class="attr">email</span>: <span class="string">&#x27;lisi@example.com&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">  request.<span class="property">onsuccess</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据更新成功&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  request.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据更新失败&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">update</span>()</span><br></pre></td></tr></table></figure></li><li><p>删除数据</p><p>IDBOjectStore.delete()方法用于删除记录</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">remove</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> request = db.<span class="title function_">transaction</span>([<span class="string">&#x27;person&#x27;</span>], <span class="string">&#x27;readwrite&#x27;</span>)</span><br><span class="line">    .<span class="title function_">objectStore</span>(<span class="string">&#x27;person&#x27;</span>)</span><br><span class="line">    .<span class="title function_">delete</span>(<span class="number">1</span>)</span><br><span class="line">  request.<span class="property">onsuccess</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据删除成功&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">remove</span>()</span><br></pre></td></tr></table></figure></li><li><p>使用索引<br>索引的意义在于，可以让你搜索任意字段，也就是说从任意字段拿到数据记录。如果不建立索引，默认只能搜索主键（即从主键取值）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">objectStore.<span class="title function_">createIndex</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, &#123; <span class="attr">unique</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> transaction = db.<span class="title function_">transaction</span>([<span class="string">&#x27;person&#x27;</span>], <span class="string">&#x27;readonly&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> store = transaction.<span class="title function_">objectStore</span>(<span class="string">&#x27;person&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> index = store.<span class="title function_">index</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> request = index.<span class="title function_">get</span>(<span class="string">&#x27;李四&#x27;</span>);</span><br><span class="line"></span><br><span class="line">request.<span class="property">onsuccess</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> result = e.<span class="property">target</span>.<span class="property">result</span>;</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>myself understand</strong></p><ul><li><p>使用 <code>window.indexedDB.open(databaseName, version)</code> 创建数据库的时候如果数据库不存在，会触发 <code>onupgradeneeded</code> 方法</p></li><li><p>如果 创建数据库的时候数据库已存在, 会触发 <code>onsuccess</code>方法</p></li><li><p>在实际应用中，我们应该先触发一次<code>onupgradeneeded</code>来创建数据库和我们所需要的表</p></li><li><p>然后在<code>onsuccess</code>方法中实现自己想要实现的方法</p></li><li><p>表格的增删一般在数据库版本变更的时候操作 即在<code>onupgradeneeded</code>方法中</p></li><li><p>数据的增删查等操作一般在<code>onsuccess</code>方法中实现，此时不能涉及到数据库版本变更，否则会报错</p></li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;浏览器存储方式&quot;&gt;&lt;a href=&quot;#浏览器存储方式&quot; class=&quot;headerlink&quot; title=&quot;浏览器存储方式&quot;&gt;&lt;/a&gt;浏览器存储方式&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;cookie： cookie相当于客户端和服务器之间进行信息交互的一个标识，每次客</summary>
      
    
    
    
    
    <category term="browser" scheme="https://lxx1997.github.io/tags/browser/"/>
    
    <category term="localStorage" scheme="https://lxx1997.github.io/tags/localStorage/"/>
    
    <category term="indexedDB" scheme="https://lxx1997.github.io/tags/indexedDB/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript 学习之路进阶版 - 扩展</title>
    <link href="https://lxx1997.github.io/2020/06/29/web/typescript-study-05/"/>
    <id>https://lxx1997.github.io/2020/06/29/web/typescript-study-05/</id>
    <published>2020-06-29T11:39:30.000Z</published>
    <updated>2020-06-29T11:39:30.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="代码检查"><a href="#代码检查" class="headerlink" title="代码检查"></a>代码检查</h4><p> eslint 能够发现一些tsc不会关心的错误，检查出一些潜在的问题</p><p> <strong>TypeScript中使用Eslint</strong></p><p>  <strong>eslint安装</strong></p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint -S</span><br></pre></td></tr></table></figure><p>  由于ESLint 默认使用<code>Espree</code>进行语法解析，无法识别TypeScript中的一些语法，因此我们需要安装<code>@typescript-eslint/eslint-plugin</code>, 他作为eslint默认规则的补充，提供了一些额外的适用于ts语法的规则</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @typescript-eslint/eslint-plugin</span><br></pre></td></tr></table></figure><p>  <strong>创建配置文件</strong></p><p>  ESLint 需要配置文件来决定对哪些规则进行检查配置文件的名称一般是<code>.eslintrc.js</code>或<code>.eslintrc.json</code></p><p>  当运行ESLint的时候检查一个文件，他会首先尝试读取到文件的目录下的配置文件，然后一级一级往上查找，将所找到的配置合并起来</p><p>  在根目录创建一个<code>.eslintrc.js</code></p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">parser</span>: <span class="string">&#x27;@typesript-eslint/parser&#x27;</span>,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&#x27;@typescript-eslint&#x27;</span>],</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="comment">// 禁止使用var</span></span><br><span class="line">    <span class="string">&#x27;no-var&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="comment">// 优先使用interface 而不是type</span></span><br><span class="line">    <span class="string">&#x27;@typescript-eslint/consistent-type-difinitions&#x27;</span>: [</span><br><span class="line">      <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;interface&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  以上配置中，指定了两个规则，其中<code>no-var</code> 是ESLint原生规则，<code>@typescript-eslint/consistent-type-definitions</code> 是 <code>@typescript-eslint/elsint-plugin</code> 新增的规则</p><p>  规则的取值一般是一个数组，其中一项是 <code>off</code>,<code>warn</code>,<code>error</code>中的一个，表示关闭，警告和报错，后面的项都是该规则的其他配置</p><p>  关闭、警告和报错的含义如下：</p><ul><li>关闭： 禁用此规则</li><li>警告： 代码检查的时候输出错误信息，但是不会影响到exit code</li><li>报错： 发现错误时，不仅会输出错误信息而且exit code 将被设为 1（一般exit code 不为0 则表示执行出现错误）</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;代码检查&quot;&gt;&lt;a href=&quot;#代码检查&quot; class=&quot;headerlink&quot; title=&quot;代码检查&quot;&gt;&lt;/a&gt;代码检查&lt;/h4&gt;&lt;p&gt; eslint 能够发现一些tsc不会关心的错误，检查出一些潜在的问题&lt;/p&gt;
&lt;p&gt; &lt;strong&gt;TypeScript</summary>
      
    
    
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/categories/TypeScript/"/>
    
    
    <category term="ES6" scheme="https://lxx1997.github.io/tags/ES6/"/>
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/tags/TypeScript/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript 学习之路进阶版 - 泛型</title>
    <link href="https://lxx1997.github.io/2020/06/28/web/typescript-study-04/"/>
    <id>https://lxx1997.github.io/2020/06/28/web/typescript-study-04/</id>
    <published>2020-06-28T01:17:07.000Z</published>
    <updated>2020-06-28T01:17:07.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h4><p>  <strong>泛型</strong>是指在定义函数、接口或者类的时候，不预选指定类的具体累心，而是在使用的时候在指定类型的一种特性</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> createArray&lt;T&gt;(<span class="attr">length</span>: number, <span class="attr">value</span>: T): <span class="title class_">Array</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">result</span>: T[] = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">      result[i] = value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">createArray&lt;string&gt;(<span class="number">3</span>, <span class="string">&#x27;x&#x27;</span>); <span class="comment">// [&#x27;x&#x27;, &#x27;x&#x27;, &#x27;x&#x27;]</span></span><br></pre></td></tr></table></figure><p>  我们在函数名后添加了<code>&lt;T&gt;</code>, 其中<code>T</code>用来指代任意输入的类型，在后面的输入和输出都可以使用</p><p>  在调用的时候可以指定他的具体的类型，也可以不指定，而让类型推论自动推算出来</p><p>  <strong>多个类型参数</strong></p><p>  定义泛型的时候,可以一次定义多个类型参数</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> swap&lt;T, U&gt;(<span class="attr">tuple</span>: [T, U]): [U, T] &#123;</span><br><span class="line">    <span class="keyword">return</span> [tuple[<span class="number">1</span>], tuple[<span class="number">0</span>]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">swap</span>([<span class="number">7</span>, <span class="string">&#x27;seven&#x27;</span>]); <span class="comment">// [&#x27;seven&#x27;, 7]</span></span><br></pre></td></tr></table></figure><p>  输入的<code>&lt;T, U&gt;</code>是元组</p><p>  <strong>泛型约束</strong></p><p>  在函数内部使用泛型变量的时候，由于事先不知道它是那种类型的，所以不能随意操作它的属性和方法</p><p>  这时我们可以对泛型进行约束，只允许这个函数传入那些包含<code>length</code>属性的变量</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Lengthwise</span> &#123;</span><br><span class="line">    <span class="attr">length</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> loggingIdentity&lt;T <span class="keyword">extends</span> <span class="title class_">Lengthwise</span>&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  在上面的例子中，我们使用了<code>extends</code>约束了泛型T必须符合接口l的形状，也就是必须包含length属性</p><p>  多个类型参数之间也可以互相约束</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> copyFields&lt;T <span class="keyword">extends</span> U, U&gt;(<span class="attr">target</span>: T, <span class="attr">source</span>: U): T &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> id <span class="keyword">in</span> source) &#123;</span><br><span class="line">        target[id] = (&lt;T&gt;source)[id];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>, <span class="attr">d</span>: <span class="number">4</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">copyFields</span>(x, &#123; <span class="attr">b</span>: <span class="number">10</span>, <span class="attr">d</span>: <span class="number">20</span> &#125;);</span><br></pre></td></tr></table></figure><p>  我们使用了两个类型参数，其中要求T继承于U，这样就保证了U中不会出现T中不存在的字段</p><p>  <strong>泛型接口</strong></p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">CreateArrayFunc</span>&lt;T&gt; &#123;</span><br><span class="line">    (<span class="attr">length</span>: number, <span class="attr">value</span>: T): <span class="title class_">Array</span>&lt;T&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">createArray</span>: <span class="title class_">CreateArrayFunc</span>&lt;any&gt;;</span><br><span class="line">createArray = <span class="keyword">function</span>&lt;T&gt;(<span class="attr">length</span>: number, <span class="attr">value</span>: T): <span class="title class_">Array</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">result</span>: T[] = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        result[i] = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">createArray</span>(<span class="number">3</span>, <span class="string">&#x27;x&#x27;</span>); <span class="comment">// [&#x27;x&#x27;, &#x27;x&#x27;, &#x27;x&#x27;]</span></span><br></pre></td></tr></table></figure><p>  在使用泛型接口的时候，需要定义泛型的类型</p><p>  <strong>泛型类</strong></p><p>  与泛型接口类似，泛型也可以用于类的类型定义</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GenericNumber</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="attr">zeroValue</span>: T;</span><br><span class="line">    <span class="attr">add</span>: <span class="function">(<span class="params">x: T, y: T</span>) =&gt;</span> T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myGenericNumber = <span class="keyword">new</span> <span class="title class_">GenericNumber</span>&lt;number&gt;();</span><br><span class="line">myGenericNumber.<span class="property">zeroValue</span> = <span class="number">0</span>;</span><br><span class="line">myGenericNumber.<span class="property">add</span> = <span class="keyword">function</span>(<span class="params">x, y</span>) &#123; <span class="keyword">return</span> x + y; &#125;;</span><br></pre></td></tr></table></figure><p>  <strong>泛型参数的默认类型</strong></p><p>  我们可以为泛型中的类型参数指定默认类型，从实际值参数中也无法推测出时，这个默认类型就会起作用</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> createArray&lt;T = string&gt;(<span class="attr">length</span>: number, <span class="attr">value</span>: T): <span class="title class_">Array</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">result</span>: T[] = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        result[i] = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="声明合并"><a href="#声明合并" class="headerlink" title="声明合并"></a>声明合并</h4><p>  如果定义了两个相同名字的函数、接口或类，那么它们会合并成一个类型</p><p>  <strong>函数的合并</strong></p><p>  可以使用重载定义多个函数类型</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">reverse</span>(<span class="params">x: number</span>): number</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reverse</span>(<span class="params">y:number</span>): string</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reverse</span>(<span class="params">x: number | string</span>): number | string &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Number</span>(x.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> x === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> x.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <strong>接口的合并</strong></p><p>  接口的属性在合并时会简单的合并到一个接口中</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  <span class="attr">price</span>: number</span><br><span class="line">&#125;</span><br><span class="line">interface <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  <span class="attr">weight</span>: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于</span></span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  price：number;</span><br><span class="line">  <span class="attr">weight</span>: number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  合并的属性的类型必须是唯一的</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  <span class="attr">price</span>: number</span><br><span class="line">&#125;</span><br><span class="line">interface <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  <span class="attr">price</span>: number</span><br><span class="line">  <span class="attr">weight</span>: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于</span></span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  price：number;</span><br><span class="line">  <span class="attr">weight</span>: number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  假如 <code>price</code> 的类型不一致就会报错</p><p>  接口中方法的合并与函数的合并一样</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;泛型&quot;&gt;&lt;a href=&quot;#泛型&quot; class=&quot;headerlink&quot; title=&quot;泛型&quot;&gt;&lt;/a&gt;泛型&lt;/h4&gt;&lt;p&gt;  &lt;strong&gt;泛型&lt;/strong&gt;是指在定义函数、接口或者类的时候，不预选指定类的具体累心，而是在使用的时候在指定类型的一种特性&lt;/</summary>
      
    
    
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/categories/TypeScript/"/>
    
    
    <category term="ES6" scheme="https://lxx1997.github.io/tags/ES6/"/>
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/tags/TypeScript/"/>
    
  </entry>
  
  <entry>
    <title>typescript 学习之路进阶版  -  2</title>
    <link href="https://lxx1997.github.io/2020/06/22/web/typescript-study-03/"/>
    <id>https://lxx1997.github.io/2020/06/22/web/typescript-study-03/</id>
    <published>2020-06-22T08:31:39.000Z</published>
    <updated>2020-06-22T08:31:39.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="类和接口"><a href="#类和接口" class="headerlink" title="类和接口"></a>类和接口</h4><p>  <strong>类实现接口</strong><br>  实现(implements)是面向对象中一个重要概念,一般来讲,一个类只能继承自另一个类,有时候不同类之间可以有一些共有特性,这时候可以把特新提取成接口(interfaces), 用<code>implements</code>关键字来实现,这个特新大大提高了面向对象的灵活性</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(): <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Door</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SecurityDoor</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Door</span> implements <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;securityDoor)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">class Car implements Alarm &#123;</span></span><br><span class="line"><span class="string">  alert() &#123;</span></span><br><span class="line"><span class="string">    console.log(&#x27;</span>car<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>  一个类可以实现多个接口</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(): <span class="keyword">void</span></span><br><span class="line">&#125;</span><br><span class="line">interface <span class="title class_">Light</span> &#123;</span><br><span class="line">  <span class="title function_">lightOn</span>(): <span class="keyword">void</span>;</span><br><span class="line">  <span class="title function_">lightOff</span>(): <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> implements <span class="title class_">Alarm</span>, <span class="title class_">Light</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <strong>接口继承接口</strong></p><p>  接口与接口之间也可以是继承关系,并拥有继承的方法</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Alarm</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(): <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line">interface <span class="title class_">Light</span> <span class="keyword">extends</span> <span class="title class_">Alarm</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <strong>接口继承类</strong></p><p>  常见的面向对象语言中,接口是不能继承类的,但是在TypeScript中是可以的</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="attr">x</span>: number;</span><br><span class="line">    <span class="attr">y</span>: number;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">x: number, y: number</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Point3</span>d <span class="keyword">extends</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="attr">z</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">point3d</span>: <span class="title class_">Point3</span>d = &#123;<span class="attr">x</span>: <span class="number">1</span>, <span class="attr">y</span>: <span class="number">2</span>, <span class="attr">z</span>: <span class="number">3</span>&#125;;</span><br></pre></td></tr></table></figure><p>  当我们在声明 <code>class Point</code> 时,除了会创建一个名为Point的类外,同时也创建了一个名为Point类型(实例的类型)</p><p>  所以我们既可以将Point当作一个类来用</p><p>  也可以将Point当作一个类型来用 (使用:Point表示参数的类型)</p><p>  当我们声明 <code>interface Point3d extends Point</code>的时候,Point3d继承的实际上是类Point的实例的类型,<em>定义了一个接口Point3d继承了另一个接口PointInstaneType</em><br>  <em>声明point类时创建的Point类型是不包含构造函数的,静态属性和静态方法也是不包含的</em></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;类和接口&quot;&gt;&lt;a href=&quot;#类和接口&quot; class=&quot;headerlink&quot; title=&quot;类和接口&quot;&gt;&lt;/a&gt;类和接口&lt;/h4&gt;&lt;p&gt;  &lt;strong&gt;类实现接口&lt;/strong&gt;&lt;br&gt;  实现(implements)是面向对象中一个重要概念,一般来讲,</summary>
      
    
    
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/categories/TypeScript/"/>
    
    
    <category term="ES6" scheme="https://lxx1997.github.io/tags/ES6/"/>
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/tags/TypeScript/"/>
    
  </entry>
  
  <entry>
    <title>Deno 学习</title>
    <link href="https://lxx1997.github.io/2020/06/16/node/learn-Deno/"/>
    <id>https://lxx1997.github.io/2020/06/16/node/learn-Deno/</id>
    <published>2020-06-16T08:25:19.000Z</published>
    <updated>2020-06-16T08:25:19.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>首先我们先谈一下nodeJs的无法忽视的问题</strong></p><ul><li><p>nodeJs对于 ES6的新的语法特性 Promise接口 和async函数 和ES模块 的支持并不理想, NodeJs 必须支持回调函数(callback) 导致异步接口会有promise 和回调函数两种写法,同时NodeJs自己的模块格式 CommonJs和ES模块不兼容</p></li><li><p>nodeJs 的模块管理工具 <code>npm</code> 的逻辑越来越复杂, 模块安装目录极其庞大,难以管理, nodeJs 几乎没有安全措施,用户只要下载了外部模块,就只好任凭别人代码在本地运行,进行各种读写操作</p></li></ul><p><strong>什么是Deno</strong></p><ul><li><p>Deno和nodeJs一样,也是一个服务器运行,但是支持多种语言,可以直接运行在JavaScript,TypeScript和WebAssembly程序</p></li><li><p>并且内置了V8引擎,用来解释JavaScript,同时,也内置了tsc引擎,解释TypeScript,使用Rust语言开发, 由于Rust原生支持WebAssemly, 所以它也能直接运行WebAssemly</p></li><li><p>Rust 提供了许多现成的模块，对Deno项目来说，可以节约很多开发时间</p></li><li><p>Deno 只有一个可执行文件，所有操作都通过这个文件完成，支持跨平台</p></li><li><p>Deno具有安全控制，默认下脚本不具有读写权限，如果脚本未授权就读写文件系统或者网络就会报错，必须使用参数，显示打开权限才可以</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--allow-read：打开读权限，可以指定可读的目录，比如--allow-read=/temp。</span><br><span class="line">--allow-write：打开写权限。</span><br><span class="line">--allow-net=google.<span class="property">com</span>：允许网络通信，可以指定可请求的域，比如--allow-net=google.<span class="property">com</span>。</span><br><span class="line">--allow-env：允许读取环境变量</span><br></pre></td></tr></table></figure><ul><li><p>Deno支持Web Api 尽量保持和浏览器一致，提供了window这个全局对象，同时支持fetch，webCrypto，worker等web标准，同时也支持onload，onunload，addEventListener等时间的操作函数，另外 <strong>Deon的所有异步操作都返回Promise</strong></p></li><li><p>Deno只支持ES模块。和浏览器的模块加载规则一致，没有npm和npm_modules目录，没有require()命令，也不需要package.json<br>所有的模块通过URL加载，比如 <code>import &#123; bar &#125; from &quot;https//foo.com/bar.ts&quot;</code>(绝对URL)或者 <code>import &#123; bar &#125; from &quot;./foo/bar.ts&quot;</code>(相对URL)，因此Deno不需要一个中心化的模块储存系统，可以从任何方式加载模块<br>Deno 下载模块以后，会有一个总的目录，在本地缓存模块，因此可以离线使用</p></li><li><p>Deno 只支持从URL 加载模块，导致nodeJs 的模块加载写法都会失效，Deno的所有模块都要通过入口脚本加载，不能通过模块名加载，所以必须带有脚本后缀名</p></li><li><p>Deno 原生支持TypeScript语言，可以直接运行，不必显示转码<br>他的内部会根据文件名后缀判断，如果是<code>.ts</code>后缀名，就先调用TS编译器，将其编译成JavaScript 如果是.js后缀名，就直接传入V8引擎运行</p></li><li><p>Deno内置了开发中需要的各种功能，不需要外部工具，打包、格式清理、测试、安装、文档生成、liniting、脚本编辑成可执行文件</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">deno bundle：将脚本和依赖打包</span><br><span class="line">deno <span class="built_in">eval</span>：执行代码</span><br><span class="line">deno fetch：将依赖抓取到本地</span><br><span class="line">deno fmt：代码的格式美化</span><br><span class="line">deno help：等同于-h参数</span><br><span class="line">deno info：显示本地的依赖缓存</span><br><span class="line">deno install：将脚本安装为可执行文件</span><br><span class="line">deno repl：进入 <span class="variable constant_">REPL</span> 环境</span><br><span class="line">deno run：运行脚本</span><br><span class="line">deno test：运行测试</span><br></pre></td></tr></table></figure><h4 id="安装Deno"><a href="#安装Deno" class="headerlink" title="安装Deno"></a>安装Deno</h4><p>Shell (Mac, Linux):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL <span class="attr">https</span>:<span class="comment">//deno.land/x/install/install.sh | sh</span></span><br></pre></td></tr></table></figure><p>PowerShell (Windows):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iwr <span class="attr">https</span>:<span class="comment">//deno.land/x/install/install.ps1 -useb | iex</span></span><br></pre></td></tr></table></figure><p>Homebrew (Mac):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install deno</span><br></pre></td></tr></table></figure><p>Chocolatey (Windows):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">choco install deno</span><br></pre></td></tr></table></figure><p>Scoop (Windows):</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scoop install deno</span><br></pre></td></tr></table></figure><p>Build and install from source using Cargo</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo install deno</span><br></pre></td></tr></table></figure><p><strong>查看版本</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deno --version</span><br></pre></td></tr></table></figure><p>命令行直接deno 就会进入 REPL环境</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deno</span><br><span class="line">&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p><strong>运行脚本</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ deno run \</span><br><span class="line"><span class="attr">https</span>:<span class="comment">//deno.land/std/examples/curl.ts \</span></span><br><span class="line"><span class="attr">https</span>:<span class="comment">//example.com</span></span><br></pre></td></tr></table></figure><p>上面的例子中， Deno执行远程脚本curl.ts,用这个脚本去抓取网址example.com,但是会提示没有网络通讯权限，给予Deno网络通信权限，就可以顺利执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ deno run --allow-net \</span><br><span class="line"><span class="attr">https</span>:<span class="comment">//deno.land/std/examples/curl.ts \</span></span><br><span class="line"><span class="attr">https</span>:<span class="comment">//example.com</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;首先我们先谈一下nodeJs的无法忽视的问题&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;nodeJs对于 ES6的新的语法特性 Promise接口 和async函数 和ES模块 的支持并不理想, NodeJs 必须支持回调函数(callback) 导</summary>
      
    
    
    
    <category term="nodejs" scheme="https://lxx1997.github.io/categories/nodejs/"/>
    
    <category term="deno" scheme="https://lxx1997.github.io/categories/deno/"/>
    
    
    <category term="nodejs" scheme="https://lxx1997.github.io/tags/nodejs/"/>
    
    <category term="deno" scheme="https://lxx1997.github.io/tags/deno/"/>
    
  </entry>
  
  <entry>
    <title>typescript 学习之路进阶版</title>
    <link href="https://lxx1997.github.io/2020/06/10/web/typescript-study-02/"/>
    <id>https://lxx1997.github.io/2020/06/10/web/typescript-study-02/</id>
    <published>2020-06-10T02:57:48.000Z</published>
    <updated>2020-06-10T02:57:48.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">Name</span> = string;</span><br><span class="line">type <span class="title class_">NameResolver</span> = <span class="function">() =&gt;</span> string;</span><br><span class="line">type <span class="title class_">NameOrResolver</span> = <span class="title class_">Name</span> | <span class="title class_">NameResolver</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getName</span>(<span class="params">n: NameOrResolver</span>): <span class="title class_">Name</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> n === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">n</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>类型别名为类型创建新名称。类型别名有时类似于接口，但是可以命名原语，并集，元祖和其他必须手动编写的其他类型。</p><p>别名实际上并不会创建新的类型，他会创建一个新名称来引用该类型<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">Container</span>&lt;T&gt; = &#123;<span class="attr">value</span>: T&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以在属性中使用类型别名来引用自身</span></span><br><span class="line">type <span class="title class_">Tree</span>&lt;T&gt; = &#123;</span><br><span class="line">  <span class="attr">value</span>: T;</span><br><span class="line">  <span class="attr">left</span>: <span class="title class_">Tree</span>&lt;T&gt;;</span><br><span class="line">  <span class="attr">right</span>: <span class="title class_">Tree</span>&lt;T&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 与交叉点类型一起使用</span></span><br><span class="line">type <span class="title class_">LinkedList</span>&lt;T&gt; = T &amp; &#123;<span class="attr">next</span>: <span class="title class_">LinkedList</span>&lt;T&gt;&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="attr">people</span>: <span class="title class_">LinkedList</span>&lt;<span class="title class_">Person</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s = people.<span class="property">name</span></span><br><span class="line"><span class="keyword">var</span> s = people.<span class="property">next</span>.<span class="property">name</span></span><br><span class="line"><span class="keyword">var</span> s = people.<span class="property">next</span>.<span class="property">next</span>.<span class="property">name</span></span><br><span class="line"><span class="keyword">var</span> s = people.<span class="property">next</span>.<span class="property">next</span>.<span class="property">next</span>.<span class="property">name</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 但是类型别名不可能出现在声明右侧的任何其他位置</span></span><br></pre></td></tr></table></figure></p><h4 id="字符串字面量类型"><a href="#字符串字面量类型" class="headerlink" title="字符串字面量类型"></a>字符串字面量类型</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">EventNames</span> = <span class="string">&#x27;click&#x27;</span> | <span class="string">&#x27;scroll&#x27;</span> | <span class="string">&#x27;mousemove&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleEvent</span>(<span class="params">ele: Element, event: EventNames</span>) &#123;</span><br><span class="line">  <span class="comment">// do someting</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">handleEvent</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;hello&#x27;</span>), <span class="string">&#x27;scroll&#x27;</span>) <span class="comment">// success</span></span><br><span class="line"><span class="title function_">handleEvent</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;hello&#x27;</span>), <span class="string">&#x27;dblclick&#x27;</span>) <span class="comment">// error</span></span><br></pre></td></tr></table></figure><p>我们使用type定了一个字符串字面量类型<code>EventNames</code>, 它只能取三种字符串中的一种<br>类型别名与字符串字面量类型都是使用<code>type</code>进行定义</p><p>可以使用相同的方式使用字符串文字类型来区分重载<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createElement</span>(<span class="params">tagName: <span class="string">&#x27;img&#x27;</span></span>): <span class="title class_">HTMLImageElement</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElement</span>(<span class="params">tagName: <span class="string">&#x27;input&#x27;</span></span>): <span class="title class_">HTMLIputElement</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElement</span>(<span class="params">tagName: <span class="string">&#x27;string&#x27;</span></span>): <span class="title class_">Element</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h4><p>数组合并了相同类型的对象，而元组(Tuple)合并了不同类型的对象</p><p>eg:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">tom</span>: [string, number] = [<span class="string">&#x27;Tom&#x27;</span>, <span class="number">25</span>]</span><br></pre></td></tr></table></figure><br>当赋值或访问一个已知的索引元素时,会得到正确的类型<br>也可以只赋值其中一项</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">tom</span>: [string, number]</span><br><span class="line">tom[<span class="number">0</span>] = <span class="string">&#x27;Tom&#x27;</span></span><br></pre></td></tr></table></figure><p>如果直接对元组类型的变量进行初始化或者赋值的时候,需要提供所有的元组类型中指定的项</p><p>当添加越界的元素时,它的类型会被限制为元组的每个类型的联合类型</p><h4 id="枚举-Enum"><a href="#枚举-Enum" class="headerlink" title="枚举  Enum"></a>枚举  Enum</h4><p>枚举类型用于取值被限定在一定范围内的场景,比如一周只能有七天,颜色限定为红绿蓝等</p><p>eg:<br>枚举定义 使用<code>enum</code>定义<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">enum <span class="title class_">Days</span> &#123;<span class="title class_">Sun</span>, <span class="title class_">Mon</span>, <span class="title class_">Tue</span>, <span class="title class_">Web</span>, <span class="title class_">Thu</span>, <span class="title class_">Fri</span>, <span class="title class_">Sat</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 枚举成员会被赋值从0开始递增的数字,同时也会对枚举值到枚举名进行反向映射</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Days</span>[<span class="string">&#x27;Sun&#x27;</span>] === <span class="number">0</span>  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Days</span>[<span class="number">0</span>] === <span class="string">&#x27;Sun&#x27;</span>  <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p><p><strong>手动赋值</strong></p><p>我们也可以手动给枚举项赋值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">enum <span class="title class_">Days</span> &#123;<span class="title class_">Sun</span> = <span class="number">7</span>, <span class="title class_">Mon</span> = <span class="number">1</span>, <span class="title class_">Tue</span>, <span class="title class_">Wed</span>, <span class="title class_">Thu</span>, <span class="title class_">Fri</span>, <span class="title class_">Sat</span>&#125;</span><br><span class="line"><span class="comment">// 未手动赋值的枚举项会接着上一个枚举项递增</span></span><br></pre></td></tr></table></figure><p>如果<strong>手动赋值的枚举项</strong>与<strong>自动赋值的枚举项</strong>重复了,并不会报错</p><p>手动赋值的枚举项可以不是数字,但是需要使用类型断言来无视类型检查</p><p><strong>常数项和计算所得项</strong></p><p>枚举有两种类型: 常数项和计算所得项</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enum <span class="title class_">Color</span> &#123;<span class="title class_">Red</span>, <span class="title class_">Green</span>, <span class="title class_">Blue</span> = <span class="string">&#x27;blue&#x27;</span>.<span class="property">length</span>&#125;</span><br></pre></td></tr></table></figure><p>上面 <code>&#39;blue&#39;.length</code>就是一个计算所得项</p><p>如果紧接在计算所得项后面是未手动赋值的项,那么会因为无法获得初始值而报错</p><p><strong>常数枚举</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> enum <span class="title class_">Directions</span> &#123;</span><br><span class="line">  <span class="title class_">Up</span>,</span><br><span class="line">  <span class="title class_">Down</span>,</span><br><span class="line">  <span class="title class_">Left</span>,</span><br><span class="line">  <span class="title class_">Right</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> directions = [<span class="title class_">Directions</span>.<span class="property">Up</span>, <span class="title class_">Directions</span>.<span class="property">Down</span>, <span class="title class_">Direction</span>.<span class="property">Left</span>, <span class="title class_">Direction</span>.<span class="property">Down</span>]</span><br></pre></td></tr></table></figure><p>常数枚举与普通枚举的区别是,它会在编译阶段被删除,并且不能包含计算成员</p><p>上述编译的结果是:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> directions = [<span class="number">0</span> <span class="comment">/* Up */</span> , <span class="number">1</span> <span class="comment">/* Up */</span>, <span class="number">2</span> <span class="comment">/* Up */</span>, <span class="number">3</span> <span class="comment">/* Up */</span>]</span><br></pre></td></tr></table></figure><p><em>如果在定义的时候包含了计算成员,则会在编译阶段报错</em></p><p><strong>外部枚举</strong></p><p>外部枚举 是使用<code>declare enum</code> 定义的枚举类型</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">declare enum <span class="title class_">Directions</span> &#123;</span><br><span class="line">  <span class="title class_">Up</span>,</span><br><span class="line">  <span class="title class_">Down</span>,</span><br><span class="line">  <span class="title class_">Left</span>,</span><br><span class="line">  <span class="title class_">Right</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> directions = [<span class="title class_">Directions</span>.<span class="property">Up</span>, <span class="title class_">Directions</span>.<span class="property">Down</span>, <span class="title class_">Direction</span>.<span class="property">Left</span>, <span class="title class_">Direction</span>.<span class="property">Down</span>]</span><br></pre></td></tr></table></figure><p>同时使用<code>declare</code> 和<code>const</code>也是可以的</p><h4 id="类"><a href="#类" class="headerlink" title="类"></a>类</h4><p><strong>类的概念</strong></p><ul><li><p>类：定义了一件事物的抽象特点，包含他的属性和方法</p></li><li><p>对象：类的实例，通过new生成</p></li><li><p>面对对象（OPP）三大特性： 封装、继承、多态</p></li><li><p>封装（Encapsulation）：将对数据的操作细节隐藏起来，质保楼对外的接口，外界调用端不需要知道细节，就能通过对外提供的接口来访问该对象，同时也保证了外界无法任意更改对象内部的数据</p></li><li><p>继承（Inheritance）：子类继承父类，子类除了拥有父类的所有特性外，还有一些更具体的特性</p></li><li><p>多态（Poluymorphism）：由继承而产生的不同的类，对同一个方法可以有不同的响应，程序会自动判断应该如何执行</p></li><li><p>存取器(getter &amp; setter): 用于改变属性的读取和赋值行为</p></li><li><p>修饰符(Modifiers): 修饰符是一些关键字,用于限定成员或类型的性质,比如<code>public</code>表示共有属性和方法</p></li><li><p>抽象类(Abstract Class): 抽象类是供其他继承的基类,抽象类不允许被实例化,抽象类中的抽象方法必须在子类中被实现</p></li><li><p>接口(interface): 不同类之间巩固偶的属性和方法可以抽象成一个接口,接口可以被类实现,一个类只能继承自另一个类,但是可以实现多个接口</p></li></ul><p><strong>ES6中类的用法</strong></p><p> <strong>属性和方法</strong></p><p> 使用<code>class</code>定义类,使用<code>constructor</code>定义构造函数</p><p> 通过<code>new</code> 生成新实例的时候,会自动带调用构造函数</p><p> <strong>类的继承</strong></p><p> 使用<code>extends</code> 关键字实现继承,子类通过<code>super</code>关键字调用父类的构造函数和方法</p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(name);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">sayHi</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">sayHi</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <strong>存取器</strong></p><p> 使用getter和setter可以改变属性的赋值和读取行为</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">name</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;jack&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title function_">name</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setter:&#x27;</span> + value)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <strong>静态方法</strong></p><p>  使用<code>static</code>修饰符修饰的方法称为静态方法,不需要实例化,而是直接通过类来调用</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">isAnimal</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a <span class="keyword">instanceof</span> <span class="title class_">Animal</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&#x27;Jack)</span></span><br><span class="line"><span class="string">Animal.isAnimal(a)  // true</span></span><br><span class="line"><span class="string">a.isAnimal(a)   // TypeError</span></span><br></pre></td></tr></table></figure><p><strong>ES7中类的用法</strong></p><p>  <strong>实例属性</strong></p><p>  ES6中实例的属性只能通过构造函数中的<code>this.xxx</code>来定义,ES7可以直接在类里面定义</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES7</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  name = <span class="string">&#x27;Jack&#x27;</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// TODO something</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> a = <span class="keyword">new</span> <span class="title class_">Animal</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  <strong>静态属性</strong></p><p>  可以用<code>static</code> 定义一个静态属性</p>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES7</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> name = <span class="string">&#x27;Jack&#x27;</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// TODO something</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="keyword">new</span> <span class="title class_">Animal</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>TypeScript中使用类</strong></p><p>  <strong>public private和protect</strong></p><p>  TypeScript中可以使用三种访问修饰符分别是<code>public</code>,<code>private</code>,<code>protected</code></p><ul><li><code>public</code>修饰的属性或方法是共有的,可以在任何地方被访问,默认所有的属性和方法都是<code>public</code>的</li><li><code>private</code>修饰的属性和方法是私有的,不能在声明它的类的访问’</li><li><p><code>protected</code>修饰的属性和方法是受保护的,它和<code>private</code>类似,区别是在子类中也是允许被访问的</p><p><em>当构造函数<code>constructor</code>修饰为<code>private</code>时,该类不允许被继承或者实例化</em><br><em>当构造函数<code>constructor</code>修饰为<code>protected</code>时, 该类只允许被继承</em></p><p><strong>参数属性</strong></p><p>修饰符和<code>readonly</code>还可以使用构造函数参数中,等同于类中定义该属性的同时给该属性赋值,使代码更简洁</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  public <span class="title function_">construtor</span>(<span class="params">public name</span>) &#123;</span><br><span class="line">    <span class="comment">// 等同于 this.name = name</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>readonly</strong> </p><p>只读属性关键字,只允许出现在属性声明或索引签名或构造函数中<br><em>如果<code>readonly</code>和其他修饰符同时存在的话,需要写在后面</em></p><p><strong>抽象类</strong></p><p><code>abstract</code>用于定义抽象类和其中的抽象方法</p><p>抽象类是不允许被实例化的</p><p>如果定义了一个抽象类,并且定义了一个抽象方法<code>sayHi</code>, 在实例化抽象类的时候报错</p><p>抽象类中的抽象方法必须被子类实现,如果继承了抽象类,却没有实现抽象类中的抽象方法,就是编译报错</p><p>正确使用抽象类</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  public name;</span><br><span class="line">  public <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  public abstract <span class="title function_">sayHi</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">  public <span class="title function_">sayHi</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Meow, My name is <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&#x27;Tom&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>类的类型</strong><br>给类加上TypeScript的类型</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">sayHi</span>(): string &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`My name is <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="title class_">Animal</span> = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&#x27;Jack&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="title function_">sayHi</span>()); <span class="comment">// My name is Jack</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;类型别名&quot;&gt;&lt;a href=&quot;#类型别名&quot; class=&quot;headerlink&quot; title=&quot;类型别名&quot;&gt;&lt;/a&gt;类型别名&lt;/h4&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;</summary>
      
    
    
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/categories/TypeScript/"/>
    
    
    <category term="ES6" scheme="https://lxx1997.github.io/tags/ES6/"/>
    
    <category term="TypeScript" scheme="https://lxx1997.github.io/tags/TypeScript/"/>
    
  </entry>
  
  <entry>
    <title>python学习之路----制作小游戏</title>
    <link href="https://lxx1997.github.io/2020/06/04/use-python-create-game/"/>
    <id>https://lxx1997.github.io/2020/06/04/use-python-create-game/</id>
    <published>2020-06-04T09:38:00.000Z</published>
    <updated>2020-06-04T09:38:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>安装pygame</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pygame</span><br></pre></td></tr></table></figure><p><strong>引入</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="keyword">from</span> pygame.<span class="property">locals</span> <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure><br><strong>初始化</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pygame.<span class="title function_">init</span>()</span><br></pre></td></tr></table></figure></p><p><strong>创建一个窗口</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">screen = pygame.<span class="property">display</span>.<span class="title function_">set_mode</span>([<span class="number">800</span>,<span class="number">600</span>])</span><br><span class="line"><span class="comment">// 生成一个 宽800 高600大小的窗口</span></span><br></pre></td></tr></table></figure><br><strong>使窗口正常工作</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pygame的作用就是为了创建游戏,需要与玩家不断互动,所以需要一个事件一直循环运行,使用while 执行事件循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="title class_">True</span>:</span><br><span class="line"><span class="comment">// 接下来增加事件处理器,pygame包含多种模块,使用paygame.event.get()方法获取所有事件的一个列表,使用for循环迭代处理这个列表中的每一个事件,如果看到quit事件,将while 判断设为false 结束while循环</span></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> pygame.<span class="property">event</span>.<span class="title function_">get</span>():</span><br><span class="line">  <span class="keyword">if</span> event.<span class="property">type</span> == pygame.<span class="property">QUIT</span>:</span><br><span class="line">    mRuning = <span class="title class_">False</span></span><br><span class="line">    pygame.<span class="title function_">quit</span>()</span><br></pre></td></tr></table></figure></p><p><strong>翻转  flip</strong><br>对于pygame窗口显示的内容，screen对象中都会有这些内容的两个副本，可以看做一个当前屏和一个下一屏，当前屏使我们现在看到的，下一屏是完成翻转之后看到的,完成下一屏上的所有修改,再反转到下一屏,就能看到所有的改变,这样,我们对图形多次修改后flip到图形的新版本,而不是每次对图形做小小修改都更新提示,从而让动画更流程,更新速度更快</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">screen.fill([<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>])</span><br><span class="line">pygame.display.flip()</span><br></pre></td></tr></table></figure><p><strong>插入图片  pygame.image</strong></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">imageRect = pygame.image.load(imageUrl)</span><br><span class="line"><span class="comment"># 图片加载完成之后,我们需要将像素从一个地方复制到另一个地方,像素复制在编程中叫做 快移(blitting),帮助我们将一个图像从一个地方复制到另一个地方</span></span><br><span class="line"></span><br><span class="line">screen.blit(imageRect, [<span class="number">0</span>,<span class="number">0</span>])</span><br></pre></td></tr></table></figure><p><strong>音乐播放器</strong></p><p>pygame中有一个处理声音的模块,叫 pygame.mixer (混音器)<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">soundTrack = pygame.mixer.music.load(wavFileName)</span><br><span class="line">pygame.mixer.music.play()</span><br></pre></td></tr></table></figure></p><p><strong>事件处理器</strong></p><p>在上面通过pygame,event.get() 获取到当前事件集</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 退出</span></span><br><span class="line">event.<span class="built_in">type</span> == pygame.QUIT</span><br><span class="line"><span class="comment"># 键盘事件</span></span><br><span class="line">event.<span class="built_in">type</span> == pygame.KEYDOWN <span class="keyword">or</span> pygame.KEYUP</span><br><span class="line">  <span class="comment"># 判断键盘值  eg: d键</span></span><br><span class="line">  event.key == K_d  </span><br><span class="line"><span class="comment"># 鼠标事件  鼠标点击事件</span></span><br><span class="line">event.<span class="built_in">type</span> == pygame.MOUSEBUTTONDOWN</span><br></pre></td></tr></table></figure><h4 id="pygame-模块"><a href="#pygame-模块" class="headerlink" title="pygame  模块"></a>pygame  模块</h4><p>模块名 |  功能<br>pygame.down | 访问光驱<br>pygame.cursors | 加载光标<br>pygame.display | 访问设备显示问题<br>pygame.draw | 绘制形状,线和点<br>pygame.event | 管理事件<br>pygame.font | 使用字体<br>pygame.image | 加载和存储图片<br>pygame.joystick | 使用手柄或类似的东西<br>pygame.key | 读取键盘按键<br>pygame.mixer | 读取声音<br>pygame.mouse | 鼠标<br>pygame.movie | 播放视频<br>pygame.music | 播放音频<br>pygame.overlay | 访问高级视频叠加<br>pygame.rect | 管理矩形区域<br>pygame.sndarray | 操作声音数据<br>pygame.sprite | 操作移动图像<br>pygame.surface | 管理图像和屏幕<br>pygame.time | 管理时间和帧消息<br>pygame.transform | 缩放和移动图像</p><p>有些模块可能在某些平台上不存在,可以用None来测试<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> pygame.transform <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&#x27;The transform module is not available&#x27;</span></span><br><span class="line">  exit()</span><br></pre></td></tr></table></figure></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;安装pygame&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;</summary>
      
    
    
    
    
    <category term="python" scheme="https://lxx1997.github.io/tags/python/"/>
    
    <category term="pygame" scheme="https://lxx1997.github.io/tags/pygame/"/>
    
  </entry>
  
</feed>
